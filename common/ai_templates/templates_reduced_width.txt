armor_MA = {

	blocked_for = { DED }

	role = armor

	upgrade_prio = {
		factor = 3.1
	}

	###match_to_count = 0.5

	light_armor_default_DO = {
	
		enable = {
			has_tech = deep_operations
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = deep_operations
			}			
		}

		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = medium_armor_default_DO
		target_min_match = 0.401

		target_template = {
			
			support = {
				engineer = 1
				light_tank_recon = 1
				artillery = 1
				anti_air = 1
				logistics_company = 1
			}

			regiments = {
				light_armor = 5
				motorized = 6
			}
		}
	}

	medium_armor_default_DO = {
	
		enable = {
			has_tech = deep_operations
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = deep_operations
			}			
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				num_of_military_factories > 60
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				OR = {
					has_tech = main_battle_tank
					has_tech = main_battle_tank_chassis
				}
				num_of_military_factories > 60
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						OR = {
							has_tech = basic_medium_tank
							has_tech = basic_medium_tank_chassis
						}
						num_of_military_factories > 24
					}
				}
			}
		}

		reinforce_prio = 1

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			num_of_military_factories > 60
			has_equipment = { mechanized_equipment > 10 }
		}

		replace_at_match = 1.5
		replace_with = medium_armor_default_2_DO
		target_min_match = 0.5

		target_template = {
			
			support = {
				engineer = 1
				anti_air = 1
				logistics_company = 1
				light_tank_recon = 1
				artillery = 1
			}

			regiments = {
				medium_armor = 10
				motorized = 7
			}
		}
	}

	medium_armor_default_2_DO = {
	
		enable = {
			has_tech = deep_operations
			has_tech = mechanised_infantry
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = deep_operations
			}			
			modifier = {
				factor = 0.01
				NOT = {
					has_tech = mechanised_infantry
					num_of_military_factories > 60
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				OR = {
					has_tech = main_battle_tank
					has_tech = main_battle_tank_chassis
				}
				num_of_military_factories > 60
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						OR = {
							has_tech = basic_medium_tank
							has_tech = basic_medium_tank_chassis
						}
						num_of_military_factories > 29
					}
				}
			}
		}

		reinforce_prio = 1
		
		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			OR = {
				has_tech = main_battle_tank
				has_tech = main_battle_tank_chassis
			}
			num_of_military_factories > 60
			has_equipment = { mechanized_equipment > 10 }
		}

		replace_at_match = 1.5
		replace_with = modern_armor_default_DO_no_RO
		target_min_match = 0.5

		target_template = {
			support = {
				engineer = 1
				light_tank_recon = 1
				logistics_company = 1
				anti_air = 1
				artillery = 1
			}

			regiments = {
				medium_armor = 10
				mechanized = 7
			}
		}
	}

	modern_armor_default_DO_no_RO = {
	
		enable = {
			has_tech = deep_operations
			has_tech = mechanised_infantry
			NOT = { has_tech = red_orchestra }
			OR = {
				has_tech = main_battle_tank
				has_tech = main_battle_tank_chassis
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = deep_operations
				NOT = { has_tech = red_orchestra }
			}			
			modifier = {
				factor = 100
				has_tech = mechanised_infantry
				OR = {
					has_tech = main_battle_tank
					has_tech = main_battle_tank_chassis
				}
				num_of_military_factories > 60
			}
		}

		reinforce_prio = 1

		target_template = {
			
			support = {
				engineer = 1
				light_tank_recon = 1
				logistics_company = 1
				anti_air = 1
				artillery = 1
			}

			regiments = {
				modern_armor = 10
				mechanized = 7
			}
		}
	}
	modern_armor_default_RO_no_DO = {
	
		enable = {
			NOT = { has_tech = deep_operations }
			has_tech = mechanised_infantry
			has_tech = red_orchestra
			OR = {
				has_tech = main_battle_tank
				has_tech = main_battle_tank_chassis
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				NOT = { has_tech = deep_operations }
				has_tech = red_orchestra
			}			
			modifier = {
				factor = 100
				has_tech = mechanised_infantry
				OR = {
					has_tech = main_battle_tank
					has_tech = main_battle_tank_chassis
				}
				num_of_military_factories > 60
			}
		}

		reinforce_prio = 1

		target_template = {
			
			support = {
				engineer = 1
				light_tank_recon = 1
				logistics_company = 1
				anti_air = 1
				artillery = 1
			}

			regiments = {
				modern_armor = 7
				mechanized = 10
			}
		}
	}
	modern_armor_default_DO_and_RO = {
	
		enable = {
			has_tech = deep_operations
			has_tech = mechanised_infantry
			has_tech = red_orchestra
			OR = {
				has_tech = main_battle_tank
				has_tech = main_battle_tank_chassis
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				AND = {
					has_tech = deep_operations
					has_tech = red_orchestra
				}
			}			
			modifier = {
				factor = 100
				has_tech = mechanised_infantry
				OR = {
					has_tech = main_battle_tank
					has_tech = main_battle_tank_chassis
				}
				num_of_military_factories > 60
			}
		}

		reinforce_prio = 1

		target_template = {
			
			support = {
				engineer = 1
				light_tank_recon = 1
				logistics_company = 1
				anti_air = 1
				artillery = 1
			}

			regiments = {
				modern_armor = 10
				mechanized = 10
			}
		}
	}
}

infantry_MA = {
	
	blocked_for = { DED }

	role = infantry
	upgrade_prio = {
		factor = 3.5
	}

	###match_to_count = 0.401


	infantry_default_MA = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
			}			
			modifier = {
				factor = 0.01
				num_of_military_factories > 10
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_2
		target_min_match = 0.401

		can_upgrade_in_field = {
			num_of_military_factories > 9
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		target_template = {
			
			regiments = {
				infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
			}
		}
	}
	infantry_default_MA_2 = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 9
						num_of_military_factories < 20
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5
		replace_with = infantry_default_MA_3
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
			}
		}
	}
	infantry_default_MA_2_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn 
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 9
						num_of_military_factories < 20
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_3_pony
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
				unicorn_company = 1
			}
		}
	}
	infantry_default_MA_2_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 9
						num_of_military_factories < 20
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}		
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_3_changeling
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
				infiltrator_company = 1
			}
		}
	}
	infantry_default_MA_3 = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_4
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_3_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_4_pony
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				unicorn_company = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_3_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = infantry_default_MA_4_changeling
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				infiltrator_company = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_4 = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1

		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_4_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				unicorn_company = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_4_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {

			regiments = {
				infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				infiltrator_company = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
	infantry_default_MA_mechanized_RO = {
	
		enable = {
			has_tech = red_orchestra 
			has_tech = mechanised_infantry
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = red_orchestra 
			}
			modifier = {
				factor = 0.01
				NOT = { has_tech = mechanised_infantry }
				num_of_military_factories < 150
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		target_template = {
			
			regiments = {
				mechanized = 10
				mot_artillery_brigade = 4
				mot_anti_tank_brigade = 1
				mot_anti_air_brigade = 1
			}

			support = {
				engineer = 1
				artillery = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
			}
		}
	}
}

magical_infantry_MA = {

	blocked_for = { DED }

	role = magical_infantry

	upgrade_prio = {
		factor = 3

		modifier = {
			factor = 0
			NOT = { has_tech = magical_weapons }
		}
	}

	####match_to_count = 0.5

	magical_infantry_default_MA = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			NOT = { has_tech = tech_unicorn }
			NOT = { has_tech = tech_infiltrators }
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				num_of_military_factories > 20
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_2
		target_min_match = 0.401

		can_upgrade_in_field = {
			OR = {
				num_of_military_factories > 40
				AND = {
					num_of_military_factories > 30
					manpower_per_military_factory > 4000
				}
				AND = {
					num_of_military_factories > 20
					manpower_per_military_factory > 6000
				}
			}
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_air = 1
				anti_tank = 1
			}
		}
	}
	magical_infantry_default_MA_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_unicorn
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				num_of_military_factories > 20
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_2_pony
		target_min_match = 0.401

		can_upgrade_in_field = {
			OR = {
				num_of_military_factories > 40
				AND = {
					num_of_military_factories > 30
					manpower_per_military_factory > 4000
				}
				AND = {
					num_of_military_factories > 20
					manpower_per_military_factory > 6000
				}
			}
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_air = 1
				anti_tank = 1
				unicorn_company = 1
			}
		}
	}
	magical_infantry_default_MA_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_infiltrators
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				num_of_military_factories > 20
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_2_changeling
		target_min_match = 0.401

		can_upgrade_in_field = {
			OR = {
				num_of_military_factories > 40
				AND = {
					num_of_military_factories > 30
					manpower_per_military_factory > 4000
				}
				AND = {
					num_of_military_factories > 20
					manpower_per_military_factory > 6000
				}
			}
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
			}

			support = {
				engineer = 1
				artillery = 1
				anti_air = 1
				anti_tank = 1
				infiltrator_company = 1
			}
		}
	}
	magical_infantry_default_MA_2 = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			NOT = { has_tech = tech_unicorn }
			NOT = { has_tech = tech_infiltrators }
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_3
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				artillery = 1
			}
		}
	}
	magical_infantry_default_MA_2_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_unicorn
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_3_pony
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				unicorn_company = 1
			}
		}
	}
	magical_infantry_default_MA_2_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_infiltrators
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					AND = {
						num_of_military_factories > 19
						num_of_military_factories < 50
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		replace_with = magical_infantry_default_MA_3_changeling
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 10
				artillery_brigade = 1
				anti_tank_brigade = 1
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				infiltrator_company = 1
			}
		}
	}
	magical_infantry_default_MA_3 = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			NOT = { has_tech = tech_unicorn }
			NOT = { has_tech = tech_infiltrators }
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				NOT = { 
					OR = {
						has_tech = tech_unicorn 
						has_tech = tech_infiltrators
					}
				}
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				artillery = 1
			}
		}
	}
	magical_infantry_default_MA_3_pony = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_unicorn
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_unicorn
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				unicorn_company = 1
			}
		}
	}
	magical_infantry_default_MA_3_changeling = {
	
		enable = {
			OR = {
				has_tech = vast_offensives
				has_tech = human_wave_offensive 
			}
			has_tech = magical_weapons
			has_tech = tech_infiltrators
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				OR = {
					has_tech = vast_offensives
					has_tech = human_wave_offensive 
				}
				has_tech = tech_infiltrators
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = {
					num_of_military_factories > 49
					AND = {
						num_of_military_factories > 30
						manpower_per_military_factory > 4000
					}
					AND = {
						num_of_military_factories > 20
						manpower_per_military_factory > 6000
					}
				}
			}
			modifier = {
				factor = 0.01
				has_tech = mechanised_infantry
				NOT = { num_of_military_factories < 150 }
			}
		}
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		can_upgrade_in_field = {
			has_tech = mechanised_infantry
			has_equipment = { mechanized_equipment > 500 }
			NOT = { num_of_military_factories < 150 }
		}

		target_template = {
			
			regiments = {
				magical_infantry = 15
				artillery_brigade = 1
				anti_tank_brigade = 2
				anti_air_brigade = 1
			}

			support = {
				engineer = 1
				logistics_company = 1
				anti_tank = 1
				anti_air = 1
				infiltrator_company = 1
			}
		}
	}
	magical_infantry_default_mechanized_RO = {
	
		enable = {
			has_tech = red_orchestra
			has_tech = magical_weapons
			has_tech = mechanised_infantry 
		}

		upgrade_prio = {
			base = 0
			modifier = {
				add = 2
				has_tech = red_orchestra
			}
			modifier = {
				factor = 0
				NOT = { has_tech = magical_weapons }
			}
			modifier = {
				factor = 0.01
				NOT = { has_tech = mechanised_infantry }
				num_of_military_factories < 150
			}
		}
		
		reinforce_prio = 1
		
		replace_at_match = 1.5  # value higher than 1.0 means it will only upgrade/replace when upgrade_prio takes over
		target_min_match = 0.401

		target_template = {
			
			regiments = {
				magical_mechanized = 10
				mot_artillery_brigade = 4
				mot_anti_tank_brigade = 1
				mot_anti_air_brigade = 1
			}

			support = {
				engineer = 1
				anti_tank = 1
				anti_air = 1
				logistics_company = 1
				artillery = 1
			}
		}
	}
}