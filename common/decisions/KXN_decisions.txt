KXN_Conquest_Category = {
	KXN_Conquest_Mission_1 = {
		icon = generic_ignite_civil_war
		allowed = { original_tag = KXN }
		activation = { always = no }
		ai_will_do = { factor = 450 }
		selectable_mission = yes ## Needed to enable custom_cost_text
		custom_cost_trigger = { always = yes }
		custom_cost_text = KXN_Conquest_Mission_1_Cost_tt ## Stage Indicator
		days_mission_timeout = KXN_Conquest_Mission_1_Days_Timeout
		
		available = {
			event_target:KXN_Conquest_Target_1 = { ## Enemy country defeated
				OR = {
					exists = no
					is_subject_of = ROOT
					has_capitulated = yes
				}
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision KXN_Conquest_Mission_1"
			custom_effect_tooltip = KXN_Conquest_Mission_1_Effect_tt
			hidden_effect = {
				if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.8 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_9 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.7 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_8 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.6 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_7}
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.5 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_6 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.4 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_5 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.3 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_4 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.2 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_3 }
				}
				else_if = {
					limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.1 } }
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_2 }
				}
				else = {
					add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_1 }
				}
				clr_country_flag = KXN_Conquest_Mission_1_Active ## Frees up mission
				clear_global_event_target = KXN_Conquest_Target_1
				activate_mission = KXN_Conquest_Mission_1 ## Removes the mission from the menu
				remove_mission = KXN_Conquest_Mission_1
			}
		}

		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout KXN_Conquest_Mission_1"
			if = {
				limit = {
					event_target:KXN_Conquest_Target_1 = { ## If prerequisites have been met but player forgot to click
						OR = {
							exists = no
							is_subject_of = ROOT
							has_capitulated = yes
						}
					}
				}
				hidden_effect = {
					if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.8 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_9 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.7 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_8 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.6 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_7}
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.5 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_6 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.4 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_5 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.3 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_4 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.2 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_3 }
					}
					else_if = {
						limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.1 } }
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_2 }
					}
					else = {
						add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_1 }
					}
				}
			}
			else = {
				custom_effect_tooltip = KXN_Conquest_Mission_1_Malus_tt
				hidden_effect = {
					event_target:KXN_Conquest_Target_1 = {
						if = {
							limit = { is_major = yes }
							add_relation_modifier = { target = KXN modifier = KXN_resistance_against_us }
						}
						else = { add_relation_modifier = { target = KXN modifier = KXN_resistance_against_us_minor } }
					}
				}
				if = {
					limit = { NOT = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.3 } } }
					custom_effect_tooltip = KIR_line_break
					custom_effect_tooltip = KXN_Conquest_Mission_1_Effect_tt
					hidden_effect = {
						if = {
							limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.3 } }
							add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_4 }
						}
						else_if = {
							limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.2 } }
							add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_3 }
						}
						else_if = {
							limit = { check_variable = { KXN.KXN_Conquest_Mission_1_Enemy_Casualties > 0.1 } }
							add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_2 }
						}
						else = {
							add_relation_modifier = { target = event_target:KXN_Conquest_Target_1 modifier = KXN_enemy_defeated_1 }
						}
					}
				}
			}
			hidden_effect = {
				clr_country_flag = KXN_Conquest_Mission_1_Active
				clear_global_event_target = KXN_Conquest_Target_1
				activate_mission = KXN_Conquest_Mission_1
				remove_mission = KXN_Conquest_Mission_1
			}
		}

		cancel_trigger = {
			hidden_trigger = {
				event_target:KXN_Conquest_Target_1 = { ## White peace with enemy country
					exists = yes
					NOT = {
						is_subject_of = ROOT
						has_war_with = ROOT
					}
				}
			}
		}
		
		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel KXN_Conquest_Mission_1"
			clr_country_flag = KXN_Conquest_Mission_1_Active
			clear_global_event_target = KXN_Conquest_Target_1
		}
	}
}