
##### ###  ### ##### ### #   #  ###
  #   #   #      #    #  ##  # #   
  #   ##   ##    #    #  # # # #  ##
  #   #      #   #    #  #  ## #   #
  #   ### ###    #   ### #   #  ###
 
NCH_trade_crisis = {
	
	NCH_inevitable_crisis = {

		priority = 10

		icon = generic_ignite_civil_war

		days_mission_timeout = 275

		fire_only_once = yes

		available = {
			OR = { #needs a tooltip, either 7 trade partners or 2 nations rejected
				check_variable = { NCH_trade_partners_iter > 7 }
				check_variable = { gytha_insanity > 1 }
			}
		}

		allowed = {
			original_tag = NCH
		}

		activation = {
			has_country_flag = NCH_start_trading_flag
			NOT = { has_global_flag = NCH_crisis_flag }
		}

		cancel_if_not_visible = yes

		is_good = no

		timeout_effect = {
			country_event = greneclyf_trade.34
		}

		complete_effect = {
			country_event = greneclyf.28
		}
	}
	
	NCH_infiltrate_FBK = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				455 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				455 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				455 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				455 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			455 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 455
			}
		}

		on_map_mode = map_only

		cost = 455.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_our_old_friends }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			455 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_BAK = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				649 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				649 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				649 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				649 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			649 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 649
			}
		}

		on_map_mode = map_only

		cost = 649.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_bakara }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			649 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_DEP = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				544 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				544 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				544 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				544 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			544 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 544
			}
		}

		on_map_mode = map_only

		cost = 544.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_deponya }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			544 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_DMT = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				637 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				637 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				637 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				637 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			637 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 637
			}
		}

		on_map_mode = map_only

		cost = 637.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_diamond_dogs }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			637 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_FRE = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				580 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				580 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				580 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				580 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			580 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 580
			}
		}

		on_map_mode = map_only

		cost = 580.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_ponaidhean }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			580 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_LCT = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				387 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				387 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				387 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				387 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			387 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 387
			}
		}

		on_map_mode = map_only

		cost = 387.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_lake_city }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			387 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_NIM = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				645 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				645 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				645 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				645 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
			custom_trigger_tooltip = {
				tooltip = NCH_increase_spylevel_trigger_tt
				645 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 645
			}
		}

		on_map_mode = map_only

		cost = 645.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_nimbusia }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			645 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_RCT = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				619 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				619 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				619 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				619 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			619 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 619
			}
		}

		on_map_mode = map_only

		cost = 619.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_river_republic }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			619 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}

	NCH_infiltrate_WIT = {

		icon = {
			key = nch_spylevel_none
			trigger = {
				617 = {
					check_variable = { var = NCH_spylevel value = 1 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_weak
			trigger = {
				617 = {
					check_variable = { var = NCH_spylevel value = 2 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_strong
			trigger = {
				617 = {
					check_variable = { var = NCH_spylevel value = 3 compare = equals }
				}
			}
		}
		icon = {
			key = nch_spylevel_total
			trigger = {
				617 = {
					check_variable = { var = NCH_spylevel value = 4 compare = equals }
				}
			}
		}

		available = {
		custom_trigger_tooltip = {
			tooltip = NCH_increase_spylevel_trigger_tt
			617 = { check_variable = { var = NCH_spylevel value = 4 compare = less_than } }
			}
			NOT = {
				has_country_flag = NCH_already_expanding_influence_flag
			}
		}

		highlight_states = { 
			highlight_state_targets = {
				state = 617
			}
		}

		on_map_mode = map_only

		cost = 617.NCH_spylevel_cost?10

		fire_only_once = no

		days_remove = 14

		visible = {
			NOT = { has_global_flag = NCH_crisis_flag }
			has_country_flag = NCH_start_trading_flag
			has_country_flag = NCH_spy_game_flag
			NOT = { has_completed_focus = NCH_trade_wittenland }
		}

		cancel_if_not_visible = yes

		complete_effect = {
			set_country_flag = NCH_already_expanding_influence_flag
		}

		remove_effect = {
			617 = {
				custom_effect_tooltip = NCH_expand_influence_tt
				hidden_effect = {
					if = {
						limit = { check_variable = { NCH_spylevel < 4 } }
						
						add_to_variable = { var = NCH_spylevel value = 1 }
					}
					NCH_spylevel_tooltip = yes
					NCH_spylevel_cost_calculation = yes
				}
			}
			clr_country_flag = NCH_already_expanding_influence_flag
		}

		ai_will_do = {
			base = 110
			modifier = {
				is_historical_focus_on = yes
				factor = 10
			}
		}
	}
}

#NCH_coach_oiren = {
#
#	icon = generic_army_support
#
#	allowed = {
#		original_tag = NCH
#	}
#	available = {
#		has_country_leader = { ruling_only = yes name = "Queen Oiren" }
#	}
#	visible = {
#		has_country_leader = { ruling_only = yes name = "Queen Oiren" }
#	}
#	cost = 0
#	fire_only_once = yes
#	ai_will_do = {
#		factor = 1
#	}
#	complete_effect = {
#		
#		add_war_support = 0.1
#		add_stability = -0.05
#	}
#}

NCH_marriages = {

	NCH_marry_cenhelm_decision = {
		icon = GFX_decision_wedding

		cost = 200
		ai_will_do = {
			factor = 10
		}
		fire_only_once = yes

		visible = {
			has_government = democratic
			NOT = {
				has_country_flag = NCH_having_crisis_flag
			}
			FROM = {
				has_idea = NCH_trading_with_NCH_harmonic
			}
		}
		target_root_trigger = {
			has_government = democratic
		}
		targets = { FBK }
		target_trigger = {
			FROM = { tag = FBK }
		}


		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision NCH_marry_cenhelm_decision target: [From.GetName]"
			add_ideas = NCH_marriage_cenhelm_idea
			diplomatic_relation = {
				country = FROM
				relation = non_aggression_pact
				active = yes
			}
			give_guarantee = FROM
			FROM = {
				give_guarantee = ROOT
			}
		}
	}
}

Remove_NCH_trade_category = {
	Remove_NCH_trade = {
		icon = decision_infiltrate_state

		cost = 50
		ai_will_do = {

			factor = 1

			modifier = {
				has_idea = NCH_trading_with_NCH_harmonic
				factor = 0.01
			}
			modifier = {
				has_idea = NCH_trading_with_NCH_fascist
				factor = 80
			}
		}


		fire_only_once = yes

		visible = {
			is_trading_with_NCH = yes
		}
		target_root_trigger = {
			is_trading_with_NCH = yes
		}
		targets = { NCH }
		target_trigger = {
			FROM = { tag = NCH }
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision Remove_NCH_trade target: [From.GetName]"
			if = {
				limit = {
					has_idea = NCH_trading_with_NCH_harmonic
				}
				remove_ideas = NCH_trading_with_NCH_harmonic
			}

			if = {
				limit = {
					has_idea = NCH_trading_with_NCH_fascist
				}
				remove_ideas = NCH_trading_with_NCH_fascist
			}

			remove_opinion_modifier = {
				modifier = NCH_negative_trading target = FROM
			}
			remove_opinion_modifier = {
				modifier = trading target = FROM
			}

			FROM = {
				country_event = greneclyf.61
				hidden_effect = {
					add_to_variable = {
						var = NCH_trade_partners_iter
						value = -1
					}
					add_to_variable = { var = gytha_insanity value = 1 }
				}
				NCH_get_trading_idea = yes
			}
		}
	}
}

NCH_crisis_category = {
	NCH_crisis = {
		icon = griffon_bandits
		allowed = { tag = NCH }
		fire_only_once = yes
		available = {
			check_variable = {
				var = NCH_Crisis_Resolve_Points
				value = 4
				compare = equals
			}
		}
		activation = {
			has_country_flag = NCH_having_crisis_flag
		}
		is_good = no
		days_mission_timeout = 140
		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout NCH_crisis"
			country_event = greneclyf_crisis.24
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision NCH_crisis"
			country_event = greneclyf_crisis.25
		}
	}
}