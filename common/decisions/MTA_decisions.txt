MTA_artifact_experimentation_category = {
	MTA_artifact_action = {
		icon = GFX_decision_eng_trade_unions_demand

		visible = {
			has_country_flag = MTA_opened_cave_flag
			is_in_array = { ROOT.MTA_owned_artifacts = FROM }
			FROM = {
				NOT = {
					OR = {
						has_state_flag = MTA_sealed_artifact_flag
						state = 2
					}
				}
			}
		}
		available = {
			NOT = { has_country_flag = MTA_recent_artifact_action_flag }
		}
		state_target = yes
		target_array = ROOT.MTA_owned_artifacts
		target_trigger = {
			is_in_array = { ROOT.MTA_owned_artifacts = FROM }
			FROM = {
				NOT = {
					OR = {
						has_state_flag = MTA_sealed_artifact_flag
						state = 2
					}
				}
			}
		}
		target_root_trigger = {
			has_country_flag = MTA_opened_cave_flag
		}
		ai_will_do = {
			factor = 100
		}
		cost = 0

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_artifact_action"
			set_country_flag = { flag = MTA_recent_artifact_action_flag days = 30 value = 1 }
			FROM = { add_to_array = { ROOT.MTA_tested_artifact = THIS } }
			country_event = marcsi.1
		}
	}
}
MTA_artifact_acquisition_category = {
	MTA_artifact_searching_lootbox_roll = {
		icon = generic_magic

		cost = MTA_artifact_searching_lootbox_cost?25
		days_remove = MTA_artifact_searching_lootbox_time?90
		modifier = {
			#research_speed_factor = -0.1
		}
		visible = {
			has_country_flag = MTA_opened_cave_flag
		}

		ai_will_do = {
			factor = 50
		}
		
		complete_effect = {
			log = "[GetDateText] [Root.GetName]: Decision MTA_artifact_searching_lootbox_roll" 
			custom_effect_tooltip = MTA_artifact_searching_lootbox_roll_decision_tt
        }
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_artifact_searching_lootbox_roll"
			custom_effect_tooltip = MTA_artifact_searching_lootbox_roll_remove_tt
			hidden_effect = {
				country_event = marcsi.4
			}
		}
	}
}
MTA_economic_affairs = {
	MTA_magical_manufacturing_decision = {
		icon = generic_construction

		visible = {
            has_completed_focus = MTA_magical_manufactures
        }
		
		available = {
			FROM = {
				has_resources_amount = { 
					resource = crystals 
					amount > 4 
				}
			}
		}
		
		days_remove = 90
		
		state_target = yes
		targets = { 994 995 997 962 }
       
		target_trigger = {
            has_full_control_of_state = FROM
        }

		on_map_mode = map_and_decisions_view

		cancel_trigger = {
			NOT = {
				has_full_control_of_state = FROM
			}
		}

		cost = 0

		ai_will_do = {
			factor = 20
			modifier = {
				factor = 0
				check_variable = { MTA_construction_ai_sanity_check > 5 }
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_magical_manufacturing_decision"
			add_to_variable = { MTA_construction_ai_sanity_check = 1 }
			add_resource = {
				type = crystals
				amount = -5
				state = FROM
			}
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_magical_manufacturing_decision"
			FROM = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
		}
	}
}
MTA_military_affairs = {
	MTA_acquire_guns = { 
		icon = generic_prepare_civil_war

		fire_only_once = no
		days_remove = 90
		
		visible = {
			has_completed_focus = MTA_get_infantry_equipment
		}

		ai_will_do = {
			factor = 50
		}

		cost = 50

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: decision MTA_acquire_guns"
			add_equipment_to_stockpile = {
				type = infantry_equipment
				amount = 1000
				producer = MTA
			}
		}
	}
	MTA_operative_reform_offensive = {
		available = {
			has_war = no
		}

		icon = generic_prepare_civil_war

		cost = 0
		ai_will_do = {
			factor = 100
		}
		days_remove = 50
		visible = {
			has_completed_focus = MTA_form_new_mission_teams
			NOT = { has_country_flag = MTA_finalized_operative_reform }
			NOT = {
				has_decision = MTA_operative_reform_defensive
			}
		}
        fire_only_once = yes
		
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_operative_reform_offensive"
			set_division_template_lock = {
				division_template = "CSI Cave Defense"
				is_locked = no
			}
			custom_effect_tooltip = MTA_operative_reform_offensive_tt
			hidden_effect = {
				if = {
					limit = { has_template = "CSI Cave Defense" }
					delete_unit_template_and_units = { division_template = "CSI Cave Defense" }
				}
				division_template = {
					name = "CSI Cave Defense"
					division_names_group = MTA_MAG_01
					is_locked = no
					regiments = {
						magical_infantry = { x = 0 y = 0 }
						magical_infantry = { x = 0 y = 1 }
						magical_infantry = { x = 0 y = 2 }
						magical_infantry = { x = 0 y = 3 }
						magical_infantry = { x = 1 y = 0 }
						magical_infantry = { x = 1 y = 1 }
						magical_infantry = { x = 1 y = 2 }
						artillery_brigade = { x = 1 y = 3 }
						artillery_brigade = { x = 1 y = 4 }
					}
					support = {
						recon = { x = 0 y = 0 }
						engineer = { x = 0 y = 1 }
						artillery = { x = 0 y = 2 }
					}
				}
				995 = {
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 1000
					producer = MTA
				}
			}
			set_country_flag = MTA_finalized_operative_reform
		}
	}
	MTA_operative_reform_defensive = {
		available = {
			has_war = no
		}

		icon = generic_prepare_civil_war

		cost = 0
		ai_will_do = {
			factor = 100
		}
		days_remove = 50
		visible = {
			has_completed_focus = MTA_form_new_mission_teams
			NOT = { has_country_flag = MTA_finalized_operative_reform }
			NOT = {
				has_decision = MTA_operative_reform_offensive
			}
		}
        fire_only_once = yes
		
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_operative_reform_defensive"
			custom_effect_tooltip = MTA_operative_reform_defensive_tt
			hidden_effect = {
				if = {
					limit = { has_template = "CSI Cave Defense" }
					delete_unit_template_and_units = { division_template = "CSI Cave Defense" }
				}
				division_template = {
					name = "CSI Cave Defense"
					division_names_group = MTA_MAG_01
					is_locked = no
					regiments = {
						magical_infantry = { x = 0 y = 0 }
						magical_infantry = { x = 0 y = 1 }
						magical_infantry = { x = 0 y = 2 }
						magical_infantry = { x = 0 y = 3 }
						magical_infantry = { x = 0 y = 4 }
						magical_infantry = { x = 1 y = 0 }
						magical_infantry = { x = 1 y = 1 }
						magical_infantry = { x = 1 y = 2 }
						magical_infantry = { x = 1 y = 3 }
						magical_infantry = { x = 1 y = 4 }
					}
					support = {
						recon = { x = 0 y = 0 }
						engineer = { x = 0 y = 1 }
						artillery = { x = 0 y = 2 }
					}
				}
				995 = {
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
					create_unit = {
						division = "division_template = \"CSI Cave Defense\" start_equipment_factor = 1 start_experience_factor = 1"
						owner = ROOT
						prioritize_location = 14466
					}
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 1000
					producer = MTA
				}
			}
			set_country_flag = MTA_finalized_operative_reform
		}
	}
	MTA_form_cave_defense_4 = {
		icon = generic_prepare_civil_war
		visible = {
			has_completed_focus = MTA_worldwide_recruitment
		}
		available = {
			hidden_trigger = { has_manpower > 11100 has_political_power > 49 }
		}
		custom_cost_trigger = {
			has_manpower > 11100
			has_political_power > 49
		}
		custom_cost_text = decision_cost_pp_50_manpower_11100
		days_remove = 90
		fire_only_once = yes
		ai_will_do = {
			factor = 20
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_form_cave_defense_4"
			hidden_effect = {
				add_manpower = -11100
				add_political_power = -50
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_form_cave_defense_4"
			custom_effect_tooltip = MTA_raise_new_cave_defense_tp
			hidden_effect = {
				995 = {
					create_unit = {
						division = "name = \"CSI Cold Case Company\" division_template = \"CSI Cave Defense\" start_experience_factor = 1" 
						owner = MTA
					}
				}
			}
		}
	}
	MTA_form_cave_defense_5 = {
		icon = generic_prepare_civil_war
		visible = {
			has_completed_focus = MTA_worldwide_recruitment
		}
		available = {
			hidden_trigger = { has_manpower > 11100 has_political_power > 49 }
		}
		custom_cost_trigger = {
			has_manpower > 11100
			has_political_power > 49
		}
		custom_cost_text = decision_cost_pp_50_manpower_11100
		days_remove = 90
		fire_only_once = yes
		ai_will_do = {
			factor = 20
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_form_cave_defense_5"
			hidden_effect = {
				add_manpower = -11100
				add_political_power = -50
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_form_cave_defense_5"
			custom_effect_tooltip = MTA_raise_new_cave_defense_tp
			hidden_effect = {
				995 = {
					create_unit = {
						division = "name = \"CSI Without a Trace Company\" division_template = \"CSI Cave Defense\" start_experience_factor = 1" 
						owner = MTA
					}
				}
			}
		}
	}
	MTA_form_cave_defense_6 = {
		icon = generic_prepare_civil_war
		visible = {
			has_completed_focus = MTA_worldwide_recruitment
		}
		available = {
			hidden_trigger = { has_manpower > 11100 has_political_power > 49 }
		}
		custom_cost_trigger = {
			has_manpower > 11100
			has_political_power > 49
		}
		custom_cost_text = decision_cost_pp_50_manpower_11100
		days_remove = 90
		fire_only_once = yes
		ai_will_do = {
			factor = 20
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_form_cave_defense_6"
			hidden_effect = {
				add_manpower = -11100
				add_political_power = -50
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_form_cave_defense_6"
			custom_effect_tooltip = MTA_raise_new_cave_defense_tp
			hidden_effect = {
				995 = {
					create_unit = {
						division = "name = \"CSI Two and a Half Ponies Company\" division_template = \"CSI Cave Defense\" start_experience_factor = 1" 
						owner = MTA
					}
				}
			}
		}
	}
}
foreign_politics = {
	MTA_invade_riseia_states = {
		icon = hol_draw_up_staff_plans

		available = {
			is_neighbor_of = FROM
		}

		visible = {
			can_declare_war_on = FROM
		}

		targets = { OSQ HMR YMN REE }
		target_root_trigger = {
			has_completed_focus = MTA_war_plan_ivory_tower
		}
		target_trigger = {
			can_declare_war_on = FROM
		}

		cost = 10
		days_remove = 14
		fire_only_once = yes
		war_with_target_on_remove = yes
		ai_will_do = {
			factor = 200
			modifier = {
				factor = 0.5
				enemies_strength_ratio > 1
			}
			modifier = {
				factor = 0.5
				surrender_progress > 0
			}
			modifier = {
				factor = 0.5
				strength_ratio = { tag = FROM ratio < 0.8 }
			}
			modifier = {
				factor = 0.5
				FROM = {
					is_in_faction = yes
					any_allied_country = {
						strength_ratio = { tag = ROOT ratio > 0.7 }
					}
				}
			}
			modifier = {
				factor = 0
				has_country_flag = imminent_war
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_invade_riseia_states target: [From.GetName]"
			set_country_flag = { flag = imminent_war days = 20 value = 1 }
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = 1000
				}
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_invade_riseia_states target: [From.GetName]"
			FROM = { 
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = -1000
				}
			}
			declare_war_on = {
				target = FROM
				type = annex_everything
			}
		}
	}
}
MTA_advisor_network = {
	MTA_send_advisor = {
		icon = generic_magic

		available = {
			FROM = {
				NOT = {
					has_government = communism
					has_government = fascism
					has_war_with = MTA
				}
			}
		}

		visible = {
			FROM = {
				is_major = yes
				exists = yes
			}
			NOT = {
				has_government = fascism
			}
		}

		target_array = global.majors
		target_root_trigger = {
			has_completed_focus = MTA_advisor_network
		}
		target_trigger = {
            FROM = {
                is_major = yes
                exists = yes
            }
        }


		cost = 40
		days_remove = 30
		fire_only_once = yes
		ai_will_do = {
			factor = 50
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision MTA_send_advisor target: [From.GetName]"
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_send_advisor target: [From.GetName]"
			FROM = {
				country_event = maretania.7
			}
		}
	}
}
MTA_eotc_decisions = {
	MTA_eotc_maintenance = {
		icon = GFX_decision_crystals

		available = {
			hidden_trigger = { always = no }
		}

		visible = {
			has_cosmetic_tag = MTA_eotc
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_eotc_maintenance"
		}
	}
	MTA_eotc_spread_atrophy = {
		icon = GFX_decision_generic_scorched_earth
		
		allowed = {
			original_tag = MTA
		}
		
		visible = { 
			has_cosmetic_tag = MTA_eotc
			FROM = {
				NOT = { has_state_flag = MTA_eotc_atrophied_state }
			}
		}

		target_root_trigger = {
			has_completed_focus = MTA_eotc_focus
			has_cosmetic_tag = MTA_eotc
		}
		
		available = { 
			FROM = {
				is_fully_controlled_by = MTA
			}
		}

		state_target = yes

		target_array = controlled_states

		target_trigger = {
			FROM = {
				NOT = { has_state_flag = MTA_eotc_atrophied_state }
			}
		}
		
		ai_will_do = {
			base = 100
		}
		
		days_remove = 30
		
		modifier = { 
			army_speed_factor = -0.1
		}
		
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_eotc_spread_atrophy"
			FROM = {
				set_state_flag = MTA_eotc_atrophied_state
				add_dynamic_modifier = { modifier = MTA_entropy_state }
				custom_effect_tooltip = MTA_remove_core_eotc_tt
				force_disable_resistance = { clear = yes }
				cancel_resistance = yes
				for_each_loop = {
					array = core_countries
					add_to_temp_array = { cores_to_remove = v }
				}
				for_each_loop = {
					array = cores_to_remove
					remove_core_of = var:v
				}
				set_temp_variable = { from_fact = FROM.building_level@arms_factory }
				add_to_temp_variable = { from_fact = FROM.building_level@industrial_complex }
				add_to_temp_variable = { from_fact = FROM.building_level@dockyard }
				set_temp_variable = { MTA_mana_gain = MTA.from_fact }
				if = {
					limit = {
						ROOT = {
							has_completed_focus = MTA_refine_harvest
						}
					}
					custom_effect_tooltip = MTA_all_factories_converted_to_units_refined_harvest_tt
					multiply_temp_variable = { MTA_mana_gain = 30 }
				}
				else = {
					custom_effect_tooltip = MTA_all_factories_converted_to_units_tt
					multiply_temp_variable = { MTA_mana_gain = 25 }
				}
				add_to_variable = { MTA.MTA_eotc_sparrowber_mana = MTA_mana_gain }
				hidden_effect = {
					if = {
						limit = {
							ROOT = {
								NOT = { has_completed_focus = MTA_40_width }
							}
						}
						create_unit = {
							division = "name = \"Unnamed\" division_template = \"Spectral Infantry\" start_equipment_factor = 1.0 start_experience_factor = 0.3"
							owner = MTA
							count = MTA.from_fact
						}
					}
					else = {
						create_unit = {
							division = "name = \"Unnamed\" division_template = \"Spectral Legion\" start_equipment_factor = 1.0 start_experience_factor = 0.3"
							owner = MTA
							count = MTA.from_fact
						}
					}
					remove_building = { type = arms_factory level = 20 }
					remove_building = { type = industrial_complex level = 20 }
					remove_building = { type = dockyard level = 20 }
				}
			}
		}
	}

	MTA_eotc_reap_the_land = {
		icon = GFX_decision_generic_scorched_earth
		
		allowed = {
			original_tag = MTA
		}
		
		visible = { 
			has_cosmetic_tag = MTA_eotc
			FROM = {
				NOT = { has_state_flag = MTA_eotc_reaped_state }
				has_state_flag = MTA_eotc_atrophied_state
			}
		}

		target_root_trigger = {
			has_completed_focus = MTA_reap_the_land
			has_cosmetic_tag = MTA_eotc
		}
		
		available = { 
			FROM = {
				is_fully_controlled_by = MTA
			}
		}

		state_target = yes

		target_array = controlled_states

		target_trigger = {
			FROM = {
				NOT = { has_state_flag = MTA_eotc_reaped_state }
				has_state_flag = MTA_eotc_atrophied_state
			}
		}
		
		ai_will_do = {
			base = 100
		}
		
		days_remove = 30
		
		modifier = { 
			army_speed_factor = -0.1
		}
		
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove MTA_eotc_reap_the_land"
			FROM = {
				set_state_flag = MTA_eotc_reaped_state 
				custom_effect_tooltip = MTA_all_buildings_converted_to_mana_tt
				set_temp_variable = { from_fact = FROM.building_level@air_base }
				add_to_temp_variable = { from_fact = FROM.building_level@anti_air_building }
				add_to_temp_variable = { from_fact = FROM.building_level@synthetic_refinery }
				add_to_temp_variable = { from_fact = FROM.building_level@fuel_silo }
				add_to_temp_variable = { from_fact = FROM.building_level@radar_station }
				add_to_temp_variable = { from_fact = FROM.building_level@rocket_site }
				add_to_temp_variable = { from_fact = FROM.building_level@nuclear_reactor }
				add_to_temp_variable = { from_fact = FROM.building_level@infrastructure }
				set_temp_variable = { MTA_mana_gain = MTA.from_fact }
				multiply_temp_variable = { MTA_mana_gain = 25 }
				add_to_variable = { MTA.MTA_eotc_sparrowber_mana = MTA_mana_gain }
				hidden_effect = {
					remove_building = { type = arms_factory level = 20 }
					remove_building = { type = industrial_complex level = 20 }
					remove_building = { type = dockyard level = 20 }
				}
			}
		}
	}
}
