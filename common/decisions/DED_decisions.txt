DED_deccat_faction_system = {
	DED_keep_faction_system_deccat_visible = {
		icon = generic_magic
		available = {
			always = no
		}
		visible = {
			always = yes
		}
	}

	#Requisition Thralls
	#
	#Fund Institute Research
	#Fund Stitchers Project
	#
}

DED_deccat_catacomb_system_mages = {
}
DED_deccat_catacomb_system_undeads = {
}



DED_the_thaumaturgia = {
	DED_thaum_test = {
		icon = generic_magic
		available = {
			#has_political_power > var:DED_thaumaturgia_project_price
		}
		visible = {
			always = yes
		}
		#custom_cost_text = <localisation key>

		complete_effect = {
			set_power_balance = {
				id = DED_the_queens_control_bop
				left_side = DED_the_queens_legitimacy_bop_decentralised
				right_side = DED_the_queens_legitimacy_bop_centralised
				#set_default = yes # whether or not to reset the power balance to the initial value, default = no
				set_value = 0.2
			}
		}
	}
	DED_thaum_test_weak = {
		icon = generic_magic
		available = {
			#has_political_power > var:DED_thaumaturgia_project_price
		}
		visible = {
			always = yes
		}
		#custom_cost_text = <localisation key>

		complete_effect = {
			add_power_balance_value= {
				id = DED_the_queens_control_bop
				value = -0.1
			}
		}
	}
	DED_thaum_test_strong = {
		icon = generic_magic
		available = {
			#has_political_power > var:DED_thaumaturgia_project_price
			has_manpower > 50000
		}
		targets = { 420 419 418 417 416 415 }
		is_good = yes
		target_trigger = {
			FROM = {
				is_controlled_by = ROOT
			}
		}
		state_target = yes
		on_map_mode = map_only
		days_remove = 40
		cost = 30
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			add_manpower = 50000
			if = {
				limit = {
					FROM = {
						OR = {
							state = 420
							state = 419
							state = 418
							state = 417
							state = 416
						}
						
					}
				}

				FROM = {
					DED_APN_convert_league = yes
				}
			}
			else_if = {
				limit = {
					FROM = {
						state = 415
					}
				}
				if = {
					limit = {
						415 = {
							has_state_flag = DED_APN_starting_conversion
						}
					}
					415 = {
						if = {
							limit = {
								DED = {has_country_flag = DED_APN_living_factories_flag}
							}       
							DED = {
								add_offsite_building = { type = arms_factory level = 2 }
								hidden_effect = {
						        	add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 2 }
						        	add_offsite_building = { type = arms_factory level = -2 }
						        }
							}
						}
						else = {
							set_building_level = {
							    type = arms_factory
							    level = 2
								instant_build = yes
							}
						}
						set_building_level = {
						    type = industrial_complex
						    level = 0
						}
						add_manpower = -200000
						clr_state_flag = DED_APN_starting_conversion
						set_state_flag = DED_APN_conversion_step_two
						set_variable = {
							DED_APN_conversion_magehold = 0
						}
					}
					add_manpower = 200000
				}
				else_if = {
					limit = {
						415 = {
							has_state_flag = DED_APN_conversion_step_two
						}
					}
					415 = {
						add_to_variable = {
							DED_APN_conversion_magehold = 1
						}
						if = {
							limit = {
								check_variable = {
									DED_APN_conversion_magehold = 4
								}
							}
							clr_state_flag = DED_APN_conversion_step_two
							set_state_flag = DED_APN_conversion_done
						}
						if = {
							limit = {
								DED = {has_country_flag = DED_APN_living_factories_flag}
							}  
							DED = {     
								add_offsite_building = { type = arms_factory level = 1 }
								hidden_effect = {
						        	add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 1 }
						        	add_offsite_building = { type = arms_factory level = -1 }
						        }
					        }
						}
						else = {
							add_building_construction = {
							    type = arms_factory
							    level = 1
								instant_build = yes
							}
						}
						add_manpower = -200000
						
					}
					add_manpower = 200000
				}
			}
		}
	}

	DED_exploit_ressources_league = {
		#icon = GFX_icon_
		visible = {
			has_country_flag = DED_APN_ressources_league
			FROM = {
				is_fully_controlled_by = DED
				check_variable = {infrastructure_level < 5}
			}
		}
		target_root_trigger = {
			has_country_flag = DED_APN_ressources_league
		}
		targets = { 415 }
		available = {
			has_manpower > 50000
		}
		is_good = yes
		state_target = yes
		target_trigger = {
			FROM = {
				is_owned_by = ROOT
			}
		}
		on_map_mode = map_and_decisions_view
		days_remove = 40
		cost = 30
		complete_effect = {
			add_manpower = -30000
		}
		remove_effect = {
			415 = {
				if = {
					limit = {
						check_variable = {infrastructure_level = 4}
					}
					add_building_construction = {
					    type = infrastructure
					    level = 1
					    instant_build = yes
					}
				}
				else = {
					add_building_construction = {
					    type = infrastructure
					    level = 2
					    instant_build = yes
					}
				}
			}
			
			add_resource = {
			    type = steel
			    amount = 8
			    state = 415
			}
			add_resource = {
			    type = crystals
			    amount = 8
			    state = 415
			}
		}
	}


	DED_APN_order_in_region = {
		#icon = GFX_icon_
		target_root_trigger = {
			has_country_flag = DED_APN_converting_dead
		}
		visible = {
			always = yes
		}
		#custom_cost_text = <localisation key>

		complete_effect = {
			add_power_balance_value= {
				id = DED_the_queens_control_bop
				value = 0.1
		available = {
			has_manpower > 50000
		}
		target_array = controlled_states
		fire_only_once = yes
		is_good = yes
		state_target = yes
		on_map_mode = map_only
		days_remove = 30
		cost = 10
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			add_manpower = 40000
			set_state_owner = FROM
		}
	}

	DED_APN_convert_the_living = {
		#icon = GFX_icon_

		target_root_trigger = {
			has_country_flag = DED_APN_converting_dead
		}

		visible = {
			has_country_flag = DED_APN_converting_dead
			owns_state = FROM
			FROM = {
				is_fully_controlled_by = DED
			}
			NOT = {
				FROM = {
					is_core_of = DED
				}
			}
		}

		available = {
			custom_trigger_tooltip = {
				tooltip = DED_APN_can_convert_living
				check_variable = {DEDAPNconvertthelivingcurrent < DEDAPNconvertthelivinglimit}
			}
		}

		target_array = owned_controlled_states

		fire_only_once = yes
		is_good = yes
		state_target = yes
		on_map_mode = map_only

		days_remove = 60
		cost = 20
		complete_effect = {
			add_to_variable = {
				DEDAPNconvertthelivingcurrent = 1
			}
		}
		remove_effect = {
			subtract_from_variable = {
				DEDAPNconvertthelivingcurrent = 1
			}
			add_to_variable = {DED_APN_cored_states = 1}
			FROM = {
				add_core_of = DED
				hidden_effect = {
					DED_APN_core_state = yes
				}
			}
		}
	}

	DED_APN_build_factories = {
		visible = {
			has_country_flag = DED_APN_build_factories
			NOT = {
				has_country_flag = DED_APN_living_flesh
			}
		}

		available = {
			has_manpower > 30000
		}

		days_remove = 120
		cost = 50
		complete_effect = {
			add_manpower = -30000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
				}
				add_manpower = 30000

				if = {
					limit = {
						DED = {has_country_flag = DED_APN_living_factories_flag}
					}       
					DED = {
						add_offsite_building = { type = arms_factory level = 3 }
						hidden_effect = {
				        	add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 3 }
				        	add_offsite_building = { type = arms_factory level = -3 }
				        }
					}
				}
				else = {
					add_building_construction = {
					    type = arms_factory
					    level = 3
						instant_build = yes
					}
					add_extra_state_shared_building_slots = 3
				}
			}
		}
	}

	DED_APN_build_factories_upgraded = {
		visible = {
			has_country_flag = DED_APN_living_flesh
		}

		available = {
			has_manpower > 50000
		}
		days_remove = 80
		cost = 50
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
				}
				add_manpower = 50000
				if = {
					limit = {
						DED = {has_country_flag = DED_APN_living_factories_flag}
					}       
					DED = {
						add_offsite_building = { type = arms_factory level = 5 }
						hidden_effect = {
				        	add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 5 }
				      		add_offsite_building = { type = arms_factory level = -5 }
				        }
					}
				}
				else = {
					add_building_construction = {
					    type = arms_factory
					    level = 5
						instant_build = yes
					}
					add_extra_state_shared_building_slots = 3
				}
			}
		}
	}

	DED_APN_build_dockyards = {
		visible = {
			has_country_flag = DED_APN_boat
		}

		available = {
			has_manpower > 80000
		}
		days_remove = 60
		cost = 50
		complete_effect = {
			add_manpower = -80000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
					is_coastal = yes
				}
				add_manpower = 80000
				add_building_construction = {
				    type = dockyard
				    level = 4
				    instant_build = yes
				}
				add_extra_state_shared_building_slots = 4
			}
		}
	}

	

	DED_APN_expand_infrastructure = {
		visible = {
			has_country_flag = DED_APN_meat_is_a_ressource_flag
		}

		available = {
			has_manpower > 100000
		}
		days_remove = 120
		cost = 50
		complete_effect = {
			add_manpower = -100000
		}
		remove_effect = {
			add_manpower = 90000
			custom_effect_tooltip = DED_APN_expand_infrastructure_tt
			for_each_scope_loop = {
				array = DED.core_states
				if = {
					limit = {
						is_fully_controlled_by = DED
					}
					add_building_construction = {
					    type = infrastructure
					    level = 1
					    instant_build = yes
					}
				}
			}
		}
	}
}