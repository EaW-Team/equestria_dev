
DED_APN_undead_economics = {

	DED_convert_the_league = {
		#icon = GFX_icon_
		visible = {
			tag = DED
			FROM = {
				is_fully_controlled_by = DED
				NOT = {
					has_state_flag = DED_APN_conversion_done
				}
				OR = {
					state = 420
					state = 419
					state = 418
					state = 417
					state = 416
					state = 415
				}
			}

			has_country_flag = DED_APN_flag_convert_to_undead
			
		}
		available = {
			tag = DED
			FROM = {
				is_fully_controlled_by = DED
				NOT = {
					has_state_flag = DED_APN_conversion_done
				}
				OR = {
					state = 420
					state = 419
					state = 418
					state = 417
					state = 416
					state = 415
				}
			}
			has_country_flag = DED_APN_flag_convert_to_undead
			has_manpower > 50000
		}
		is_good = yes
		state_target = yes
		on_map_mode = map_only
		days_remove = 40
		cost = 30
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			add_manpower = 50000
			if = {
				limit = {
					FROM = {
						OR = {
							state = 420
							state = 419
							state = 418
							state = 417
							state = 416
						}
						
					}
				}

				FROM = {
					DED_APN_convert_league = yes
				}
			}
			else_if = {
				limit = {
					FROM = {
						state = 415
					}
				}
				if = {
					limit = {
						415 = {
							has_state_flag = DED_APN_starting_conversion
						}
					}
					415 = {
						if = {
							limit = {
								DED = {has_country_flag = DED_APN_living_factories_flag}
							}       
							DED = {
								add_offsite_building = { type = arms_factory level = 2 }
						        add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 2 }
						        add_offsite_building = { type = arms_factory level = -2 }
							}
						}
						else = {
							set_building_level = {
							    type = arms_factory
							    level = 2
								instant_build = yes
							}
						}
						set_building_level = {
						    type = industrial_complex
						    level = 0
						}
						add_manpower = -200000
						clr_state_flag = DED_APN_starting_conversion
						set_state_flag = DED_APN_conversion_step_two
						set_variable = {
							DED_APN_conversion_magehold = 0
						}
					}
					add_manpower = 200000
				}
				else_if = {
					limit = {
						415 = {
							has_state_flag = DED_APN_conversion_step_two
						}
					}
					415 = {
						add_to_variable = {
							DED_APN_conversion_magehold = 1
						}
						if = {
							limit = {
								check_variable = {
									DED_APN_conversion_magehold = 4
								}
							}
							clr_state_flag = DED_APN_conversion_step_two
							set_state_flag = DED_APN_conversion_done
						}
						if = {
							limit = {
								DED = {has_country_flag = DED_APN_living_factories_flag}
							}  
							DED = {     
								add_offsite_building = { type = arms_factory level = 1 }
						        add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 1 }
						        add_offsite_building = { type = arms_factory level = -1 }
					        }
						}
						else = {
							add_building_construction = {
							    type = arms_factory
							    level = 1
								instant_build = yes
							}
						}
						add_manpower = -200000
						
					}
					add_manpower = 200000
				}
			}
		}
	}

	DED_exploit_ressources_league = {
		#icon = GFX_icon_
		visible = {
			tag = DED
			FROM = {
				is_fully_controlled_by = DED
				state = 415
				check_variable = {infrastructure_level < 10}
			}
			has_country_flag = DED_APN_ressources_league
		}
		available = {
			tag = DED
			FROM = {
				is_fully_controlled_by = DED
				state = 415
				check_variable = {infrastructure_level < 10}
			}
			has_country_flag = DED_APN_ressources_league
			has_manpower > 50000
		}
		is_good = yes
		state_target = yes
		on_map_mode = map_and_decisions_view
		days_remove = 40
		cost = 30
		complete_effect = {
			add_manpower = -30000
		}
		remove_effect = {
			415 = {
				if = {
					limit = {
						check_variable = {infrastructure_level = 7}
					}
					add_building_construction = {
					    type = infrastructure
					    level = 3
					    instant_build = yes
					}
				}
				else = {
					add_building_construction = {
					    type = infrastructure
					    level = 2
					    instant_build = yes
					}
				}
			}
			
			add_resource = {
			    type = steel
			    amount = 4
			    state = 415
			}
			add_resource = {
			    type = crystals
			    amount = 4
			    state = 415
			}
		}
	}


	DED_APN_order_in_region = {
		#icon = GFX_icon_
		visible = {
			tag = DED
			NOT = {
				owns_state = FROM
			}
			FROM = {
				is_fully_controlled_by = DED
				NOT = {
					is_core_of = DED
				}
				any_neighbor_state = {
					is_owned_by = DED
				}
			}
			has_country_flag = DED_APN_converting_dead
			
		}
		available = {
			tag = DED
			NOT = {
				owns_state = FROM
			}
			FROM = {
				is_fully_controlled_by = DED
				NOT = {
					is_core_of = DED
				}
			}
			has_country_flag = DED_APN_converting_dead
			has_manpower > 50000
		}
		fire_only_once = yes
		is_good = yes
		state_target = yes
		on_map_mode = map_only
		days_remove = 30
		#cost = 30
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			add_manpower = 40000
			set_state_owner = FROM
		}
	}

	DED_APN_convert_the_living = {
		#icon = GFX_icon_

		visible = {
			tag = DED
			owns_state = FROM
			FROM = {
				is_fully_controlled_by = DED
			}
			NOT = {
				FROM = {
					is_core_of = DED
				}
			}
			has_country_flag = DED_APN_converting_dead
		}

		available = {
			tag = DED
			owns_state = FROM
			FROM = {
				is_fully_controlled_by = DED
			}
			NOT = {
				FROM = {
					is_core_of = DED
				}
			}
			hidden_trigger = {
				has_country_flag = DED_APN_converting_dead
			}
			custom_trigger_tooltip = {
				tooltip = DED_APN_can_convert_living
				check_variable = {DEDAPNconvertthelivingcurrent < DEDAPNconvertthelivinglimit}
			}
		}

		fire_only_once = yes
		is_good = yes
		state_target = yes
		on_map_mode = map_only

		days_remove = 60
		cost = 20
		complete_effect = {
			add_to_variable = {
				DEDAPNconvertthelivingcurrent = 1
			}
		}
		remove_effect = {
			subtract_from_variable = {
				DEDAPNconvertthelivingcurrent = 1
			}
			add_to_variable = {DED_APN_cored_states = 1}
			FROM = {
				add_core_of = DED
				hidden_effect = {
					DED_APN_core_state = yes
				}
			}
		}
	}

	DED_APN_build_factories = {
		visible = {
			tag = DED
			has_country_flag = DED_APN_build_factories
			NOT = {
				has_country_flag = DED_APN_living_flesh
			}
		}

		available = {
			tag = DED
			has_country_flag = DED_APN_build_factories
			NOT = {
				has_country_flag = DED_APN_living_flesh
			}
			has_manpower > 30000
		}
		days_remove = 120
		cost = 50
		complete_effect = {
			add_manpower = -30000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
				}
				add_manpower = 30000

				if = {
					limit = {
						DED = {has_country_flag = DED_APN_living_factories_flag}
					}       
					DED = {
						add_offsite_building = { type = arms_factory level = 3 }
				        add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 3 }
				        add_offsite_building = { type = arms_factory level = -3 }
					}
				}
				else = {
					add_building_construction = {
					    type = arms_factory
					    level = 3
						instant_build = yes
					}
					add_extra_state_shared_building_slots = 3
				}
			}
		}
	}

	DED_APN_build_factories_upgraded = {
		visible = {
			tag = DED
			has_country_flag = DED_APN_living_flesh
		}

		available = {
			tag = DED
			has_country_flag = DED_APN_living_flesh
			has_manpower > 50000
		}
		days_remove = 80
		cost = 50
		complete_effect = {
			add_manpower = -50000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
				}
				add_manpower = 50000
				if = {
					limit = {
						DED = {has_country_flag = DED_APN_living_factories_flag}
					}       
					DED = {
						add_offsite_building = { type = arms_factory level = 5 }
				        add_to_variable = { var = DED_APN_factory_donations_test_modifier_m value = 5 }
				        add_offsite_building = { type = arms_factory level = -5 }
					}
				}
				else = {
					add_building_construction = {
					    type = arms_factory
					    level = 5
						instant_build = yes
					}
					add_extra_state_shared_building_slots = 3
				}
			}
		}
	}

	DED_APN_build_dockyards = {
		visible = {
			tag = DED
			has_country_flag = DED_APN_boat
		}

		available = {
			tag = DED
			has_country_flag = DED_APN_boat
			has_manpower > 80000
		}
		days_remove = 60
		cost = 50
		complete_effect = {
			add_manpower = -80000
		}
		remove_effect = {
			random_owned_state = {
				limit = {
					is_fully_controlled_by = DED
					is_core_of = DED
					is_coastal = yes
				}
				add_manpower = 80000
				add_building_construction = {
				    type = dockyard
				    level = 4
				    instant_build = yes
				}
				add_extra_state_shared_building_slots = 4
			}
		}
	}

	

	DED_APN_expand_infrastructure = {
		visible = {
			tag = DED
			has_country_flag = DED_APN_meat_is_a_ressource_flag
		}

		available = {
			tag = DED
			has_country_flag = DED_APN_meat_is_a_ressource_flag
			has_manpower > 100000
		}
		days_remove = 120
		cost = 50
		complete_effect = {
			add_manpower = -100000
		}
		remove_effect = {
			add_manpower = 90000
			for_each_scope_loop = {
				array = DED.core_states
				if = {
					limit = {
						is_fully_controlled_by = DED
						is_core_of = DED
						check_variable = {infrastructure_level < 9}
					}
					add_building_construction = {
					    type = infrastructure
					    level = 1
					    instant_build = yes
					}
				}
			}
		}
	}
}

DED_APN_war_plans = {
	DED_Infiltation_NTR = {
	icon = generic_magic
		available = {

		}
		visible = {
		NTR = {
		exists = yes
		}
			has_completed_focus = DED_something_that_keeps_the_frost_away
			NOT = {
				owns_state = 562
			}
		}
		cost = 20
		fire_only_once = yes
		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove LSP_stop_that_pigeon"
			NTR = {
				country_event = { id = dedaprilfool.210 days = 1 }
			}
		}
	}
	
	DED_Infiltation_SRS = {
		icon = generic_magic
		available = {

		}
		visible = {
		SRS = {
		exists = yes
		}
			has_completed_focus = DED_something_that_keeps_the_frost_away
			NOT = {
				owns_state = 522
			}
		}
		cost = 20
		fire_only_once = yes
		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove LSP_stop_that_pigeon"
			SRS = {
				country_event = { id = dedaprilfool.211 days = 1 }
			}
		}
	}
	
	DED_Infiltation_WAT = {
		icon = generic_magic
		available = {

		}
		visible = {
		WAT = {
		exists = yes
		}
			has_completed_focus = DED_poison_in_water
			NOT = {
				owns_state = 642
			}
		}
		cost = 20
		fire_only_once = yes
		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove LSP_stop_that_pigeon"
			WAT = {
				country_event = { id = dedaprilfool.213 days = 1 }
			}
		}
	}
	
	DED_Infiltation_FBK = {
		icon = generic_magic
		available = {

		}
		visible = {
		FBK = {
		exists = yes
		}
			has_completed_focus = DED_poison_in_water
			NOT = {
				owns_state = 455
			}
		}
		cost = 20
		fire_only_once = yes
		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove LSP_stop_that_pigeon"
			FBK = {
				country_event = { id = dedaprilfool.214 days = 1 }
			}
		}
	}
	
	DED_Infiltation_FIR = {
		icon = generic_magic
		available = {

		}
		visible = {
		FIR = {
		exists = yes
		}
			has_completed_focus = DED_poison_in_water
			NOT = {
				owns_state = 454
			}
		}
		cost = 20
		fire_only_once = yes
		ai_will_do = {
			base = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove LSP_stop_that_pigeon"
			FIR = {
				country_event = { id = dedaprilfool.215 days = 1 }
			}
		}
	}
}
