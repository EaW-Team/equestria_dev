north_zebrican_war = {
	northern_war_peace_timer = {
		icon = eng_trade_unions_support
		available = {
			hidden_trigger = {
				always = no
			}
		}
		allowed = {
			OR = {
				NZW_is_north_zebrican_tag = yes
				original_tag = WNG
			}
		}
		activation = {
			is_subject = no
			has_country_flag = NZW_war_participant
			has_global_flag = NZW_in_progress
			has_global_flag = NZW_war_status_partial
			NZW_no_mainland_control_for_HIP = yes # Can be called from any scope

			OR = { # Only once, except for all human players
				is_ai = no # If human player, show here
				if = { # If not human player, pick Chiropterra over Colthage (never Wingbardy)
					limit = {
						NZ2 = {
							has_country_flag = NZW_war_participant
						}
					}
					AND = {
						tag = NZ2
						is_ai = yes
					}
				}
				else = {
					AND = {
						tag = NZ1
						is_ai = yes
					}
				}
			}
		}
		cancel_trigger = {
			OR = {
				has_global_flag = NZW_war_status_total
				NZW_no_mainland_control_for_HIP = no
				hidden_trigger = {
			  		ROOT = {
						NOT = {
					  		has_country_flag = NZW_war_participant
						}
					}
				}
			}
		}
		cancel_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision cancel northern_war_peace_timer"
			hidden_effect = {
				if = {
					limit = {
						has_global_flag = NZW_encircled_HIP
					}
					clr_global_flag = NZW_encircled_HIP
				}
				if = {
					limit = {
						has_country_flag = NZW_war_participant
					}
					clr_global_flag = NZW_first_north_war_peacer_time_active
				}
			}
		}
		is_good = yes
		days_mission_timeout = 180
#		complete_effect = { # TODO: Figure out where to put this code
#			log = "[GetDateText]: [Root.GetName]: Decision complete northern_war_peace_timer"
#
#			# Correct mission length
#			if = {
#				limit = {
#					has_global_flag = NZW_first_north_war_peacer_time_active
#				}
#				set_temp_variable = { # Current date
#					days_to_remove = global.num_days
#				}
#				subtract_from_temp_variable = { # Date peace timer got activated
#					days_to_remove = global.NZW_peace_timer_activated
#				}
#				add_days_mission_timeout = {
#					mission = northern_war_peace_timer
#					days = days_to_remove
#				}
#			}
#			else = {
##			set_global_flag = NZW_first_north_war_peacer_time_active
#				set_variable = {
#					global.NZW_peace_timer_activated = global.num_days
#				}
#			}
#		}
		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout northern_war_peace_timer"
			
			NZW_show_projected_peacedeal = yes
			
			HIP = {
				country_event = north_war.1
			}
		}
	}
	
	set_stance_total_war = {
		ai_will_do = {
			factor = 0
		}
		available = {
			if = {
				limit = {
					is_in_faction = yes
				}
				is_faction_leader = yes
			}
			is_subject = no
			custom_trigger_tooltip = {
				tooltip = northern_zebrica_180_days_tp
				NOT = {
					has_country_flag = recently_changed_stance
				}
			}
		}
		allowed = {
			NZW_is_north_zebrican_tag = yes
			NOT = { original_tag = HIP }
		}
		visible = {
			has_country_flag = NZW_war_participant
			OR = { # Major participant
				tag = NZ1
				tag = NZ2
				original_tag = WNG
			}
			has_war_with = HIP
			has_global_flag = NZW_in_progress
			has_global_flag = NZW_war_status_partial
		}
		
		icon = hol_war_on_pacifism
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision set_stance_total_war"
			hidden_effect = {
				clr_global_flag = NZW_war_status_partial
				set_global_flag = NZW_war_status_total
				
				set_country_flag = {
					flag = recently_changed_stance
					days = 180
					value = 1
				}
			}
		}
	}
	
	set_stance_partial_war = {
		ai_will_do = {
			factor = 100
		}
		available = {
			if = {
				limit = {
					is_in_faction = yes
				}
				is_faction_leader = yes
			}
			is_subject = no
			custom_trigger_tooltip = {
				tooltip = northern_zebrica_180_days_tp
				NOT = {
					has_country_flag = recently_changed_stance
				}
			}
		}
		allowed = {
			NZW_is_north_zebrican_tag = yes
			NOT = { original_tag = HIP }
		}
		visible = {
			has_country_flag = NZW_war_participant
			OR = { # Major participant
				tag = NZ1
				tag = NZ2
				original_tag = WNG
			}
			has_war_with = HIP
			has_global_flag = NZW_in_progress
			has_global_flag = NZW_war_status_total
			NOT = { has_global_flag = NZW_war_status_partial_blocked }
		}
		
		icon = hol_war_on_pacifism
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision set_stance_partial_war"
			hidden_effect = {
				clr_global_flag = NZW_war_status_total
				set_global_flag = NZW_war_status_partial
				
				set_country_flag = {
					flag = recently_changed_stance
					days = 180
					value = 1
				}
			}
		}
	}
	
	WNG_join_the_war = {
		icon = generic_intelligence_operation
		allowed = {
		    original_tag = WNG
		}
		available = {
			is_subject = no
		}
		visible = {
		    has_government = fascism
			
			has_global_flag = NZW_in_progress
		    OR = {
		        NZ1 = {
					has_war_with = HIP
				}
				NZ2 = {
					has_war_with = HIP
				}
			}
			HIP = {
				exists = yes
				NOT = {
					is_in_faction_with = ROOT 
				}
				NOT = {
					is_subject_of = ROOT 
				}
				NOT = { 
				    has_war_with = ROOT 
				}
			}
			NOT = {
				NZ1 = {
					tag = HIE # Never help Star Father in his crimes against Avians
				}
			}
			NOT = {
			    has_country_flag = BAT_HIP_defeated
			}
			NOT = {
			    has_global_flag = BAT_won_civil_war
			}
		}
		cancel_trigger = {
			OR = {
				is_subject = yes
				HIP = {
					OR = {
						exists = no
						is_subject_of = ROOT 
						has_war_with = ROOT
					}
				}
				NOT = { has_global_flag = NZW_in_progress }
			}
		}
		
		cost = 50
		fire_only_once = yes
		
		days_remove = 7
		war_with_on_remove = HIP
		
		ai_will_do = {
			factor = 200
			modifier = {
				factor = 0.25
				has_war = yes
			}
			modifier = {
				factor = 0
				surrender_progress > 0.20
			}
		}
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision WNG_join_the_war target: [From.GetName]"
			HIP = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = 1000
                }
            }
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove WNG_join_the_war target: [From.GetName]"
			HIP = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = -1000
                }
            }
			hidden_effect = {
				HIP = {
					country_event = {
						id = hippogriff.65
						hours = 7
					}
				}
			}
			declare_war_on = {
                target = HIP
                type = annex_everything
            }
			set_country_flag = NZW_war_participant
		}
	}
	
	# If the regions in question got snatched by somebody else
	north_war_edge_case_white_peace = {
		icon = eng_trade_unions_support
		allowed = {
			NZW_is_north_zebrican_tag = yes
		}
		visible = {
			OR = {
				tag = NZ1
				tag = NZ2
				tag = WNG
			}
			NOT = {
				OR = {
					697 = {
						owner = {
							OR = {
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
							}
						}
					}
					698 = {
						owner = {
							OR = {
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
							}
						}
					}
					710 = {
						owner = {
							OR = {
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
							}
						}
					}
					711 = {
						owner = {
							OR = {
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
							}
						}
					}
					688 = {
			            controller = {
				            OR = { 
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
				            }
			            }
		            }
					743 = {
			            controller = {
				            OR = { 
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
				            }
			            }
		            }
					744 = {
			            controller = {
				            OR = { 
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
				            }
			            }
		            }
					1206 = {
			            controller = {
				            OR = { 
								tag = HIP
								is_subject_of = HIP
								has_war_with = ROOT
								is_in_faction_with = HIP
				            }
			            }
		            }
				}
			}
			has_global_flag = NZW_war_status_partial
			has_country_flag = NZW_war_participant
		}
		fire_only_once = yes
		available = {
			has_global_flag = NZW_war_status_partial
			if = { # If any human player is part of the NZW, abandoning the NZW is only available to said human player
				limit = {
					any_country = {
						has_country_flag = NZW_war_participant
						OR = {
							tag = NZ1
							tag = NZ2
							tag = WNG
						}
						is_ai = no
					}
				}
				is_ai = no
			}

			custom_trigger_tooltip = {
				tooltip = nzw_white_peace_tt
				NOT = {
					OR = {
						697 = {
							owner = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						698 = {
							owner = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						710 = {
							owner = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						711 = {
							owner = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						688 = {
							controller = {
								OR = { 
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						743 = {
							controller = {
								OR = { 
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						744 = {
							controller = {
								OR = { 
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
						1206 = {
							controller = {
								OR = { 
									tag = HIP
									is_subject_of = HIP
									has_war_with = ROOT
									is_in_faction_with = HIP
								}
							}
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = nzw_white_peace_2_tt
				NOT = {
					any_owned_state = {
						is_core_of = ROOT
						is_controlled_by = HIP
					}
				}
			}
		}
		cost = 0
		ai_will_do = {
			factor = 100
			modifier = {
				HIP = {
					any_enemy_country = {
						is_ai = no
						has_country_flag = NZW_war_participant
					}
				}
				factor = 0
			}
		}
		complete_effect = {
			NZW_make_peace_with_HIP = yes
			NZW_on_end_effect = yes

			hidden_effect = {
				HIP = {
					if = {
						limit = {
							NOT = {
								has_country_flag = HIP_gave_ZUM_willing
							}
						}
						country_event = {
							id = hippogriff.1002
							days = 2
						}
						clr_country_flag = NZW_war_participant
						set_country_flag = HIP_third_party_defeat
					}
					else = {
						clr_country_flag = NZW_war_participant
						set_country_flag = HIP_averted_nzw
					}
				}
			}
		}
	}

	#HIP can peace WNG by defeating allies
	#This is active during the NZW (if Wingbardy joined)
	HIP_white_peace_WNG = {
		icon = griffon_claw
		allowed = {
			original_tag = HIP
		}
		days_mission_timeout = 365
		visible = {
			WNG = {
				has_country_flag = NZW_war_participant
				has_war_with = ROOT
			}
		}
		activation = {
			WNG = {
				has_country_flag = NZW_war_participant
				has_war_with = ROOT
			}
		}
		available = {
			if = {
				limit = {
					NZ1 = {
						has_country_flag = NZW_war_participant
					}
				}
				NZ1 = {
					OR = {
						exists = no
						is_subject = yes
						has_capitulated = yes
						has_war = no
					}
				}
			}
			if = {
				limit = {
					NZ2 = {
						has_country_flag = NZW_war_participant
					}
				}
				NZ2 = {
					OR = {
						exists = no
						is_subject = yes
						has_capitulated = yes
						has_war = no
					}
				}
			}
			WNG = {
				has_war_with = ROOT
			}
		}
		cancel_trigger = {
			WNG = {
				NOT = {
					has_war_with = HIP
				}
			}
		}
		complete_effect = {
			country_event = hippogriff.64 # HIP gets option to sign peace with WNG
		}
		timeout_effect = {
			if = {
				limit = {
					NOT = {
						has_country_flag = HIP_WNG_year_one_of_war
					}
				}
				country_event = north_war.34
			}
			else_if = {
				limit = {
					NOT = {
						has_country_flag = HIP_WNG_year_two_of_war
					}
				}
				country_event = north_war.35
			}
			else = {
				country_event = north_war.36
			}
			WNG = {
				if = {
					limit = {
						NOT = {
							has_country_flag = HIP_WNG_year_one_of_war
						}
					}
					country_event = north_war.34
				}
				else_if = {
					limit = {
						NOT = {
							has_country_flag = HIP_WNG_year_two_of_war
						}
					}
					country_event = north_war.35
				}
				else = {
					country_event = north_war.36
				}
			}
		}
	}
	HIP_enforce_WNG_concessions = {#HIP enforcing concessions on WNG after defeating allies
		icon = griffon_claw
		cost = 0
		allowed = {
			original_tag = HIP
		}
		ai_will_do = {
			factor = 200
		}
		visible = {
			WNG = {
				has_country_flag = NZW_war_participant
				has_war_with = ROOT
			}
			HIP = {
				has_country_flag = HIP_dismantling_WNG
			}
		}
		available = {
			NZ1 = {
				OR = {
					exists = no
					is_subject = yes
					has_capitulated = yes
					has_war = no
				}
			}
			NZ2 = {
				OR = {
					exists = no
					is_subject = yes
					has_capitulated = yes
					has_war = no
				}
			}
			NOT = {
				784 = {
					is_controlled_by = WNG
				}
				1200 = {
					is_controlled_by = WNG
				}
				OR = {
					AND = {
						ABY = {
							is_in_faction_with = WNG
						}
						775 = {
							is_controlled_by = ABY
						}
					}
					775 = {
						is_controlled_by = WNG
					}
				}
				OR = {
					AND = {
						ABY = {
							is_in_faction_with = WNG
						}
						780 = {
							is_controlled_by = ABY
						}
					}
					780 = {
						is_controlled_by = WNG
					}
				}
			}
		}
		complete_effect = {
			custom_effect_tooltip = HIP_enforce_demands_tt
			hidden_effect = {
				country_event = north_war.31
			}
			clr_country_flag = HIP_dismantling_WNG
		}
	}
	HIP_WNG_war_countdown = {#Timer to conquer WNG territory
		icon = GFX_decision_generic_army_support

		days_mission_timeout = 120
		
		visible = {
			has_country_flag = HIP_dismantling_WNG
			has_war_with = WNG
		}

		activation = {
			has_war_with = WNG
			has_country_flag = HIP_dismantling_WNG
		}

		available = {
			NOT = {
				has_war_with = WNG
			}
		}

		is_good = no

		timeout_effect = {
			hidden_effect = {
				clr_country_flag = HIP_dismantling_WNG
				country_event = north_war.30 # White peace with WNG (and NZW end)
			}
			custom_effect_tooltip = HIP_WNG_timeout_tt
			add_war_support = -0.05
			add_political_power = -50
		}
		complete_effect = {
		}
	}
	
	HIP_spawn_militias = {
		icon = GFX_decision_generic_army_support
		allowed = {original_tag = HIP}
		visible = {
			has_country_flag = NZW_war_participant
			any_owned_state = {
				is_in_home_area = yes
				is_core_of = HIP
				CONTROLLER = {
					has_country_flag = NZW_war_participant
					has_war_with = HIP
				}
			}
		}
		available = {
			has_manpower > 90000
		}
		ai_will_do = {factor = 200}
		fire_only_once = yes

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision HIP_spawn_militias"
			add_war_support = -0.10
			add_manpower = -84000
			add_equipment_to_stockpile = { 
				type = infantry_equipment 
				amount = -5000 
				producer = HIP 
			}
			set_country_flag = HIP_desperation
			load_oob = "HIP_nzw_militias"
			custom_effect_tooltip = HIP_militias_tooltip	
		}
	}
	
	BAT_CTH_encircle_HIP = {
		icon = eng_trade_unions_support
		allowed = {
			OR = {
				NZW_is_north_zebrican_tag = yes
				original_tag = WNG
			}
		}
		visible = {
			has_active_mission = northern_war_peace_timer 
			NOT = {
				has_global_flag = NZW_encircled_HIP
			}
		}
		available = {
			# Island states around HIP
			693 = {
				NOT = {
					is_controlled_by = HIP
				}
			}
			694 = {
				NOT = {
					is_controlled_by = HIP
				}
			}
			687 = {
				NOT = {
					is_controlled_by = HIP
				}
			}
			696 = {
				NOT = {
					is_controlled_by = HIP
				}
			}
			695 = {
				NOT = {
					is_controlled_by = HIP
				}
			}
			hidden_trigger = { # Either the human or NZ1 (Colthage) will get the mission, if they are not at war as fallback Chiroperra
				OR = {
					ROOT = {
						tag = NZ1
						is_ai = no
					}
					ROOT = {
						tag = NZ2
						is_ai = no
					}
					ROOT = {
						tag = WNG
						is_ai = no
					}
					AND = {
						ROOT = {
							tag = NZ1
						}
						NZ2 = {
							NOT = {
								has_war_with = HIP
							}
						}
						WNG = {
							OR = {
								is_ai = yes
								NOT = {
									has_war_with = HIP
								}
							}
						}
					}
					AND = {
						ROOT = {
							tag = NZ2
						}
						NZ1 = {
							OR = {
								is_ai = yes
								NOT = {
									has_war_with = HIP
								}
							}
						}
						WNG = {
							OR = {
								is_ai = yes
								NOT = {
									has_war_with = HIP
								}
							}
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 100
		}
		complete_effect = {
			set_global_flag = NZW_encircled_HIP
			every_country = {
				limit = {
					has_active_mission = northern_war_peace_timer
				}
				add_days_mission_timeout = {
					mission = northern_war_peace_timer
					days = -60
				}
			}
		}
	}
}

political_actions = { # Keep that restrained to CTH/BAT/WNG for now
	HIP_form_the_government_of_national_unity = {
		icon = GFX_decision_gre_investment_decisions
		allowed = {
			OR = {
				original_tag = CTH
				original_tag = BAT
				original_tag = WNG
			}
		}
		visible = {
			OR = {
				HIP = {
					AND = {
						is_subject_of = ROOT
						owns_state = 1165
					}
				}
				owns_state = 1165
			}
			OR = {
				NOT = {tag = BAT}
				CTH = {
					AND = {
						is_in_faction_with = BAT
						is_subject = no
					}
				}
			}
		}
		ai_will_do ={
			factor = 100
		}
		cost = 0
		fire_only_once = yes
		complete_effect = {
			1199 = {
				remove_core_of = HIP
			}
			694 = {
				remove_core_of = HIP
			}
			687 = {
				remove_core_of = HIP
			}
			every_state = {
				limit = {
					OR = {
						is_core_of = ZUM
						is_core_of = WAR
					}
				}
				remove_core_of = HIP
			}
			if = {
				limit = {
					HIP = {
						exists = no
					}
				}
				release_autonomy = {
					target = HIP
					autonomy_state = autonomy_satellite
					freedom_level = 0.5
				}
			}
			else_if = {
				limit = {
					HIP = {
						is_subject_of = ROOT
					}
				}
				set_autonomy = {
					target = HIP
					autonomy_state = autonomy_satellite
					freedom_level = 0.5
				}
			}
			country_event = north_war.8
		}
	}
}