# Contain the scripted gui for the quest diary

@TOP_BAR_PROGRESS_BAR_STEP = 20

@ADVENTURE_LOG_CONTENT_TITLE_OFFSET_Y = 25

scripted_gui = {
	VED_quest_diary_top_bar_scripted_gui = {
		window_name = VED_quest_diary_button_top_bar_gui
		parent_window_token = top_bar
		context_type = player_context
		dirty = VED_top_bar_quest_diary_gui_update

		visible = {
			original_tag = VED
		}

		effects = {
			diary_button_click = {
				# Placeholder effect for now
				if = {
					limit = { has_country_flag = VED_top_bar_quest_diary_glow }
					clr_country_flag = VED_top_bar_quest_diary_glow
				} else = {
					set_country_flag = VED_top_bar_quest_diary_glow
				}

				if = {
					limit = {
						check_variable = {
							VED_top_bar_quest_diary_progress < @TOP_BAR_PROGRESS_BAR_STEP
						}
					}
					add_to_variable = { VED_top_bar_quest_diary_progress = 1 }
				} else = {
					set_variable = { VED_top_bar_quest_diary_progress = 1 }
				}

				set_temp_variable = { i_diary_category = 0 }
				f_VED_open_diary = yes
			}

			diary_button_right_click = {
				# Debug
				if = {
					limit = { check_variable = { VED_quest_diary_content_array^num > 0 } }

					if = {
						limit = { check_variable = { VED_quest_diary_content_array^0 = 3 } }
						set_variable = { VED_quest_diary_content_array^0 = 0 }
					} else = {
						add_to_variable = { VED_quest_diary_content_array^0 = 1 }
					}
				} else = {
					add_to_array = { VED_quest_diary_content_array = 0 }
				}
				f_VED_refresh_diary_gui = yes
			}
		}

		triggers = {
			diary_glow_visible = {
				has_country_flag = VED_top_bar_quest_diary_glow
			}
			diary_progress_bar_visible = {
				has_variable = VED_top_bar_quest_diary_progress
			}
		}

		properties = {
			diary_progress_bar = {
				frame = VED_top_bar_quest_diary_progress
			}
		}
	}

	VED_quest_diary_scripted_gui = {
		window_name = VED_quest_diary_main_gui
		context_type = player_context
		dirty = VED_quest_diary_gui_update

		visible = {
			has_country_flag = VED_display_quest_diary
		}

		effects = {
			close_button_click = {
				clr_country_flag = VED_display_quest_diary
				add_to_variable = { VED_quest_diary_gui_update = 1 }
			}
		}
	}

	VED_quest_diary_sub_scripted_gui = {
		window_name = VED_quest_diary_sub_gui
		parent_window_name = VED_quest_diary_main_gui
		context_type = player_context
		dirty = VED_quest_diary_gui_update

		dynamic_lists = {
			# Bookmark management
			left_bookmark_gridbox = {
				array = VED_quest_diary_left_bookmark_array
				value = VED_quest_diary_left_bookmark_value
				index = VED_quest_diary_left_bookmark_index
				entry_container = "VED_quest_diary_left_bookmark_gui"
				change_scope = no
			}
			right_bookmark_gridbox = {
				array = VED_quest_diary_right_bookmark_array
				value = VED_quest_diary_right_bookmark_value
				index = VED_quest_diary_right_bookmark_index
				entry_container = "VED_quest_diary_right_bookmark_gui"
				change_scope = no
			}
			
			# Content of the diary
			diary_content_gridbox = {
				array = VED_quest_diary_content_array
				value = VED_quest_diary_content_value
				index = VED_quest_diary_content_index
				entry_container = "VED_quest_diary_content_gui_[?VED_quest_diary_content_value]"
				change_scope = no
			}

			# Tab 3 : Adventure log
			tab_3_left_log_gridbox = {
				array = VED_quest_diary_tab_3_left_log_array
				value = VED_quest_diary_tab_3_left_log_value
				index = VED_quest_diary_tab_3_left_log_index
				entry_container = "VED_quest_diary_tab_3_left_log_entry"
				change_scope = no
			}
			tab_3_right_log_gridbox = {
				array = VED_quest_diary_tab_3_right_log_array
				value = VED_quest_diary_tab_3_right_log_value
				index = VED_quest_diary_tab_3_right_log_index
				entry_container = "VED_quest_diary_tab_3_right_log_entry"
				change_scope = no
			}
		}

		visible = {
			always = yes # Visibility controlled by the parent window
		}

		triggers = {
			right_bookmark_visible = {
				# Display the bookmark
				if = {
					check_variable = {
						var =   VED_quest_diary_right_bookmark_index
						value = VED_quest_diary_content_array^0
						compare = greater_than_or_equals
					}
				}

				# Compute the frame
				set_temp_variable = { frame_right_bookmark = 1 }
				add_to_temp_variable = { frame_right_bookmark = VED_quest_diary_right_bookmark_index }
			}

			left_bookmark_visible = {
				# Display the bookmark
				if = {
					check_variable = {
						var =   VED_quest_diary_left_bookmark_index
						value = VED_quest_diary_content_array^0
						compare = less_than
					}
				}

				# Compute the frame
				set_temp_variable = { frame_left_bookmark = 1 }
				add_to_temp_variable = { frame_left_bookmark = VED_quest_diary_left_bookmark_index }
			}

			# Advetnure Log

			# Left
			tab_3_left_log_entry_title_visible = {
				set_temp_variable = {
					t_title_pos_y = VED_quest_diary_tab_3_left_log_offsets_array^VED_quest_diary_tab_3_left_log_index
				}
				set_temp_variable = { t_entry_date = VED_quest_diary_tab_3_left_log_date_array^VED_quest_diary_tab_3_left_log_index }
				set_temp_variable = { t_entry_location = VED_quest_diary_tab_3_left_log_location_array^VED_quest_diary_tab_3_left_log_index }
			}
			tab_3_left_log_entry_content_visible = {
				set_temp_variable = { t_entry_content = VED_quest_diary_tab_3_left_log_value }
				set_temp_variable = {
					t_content_pos_y = VED_quest_diary_tab_3_left_log_offsets_array^VED_quest_diary_tab_3_left_log_index
				}
				add_to_temp_variable = { t_content_pos_y = @ADVENTURE_LOG_CONTENT_TITLE_OFFSET_Y }
			}
			# Right
			tab_3_right_log_entry_title_visible = {
				set_temp_variable = {
					t_title_pos_y = VED_quest_diary_tab_3_right_log_offsets_array^VED_quest_diary_tab_3_right_log_index
				}
				set_temp_variable = { t_entry_date = VED_quest_diary_tab_3_right_log_date_array^VED_quest_diary_tab_3_right_log_index }
				set_temp_variable = { t_entry_location = VED_quest_diary_tab_3_right_log_location_array^VED_quest_diary_tab_3_right_log_index }
			}
			tab_3_right_log_entry_content_visible = {
				set_temp_variable = { t_entry_content = VED_quest_diary_tab_3_right_log_value }
				set_temp_variable = {
					t_content_pos_y = VED_quest_diary_tab_3_right_log_offsets_array^VED_quest_diary_tab_3_right_log_index
				}
				add_to_temp_variable = { t_content_pos_y = @ADVENTURE_LOG_CONTENT_TITLE_OFFSET_Y }
			}
			tab_3_left_turn_page_visible = {
				check_variable = { VED_quest_diary_tab_3_current_page > 1 }
			}
			tab_3_right_turn_page_visible = {
				set_temp_variable = { t_page = VED_quest_diary_tab_3_current_page }
				add_to_temp_variable = { t_page = 2 }
				check_variable = { t_page < VED_quest_diary_adventure_log_page_index^num }
			}
		}

		properties = {
			left_bookmark = {
				frame = frame_left_bookmark
			}

			right_bookmark = {
				frame = frame_right_bookmark
			}

			tab_3_left_log_entry_title = {
				x = 0
				y = t_title_pos_y
			}
			tab_3_left_log_entry_content = {
				x = 0
				y = t_content_pos_y
			}
			tab_3_right_log_entry_title = {
				x = 0
				y = t_title_pos_y
			}
			tab_3_right_log_entry_content = {
				x = 0
				y = t_content_pos_y
			}
		}

		effects = {
			left_bookmark_click = {
				set_variable = { VED_quest_diary_content_array^0 = VED_quest_diary_left_bookmark_index }
				f_VED_refresh_diary_gui = yes
			}

			right_bookmark_click = {
				set_variable = { VED_quest_diary_content_array^0 = VED_quest_diary_right_bookmark_index }
				f_VED_refresh_diary_gui = yes
			}

			# Adventure log
			tab_3_left_turn_page_click = {
				add_to_variable = { VED_quest_diary_tab_3_current_page = -2 }
				set_temp_variable = { i_page_nb = VED_quest_diary_tab_3_current_page }
				f_VED_refresh_adventure_log_display = yes
				f_VED_refresh_diary_gui = yes
			}
			tab_3_right_turn_page_click = {
				add_to_variable = { VED_quest_diary_tab_3_current_page = 2 }
				set_temp_variable = { i_page_nb = VED_quest_diary_tab_3_current_page }
				f_VED_refresh_adventure_log_display = yes
				f_VED_refresh_diary_gui = yes
			}
		}
	}
}