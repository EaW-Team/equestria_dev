# Contain the scripted gui for the quest diary

@TOP_BAR_PROGRESS_BAR_STEP = 20

scripted_gui = {
	VED_quest_diary_top_bar_scripted_gui = {
		window_name = VED_quest_diary_button_top_bar_gui
		parent_window_token = top_bar
		context_type = player_context
		dirty = VED_top_bar_quest_diary_gui_update

		visible = {
			original_tag = VED
		}

		effects = {
			diary_button_click = {
				set_country_flag = VED_display_quest_diary
				# Placeholder effect for now
				if = {
					limit = { has_country_flag = VED_top_bar_quest_diary_glow }
					clr_country_flag = VED_top_bar_quest_diary_glow
				} else = {
					set_country_flag = VED_top_bar_quest_diary_glow
				}

				if = {
					limit = {
						check_variable = {
							VED_top_bar_quest_diary_progress < @TOP_BAR_PROGRESS_BAR_STEP
						}
					}
					add_to_variable = { VED_top_bar_quest_diary_progress = 1 }
				} else = {
					set_variable = { VED_top_bar_quest_diary_progress = 1 }
				}

				add_to_variable = { VED_top_bar_quest_diary_gui_update = 1 }
			}
		}

		triggers = {
			diary_glow_visible = {
				has_country_flag = VED_top_bar_quest_diary_glow
			}
			diary_progress_bar_visible = {
				has_variable = VED_top_bar_quest_diary_progress
			}
		}

		properties = {
			diary_progress_bar = {
				frame = VED_top_bar_quest_diary_progress
			}
		}
	}

	VED_quest_diary_scripted_gui = {
		window_name = VED_quest_diary_main_gui
		context_type = player_context
		dirty = VED_quest_diary_gui_update

		visible = {
			has_country_flag = VED_display_quest_diary
		}

		effects = {
			close_button_click = {
				clr_country_flag = VED_display_quest_diary
				add_to_variable = { VED_quest_diary_gui_update = 1 }
			}
		}
	}

	VED_quest_diary_sub_scripted_gui = {
		window_name = VED_quest_diary_sub_gui
		parent_window_name = VED_quest_diary_main_gui
		context_type = player_context
		dirty = VED_quest_diary_gui_update

		visible = {
			always = yes # Visibility controlled by the parent window
		}
	}
}