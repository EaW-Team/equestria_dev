scripted_gui = {
	KXN_Nirik_Kirin_Toggle_SGUI = {
		context_type = player_context
		parent_window_name = "countrypoliticsview"

		visible = {
			ROOT = {
				tag = KXN
			}
		}

		window_name = "KXN_Nirik_Kirin_Toggle_Window"

		triggers = {
			KXNKirNirUsesCounter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
			}
			KXN_Nirik_Glow_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Pulsar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Counter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Counter_Progress_Bar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Kirin_Button_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var < 1 }
			}
			KXN_Kirin_Counter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Counter_Progress_Bar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Icon_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Icon_click_enabled = {
				always = no ## Grey-out
			}
		}

		properties = {
			KXN_Kirin_Counter_Progress_Bar = {
				frame = KXN.KXN_Kirin_Countdown_Prog_Var
			}
			KXN_Nirik_Counter_Progress_Bar = {
				frame = KXN.KXN_Nirik_Counter_Prog_Var
			}
			KXNHarvestProgBar = {
				frame = KXN.KXNHarvestProgBar_Var
			}
			KXNHarvestCasualties = {
				frame = 0
			}
		}

		effects = {
			KXN_Kirin_Button_click = {
				set_variable = { var = KXN_Nirik_Counter_Var value = KXN_Nirik_Counter_Days }
				set_variable = { var = KXN_Kirin_Countdown_Var value = KXN_Kirin_Countdown_Days }
				set_variable = { KXN_Nirik_Counter_Prog_Var = 100 }
			}
		}
	}
	
	KXN_City_Fall_SGUI = {
		context_type = state_mapicon
		window_name = "KXN_City_Fall_Window"

		visible = { ROOT = { tag = KXN } }
		dirty = KXN.KXN_City_Fall_Var
		mapicon_targets = { target_array = KXN.City_Fall_Target_Array }

		effects = {
			KXN_CF_OCCUPY_BUTTON_click = {
				THIS = {
					KXN_OCCUPY_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_PILLAGE_BUTTON_click = {
				THIS = {
					KXN_PILLAGE_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_BURN_BUTTON_click = {
				THIS = {
					KXN_BURN_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_TOGGLE_BUTTON_click = {
				THIS = {
					set_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_TOGGLE_BACK_BUTTON_click = {
				THIS = {
					clr_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
		}

		triggers = {
			KXN_CF_TOGGLE_BACK_BUTTON_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
			}
			background_fade_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
			}
			KXN_CF_OCCUPY_BUTTON_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
			}
			KXN_CF_PILLAGE_BUTTON_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
			}
			KXN_CF_BURN_BUTTON_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
			}
		}
	}
}