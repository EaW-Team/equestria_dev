scripted_gui = {
	KXN_Overexpansion_Alert_SGUI = {
		context_type = player_context
		parent_window_name = "countrypoliticsview"

		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
				has_country_flag = KXN_Overexpansion_Alert_Flag
				has_dynamic_modifier = { modifier = KXN_Nirik_Militarchy }
			}
		}

		window_name = "KXN_Overexpansion_Alert_SGUI_Window"
		
		effects = {
			KXN_Overexpansion_Alert_Button_click = {
				clr_country_flag = KXN_Overexpansion_Alert_Flag
			}
		}
	}
	KXN_Saurider_Alert_SGUI = {
		context_type = player_context
		parent_window_name = "countrypoliticsview"

		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
				has_country_flag = KXN_Saurider_Alert_Flag
				NOT = { has_country_flag = KXN_Saurider_Alert_Timer }
				has_dynamic_modifier = { modifier = KXN_Lan_Kir_Banners }
			}
		}

		window_name = "KXN_Saurider_Alert_SGUI_Window"
		
		effects = {
			KXN_Saurider_Alert_Button_click = {
				clr_country_flag = KXN_Saurider_Alert_Flag
				set_country_flag = { flag = KXN_Saurider_Alert_Timer days = 30 value = 1 }
			}
		}
	}
	
	KXN_Nirik_Kirin_Toggle_Handle_SGUI = {
		context_type = player_context
		parent_window_name = "countrypoliticsview"

		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
			}
		}

		window_name = "KXN_Nirik_Kirin_Toggle_Handle"
		
		effects = {
			KXN_Kirin_Toggle_Handle_click = {
				if = {
					limit = {
						has_country_flag = KXN_Nirik_Kirin_Toggle_Open
					}
					clr_country_flag = KXN_Nirik_Kirin_Toggle_Open
				}
				else = {
					set_country_flag = KXN_Nirik_Kirin_Toggle_Open
				}
			}
		}

		triggers = {
			KXNHarvestBackground_visible = {
				has_country_flag = KXN_Nirik_Kirin_Toggle_Open
			}
			KXN_Kirin_Toggle_Close_visible = {
				has_country_flag = KXN_Nirik_Kirin_Toggle_Open
			}
			KXN_Kirin_Toggle_Open_visible = {
				NOT = { has_country_flag = KXN_Nirik_Kirin_Toggle_Open }
			}
		}
	}
	
	KXN_Nirik_Kirin_Toggle_SGUI = {
		context_type = player_context
		parent_window_name = "countrypoliticsview"

		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
				has_country_flag = KXN_Nirik_Kirin_Toggle_Open
			}
		}

		window_name = "KXN_Nirik_Kirin_Toggle_Window"

		triggers = {
			KXNKirNirUsesCounter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
			}
			KXN_Nirik_Glow_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Pulsar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Counter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Nirik_Counter_Progress_Bar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var > 0 }
			}
			KXN_Kirin_Button_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var < 1 }
			}
			KXN_Kirin_Counter_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Counter_Progress_Bar_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Icon_visible = {
				check_variable = { KXN.KXN_Nirik_Counter_Var < 1 }
				check_variable = { KXN.KXN_Kirin_Countdown_Var > 0 }
			}
			KXN_Kirin_Icon_click_enabled = {
				always = no ## Grey-out
			}
			KXN_Kirin_Button_click_enabled = {
				check_variable = { var = command_power value = 5 compare = greater_than_or_equals }
				check_variable = { var = KXN_KirNir_Uses_Var value = 1 compare = greater_than_or_equals }
			}
		}

		properties = {
			KXN_Kirin_Counter_Progress_Bar = {
				frame = KXN.KXN_Kirin_Countdown_Prog_Var
			}
			KXN_Nirik_Counter_Progress_Bar = {
				frame = KXN.KXN_Nirik_Counter_Prog_Var
			}
			KXNHarvestProgBar = {
				frame = KXN.KXNHarvestProgBar_Var
			}
			KXNHarvestCasualties = {
				frame = 0
			}
		}

		effects = {
			KXN_Kirin_Button_click = {
				set_variable = { var = KXN_Nirik_Counter_Var value = KXN_Nirik_Counter_Days }
				set_variable = { var = KXN_Kirin_Countdown_Var value = KXN_Kirin_Countdown_Days }
				set_variable = { KXN_Nirik_Counter_Prog_Var = 100 }
				add_command_power = -5
				subtract_from_variable = { KXN.KXN_KirNir_Uses_Var = 1 }
				add_dynamic_modifier = { modifier = KXN_Nirik_Storm days = KXN.KXN_Nirik_Counter_Days }
				add_country_leader_trait = nirik_fury
				if = {
					limit = { has_country_flag = KXNNirikStormValiantBuff_Flag }
					set_technology = {
						popup = no
						KXN_Super_Valiants = 1
					}
					KXN_REFRESH_VALIANTS_EFFECT = yes
				}
				KXN_SET_NIRIK_PORTRAITS_EFFECT = yes
				country_event = { id = lan_kir_utility.1 days = KXN.KXN_Nirik_Counter_Days }
			}
		}
	}
	
	KXN_City_Fall_SGUI = {
		context_type = state_mapicon
		window_name = "KXN_City_Fall_Window"
		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
			}
		}
		dirty = KXN.KXN_City_Fall_Var
		mapicon_targets = { target_array = KXN.City_Fall_Target_Array }

		effects = {
			KXN_CF_OCCUPY_BUTTON_click = {
				THIS = {
					KXN_OCCUPY_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_PILLAGE_BUTTON_click = {
				THIS = {
					KXN_PILLAGE_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_BURN_BUTTON_click = {
				THIS = {
					KXN_BURN_STATE_EFFECT = yes
					remove_from_array = { KXN.City_Fall_Target_Array = THIS }
					set_state_flag = { flag = KXN_STATE_FALLEN_FLAG days = 365 value = 1 }
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
			KXN_CF_TOGGLE_BUTTON_click = {
				THIS = {
					if = {
						limit = {
							has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
						}
						clr_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
					}
					else = {
						set_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
					}
					add_to_variable = { KXN.KXN_City_Fall_Var = 1 }
				}
				ROOT = { add_to_variable = { KXN_City_Fall_Var = 1 } }
			}
		}

		triggers = {
			KXN_City_Fall_Title_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_City_Fall_BG_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_OCCUPY_BUTTON_TITLE_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_OCCUPY_BUTTON_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_PROCURE_BUILDINGS_TITLE_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
				KXN = { has_country_flag = KXN_OCCUPY_STATE_EFFECT_PROCURE }
			}
			KXN_CF_PILLAGE_RESOURCES_TITLE_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_PILLAGE_BUTTON_TITLE_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_PILLAGE_BUTTON_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_BURN_BUILDINGS_TITLE_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_BURN_BUTTON_TITLE_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_BURN_BUTTON_visible = { has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG }
			KXN_CF_PLUNDER_FUEL_TITLE_visible = {
				has_state_flag = KXN_STATE_FALL_TOGGLED_FLAG
				check_variable = { KXN_City_Fall_Fuel > 0 }
				KXN = { has_country_flag = KXN_Plunder_Oil_Flag }
			}
		}
	}
	
	KXN_Conquest_Decision_Image_Desc = {
		context_type = decision_category
		parent_window_token = decision_tab

		visible = { always = yes }

		window_name = "KXN_Conquest_SGUI"
	}
	
	KXN_Airship_Decision_Category_SGUI = {
		context_type = decision_category
		parent_window_token = decision_tab

		visible = { always = yes }

		window_name = "KXN_Airship_SGUI"
	}
	
	KXN_Puppet_Decision_Category_SGUI = {
		context_type = decision_category
		parent_window_token = decision_tab

		visible = { always = yes }

		window_name = "KXN_Puppet_SGUI"

		effects = {
			KXN_Puppet_KXV_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_1_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_1_Decision_Flag
					KXV = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_1_Var = 2 }
				}
			}
			KXN_Puppet_KXF_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_2_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_2_Decision_Flag
					KXF = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_2_Var = 2 }
				}
			}
			KXN_Puppet_KXK_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_3_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_3_Decision_Flag
					KXK = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_3_Var = 2 }
				}
			}
			KXN_Puppet_KXZ_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_4_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_4_Decision_Flag
					KXZ = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_4_Var = 2 }
				}
			}
			KXN_Puppet_KXH_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_5_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_5_Decision_Flag
					KXH = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_5_Var = 2 }
				}
			}
			KXN_Puppet_KXE_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_6_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_6_Decision_Flag
					KXE = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_6_Var = 2 }
				}
			}
			KXN_Puppet_KXO_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_7_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_7_Decision_Flag
					KXO = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_7_Var = 2 }
				}
			}
			KXN_Puppet_KXM_Button_click = {
				if = {
					limit = { check_variable = { KXN.KXN_Puppet_Frame_8_Var = 2 } }
					KXN_Puppet_Reset_All_Frames = yes
				}
				else = {
					KXN_Puppet_Reset_All_Frames = yes
					set_country_flag = KXN_8_Decision_Flag
					KXM = { set_country_flag = KXN_Satellite_Decision_Flag }
					set_variable = { KXN.KXN_Puppet_Frame_8_Var = 2 }
				}
			}
		}

		properties = {
			KXN_Puppet_Frame_1 = {
				frame = KXN.KXN_Puppet_Frame_1_Var
			}
			KXN_Puppet_Frame_2 = {
				frame = KXN.KXN_Puppet_Frame_2_Var
			}
			KXN_Puppet_Frame_3 = {
				frame = KXN.KXN_Puppet_Frame_3_Var
			}
			KXN_Puppet_Frame_4 = {
				frame = KXN.KXN_Puppet_Frame_4_Var
			}
			KXN_Puppet_Frame_5 = {
				frame = KXN.KXN_Puppet_Frame_5_Var
			}
			KXN_Puppet_Frame_6 = {
				frame = KXN.KXN_Puppet_Frame_6_Var
			}
			KXN_Puppet_Frame_7 = {
				frame = KXN.KXN_Puppet_Frame_7_Var
			}
			KXN_Puppet_Frame_8 = {
				frame = KXN.KXN_Puppet_Frame_8_Var
			}
		}
		
		triggers = {
			KXN_Puppet_KXV_Button_click_enabled = {
				has_global_flag = Form_KXN_Vermilion_Flag
				KXV = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXF_Button_click_enabled = {
				has_global_flag = Form_KXN_Fragrance_Flag
				KXF = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXK_Button_click_enabled = {
				has_global_flag = Form_KXN_Exarchate_Flag
				KXK = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXZ_Button_click_enabled = {
				has_global_flag = Form_KXN_Eparchy_Flag
				KXZ = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXH_Button_click_enabled = {
				has_global_flag = Form_KXN_Marshalcy_Flag
				KXH = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXE_Button_click_enabled = {
				has_global_flag = Form_KXN_Equatorarchy_Flag
				KXE = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXO_Button_click_enabled = {
				has_global_flag = Form_KXN_Occident_Flag
				KXO = {
					exists = yes
					is_subject_of = KXN
				}
			}
			KXN_Puppet_KXM_Button_click_enabled = {
				has_global_flag = Form_KXN_Satellite_Flag
				KXM = {
					exists = yes
					is_subject_of = KXN
				}
			}
		}
	}
	
	KXN_Focus_EMPIRE_C3_GUI = {
		context_type = national_focus_context
		parent_window_token = national_focus

		visible = {
			ROOT = {
				tag = KXN
				is_ai = no
			}
		}

		window_name = "KXN_Focus_EMPIRE_C3_SGUI"
	}
}