scripted_gui = {

	EQC_parliament_gui = {
		context_type = decision_category
		window_name = "EQC_parliament_decision_window"
		dirty = EQC_parliament_dirty
		
		dynamic_lists = {
			#Tab 0
			parliament_tab = {
				array = EQC_dummy_tab_array
				entry_container = "EQC_parliament_tab_[?EQC_parliament_tab_var]"
				value = w
				index = i
			}
			parliament_popularities = {
				array = EQC_party_token_array
				entry_container = EQC_parliament_party_popularity_entry
				value = w
				index = i
			}
			parliament_parties = {
				array = EQC_party_token_array
				entry_container = EQC_parliament_party_entry
				value = w
				index = i
			}
			
			#Tab 1
			parliament_projected_popularities = {
				array = EQC_party_token_array
				entry_container = EQC_parliament_party_projected_popularity_entry
				value = w
				index = i
			}
			parliament_projected_party_popularities = {
				array = EQC_party_token_array
				entry_container = EQC_election_prediction_entry
				value = w
				index = i
			}
		}
		
		triggers = {
			#Tab 0
			parliament_party_popularity_icon_visible = {
				NOT = {
					check_variable = { EQC_party_popularity_frame@var:w = 0 }
				}
			}
			parliament_coalition_button_click_enabled = {
				NOT = { 
					has_country_flag = EQC_parliament_popup_visible 
					check_variable = { EQC_selected_party = w }
				}
			}
			parliament_improve_relations_button_click_enabled = {
				NOT = { 
					check_variable = { EQC_selected_party = w }
				}
			}
			
			#Tab 1
			EQC_parliament_party_popularity_entry_visible = {
				NOT = {
					check_variable = { EQC_party_popularity_frame@var:w = 0 }
				}
			}
		}

		effects = {
			parliament_coalition_button_click = {
				if = {
					limit = {
						is_in_array = {
							array = EQC_coalition_partners
							value = w
						}
					}
					set_variable = { EQC_popup_header = token:break_coalition_with }
					set_variable = { EQC_popup_target = w }
				}
				else = {
					set_variable = { EQC_party_coalition_btn_frame@var:w = 2 }
					set_variable = { EQC_popup_target = w }
					set_variable = { EQC_popup_header = token:form_coalition_with }
				}
				set_country_flag = EQC_parliament_popup_visible
				add_to_variable = { EQC_parliament_dirty = 0.01 }
			}
			parliament_improve_relations_button_click = {
				if = {
					limit = {
						check_variable = { EQC_party_improve_relations_frame@var:w = 1 }
					}
					set_variable = { EQC_party_improve_relations_frame@var:w = 2 }
					remove_from_array = { EQC_party_improving_relations_decay = w }
					add_to_array = { EQC_party_improving_relations = w }
					if = {
						limit = {
							NOT = { is_in_array = { EQC_party_opinion_loc@var:w = token:improving_relations_modifier } }
						}
						add_to_array = { EQC_party_opinion_breakdown@var:w = 0 }
						add_to_array = { EQC_party_opinion_loc@var:w = token:improving_relations_modifier }
					}
					add_to_variable = { EQC_parliament_improving_relations_cost = 0.15 }
				}
				else = {
					set_variable = { EQC_party_improve_relations_frame@var:w = 1 }
					remove_from_array = { EQC_party_improving_relations = w }
					add_to_array = { EQC_party_improving_relations_decay = w }
					subtract_from_variable = { EQC_parliament_improving_relations_cost = 0.15 }
				}
				add_to_variable = { EQC_parliament_dirty = 0.01 }
			}
			
			#Tabs
			parliament_view_tab_click = {
				log = "Click 1"
				if = {
					limit = {
						check_variable = { EQC_parliament_tab_var = 1 }
					}
					subtract_from_variable = { EQC_parliament_tab_var = 1 }
					set_variable = { EQC_parliament_tab_0_frame = 1 }
					set_variable = { EQC_parliament_tab_1_frame = 2 }
					add_to_variable = { EQC_parliament_dirty = 0.01 }
				}
			}
			parliament_election_preview_tab_click = {
				log = "Click 2"
				if = {
					limit = {
						check_variable = { EQC_parliament_tab_var = 0 }
					}
					set_variable = { EQC_parliament_tab_0_frame = 2 }
					set_variable = { EQC_parliament_tab_1_frame = 1 }
					add_to_variable = { EQC_parliament_tab_var = 1 }
					add_to_variable = { EQC_parliament_dirty = 0.01 }
				}
			}
		}

		properties = {
			#Tab 0
			parliament_party_popularity_icon = {
				image = "GFX_EQC_popularity_[?w.GetTokenKey]"
				frame = EQC_party_popularity_frame@var:w
			}
			parliament_party_icon = {
				image = "GFX_EQC_parliament_icon_[?w.GetTokenKey]"
			}
			parliament_coalition_button = {
				frame = EQC_party_coalition_btn_frame@var:w
			}
			parliament_improve_relations_button = {
				frame = EQC_party_improve_relations_frame@var:w
			}
			parliament_view_tab = {
				frame = EQC_parliament_tab_0_frame
			}
			parliament_election_preview_tab = {
				frame = EQC_parliament_tab_1_frame
			}
			
			#Tab 1
			parliament_party_projected_popularity_icon = {
				image = "GFX_EQC_popularity_[?w.GetTokenKey]"
				frame = EQC_party_projected_popularity_frame@var:w
			}
		}
	}
	
	EQC_parliament_popup = {
		window_name = "EQC_parliament_popup_window"
		context_type = player_context
		
		visible = {
			has_country_flag = EQC_parliament_popup_visible
		}
		
		triggers = {
			confirm_btn_click_enabled = {
				#if = {
				#	limit = {
				#		check_variable = { EQC_popup_header = token:form_coalition_with }
				#	}
				#	check_variable = { EQC_party_opinion@var:EQC_popup_target > 49 }
				#}
				always = yes
			}
		}
		
		effects = {
			confirm_btn_click = {
				if = {
					limit = {
						check_variable = { EQC_popup_header = token:break_coalition_with }
					}
					set_temp_variable = { temp_target = EQC_popup_target }
					EQC_break_coalition_with_temp_target = yes
				}
				else = {
					set_temp_variable = { temp_target = EQC_popup_target }
					EQC_form_coalition = yes
				}
				add_to_variable = { EQC_parliament_dirty = 0.01 }
				clr_country_flag = EQC_parliament_popup_visible
			}
			cancel_btn_click = {
				if = {
					limit = {
						check_variable = { EQC_popup_header = token:form_coalition_with }
					}
					set_variable = { EQC_party_coalition_btn_frame@var:EQC_popup_target = 1 }
				}
				add_to_variable = { EQC_parliament_dirty = 0.01 }
				clear_variable = EQC_popup_target
				clr_country_flag = EQC_parliament_popup_visible
			}
		}
		
		properties = {
			parliament_party_icon = {
				image = "GFX_EQC_parliament_icon_[?EQC_popup_target.GetTokenKey]"
			}
		}
	}
}
