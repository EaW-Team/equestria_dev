scripted_gui = {
	NCH_republican_gui = {
		context_type = decision_category
		window_name = "NCH_republican_gui_window"

		visible = {
			has_country_flag = NCH_republican_decisions
		}

		properties = {
			cader_portrait = {
				frame = cader_gui_frames
			}
			fennore_portrait = {
				frame = fennore_gui_frames
			}
			eolan_portrait = {
				frame = eolan_gui_frames
			}
		}
	}
	NCH_mil_academy = {
		context_type = decision_category
		window_name = "NCH_mil_academy_window"

		visible = {
			has_country_flag = NCH_BEG_can_train_staff
		}

		triggers = {
			next_leader_button_click_enabled = {
				NOT = { has_country_flag = NCH_BEG_training_a_unit }
			}
			previous_leader_button_click_enabled = {
				NOT = { has_country_flag = NCH_BEG_training_a_unit }
			}
			switch_leader_selection_click_enabled = {
				NOT = { has_country_flag = NCH_BEG_training_a_unit }
			}
		}

		effects = {
			next_leader_button_click = {
				add_to_variable = { NCH_leader_selection = 1 }
				if = {
					limit = {
						NOT = { has_country_flag = NCH_train_navy_leaders }
						check_variable = { NCH_leader_selection = army_leaders }
					}
					set_variable = { NCH_leader_selection = 0 }
				}
				else_if = {
					limit = {
						has_country_flag = NCH_train_navy_leaders
						check_variable = { NCH_leader_selection = navy_leaders }
					}
					set_variable = { NCH_leader_selection = 0 }
				}
				if = {
					limit = {
						has_country_flag = NCH_train_navy_leaders
					}
					set_variable = { NCH_currently_selected_leader = navy_leaders^NCH_leader_selection }
				}
				else = {
					set_variable = { NCH_currently_selected_leader = army_leaders^NCH_leader_selection }
				}
				if = {
					limit = {
						var:NCH_currently_selected_leader = { has_character_flag = NCH_trained_already }
					}
					set_variable = { NCH_leader_status = 2 }
				}
				else = {
					set_variable = { NCH_leader_status = 1 }
				}
			}
			previous_leader_button_click = {
				subtract_from_variable = { NCH_leader_selection = 1 }
				if = {
					limit = {
						check_variable = { NCH_leader_selection < 0 }
					}
					if = {
						limit = {
							NOT = { has_country_flag = NCH_train_navy_leaders }
						}
						set_variable = { NCH_leader_selection = army_leaders }
					}
					else = {
						set_variable = { NCH_leader_selection = navy_leaders }
					}
					subtract_from_variable = { NCH_leader_selection = 1 }
				}
				if = {
					limit = {
						has_country_flag = NCH_train_navy_leaders
					}
					set_variable = { NCH_currently_selected_leader = navy_leaders^NCH_leader_selection }
				}
				else = {
					set_variable = { NCH_currently_selected_leader = army_leaders^NCH_leader_selection }
				}
				if = {
					limit = {
						var:NCH_currently_selected_leader = { has_character_flag = NCH_trained_already }
					}
					set_variable = { NCH_leader_status = 2 }
				}
				else = {
					set_variable = { NCH_leader_status = 1 }
				}
			}
			switch_leader_selection_click = {
				if = {
					limit = {
						NOT = { has_country_flag = NCH_train_navy_leaders }
					}
					set_variable = { NCH_leader_selection = 0 }
					set_country_flag = NCH_train_navy_leaders
					set_variable = { NCH_currently_selected_leader = navy_leaders^NCH_leader_selection }
					set_variable = { NCH_land_navy_selection = 2 }
				}
				else = {
					set_variable = { NCH_leader_selection = 0 }
					clr_country_flag = NCH_train_navy_leaders
					set_variable = { NCH_currently_selected_leader = army_leaders^NCH_leader_selection }
					set_variable = { NCH_land_navy_selection = 1 }
				}
				if = {
					limit = {
						var:NCH_currently_selected_leader = { has_character_flag = NCH_trained_already }
					}
					set_variable = { NCH_leader_status = 2 }
				}
				else = {
					set_variable = { NCH_leader_status = 1 }
				}
			}
		}

		properties = {
			NCH_leader_portrait = {
				image = "[GetNCHLeaderInTraining]"
			}
			NCH_leader_course_status = {
				frame = NCH_leader_status
			}
			switch_leader_selection = {
				frame = NCH_land_navy_selection
			}
		}

	}
	animated_flag_ui_medium_diplo = {
		window_name = "animated_flag_ui_medium_diplo"
		context_type = selected_country_context
		parent_window_name = countrydiplomacyview
			 
		visible = {
			has_country_flag = NCH_sunderer_burning_flag
		}
	}
	animated_flag_ui = {
		window_name = "animated_flag"
		context_type = player_context
			 
		visible = {
			has_country_flag = NCH_sunderer_burning_flag
		}  
	}
	miracle_mana_ui = {
		window_name = "miracle_mana_window"
		context_type = player_context

		visible = {
			has_country_flag = NCH_miracles_enabled
		}
	}
	wrath_mana_ui = {
		window_name = "wrath_mana_window"
		context_type = player_context

		visible = {
			has_country_flag = NCH_hatred_enabled
		}
	}
	convert_wrath_ui = {
		window_name = "covert_wrath_window"
		context_type = player_context

		visible = {
			has_country_flag = NCH_hatred_enabled
		}


		effects = {
			covert_wrath_button_click = {
				subtract_from_variable = {
					NCH_hatred_total = 5
				}
				add_to_variable = { NCH_sunderer_charges = 1 }
			}
		}
		triggers = {
			covert_wrath_button_click_enabled = {
				check_variable = { NCH_hatred_total > 4 }
				NOT = { check_variable = { NCH_sunderer_charges = 30 } }
			}
		}
	}
	miracle_menu_open_button = {
		window_name = "miracle_menu_button"
		context_type = player_context

		visible = {
			has_country_flag = NCH_miracles_enabled
		}

		effects = {
			miracle_starting_list_button_type_click = {
				if = {
					limit = {
						NOT = {
							has_country_flag = NCH_miracle_menu_opened
						}
						OR = {
							has_country_flag = NCH_slana_start_decisions
							has_country_flag = NCH_slana_spells_unlocked
						}
					}
					set_country_flag = NCH_miracle_menu_opened
					set_country_flag = NCH_miracle_menu_opened_once
				}
				else_if = {
					limit = {
						has_country_flag = NCH_miracle_menu_opened
					}
					clr_country_flag = NCH_miracle_menu_opened
				}
			}
		}
	}
	miracle_menu_alert = {
		window_name = "miracle_menu_button_alert"
		context_type = player_context

		visible = {
			NOT = { has_country_flag = NCH_miracle_menu_opened_once }
			OR = {
				has_country_flag = NCH_slana_start_decisions
				has_country_flag = NCH_slana_spells_unlocked
			}
		}
	}
	miracle_menu = {
		window_name = "miracle_menu"
		context_type = player_context
		dirty = NCH_update_guis_dirty

		visible = {
			has_country_flag = NCH_miracle_menu_opened
			has_country_flag = NCH_slana_start_decisions
		}

		effects = {
			miracle_close_button_click = {
				clr_country_flag = NCH_miracle_menu_opened
			}
			miracle_industry_of_the_faithful_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_industry_of_the_faithful
				}
				hidden_effect = {
					unlock_national_focus = NCH_industry_of_the_faithful
				}
				set_country_flag = NCH_industry_of_the_faithful_slana
				random_core_state = {
					add_extra_state_shared_building_slots = 4
					add_building_construction = {
						type = industrial_complex
						level = 4
						instant_build = yes
					}
				}
				custom_effect_tooltip = NCH_150_days_timer_tt
				effect_tooltip = {
					increase_society_development = yes
				}
				country_event = {
					id = greneclyf_sunderer.12
					days = 149
				}
			}
			miracle_educate_the_masses_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_educate_the_masses
				}
				hidden_effect = {
					unlock_national_focus = NCH_educate_the_masses
				}
				custom_effect_tooltip = NCH_100_days_timer_tt
				effect_tooltip = {
					add_manpower = 2500
					decrease_illiteracy = yes
				}
				hidden_effect = {
					NCH = {
						country_event = {
							id = greneclyf_development.3
							days = 99
						}
					}
				}
				set_country_flag = NCH_educate_the_masses_cast
			}
			miracle_tackling_poverty_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_tackling_poverty
				}
				hidden_effect = {
					unlock_national_focus = NCH_tackling_poverty
				}
				custom_effect_tooltip = NCH_100_days_timer_tt
				effect_tooltip = {
					add_manpower = 3500
					decrease_poverty = yes
					if = {
						limit = {
							has_country_flag = NCH_slana_has_eolans_support
						}
						effect_tooltip = {
							unlock_national_focus = NCH_the_private_beneficiaries
						}
					}
				}
				set_country_flag = NCH_slana_tackled_poverty
				hidden_effect = {
					NCH = {
						country_event = {
							id = greneclyf_development.4
							days = 99
						}
					}
				}
				set_country_flag = NCH_taclking_poverty_cast
			} 
			miracle_elicit_eolans_support_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_elicit_eolans_support
				}
				hidden_effect = {
					unlock_national_focus = NCH_elicit_eolans_support
				}
				if = {
					limit = {
						has_country_flag = NCH_slana_tackled_poverty
					}
					clr_country_flag = NCH_slana_tackled_poverty
					set_country_flag = NCH_sunderer_dealth_with_poverty_and_eolan
					effect_tooltip = {
						unlock_national_focus = NCH_the_private_beneficiaries
					}
				}
				else = {
					set_country_flag = NCH_slana_has_eolans_support
				}
				country_event = {
					id = greneclyf_sunderer.26
					days = 0
				}
				add_advisor_role = {
					character = NCH_eolan
					activate = no
					advisor = {
						slot = political_advisor
						cost = 150
						idea_token = NCH_eolan
						traits = {
							NCH_big_shot_of_blosmport
						}
					}
				}
				custom_effect_tooltip = NCH_slana_additional_treelet_eolan_tt
				show_ideas_tooltip = NCH_eolan_charity
			}
			miracle_faceoff_with_fennore_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_faceoff_with_fennore
				}
				hidden_effect = {
					unlock_national_focus = NCH_faceoff_with_fennore
				}
				add_political_power = 25
				country_event = {
					id = greneclyf_sunderer.27
					days = 0
				}
				if = {
					limit = {
						has_idea = NCH_blindfold_starting
					}
					remove_ideas = NCH_blindfold_starting
				}
				if = {
					limit = {
						has_idea = NCH_blindfold_pacified
					}
					remove_ideas = NCH_blindfold_pacified
				}
				if = {
					limit = {
						has_idea = NCH_blindfold_unamused
					}
					remove_ideas = NCH_blindfold_unamused
				}
				if = {
					limit = {
						has_idea = NCH_blindfold_angry
					}
					remove_ideas = NCH_blindfold_angry
				}
				add_timed_idea = {
					idea = NCH_fennore_promoting_sunderer_idea
					days = 365
				}
			}
			miracle_finding_feilean_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_finding_felian
				}
				hidden_effect = {
					unlock_national_focus = NCH_finding_felian
				}
				if = {
					limit = {
						has_country_flag = NCH_gytha_dead
					}
					country_event = {
						id = greneclyf_sunderer.28
						days = 0
					}
				}
				else = {
					country_event = {
						id = greneclyf_sunderer.29
						days = 0
					}
				}
			}
			miracle_meeting_murchbagh_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_meeting_murchbagh
				}
				hidden_effect = {
					unlock_national_focus = NCH_meeting_murchbagh
				}
				country_event = {
					id = greneclyf_sunderer.18
					days = 0
				}
				if = {
					limit = {
						NOT = { has_country_flag = NCH_slana_rallied_the_people }
					}
					set_country_flag = NCH_slana_met_with_murchbagh
				}
				if = {
					limit = {
						has_country_flag = NCH_slana_rallied_the_people
					}
					set_country_flag = NCH_let_slana_deal_with_cait_and_rally_the_people
					clr_country_flag = NCH_slana_rallied_the_people
				}
			}
			miracle_rallying_the_people_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_rallying_the_people
				}
				hidden_effect = {
					unlock_national_focus = NCH_rallying_the_people
				}
				custom_effect_tooltip = NCH_100_days_timer_tt
				effect_tooltip = {
					add_manpower = 5000
					decrease_poverty = yes
				}
				hidden_effect = {
					NCH = {
						country_event = {
							id = greneclyf_development.4
							days = 99
						}
					}
				}
				set_country_flag = NCH_rallying_the_people_cast
			}
			miracle_gathering_the_intelligentsia_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_gathering_the_intelligentsia
				}
				hidden_effect = {
					unlock_national_focus = NCH_gathering_the_intelligentsia
				}
				add_tech_bonus = {
					bonus = 2
					uses = 2
					category = computing_tech
				}
				custom_effect_tooltip = NCH_100_days_timer_tt
				effect_tooltip = {
					Improve_Science_Base = yes
				}
				hidden_effect = {
					NCH = {
						country_event = {
							id = greneclyf_development.1
							days = 99
						}
					}
				}
			}
			miracle_defeating_illiteracy_button_click = {
				add_political_power = -50
				custom_effect_tooltip = NCH_sunderer_charge_use
				NCH_update_guis = yes
				set_temp_variable = { NCH_used_miracles = 1 }
				NCH_cast_incantation = yes
				effect_tooltip = {
					complete_national_focus = NCH_defeating_illiteracy
				}
				hidden_effect = {
					unlock_national_focus = NCH_defeating_illiteracy
				}
				add_research_slot = 1
				custom_effect_tooltip = NCH_150_days_timer_tt
				effect_tooltip = {
					decrease_illiteracy = yes
				}
				hidden_effect = {
					NCH = {
						country_event = {
							id = greneclyf_development.3
							days = 149
						}
					}
				}
			}
		}

		triggers = {
			miracle_industry_of_the_faithful_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_educate_the_masses
				OR = {
					has_completed_focus = NCH_toiling_for_a_nation
					has_completed_focus = NCH_the_private_beneficiaries
				}
				NOT = { has_completed_focus = NCH_industry_of_the_faithful }
			}
			miracle_educate_the_masses_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_adressing_the_economy
				NOT = { has_completed_focus = NCH_educate_the_masses }
			}
			miracle_tackling_poverty_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_adressing_the_economy
				NOT = { has_completed_focus = NCH_tackling_poverty }
			}
			miracle_elicit_eolans_support_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_dealing_with_the_cpm
				NOT = { has_completed_focus = NCH_elicit_eolans_support }
			}
			miracle_faceoff_with_fennore_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_dealing_with_the_cpm
				NOT = { has_completed_focus = NCH_faceoff_with_fennore }
			}
			miracle_finding_feilean_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_handling_the_council_of_royals
				NOT = { has_completed_focus = NCH_finding_felian }
			}
			miracle_meeting_murchbagh_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_handling_the_council_of_royals
				NOT = { has_completed_focus = NCH_meeting_murchbagh }
			}
			miracle_rallying_the_people_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_comforting_the_masses
				NOT = { has_completed_focus = NCH_rallying_the_people }
			}
			miracle_gathering_the_intelligentsia_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				has_completed_focus = NCH_comforting_the_masses
				NOT = { has_completed_focus = NCH_gathering_the_intelligentsia }
			}
			miracle_defeating_illiteracy_button_click_enabled = {
				has_political_power > 49
				NCH_miracle_charges = yes
				OR = {
					has_completed_focus = NCH_reaching_the_masses
					has_completed_focus = NCH_fomenting_a_new_generation
				}
				NOT = { has_completed_focus = NCH_defeating_illiteracy }
			}
			#miracle_faceoff_with_fennore_button_shine_visible = { #MIRACLE MASK VISIBILITY TRIGGER
				#has_political_power > 49
				#NCH_miracle_charges = yes
				#has_completed_focus = NCH_dealing_with_the_cpm
				#NOT = { has_completed_focus = NCH_faceoff_with_fennore }
			#}
		}
	}

	actual_miracle_menu = {
		window_name = "actual_miracle_menu"
		context_type = player_context
		dirty = NCH_update_guis_dirty

		visible = {
			has_country_flag = NCH_miracle_menu_opened
			has_country_flag = NCH_slana_spells_unlocked
		}

		dynamic_lists = {
			tier1_grid = {
				array = NCH_spell_T1_arr
				value = value_sunderer_t1
				index = index_sunderer_t1
				change_scope = no
				entry_container = "T1"
			}
			tier2_grid = {
				array = NCH_spell_T2_arr
				value = value_sunderer_t2
				index = index_sunderer_t2
				change_scope = no
				entry_container = "T2"
			}
			tier3_grid = {
				array = NCH_spell_T3_arr
				value = value_sunderer_t3
				index = index_sunderer_t3
				change_scope = no
				entry_container = "T3"
			}
		}

		triggers = {
			mirace_T1_frame_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t1 = NCH_SUN_pos_x_t1^index_sunderer_t1 }
				set_temp_variable = { NCH_SUN_temp_y_t1 = NCH_SUN_pos_y_t1^index_sunderer_t1 }
			}
			miracle_T1_button_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t1 = NCH_SUN_pos_x_t1^index_sunderer_t1 }
				set_temp_variable = { NCH_SUN_temp_y_t1 = NCH_SUN_pos_y_t1^index_sunderer_t1 }
			}
			T1_active_mask_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t1 = NCH_SUN_pos_x_t1^index_sunderer_t1 }
				set_temp_variable = { NCH_SUN_temp_y_t1 = NCH_SUN_pos_y_t1^index_sunderer_t1 }
				always = no
			}
			mirace_T2_frame_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t2 = NCH_SUN_pos_x_t2^index_sunderer_t2 }
				set_temp_variable = { NCH_SUN_temp_y_t2 = NCH_SUN_pos_y_t2^index_sunderer_t2 }
			}
			miracle_T2_button_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t2 = NCH_SUN_pos_x_t2^index_sunderer_t2 }
				set_temp_variable = { NCH_SUN_temp_y_t2 = NCH_SUN_pos_y_t2^index_sunderer_t2 }
			}
			T2_active_mask_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t2 = NCH_SUN_pos_x_t2^index_sunderer_t2 }
				set_temp_variable = { NCH_SUN_temp_y_t2 = NCH_SUN_pos_y_t2^index_sunderer_t2 }
				always = no
			}
			mirace_T3_frame_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t3 = NCH_SUN_pos_x_t3^index_sunderer_t3 }
				set_temp_variable = { NCH_SUN_temp_y_t3 = NCH_SUN_pos_y_t3^index_sunderer_t3 }
			}
			miracle_T3_button_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t3 = NCH_SUN_pos_x_t3^index_sunderer_t3 }
				set_temp_variable = { NCH_SUN_temp_y_t3 = NCH_SUN_pos_y_t3^index_sunderer_t3 }
			}
			T3_active_mask_visible = {
				set_temp_variable = { NCH_SUN_temp_x_t3 = NCH_SUN_pos_x_t3^index_sunderer_t3 }
				set_temp_variable = { NCH_SUN_temp_y_t3 = NCH_SUN_pos_y_t3^index_sunderer_t3 }
				always = no
			}
		}

		properties = {
			mirace_T1_frame = {
				x = NCH_SUN_temp_x_t1
				y = NCH_SUN_temp_y_t1
			}
			miracle_T1_button = {
				x = NCH_SUN_temp_x_t1
				y = NCH_SUN_temp_y_t1
				image = "[GetMiracleIconT1]"
			}
			T1_active_mask = { 
				x = NCH_SUN_temp_x_t1
				y = NCH_SUN_temp_y_t1
			}
			mirace_T2_frame = {
				x = NCH_SUN_temp_x_t2
				y = NCH_SUN_temp_y_t2
			}
			miracle_T2_button = {
				x = NCH_SUN_temp_x_t2
				y = NCH_SUN_temp_y_t2
				image = "[GetMiracleIconT2]"
			}
			T2_active_mask = { 
				x = NCH_SUN_temp_x_t2
				y = NCH_SUN_temp_y_t2
			}
			mirace_T3_frame = {
				x = NCH_SUN_temp_x_t3
				y = NCH_SUN_temp_y_t3
			}
			miracle_T3_button = {
				x = NCH_SUN_temp_x_t3
				y = NCH_SUN_temp_y_t3
				image = "[GetMiracleIconT3]"
			}
			T3_active_mask = { 
				x = NCH_SUN_temp_x_t3
				y = NCH_SUN_temp_y_t3
			}
		}

		effects = {
			miracle_close_button_click = {
				clr_country_flag = NCH_miracle_menu_opened
			}
			miracle_T1_button_click = {
				meta_effect = {
					text = {
						sunderer_button_t1_effect_[INDEX] = yes
					}
					INDEX = "[?index_sunderer_t1]"
				}
			}
			miracle_T2_button_click = {
				if = {
					limit = {
						NOT = { has_country_flag = NCH_tier2_miracles_unlocked }
					}
					custom_effect_tooltip = NCH_tier2_miracles_unknown_effect
				}
				else = {
					meta_effect = {
						text = {
							sunderer_button_t2_effect_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t2]"
					}
				}
			}
			miracle_T3_button_click = {
				if = {
					limit = {
						meta_trigger = {
							text = {
								sunderer_button_t3_prereq_[INDEX] = no
							}
							INDEX = "[?index_sunderer_t3]"
						}
					}
					meta_effect = {
						text = {
							sunderer_button_t3_unknown_effect_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t3]"
					}
				}
				else = {
					meta_effect = {
						text = {
							sunderer_button_t3_effect_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t3]"
					}
				}
			}
		}
		triggers = {
			tier1_window_visible = {
				always = no 
			}
			miracle_T1_button_click_enabled = {
				meta_trigger = {
					text = {
						sunderer_button_t1_trigger_[INDEX] = yes
					}
					INDEX = "[?index_sunderer_t1]"
				}
			}
			miracle_T2_button_click_enabled = {
				if = {
					limit = {
						NOT = { has_country_flag = NCH_tier2_miracles_unlocked }
					}
					has_country_flag = NCH_tier2_miracles_unlocked
					NOT = { country_exists = DED }
				}
				else = {
					meta_trigger = {
						text = {
							sunderer_button_t2_trigger_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t2]"
					}
				}
			}
			miracle_T3_button_click_enabled = {
				if = {
					limit = {
						meta_trigger = {
							text = {
								sunderer_button_t3_prereq_[INDEX] = no
							}
							INDEX = "[?index_sunderer_t3]"
						}
					}
					meta_trigger = {
						text = {
							sunderer_button_t3_prereq_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t3]"
					}
				}
				else = {
					meta_trigger = {
						text = {
							sunderer_button_t3_trigger_[INDEX] = yes
						}
						INDEX = "[?index_sunderer_t3]"
					}
				}
			}
		}
	}
	sunderer_nuke_button = {
		window_name = "sunderer_nuke_window"
		context_type = selected_state_context
		parent_window_token = selected_state_view
		dirty = NCH_update_guis_dirty

		visible = {
			ROOT = { has_country_flag = NCH_T3M1_available }
			NOT = {
				state = 670
				state = 669
				state = 668
			}
		}

		effects = {
			sunderer_nuke_button_click = {
				NCH = {
					meta_effect = {
						text = {
							set_variable = { NCH_sunder_nuke_target = [TARGET] }
						}
						TARGET = "[PREV.GetID]"
					}
					set_country_flag = {
						flag = NCH_T3M1_cd
						days = 60
					}
					custom_effect_tooltip = NCH_sunderer_charge_use_5
					set_temp_variable = { NCH_used_miracles = 5 }
					NCH_cast_incantation = yes
					hidden_effect = { country_event = { id = greneclyf_sunderer.997 hours = 14 } }
				}
				NCH_update_guis = yes
				custom_effect_tooltip = NCH_sunderer_nuke_effect_tt
			}
		}
		triggers = {
			sunderer_nuke_button_click_enabled = {
				NCH = {
					has_war_with = FROM.controller
					NCH_miracle_charges_5 = yes
					custom_trigger_tooltip = {
						tooltip = NCH_spell_cooldown_tt	
						NOT = { 
							has_country_flag = {
								flag = NCH_T3M1_cd
								value = 0
							}
						}
					}
				}
			}
		}
	}
}