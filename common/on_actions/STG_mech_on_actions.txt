on_actions = {
	on_startup = {
		effect = {
			STG = {
				# set_variable = { stg_max_hunger_lose = 5 }
				# set_variable = { stg_max_hunger_exp = 6 }
				# add_dynamic_modifier = {
				# 	modifier = STG_hunger_modifier
				# }
				# country_event = { id = stalliongard.79 days = 1300 }
				STG_wings_popularity_penalties_check = yes
			}
		}
	}
	on_weekly_STG = {
		effect = {
			# if = {	
			# 	limit = {
			# 		has_country_flag = famine_in_stg_flag
			# 	}
			# 	randomize_temp_variable = {
			# 		var = stg_hunger_lower
			# 		min = 1
			# 		max = 5
			# 		distribution = uniform
			# 	}
			# 	subtract_from_variable = { hunger_level_100 = stg_hunger_lower }
				
			# 	clamp_variable = {
			# 		var = hunger_level_100
			# 		min = 0
			# 		max = 100 
			# 	}
			# 	set_variable = { stg_hunger_influence = hunger_level_100 }
			# 	subtract_from_variable = { stg_hunger_influence = 100 }
			# 	divide_variable = { stg_hunger_influence = 100 }
				
			# }
			
			if = {
				limit = {
					OR = {
						has_dynamic_modifier = {
							modifier = STG_comecon_leader_vasily
						}
						has_dynamic_modifier = {
							modifier = STG_comecon_leader_karamelka
						}
						has_dynamic_modifier = {
							modifier = STG_comecon_leader_sinister
						}
						has_dynamic_modifier = {
							modifier = STG_comecon_leader_masha
						}
					}
				}

				STG_update_comecon_modifier = yes
			}

			if = {
				limit = {
					has_completed_focus = STG_right_opposition_in_control
				}
				set_temp_variable = { tmp_counterref = 0.01 }
				set_temp_variable = { stg_ref_res_decay_speed_modifier = -1 }
				subtract_from_temp_variable = { stg_ref_res_decay_speed_modifier = modifier@STG_reforms_resistance_decay_modifier }
				multiply_temp_variable = { tmp_counterref = stg_ref_res_decay_speed_modifier }
				STG_expand_counterreforms_progress = yes 
				
			}
		}
	}

	@DW_MINIGAME_STABILITY_UPPER_THRESHOLD = 0.4
	@DW_MINIGAME_STABILITY_LOWER_THRESHOLD = 0.3
	on_daily_STG = {
		effect = {
			if = {
				limit = {
					has_dynamic_modifier = {
						modifier = STG_left_center_right_buffs
					}
				}
				STG_wings_popularity_penalties_check = yes
			}

			# DW Reform crisis detection
			if = {
				limit = { has_country_flag = STG_DW_minigame_enabled }

				if = { 
					limit = {
						NOT = { has_country_flag = STG_DW_reform_decision_in_progress }
						has_stability < @DW_MINIGAME_STABILITY_LOWER_THRESHOLD
					}

					set_country_flag = STG_DW_reform_decision_in_progress
					add_ideas = STG_DW_reform_crisis
					country_event = stalliongrad_darkwing_reform.0
				} else_if = {
					limit = {
						has_country_flag = STG_DW_reform_decision_in_progress
						has_stability > @DW_MINIGAME_STABILITY_UPPER_THRESHOLD
					}

					clr_country_flag = STG_DW_reform_decision_in_progress
					remove_ideas = STG_DW_reform_crisis
					country_event = stalliongrad_darkwing_reform.1
				}
			}
		}
	}
}
