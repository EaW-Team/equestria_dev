on_actions = {
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					ROOT = {
						tag = ABY
						has_country_flag = aby_af_kattail_conquest_timer_active
					}
				}
				ABY = {
					ABY_AF_calculate_world_conquered_perc = yes
					if = {
						limit = {
							is_ai = yes
							has_completed_focus = ABY_AF_the_kattown_pyramid
						}
						add_to_variable = { aby_af_kattail_conquest_timer = 6 }
					}
					else = {
						add_to_variable = { aby_af_kattail_conquest_timer = 6 }
						add_political_power = 5
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = ABY
						has_country_flag = aby_af_kattail_conquest_timer_active
					}
				}
				ABY = {
					ABY_AF_calculate_world_conquered_perc = yes
					if = {
						limit = {
							is_ai = yes
							has_completed_focus = ABY_AF_the_kattown_pyramid
						}
						subtract_from_variable = { aby_af_kattail_conquest_timer = 6 }
					}
					else = {
						subtract_from_variable = { aby_af_kattail_conquest_timer = 6 }
					}
				}
			}
		}
	}

	on_daily_ABY = {
		effect = {
			if = {
				limit = { has_country_flag = aby_af_kattail_conquest_timer_active }
				subtract_from_variable = { aby_af_kattail_conquest_timer = 1 }
				if = {
					limit = { check_variable = { aby_af_kattail_conquest_timer = 0 } }
					country_event = katzen_AF.999
				}
			}
		}
	}

	on_monthly_ABY = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_monthly_ABY"
			#Zebtropa draining
			if = {
				limit = { has_country_flag = ABY_AF_zebtropa_dam_completed }
				set_variable = { zebtropa_monthly_sea_level_drop = 0 }
				add_to_variable = { zebtropa_monthly_sea_level_drop = 2 } 
				for_each_scope_loop = {
					array = ABY_AF_zebtropa_states_array
					if = {
						limit = { is_controlled_by = ABY has_state_flag = ABY_AF_has_mirror_array }
						ABY = { add_to_variable = { zebtropa_monthly_sea_level_drop = 0.5 } }
					}
				}
				
				add_to_variable = { zebtropa_sea_level_drop = zebtropa_monthly_sea_level_drop }

				set_temp_variable = { zebtropa_new_petaliters = zebtropa_monthly_sea_level_drop }
				multiply_temp_variable = { zebtropa_new_petaliters = zebtropa_petaliters_per_m }
				add_to_variable = { zebtropa_petaliters = zebtropa_new_petaliters }

				set_temp_variable = { zebtropa_new_dam_power_output = zebtropa_monthly_sea_level_drop }
				multiply_temp_variable = { zebtropa_new_dam_power_output = zebtropa_dam_power_output_per_m }
				add_to_variable = { zebtropa_dam_power_output = zebtropa_new_dam_power_output }

				set_variable = { zebtropa_dam_power_output_mod = zebtropa_dam_power_output }
				divide_variable = { zebtropa_dam_power_output_mod = 100 }

				if = {
					limit = { check_variable = { zebtropa_sea_level_drop > zebtropa_next_designation_threshold } }
					add_to_variable = { zebtropa_draining_level = 1 }
					add_to_variable = { zebtropa_next_designation_threshold = 100 }
					851 = { add_to_variable = { zebtropa_state_spec_count = 1 } }
					1002 = { add_to_variable = { zebtropa_state_spec_count = 1 } }
					199 = { add_to_variable = { zebtropa_state_spec_count = 1 } }
					818 = { add_to_variable = { zebtropa_state_spec_count = 1 } }
					788 = { add_to_variable = { zebtropa_state_spec_count = 1 } }
				}
			}
		}
	}

	on_weekly_ABY = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_weekly_ABY"
			if = {
				limit = { has_completed_focus = ABY_AF_are_worth_taking_over }
				if = {
					limit = { has_completed_focus = ABY_AF_let_loose_the_cries_of_war }
					ABY_AF_calculate_factories_perc = yes
					ABY_AF_calculate_population_perc = yes
					ABY_AF_calculate_total_conquest_perc = yes
					ABY_AF_calculate_katzen_tension = yes
				}
				every_other_country = {
					limit = {
						NOT = { has_war_with = ABY }
						any_core_state = { is_claimed_by = ABY }
						NOT = { #Klugetown
							AND = {
								tag = KLG
								ABY = { NOT = { has_completed_focus = ABY_AF_let_loose_the_cries_of_war } }
							}
						}
						NOT = { #Mandalusia
							AND = {
								tag = MGY
								ABY = { NOT = { has_completed_focus = ABY_AF_along_the_sea } }
							}
						}
						NOT = { #Warzena
							AND = {
								tag = WAR
								ABY = { NOT = { has_completed_focus = ABY_AF_the_capable_hippogriffs } }
							}
						}
						NOT = { #Avoid interference if say WNG landed in North Griffonia
							AND = {
								OR = {
									is_griffon_continent_country = yes
									overlord = { is_griffon_continent_country = yes }
								}
								ABY = { NOT = { has_completed_focus = ABY_AF_war_plan_griffonia } }
							}
						}
						NOT = { #New Mareland
							AND = {
								OR = {
									is_equestrian_continent_country = yes
									overlord = { is_equestrian_continent_country = yes }
								}
								ABY = { NOT = { has_completed_focus = ABY_AF_war_plan_equus } }
							}
						}
					}
					ABY = {
						declare_war_on = {
							target = PREV
							type = annex_everything
						}
					}
				}
				every_other_country = {
					limit = {
						has_war_with = ABY
						NOT = { is_in_array = { ABY_AF_kattail_enemies_array = id } }
					}
					add_to_array = { ABY_AF_kattail_enemies_array = THIS.id }
				}
				if = {
					limit = { has_global_flag = ABY_AF_anti_kattail_league_formed }
					ABY_AF_AKL_calculate_mils_per_nation = yes
				}
			}
		}
	}
}
