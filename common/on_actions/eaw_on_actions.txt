on_actions = {

	on_war_relation_added = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_war_relation_added"
			if = {
				limit = {
					OR = {
						original_tag = BAT
						original_tag = HIP
						AND = {
							original_tag = WNG
							has_government = fascism
						}
						original_tag = CTH
						original_tag = TBK
					}
					NOT = {
						has_country_flag = BAT_HIP_defeated
					}
					NOT = {
						has_global_flag = BAT_won_civil_war
					}
					NOT = {
						has_country_flag = HIE_BAT_alliance
					}
					FROM = {
						OR = {
							original_tag = BAT
							original_tag = HIP
							AND = {
								original_tag = WNG
								has_government = fascism
							}
							original_tag = CTH
							original_tag = TBK
						}
						NOT = {
							has_country_flag = BAT_HIP_defeated
						}
						NOT = {
							has_country_flag = HIP_won_north_zebrican_war
						}
						NOT = {
							has_global_flag = BAT_won_civil_war
						}
					}
				}
				if = {
					limit = {
						OR = {
							original_tag = BAT
							AND = {
								original_tag = WNG
								has_government = fascism
							}
							original_tag = CTH
							original_tag = TBK
						}
						NOT = {
							has_country_flag = BAT_national_catastrophe
							AND = {
								original_tag = WNG
								NOT = { has_government = fascism }
							}
						}
						FROM = {
							original_tag = HIP
							is_subject = no
							NOT = {
								has_country_flag = HIP_siren_takeover
							}
							NOT = {
								has_country_flag = HIP_second_war
							}
							NOT = {
								has_country_flag = HIP_won_north_zebrican_war
							}
							NOT = {
								has_country_flag = BAT_HIP_defeated
							}
						}
					}
					set_country_flag = partial_war
					set_country_flag = north_zebrican_war_participant
					FROM = {
						set_country_flag = north_zebrican_war_participant
					}
					if = {
						limit = {
							NOT = {
								has_global_flag = HIP_north_war_news_event_fired
							}
						}
						set_global_flag = HIP_north_war_news_event_fired
						news_event = {
							id = north_war.101
							hours = 8
						}
					}
					if = {
						limit = {
							OR = {
								tag = CTH
								tag = HIE
								tag = CVA
								tag = TRO
								tag = BAT
							}
							is_in_faction = yes
							is_major = no
						}
						set_major = yes
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								original_tag = HIP
								NOT = {
									has_country_flag = HIP_siren_takeover
								}
								FROM = {
									original_tag = HIE
									is_subject = no
								}
							}
							AND = {
								original_tag = HIE
								is_subject = no
								FROM = {
									original_tag = HIP
									NOT = {
										has_country_flag = HIP_siren_takeover
									}
								}
							}
						}
					}
					HIP = {
						country_event = {
							id = hippogriff.63
							days = 30
						}
					}
				}
				if = {
					limit = {
						original_tag = HIP
						is_subject = no
						NOT = {
							has_country_flag = HIP_siren_takeover
						}
						NOT = {
							has_country_flag = HIP_second_war
						}
						NOT = {
							has_country_flag = BAT_HIP_defeated
						}
						NOT = {
							has_country_flag = HIP_won_north_zebrican_war
						}
						FROM = {
							OR = {
								original_tag = BAT
								AND = {
									original_tag = WNG
									has_government = fascism
								}
								original_tag = CTH
								original_tag = TBK
							}
							NOT = {
								has_country_flag = BAT_national_catastrophe
								AND = {
									original_tag = WNG
									NOT = {has_government = fascism}
								}
							}
						}
					}
					set_country_flag = north_zebrican_war_participant
					FROM = {
						set_country_flag = partial_war
						set_country_flag = north_zebrican_war_participant
					}
					if = {
						limit = {
							NOT = {
								has_global_flag = HIP_north_war_news_event_fired
							}
						}
						set_global_flag = HIP_north_war_news_event_fired
						news_event = {
							id = north_war.101
							hours = 8
						}
					}
				}
				if = {
					limit = {
						original_tag = STG
						STL = {
							has_defensive_war_with = STG
							NOT = { # to account for NG thing
								AND = {
									is_in_faction_with = EQS
									has_completed_focus = STL_help_equestria_ng
								}
							}
						}
					}
					STL_set_up_STG_war_defensive = yes
				}
				if = {
					limit = {
						original_tag = STL
						NOT = { # to account for NG thing
							AND = {
								is_in_faction_with = EQS
								has_completed_focus = STL_help_equestria_ng
							}
						}
						STG = {
							has_defensive_war_with = STL
						}
					}
					STL_set_up_STG_war_offensive = yes
				}
			}
			if = {
				limit = {
					original_tag = HIP
					has_completed_focus = HIP_sunset_atoll_test
				}
				FROM = {
					add_ideas = HIP_sunset_atoll_terror
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
						has_completed_focus = HIP_sunset_atoll_test
					}
				}
				ROOT = {
					add_ideas = HIP_sunset_atoll_terror
				}
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = CHN
							is_in_faction_with = CHN
							is_subject_of = CHN
						}
					}
					FROM = {
						has_idea = YAK_anti_chrysalis_pact_3
					}
				}
				FROM = {
					country_event = newyaks.50
				}
			}
			if = {
				limit = {
					original_tag = PLB
					has_completed_focus = PLB_reach_out_to_the_eccentric
				}
				FROM = {
					add_ideas = PLB_biological_warfare
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = PLB
						has_completed_focus = PLB_reach_out_to_the_eccentric
					}
				}
				ROOT = {
					add_ideas = PLB_biological_warfare
				}
			}
			if = {
				limit = {
					original_tag = YAK
					has_country_flag = YAK_developed_bioweapons
				}
				FROM = {
					add_ideas = YAK_biological_warfare
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = YAK
						has_country_flag = YAK_developed_bioweapons
					}
				}
				ROOT = {
					add_ideas = YAK_biological_warfare
				}
			}
			if = {
				limit = {
					original_tag = YAK
					has_completed_focus = YAK_everything_against_the_bugs
				}
				add_timed_idea = {
					idea = YAK_everything_against_the_bugs_idea
					days = 365
				}
			}
			if = {
				limit = {
					original_tag = CHN
					NOT = {
						has_government = democratic
					}
					PLB = {
						has_defensive_war_with = CHN
						is_subject = no
					}
				}
				if = {
					limit = {
						NOT = {
							has_global_flag = CHN_great_northern_war
						}
					}
					set_global_flag = CHN_great_northern_war
					news_event = {
						id = plb_news.1
						days = 1
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						has_war_with = YAK
					}
					YAK = {
						has_completed_focus = YAK_smash_our_enemies
						has_government = democratic
					}
				}
				ROOT = {
					add_ideas = YAK_smash_our_enemies_idea
				}
			}
		}
	}

	#FROM is state the nuke got dropped on
	on_nuke_drop = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_nuke_drop FROM = [From.GetName]"
			FROM = {
				decrease_population_on_nuke = yes
			}
			if = {
				limit = {
					original_tag = EQS
					FROM = { state = 251 }
					NOT = { has_country_flag = nuked_the_hive }
				}
				save_event_target_as = hive_nuker
				set_country_flag = nuked_the_hive
				news_event = { id = news.50 hours = 3 }
			}
			else_if = {
				limit = {
					NOT = {
						AND = {
							OR = {
								original_tag = ZAI
								original_tag = WIT
							}
							has_country_flag = WIT_dont_trigger_nuke_shit
						}
					}
				}
				if = {
					limit = {
						FROM = { state = 389 }
						NOT = { has_global_flag = griffonstone_nuked }
					}
					set_temp_variable = {
						nuked = FROM.owner
					}
					save_global_event_target_as = griffonstone_nuker
					set_global_flag = griffonstone_nuked
					news_event = { id =  nuke_dropped.101 hours = 3 }
					every_other_country = {
						limit = { is_griffon_continent_griffon_country = yes }
						add_ai_strategy = {
							type = antagonize
							id = PREV
							value = 500
						}
						add_ai_strategy = {
							type = contain
							id = PREV
							value = 500
						}
						add_ai_strategy = {
							type = befriend
							id = PREV
							value = -500
						}
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -500
						}
						add_ai_strategy = {
							type = ignore
							id = PREV
							value = -200
						}
						var:nuked = {
							PREV = {
								add_ai_strategy = {
									type = protect
									id = PREV
									value = 500
								}
								add_ai_strategy = {
									type = alliance
									id = PREV
									value = 500
								}
								add_ai_strategy = {
									type = send_volunteers_desire
									id = PREV
									value = 500
								}
								add_ai_strategy = {
									type = support
									id = PREV
									value = 500
								}
								add_ai_strategy = {
									type = ignore
									id = PREV
									value = -200
								}
							}
						}
					}
					add_opinion_modifier = {
						target = event_target:griffonstone_nuker
						modifier = nuked_griffonstone
					}
					add_opinion_modifier = {
						target = event_target:griffonstone_nuker
						modifier = CHN_embargo
					}
				}
				else_if = {
					limit = {
						FROM = { state = 382 }
						NOT = { has_global_flag = greifenheim_nuked }
					}
					set_global_flag = greifenheim_nuked
					news_event = { id =  nuke_dropped.102 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 377 }
						NOT = { has_global_flag = aquila_nuked }
					}
					set_global_flag = aquila_nuked
					news_event = { id =  nuke_dropped.103 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 371 }
						NOT = { has_global_flag = karthin_nuked }
					}
					set_global_flag = karthin_nuked
					news_event = { id =  nuke_dropped.104 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 415 }
						NOT = { has_global_flag = magehold_nuked }
					}
					set_global_flag = magehold_nuked
					news_event = { id =  nuke_dropped.105 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 381 }
						NOT = { has_global_flag = skyfall_nuked }
					}
					set_global_flag = skyfall_nuked
					news_event = { id =  nuke_dropped.106 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 3 }
						NOT = { has_global_flag = canterlot_nuked }
					}
					set_country_flag = nuked_canterlot
					set_global_flag = canterlot_nuked
					news_event = { id =  nuke_dropped.107 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 619 }
						NOT = { has_global_flag = rijekograd_nuked }
					}
					set_global_flag = rijekograd_nuked
					news_event = { id =  nuke_dropped.108 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = {
							OR = { ##### There are 3 proinces named Crystal City
								state = 53
								state = 345
								state = 344
							}
						}
						NOT = { has_global_flag = crystalcity_nuked }
					}
					set_global_flag = crystalcity_nuked
					news_event = { id =  nuke_dropped.109 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 153 }
						153 = {is_capital = yes}
						NOT = { has_global_flag = stalliongrad_nuked }
					}
					set_global_flag = stalliongrad_nuked
					news_event = { id = nuke_dropped.110 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 875 }
						NOT = { has_global_flag = colthage_nuked }
					}
					set_global_flag = colthage_nuked
					news_event = { id = nuke_dropped.111 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 1165 }
						NOT = { has_global_flag = mount_aris_nuked }
					}
					set_global_flag = mount_aris_nuked
					news_event = { id = nuke_dropped.112 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 712 }
						NOT = { has_global_flag = new_ayacachtli_nuked }
					}
					set_global_flag = new_ayacachtli_nuked
					news_event = { id = nuke_dropped.113 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 817 }
						817 = { has_state_flag = KIR_KirCorWar_817_nuking }
						NOT = { has_global_flag = KirCorWar_radiance_nuked }
					}
					set_global_flag = KirCorWar_radiance_nuked
					news_event = { id = nuke_dropped.114 hours = 3 }
				}
				else_if = {
					limit = {
						FROM = { state = 1139 }
						1139 = { has_state_flag = S1139_thunder_tiger_nuking }
						NOT = { has_global_flag = thunder_tiger_nuked }
					}
					set_global_flag = thunder_tiger_nuked
					news_event = { id = nuke_dropped.115 hours = 3 }
				}
			}
		}
	}

	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_puppet"
			handle_cosmetic_tag_and_puppet_change_on_puppet = yes
			FROM = { remove_opinion_modifier = { target = ROOT modifier = cry_betrayal } }
			LUS_load_commie_focus = yes
			BRF_load_mason_focus = yes
			GRU_load_commie_tree = yes
			FLO_load_ideology_focus = yes
			WIT_load_ideology_focus = yes
			FRN_load_ideology_focus = yes
			CTH_load_ideology_focus = yes
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_country_flag = is_changeling_puppet
					NOT = { tag = EQS }
				}
				country_event = changelings.910
			}
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}
			if = {
				limit = { original_tag = BAK }
				load_focus_tree = generic_griffon_focus
			}
			else_if = {
				limit = { original_tag = HLR }
				load_focus_tree = generic_griffon_focus
			}
			else_if = {
				limit = { original_tag = HIE }
				load_focus_tree = generic_zebra_focus
			}
			else_if = {
				limit = { original_tag = TRO }
				load_focus_tree = generic_zebra_focus
			}
			else_if = {
				limit = {
					ROOT = {
						original_tag = CES 
					}
					FROM = {
						NOT = {
							original_tag = EQS
							original_tag = SOL
						}
					}
				}
				load_focus_tree = generic_focus
			}
			if = {
				limit = {
					NOT = { original_tag = EQS }
					has_country_flag = is_luna_puppet
				}
				country_event = lunas.910
			}
			else_if = {
				limit = {
					has_country_flag = is_solar_puppet
				}
				country_event = solarempire.1007
			}
			else_if = {
				limit = {
					has_country_flag = EQC_puppet
				}
				country_event = mareland.79
			}
			else_if = {
				limit = {
					has_country_flag = is_FAT_puppet
				}
				country_event = griffonRepublic.101
			}
			if = {
				limit = {
					ROOT = {
						original_tag = ELF
					}
					FROM = {
						OR = {
							original_tag = CHN
							original_tag = MAN
						}
					}
				}
				if = {
					limit = {
						MAN = { is_subject_of = CHN }
						country_exists = MAN
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = ELF
							transfer_troops = no
						}
					}
				}
				else = {
					CHN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = ELF
							transfer_troops = no
						}
					}
					CHN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = MAN
							transfer_troops = yes
						}
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						is_river_fed_member = yes
					}
					FROM = {
						is_river_fed_member = no
					}
				}
				RIV_leave_fed_no_ally = yes
			}
			if = {#If RCT has done Friendship Without Borders, this will apply it to any future vassals they make
				limit = {
					FROM = {
						original_tag = RCT
						has_completed_focus = RCT_friendship_without_borders
					}
					ROOT = {
						NOT = {
							has_idea = RCT_friendship_without_borders_idea
						}
					}
				}
				add_ideas = RCT_friendship_without_borders_idea
			}

			if = {
				limit = {
					FROM = {
						tag = HIP
						has_government = fascism
						has_country_flag = HIP_arisfirst_government
					}
					ROOT = {
						tag = WAR
					}
				}
				ROOT = {
					add_country_leader_role = {
						character = WAR_king_zarizel_ii
						promote_leader = yes
						country_leader = {
							expire = "1965.1.1"
							ideology = oligarchism
						}
					}
					set_cosmetic_tag = WAR_HIP_protectorate
					remove_country_leader_trait = patriot_king
					add_stability = -0.05
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_party_name = {
						ideology = neutrality
						long_name = WAR_neutrality_party_HIP_long
						name = WAR_neutrality_party_HIP
					}
					add_popularity = {
						ideology = neutrality
						popularity = 0.20
					}
					add_popularity = {
						ideology = democratic
						popularity = 0.20
					}
					country_event = {
						id = arisfirst.712
						months = 14
					}
					add_ideas = fascist_influence
				}
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = {
					tag = NIM
				}
				NIM_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = { original_tag = CRY }
				country_event = solarempiresparkles.102
			}

			FAT_add_puppet_ideas = yes

			#JUN_handle_puppet = yes

			CRY_check_for_Sombra_when_released = yes

			handle_twilight_escaping = yes

			if = {
				limit = { original_tag = CHN }
				CHN_demilitarise = yes
				if = {
					limit = {
						FROM = {
							OR = {
								original_tag = EQS
								original_tag = CRY
								AND = {
									original_tag = CES
									has_country_flag = CES_resistance_path
								}
							}
							has_government = democratic
						}
					}
					FROM = {
						country_event = { id = news.2101 days = 1 }
						if = {
							limit = {
								is_ai = yes
							}
							every_owned_state = {
								limit = {
									is_core_of = CHN
								}
								transfer_state_to = CHN
							}
						}
					}
					CHN = {
						drop_cosmetic_tag = yes
						set_cosmetic_tag = CHN_thorax
					}
					EQS_force_OLE_release_when_puppeting_CHN = yes
				}
				load_focus_tree = generic_focus
				CHN_handle_fascist_communist_overlord = yes
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				CRY_process_when_puppeted_by_EQS = yes
				CHN_remove_pony_opinion_maluses = yes
			}

			if = {
				limit = {
					FROM = {
						OR = {
							original_tag = CRY
							original_tag = EQC
						}
					}
				}
				remove_opinion_modifier = { target = FROM modifier = CHN_embargo }
				FROM = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
				remove_opinion_modifier = { target = FROM modifier = mortal_enemies }
				FROM = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
			}
			if = {
				limit = {
					original_tag = CRY
					FROM = {
						original_tag = NLR
					}
				}
				set_cosmetic_tag = CRY_NLR
				FROM = {
					set_autonomy = {
						target = ROOT
						autonomy_state = autonomy_reichsprotectorate
					}
				}
				set_country_flag = CRY_lunar_governorship
				set_country_flag = is_luna_puppet
				set_stability = 0.3
				set_war_support = 0.3
				load_focus_tree = crystal_empire_lunar_focus
				set_party_name = { ideology = fascism name = NLR_fascism_party long_name = NLR_fascism_party_long }
				add_country_leader_role = {
					character = CRY_nightmare_moon
					promote_leader = yes
					country_leader = {
						expire = "1965.1.1"
						ideology = nazism
						traits = {
							provisional
						}
					}
				}
				if = {
					limit = {
						has_character = CRY_reese
					}
					CRY_reese = {
						set_nationality = SOL
					}
				}
				if = {
					limit = {
						has_character = CRY_cloudie
					}
					CRY_cloudie = {
						set_nationality = SOL
					}
				}
				if = {
					limit = {
						has_character = CRY_wondermane
					}
					CRY_wondermane = {
						set_nationality = SOL
					}
				}
			}

			set_have_regular_puppets = yes

			GRI_remove_RIV_opinion_modifiers = yes

			if = {
				limit = {
					OR = {
						original_tag = JER
						original_tag = JEB
						original_tag = JFT
						original_tag = JRR
						original_tag = VIN
					}
					FROM = {
						OR = {
							original_tag = JER
							original_tag = JEB
							original_tag = JFT
							original_tag = JRR
							original_tag = VIN
						}
					}
				}
				country_event = {
					id = utility.13 hours = 1
				}
				FROM = {
					country_event = {
						id = utility.13 hours = 1
					}
				}
			}

			else_if = {
				limit = {
					original_tag = FEA
					OR = {
						has_cosmetic_tag = FEA_PvdA_old_flag
						has_cosmetic_tag = FEA_PvdA_old_flag_GRI_Puppet
					}
					FROM = { has_government = communism }
				}
				drop_cosmetic_tag = yes
			}

			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}

			AI_puppet_to_annex = yes

			if = {
				limit = {
					original_tag = BRF
					FROM = { has_government = communism }
				}
				BRF_communist_GRW_not_communist = yes
			}
			else_if = {
				limit = {
					original_tag = GRW
					FROM = { NOT = { has_government = communism } }
				}
				BRF_communist_GRW_not_communist = yes
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
					original_tag = BUF
				}
				country_event = bufstate.36
			}
			if = {
				limit = {
					original_tag = JAK
					FROM = {
						OR = {
							has_government = communism 
							has_government = democratic 
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}
			else_if = {
				limit = {
					original_tag = YAK
					FROM = {
						OR = {
							has_government = fascism 
							has_government = neutrality
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CHN
						has_government = fascism
					}
					ROOT = { original_tag = EQS }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
					}
					ROOT = { original_tag = BAT }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 } #I don't know why. I don't know how. But something related to this is crashing the game. Too Bad! -Knife.
					annex_country = { target = ROOT  } #Play as Harmonist HIP, win NZW, Kill WNG first, then kill NZW participants. Puppet BAT, crash game. Why? I don't even.
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CVA
					}
					ROOT = { original_tag = CTH }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CVA
					}
					ROOT = { original_tag = CDR }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CVA
					}
					ROOT = { original_tag = CTC }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					ROOT = { original_tag = BAT }
				}
				ROOT = {
					load_focus_tree = {
						tree = generic_zebra_focus
						keep_completed = yes
					}
				}
			}

			if = {
				limit = {
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAL
					}
					FROM = {
						NOT = {
							has_government = communism
						}
					}
				}
				ROOT = {
					load_focus_tree = generic_focus
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CHN
						has_country_flag = CHN_FRV_flag
					}
				}
				ROOT = { set_cosmetic_tag = CFR_PUPPET }
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = HIN
							original_tag = CTL
							original_tag = SAM
							original_tag = BRS
						}
					}
					FROM = {
						OR = {
							original_tag = HIN
							original_tag = CTL
							original_tag = SAM
							original_tag = BRS
						}
					}
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
						has_country_flag = HIP_siren_takeover
					}
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					original_tag = FRN
					FROM = {
						original_tag = WNG
					}
				}
				FROM = {
					every_owned_state = {
						limit = {
							is_core_of = JES
						}
						transfer_state_to = ROOT
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = JER
							original_tag = JEB
							original_tag = JFT
							original_tag = JRR
							original_tag = VIN
						}
					}
					FROM = {
						original_tag = JES
						NOT = {
							has_government = fascism
						}
					}
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = PLB
						has_completed_focus = PLB_under_bear_protection
					}
				}
				add_ideas = PLB_economic_exploitation_idea
			}

			FROM = { ROOT = { apply_cosmetic_tags_on_puppet_PREV_is_overlord = yes } }
		}
	}

	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	on_release_as_puppet = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_release_as_puppet"
			handle_cosmetic_tag_and_puppet_change_on_puppet = yes
			GRU_load_commie_tree = yes
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}
			if = {
				limit = {
					FROM = { original_tag = GRW }
					ROOT = { original_tag = BRF }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			else_if = {
				limit = {
					FROM = { original_tag = BRF }
					ROOT = { original_tag = GRW }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ROOT
					}
				}
			}
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = HIP
						has_government = fascism
						has_country_flag = HIP_arisfirst_government
					}
					ROOT = {
						tag = WAR
					}
				}
				ROOT = {
					add_country_leader_role = {
						character = WAR_king_zarizel_ii
						promote_leader = yes
						country_leader = {
							expire = "1965.1.1"
							ideology = oligarchism
						}
					}
					set_cosmetic_tag = WAR_HIP_protectorate
					remove_country_leader_trait = patriot_king
					add_stability = -0.05
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_party_name = {
						ideology = neutrality
						long_name = WAR_neutrality_party_HIP_long
						name = WAR_neutrality_party_HIP
					}
					add_popularity = {
						ideology = neutrality
						popularity = 0.20
					}
					add_popularity = {
						ideology = democratic
						popularity = 0.20
					}
					country_event = {
						id = arisfirst.712
						months = 15
					}
					add_ideas = fascist_influence
				}
			}
			if = {
				limit = {
					FROM = { NOT = { tag = HLQ } }
					NOT = { tag = HLQ }
				}
				if = {
					limit = {
						owns_state = 387
					}
					reset_province_name = 8079
				}
				if = {
					limit = {
						owns_state = 619
					}
					reset_province_name = 5013
				}
				if = {
					limit = {
						owns_state = 645
					}
					reset_province_name = 11911
				}
			}
			GRI_give_released_puppet_special_cosmetic_tags = yes
			GRU_give_released_puppet_special_cosmetic_tags = yes
			FAT_add_puppet_ideas = yes

			if = {
				limit = {
					tag = DED
					FROM = {
						NOT = {
							original_tag = ZAI
							has_cosmetic_tag = Terathopia
							has_cosmetic_tag = Terathopia_2
							has_cosmetic_tag = Terathopia_3
						}
					}
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
					country_event = { id = deadempire.29 days = 1 }
				}
			}
			if = {
				limit = { FROM = { tag = DED } }
				set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
				annex_country = { target = FROM  }
			}
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {#If RCT has done Friendship Without Borders, this will apply it to any future vassals they make
				limit = {
					FROM = {
						original_tag = RCT
						has_completed_focus = RCT_friendship_without_borders
					}
					ROOT = {
						NOT = {
							has_idea = RCT_friendship_without_borders_idea
						}
					}
				}
				add_ideas = RCT_friendship_without_borders_idea
			}
			if = {
				limit = {
					ROOT = {
						is_river_fed_member = yes
					}
					FROM = {
						is_river_fed_member = no
					}
				}
				RIV_leave_fed_no_ally = yes
			}

			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = WIT
							original_tag = RCT
							original_tag = LCT
							original_tag = FRE
							original_tag = DEP
							original_tag = DMT
							original_tag = BAK
							original_tag = NIM
						}
						is_river_fed_member = no
					}
				}
				RIV_drop_cosmetic_tag = yes
			}

			LUS_load_commie_focus = yes

			BRF_load_mason_focus = yes

			FLO_load_ideology_focus = yes

			WIT_load_ideology_focus = yes

			if = {
				limit = { original_tag = BAK }
				load_focus_tree = generic_griffon_focus
			}
			else_if = {
				limit = { original_tag = HLR }
				load_focus_tree = generic_griffon_focus
			}
			else_if = {
				limit = { original_tag = HIE }
				load_focus_tree = generic_zebra_focus
			}
			else_if = {
				limit = { original_tag = TRO }
				load_focus_tree = generic_zebra_focus
			}


			FRN_load_ideology_focus = yes

			CTH_load_ideology_focus = yes

			if = {
				limit = { original_tag = BRF }
				BRF = {	country_event = brodfeld.27 }
			}

			if = {
				limit = { original_tag = CHN }
				CHN_handle_fascist_communist_overlord = yes
				CHN_demilitarise = yes
			}

			if = {
				limit = { original_tag = CRY }
				country_event = solarempiresparkles.102
			}

			CRY_check_for_Sombra_when_released = yes

			if = {
				limit = { FROM = { original_tag = NLR } original_tag = EQS }
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ROOT
					}
				}
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				if = {
					limit = { original_tag = NLR }
					FROM = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = ROOT
						}
					}
				}
				CRY_process_when_puppeted_by_EQS = yes
				CHN_remove_pony_opinion_maluses = yes
			}

			if = {
				limit = {
					original_tag = BRF
					FROM = { has_government = communism }
				}
				BRF_communist_GRW_not_communist = yes
			}

			if = {
				limit = {
					original_tag = GRW
					FROM = { NOT = { has_government = communism } }
				}
				BRF_communist_GRW_not_communist = yes
			}
			if = {
				limit = {
					original_tag = JAK
					FROM = {
						OR = {
							has_government = communism 
							has_government = democratic 
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}
			else_if = {
				limit = {
					original_tag = YAK
					FROM = {
						OR = {
							has_government = fascism 
							has_government = neutrality
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = {
					tag = NIM
				}
				NIM_load_focus_tree_on_puppet = yes
			}

			set_have_regular_puppets = yes

			#JER_complete_focuses_based_on_overlord = yes

			transfer_society_and_science_ideas_when_released = yes

			if = {
				limit = {
					FROM = {
						has_country_flag = FEA_STW_union
					}
					OR = {
						tag = STW
						tag = FEA
					}
				}
				FROM = {
					set_autonomy = {
						target = ROOT
						autonomy_state = autonomy_personal_union_eaw
					}
					clr_country_flag = FEA_STW_union
					drop_cosmetic_tag = yes
					reapply_secondary_cosmetic_tags = yes
				}
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
					original_tag = BUF
				}
				country_event = bufstate.36
			}
			if = {
				limit = {
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					FROM = {
						is_subject = no
						original_tag = CHN
						has_government = fascism
					}
					ROOT = {
						NOT = { ## insert tags with specially-named ruling parties as necessary ##
							original_tag = MAN
						}
					}
				}
				ROOT = {
					set_party_name = {
						ideology = fascism
						long_name = CHN_puppet_changeling_administration
						name = CHN_puppet_changeling_administration
					}
					add_popularity = {
						ideology = fascism
						popularity = 0.25
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = CHN
						has_country_flag = CHN_FRV_flag
					}
				}
				ROOT = { set_cosmetic_tag = CFR_PUPPET }
			}
			if = {
				limit = {
					FROM = {
						original_tag = FRN
					}
					ROOT = { original_tag = JES }
				}
				FROM = {
					country_event = {
						id = francistria.78
						days = 1
					}
				}
			}
			if = {
				limit = {
					original_tag = FRN
					FROM = {
						original_tag = WNG
					}
				}
				FROM = {
					every_owned_state = {
						limit = {
							is_core_of = JES
						}
						transfer_state_to = ROOT
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = PLB
						has_completed_focus = PLB_under_bear_protection
					}
				}
				add_ideas = PLB_economic_exploitation_idea
			}
			FROM = { ROOT = { apply_cosmetic_tags_on_puppet_PREV_is_overlord = yes } }

			actually_fix_weapon_techs = yes
			FROM = { actually_fix_weapon_techs = yes }
		}
	}

	#ROOT is subject FROM is overlord
	on_subject_annexed = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_subject_annexed FROM = [From.GetName]"
			if = {
				limit = {
					NOT = {
						has_country_flag = bypass_annex_compliance
						FROM = { has_country_flag = bypass_annex_compliance }
						is_in_array = {
							annex_compliance = FROM
						}
					}
				}
				add_to_array = {
					annex_compliance = FROM
				}
				add_to_array = {
					annex_compliance_subject = FROM
				}
				country_event = { id = utility.11 }
			}
			if = {
				limit = {
					OR = {
						tag = STW
						tag = FEA
					}
					OR = {
						has_country_flag = FEA_STW_marriage
						FROM = { has_country_flag = FEA_STW_marriage }
					}
					FROM = {
						OR = {
							tag = STW
							tag = FEA
						}
						OR = {
							has_country_leader = { ruling_only = yes character = STW_gabriela_eagleclaw }
							has_idea = FEA_beloved_monarch
							has_idea = FEA_beloved_monarch_2
							has_idea = FEA_beloved_monarch_3
						}
					}
					OR = {
						has_country_leader = { ruling_only = yes character = STW_gabriela_eagleclaw }
						has_idea = FEA_beloved_monarch
						has_idea = FEA_beloved_monarch_2
						has_idea = FEA_beloved_monarch_3
					}
				}
				FROM = {
					set_country_flag = FEA_STW_union
					set_cosmetic_tag = FEA_STW_union
				}
			}
		}
	}

	#ROOT is winner #FROM gets annexed - For civil wars on_civil_war_end is also fired
	on_annex = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_annex"
			FROM = { remove_from_global_arrays_on_annex = yes }

			if = {
				limit = {
					NOT = { has_global_flag = river_federation_founded }
					FROM = {
						is_river_fed_member = yes
						var:faction_leader = {
							is_river_fed_member = yes
						}
					}
				}
				RIV_find_new_leader = yes
			}

			if = {
				limit = {
					NOT = {
						FROM = { tag = SOL }
						has_country_flag = bypass_annex_compliance
						FROM = { has_country_flag = bypass_annex_compliance }
						is_in_array = {
							annex_compliance = FROM
						}
					}
				}
				add_to_array = {
					annex_compliance = FROM
				}
				if = {
					limit = {
						FROM = { is_subject_of = ROOT }
					}
					add_to_array = {
						annex_compliance_subject = FROM
					}
				}
				country_event = { id = utility.11 }
			}
			if = {
				limit = {
					FROM = { tag = GRD }
				}
				FROM = {
					if = {
						limit = {
							has_puppet_cosmetic_flag = no
						}
						drop_cosmetic_tag = yes
						reapply_secondary_cosmetic_tags = yes
					}
					clr_country_flag = holds_griffon_capital
				}
				GRI = {
					save_global_event_target_as = griffonian_empire
					set_variable = { global.griffonian_empire_var = THIS }
				}
			}

			if = {
				limit = {
					OR = {
						tag = FAW
						original_tag = FAT
					}
					FROM = { tag = FAT }
				}
				FAT = { FAT_kill_kemerskai = yes }
			}
			else_if = {
				limit = {
					FROM = { tag = FAW exists = no }
				}
				for_each_scope_loop = {
					array = FAW.core_states
					add_core_of = FAT
					remove_core_of = FAW
				}
			}

			if = {
				limit = {
					FROM = {
						OR = {
							tag = LNS
							tag = LSM
							tag = LSC
						}
					}
					OR = {
						tag = LNS
						tag = LSM
						tag = LSC
					}
				}
				save_global_event_target_as = longsword
			}

			FROM = {
				every_owned_state = {
					limit = {
						has_state_flag = eqs_bat_state
					}
					add_core_of = EQS
					clr_state_flag = eqs_bat_state
				}
			}
			every_owned_state = {
				limit = {
					has_state_flag = eqs_bat_state
				}
				add_core_of = EQS
				clr_state_flag = eqs_bat_state
			}

			if = {
				limit = {
					tag = CHN
					FROM = { original_tag = OLE }
				}
				FROM = { set_country_flag = OLE_was_annexed }
			}

			handle_twilight_escaping = yes

			if = {
				limit = {
					FROM = {
						tag = JER
						has_idea = JER_revolutionary
					}
					FAT = {
						exists = yes
						is_subject = no
					}
				}
				FAT = { country_event = { id = griffonRepublic.83 days = 15 } }
			}
			if = {
				limit = {
					FROM = {
					 tag = FAT
					}
					FAW = {
						exists = no
					}
					485 = {
						owner = {
							NOT = { has_country_flag = have_regular_puppets }
						}
					}
					HAU = {
						exists = yes
						is_subject = no
						NOT = {
							owns_state = 6
							owns_state = 7
							owns_state = 8
							owns_state = 9
							owns_state = 10
						}
					}
				}
				HAU = { country_event = { id = haukland.27 days = 8 } }
			}
			if = {
				limit = {
					OR = {
						tag = JEB
						tag = VIN
						tag = JFT
						tag = JRR
					}
					NOT = {
						has_government = democratic
						has_government = communism
						AND = {
							tag = JRR
							has_country_flag = JER_JRR_revolutionary
						}
					}
					FROM = {
						tag = JER
						has_completed_focus = JER_fight_for_freedom
					}
				}
				country_event = aquileia_news.4
			}

			if = {
				limit = {
					OR = {
						AND = {
							tag = JER
							has_completed_focus = JER_fight_for_freedom
							FROM = {
								OR = {
									tag = JEB
									tag = VIN
									tag = JFT
									tag = JRR
								}
							}
							OR = {
								has_government = democratic
								has_government = communism
							}
							JEB = { OR = { exists = no is_subject_of = ROOT } }
							JRR = { OR = { exists = no is_subject_of = ROOT } }
							VIN = { OR = { exists = no is_subject_of = ROOT } }
							JFT = { OR = { exists = no is_subject_of = ROOT } }
						}
						AND = {
							OR = {
								tag = JEB
								tag = VIN
								tag = JFT
								tag = JRR
							}
							FROM = {
								tag = JER
								NOT = { has_completed_focus = JER_fight_for_freedom }
							}
							OR = {
								has_government = democratic
								has_government = communism
								AND = {
									tag = JRR
									has_country_flag = JER_JRR_revolutionary
								}
							}
						}
					}
				}
				FEZ = {
					country_event = {
						id = fezera.126
						days = 5
					}
					country_event = {
						id = fezera.127
						days = 30
					}
				}
				country_event = fezera.131
			}
			if = {
				limit = {
					tag = BRF
					FROM = { tag = GRW }
				}
				country_event = { id = brodfeld.21 days = 1 }
			}
			else_if = {
				limit = {
					tag = GRW
					FROM = { tag = BRF }
				}
				country_event = { id = prywhen.1 days = 1 }
			}
			if = {
				limit = {
					OR = {
						original_tag = JER
						original_tag = JEB
						original_tag = JFT
						original_tag = JRR
						original_tag = VIN
					}
					FROM = {
						OR = {
							original_tag = JER
							original_tag = JEB
							original_tag = JFT
							original_tag = JRR
							original_tag = VIN
						}
					}
				}
				country_event = {
					id = utility.13 hours = 1
				}
				FROM = {
					country_event = {
						id = utility.13 hours = 1
					}
				}
			}
			if = {
				limit = {
					FROM = { has_idea = EQC_funding_the_resistiance }
				}
				FROM = { remove_ideas = EQC_funding_the_resistiance }
				EQS = { remove_ideas = EQC_resistance }
				ELF = { remove_ideas = EQC_resistance }
			}
			if = {
				limit = {
					FROM = { original_tag = EQC }
				}
				356 = {
					reset_state_name = yes
				}
			}

			if = {
				limit = {
					FROM = { tag = NCH }
				}
				set_variable = {
					NCH_trade_partners_iter = 0
				}
				NCH_get_trading_idea = yes
			}
			if = {
				limit = {
					FROM = {
						original_tag = BAR
					}
				}
				FROM = {
					BAR_clear_mess_puppet = yes
				}
			}
			ZES_oppressive_countries_calculate = yes
			if = {
				limit = {
					FROM = {
						tag = GRI
						GRI_synovial = { is_unit_leader = yes }
					}
				}
				remove_ideas = CHN_GRI_Attache_For_GRI
				CHN = { remove_ideas = CHN_GRI_Attache_For_CHN }
				FROM = {
					GRI_thranx = { set_nationality = CHN }
					GRI_synovial = {
						set_nationality = CHN
						set_portraits = {
							army = { large ="GFX_Synovial_CHN_cap" }
						}
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = LUS
					}
					ROOT = {
						original_tag = HLQ
						has_country_flag = HLQ_commies_attack_lushi
					}
				}
				country_event = { id = hellquill.252 days = 2 }
			}
			if = {
				limit = {
					NOT = {
						original_tag = FRN
					}
					FROM = {
						OR = {
							original_tag = JES
							original_tag = FRN
						}
					}
				}
				FRN_reduce_tarrin_resistance = yes
			}
			if = {
				limit = {
					tag = WNG
					FROM = {
						tag = JES
					}
					FRN = {
						exists = yes
						OR = {
							is_in_faction_with = ROOT
							is_subject_of = ROOT
						}
					}
				}
				every_owned_state = {
					limit = {
						is_core_of = JES
					}
					transfer_state_to = FRN
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = WNG
						has_idea = WNG_garibald_talonuel_iii
					}
				}
				if = {
					limit = {
						FRN = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = FRN
						}
					}
					FRN = {
						country_event = wingbardy.35
					}
				}
				else_if = {
					limit = {
						TAL = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = TAL
						}
					}
					TAL = {
						country_event = wingbardy.35
					}
				}
				else_if = {
					limit = {
						ARA = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = ARA
						}
					}
					ARA = {
						country_event = wingbardy.35
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = JUN
					}
					country_exists = CES
				}
				CES = {
					country_event = {
						id = daring.15
						days = 7
					}
				}	
			}
			if = {
				limit = {
					OR = {
						original_tag = CES
						original_tag = BAL
						original_tag = JUN
					}
					FROM = {
						tag = NMS
					}
					count_triggers = {
						amount = 2 #at least 2 triggers are true
						country_exists = CES
						country_exists = JUN
						country_exists = BAL
					}
				}
				country_event = {
					id = daring.3
				}
			}
			if = {
				limit = {
					tag = FAT
					has_country_leader = {
						ruling_only = yes
						character = FAT_warmaster_dawnclaw
					}
					NTR = {
						OR = {
							FROM = { tag = NTR }
							exists = no
							is_subject_of = FAT
						}
					}
					SRS = {
						OR = {
							FROM = { tag = SRS }
							exists = no
							is_subject_of = FAT
						}
					}
					VED = {
						OR = {
							FROM = { tag = VED }
							exists = no
							is_subject_of = FAT
						}
					}
					MNC = {
						OR = {
							FROM = { tag = MNC }
							exists = no
							is_subject_of = FAT
						}
					}
				}

				country_event = {
					id = chaos.28
					days = 7
					random_days = 7
				}
			}
			if = {
				limit = {
					tag = GRF
					FROM = {
						tag = GFF
					}
					NOT = {
						has_global_flag = GRF_civil_war_begun
					}
				}
				GRF = {
					country_event = {
						id = griffons.168
						days = 14
					}
				}
			}

			actually_fix_weapon_techs = yes
		}
	}

	#ROOT is winner #FROM gets annexed - This fires just before FROM gets annexed, meaning the country and everything it owns still exists. It will also fire on_annex and on_civil_war_end
	on_civil_war_end_before_annexation = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_civil_war_end_before_annexation FROM = [From.GetName]"
			FROM = {
				transfer_navy = { target = ROOT }
			}
			if = {
				limit = {
					FROM = {
						original_tag = CRY
						OR = {
							has_character = CRY_princess_mi_amore_cadenza
							has_character = CRY_shining_armour
							has_character = CRY_flurry_heart
							has_character = CRY_flash_sentry
						}
					}
				}
				FROM = {
					CRY_princess_mi_amore_cadenza = {
						set_nationality = SOL
					}
					CRY_shining_armour = { set_nationality = SOL }
					every_character = {
						set_character_flag = CRY_escapee
						set_nationality = SOL
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						original_tag = WNG
						original_tag = OLE
					}
				}
				if = {
					limit = { original_tag = OLE }
					FROM = {
						every_character = {
							limit = {
								is_unit_leader = yes
								is_country_leader = no
							}
							set_nationality = SOL
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = CTC
					FROM = {
						tag = CTA
					}
				}
				every_controlled_state = {
					remove_core_of = CTA
					remove_claim_by = CTA
				}
			}
		}
	}

	#ROOT is winner FROM gets annexed
	on_civil_war_end = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_civil_war_end"
			if = {
				limit = {
					original_tag = FBK
				}
				if = {
					limit = { NCH = { has_country_flag = NCH_Farbrook_Civil_War_Flag } }
					if = {
						limit = { NOT = { has_government = fascism } }
						NCH = { country_event = { id = greneclyf.43 days = 2 } }
						else = {
							NCH = { country_event = { id = greneclyf.37 days = 1 } }
						}
					}
				}
				else_if = {
					limit = { NCH = { has_country_flag = NCH_Farbrook_Commie_Civil_War_Flag } }
					if = {
						limit = { NOT = { has_government = communism } }
						NCH = { country_event = { id = greneclyf.55 days = 2 } }
						else = {
							NCH = { country_event = { id = greneclyf.49 days = 1 } }
						}
					}
				}
			}
			if = {
				limit = {
					is_EQS_SOL = yes
					FROM = {
						original_tag = EQS
					}
					has_global_flag = equestrian_civil_war_daybreaker
					NOT = { has_global_flag = equestrian_civil_war_daybreaker_ended }
				}
				country_event = { id =  news.sol.31 days = 1 }
			}
			else_if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					has_global_flag = equestrian_civil_war_daybreaker
					NOT = { has_global_flag = equestrian_civil_war_daybreaker_ended }
				}
				country_event = { id = news.sol.21 days = 1 }
			}
			if = {
				limit = {
					original_tag = EQS
					FROM = { original_tag = EQS has_government = communism }
					NOT = {
						has_country_flag = EQS_april_fools
					}
				}
				country_event = { id = equestriadem.8 days = 60 }
				country_event = { id = equestria.44 days = 1 }
			}
			if = {
				limit = {
					tag = event_target:equestria
					FROM = { tag = event_target:solar_empire }
				}
				set_capital = { state = 3 remember_old_capital = no }
				SOL = { save_global_event_target_as = solar_empire }
			}
			else_if = {
				limit = {
					FROM = { tag = event_target:equestria }
					tag = event_target:solar_empire
				}
				SOL = {
					set_politics = { ruling_party = democratic }
					save_global_event_target_as = equestria
				}
				set_country_flag = { flag = SOL_next_civ_war_delay value = 1 days = 180 }
			}
			else_if = {
				limit = {
					original_tag = CRY
					FROM = { original_tag = CRY }
				}
				if = {
					limit = {
						has_government = fascism
						CRY_sombra = { is_country_leader = yes }
					}
					country_event = { id = crysom.16 hours = 12 }
					if = {
						limit = { event_target:equestria = { exists = yes } }
						random_list = {
							30 = {
								event_target:equestria = {
									country_event = { id = crysom.49 hours = 2 }
								}
								country_event = { id = crysom.50 hours = 1 }
							}
							70 = { country_event = { id = crysom.41 hours = 1 } }
						}
						else = { country_event = { id = crysom.41 hours = 1 } }
					}
				}
				if = {
					limit = {
						has_government = communism
						FROM = { has_government = democratic }
					}
					news_event = { id = news.cry.1 days = 1 }
				}
				set_capital = { state = 344 remember_old_capital = no }
			}
			else_if = {
				limit = {
					original_tag = OLE
				}
				set_capital = { state = 76 remember_old_capital = no }
				drop_cosmetic_tag = yes
			}
			else_if = {
				limit = {
					original_tag = RCT
				}
				set_capital = { state = 619 remember_old_capital = no }
			}
			#End of ideology Civil War
			else_if = {
				limit = {
					original_tag = WNG
				}
				set_capital = { state = 371 remember_old_capital = no }
				# Give back WNG focus tree to Beakolini if he wins the civil war.
				if = {
					limit = {
						has_government = fascism
						FROM = {
							NOT = { has_government = fascism }
						}
					}
					news_event = { id = news_wingbardy.9 days = 1 }
					if = {
						limit = { is_in_faction = no is_subject = no }
						create_faction = Southern_Kingdoms
					}
					setup_WNG_parliament = yes
					setup_WNG_only_fascism_government = yes
				}
				#End WNG Civil War Event
				if = {
					limit = {
						FROM = {
							has_government = fascism
						}
						NOT = { has_government = fascism }
					}
					country_event = { id = wingbardy.51 days = 1 }
					news_event = { id = news_wingbardy.8 days = 1 }
				}
			}
			#End of EQC MARESOC Civil War
			else_if = {
				limit = {
					FROM = {
						original_tag = EQC
						has_country_flag = is_maresoc
					}
					original_tag = EQC
				}
				country_event = { id = mareland.26 days = 1 }
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQC
					}
					original_tag = EQC
					has_country_flag = is_maresoc
				}
				country_event = { id = mareland.27 days = 1 }
			}
			else_if = {
				limit = {
					original_tag = LUS
					FROM = { original_tag = LUS has_government = neutrality }
				}
				country_event = { id = lushi_peasants.1 days = 50 random_hours = 480 }#days to hours applied
			}
			else_if = {
				limit = {
					original_tag = FIR
					FROM = { original_tag = FIR }
				}
				country_event = { id = FIR.29 days = 1 }
			}
			else_if = {
				limit = {
					tag = CTA
					FROM = {
						tag = CTC
					}
				}
				country_event = colthage_civil_war.8
			}
			else_if = {
				limit = {
					tag = CTC
					FROM = {
						tag = CTA
					}
				}
				country_event = colthage_civil_war.9
				if = {
					limit = {
						CVA = {
							exists = yes
						}
					}
					CVA = {
						country_event = colthage_civil_war.16
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						tag = CTC
						tag = CTB
					}
					NOT = {
						has_country_flag = CTH_dont_trigger_this_twice
					}
					FROM = {
						original_tag = CTH
						has_country_flag = CTH_colthage_militarists
					}
				}
				CTC = {
					set_country_flag = CTH_dont_trigger_this_twice
					country_event = {
						id = colthage_civil_war.12
						days = 7
					}
				}
				CTB = {
					set_country_flag = CTH_dont_trigger_this_twice
					country_event = {
						id = colthage_civil_war.12
						days = 7
					}
				}
			}
			else_if = {
				limit = {
					tag = CTC
					FROM = {
						tag = CTB
					}
				}
				country_event = colthage_civil_war.13
			}
			else_if = {
				limit = {
					tag = CTB
					FROM = {
						tag = CTC
					}
				}
				country_event = colthage_civil_war.14
			}
			else_if = {
				limit = {
					original_tag = CTH
					has_country_flag = CTH_colthage_militarists
					OR = {
						AND = {
							FROM = {
								tag = CTC
							}
							CTB = {
								exists = no
							}
						}
						AND = {
							FROM = {
								tag = CTB
							}
							CTC = {
								exists = no
							}
						}
					}
				}
				country_event = colthage_civil_war.15
			}
			else_if = {
				limit = {
					original_tag = VED
				}
				country_event = vedina.76
			}
			else_if = {		#GRF disband the militia after the civil war
				limit = {
					original_tag = GRF
					has_country_flag = GRF_civil_war_flag
				}
				country_event = { id = griffons.142 days = 5 }
			}
			else_if = {
				limit = {
					original_tag = ZAR
					has_country_flag = ZAR_wormy
					FROM = {
						has_country_leader = { character = TBK_vasile ruling_only = yes }
					}
				}
				country_event = zarantia_worm.13
			}
			else_if = {
				limit = {
					original_tag = ZAI
					OR = {
						has_cosmetic_tag = Terathopia
						has_cosmetic_tag = Terathopia_2
						has_cosmetic_tag = Terathopia_3
					}
				}
				country_event = eaw_debug.35
			}
		}
	}

	# ROOT is capitulated country, FROM is winner
	# This is processed by the game BEFORE peace conference
	# If you have any effects that annex/change state ownership, put them here
	on_capitulation_immediate = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_capitulation_immediate"
			if = {
				limit = {
					tag = JES
					has_war_with = FRN
				}
				# Fire this here, otherwise it will be processed during peace conference,
				# and cause a CTD (loser state cannot be owned by non-loser, and this
				# event transfers states from loser)
				FRN = {
					country_event = francistria.82
				}
			}

			if = {
				limit = {
					is_in_faction = yes
					all_allied_country = {
						NOT = {
							has_war_with = FROM
						}
					}
				}
				leave_faction = yes
			}

			if = {
				limit = {
					NOT = { has_global_flag = river_federation_founded }
					OR = {
						AND = {
							is_river_fed_member = yes
							var:faction_leader = {
								is_river_fed_member = yes
							}
						}
						FROM = {
							is_river_fed_member = yes
							var:faction_leader = {
								is_river_fed_member = yes
							}
						}
					}
				}
				set_country_flag = RIV_cannot_be_leader
				RIV_find_new_leader = yes
				clr_country_flag = RIV_cannot_be_leader
			}
			if = {
				limit = {
					FROM = {
						original_tag = YAK
						has_country_flag = YAK_yona_and_rutherford_running_away
					}
					ROOT = {
						original_tag = JAK
					}
				}
				FROM = {
					clr_country_flag = YAK_yona_and_rutherford_running_away
					remove_country_leader_trait = YAK_absent_leader
				}
			}
			if = { #Remove AF Kaiser
				limit = {
					ROOT = {
						original_tag = ABY
						has_completed_focus = ABY_AF_are_worth_taking_over
						NOT = { has_country_flag = ABY_AF_kaiser_left }
					}
				}
				ROOT = {
					set_party_name = { ideology = neutrality long_name = ABY_neutrality_party_long name = ABY_neutrality_party }
					set_party_name = { ideology = fascism long_name = ABY_fascism_party_long name = ABY_fascism_party }
					set_party_name = { ideology = democratic long_name = ABY_democratic_party_long name = ABY_democratic_party }
					set_party_name = { ideology = communism long_name = ABY_communism_party_long name = ABY_communism_party }
					if = { limit = { has_idea = ABY_AF_taking_too_long } remove_ideas = ABY_AF_taking_too_long }
					remove_decision = ABY_AF_clock_is_ticking_kattail_mission
					load_focus_tree = generic_zebra_focus
					set_cosmetic_tag = ABY
					set_country_flag = ABY_AF_kaiser_left
					ABY_AF_kaiser_kattail = { retire = yes }
				}
			}
			if = { #auto annex because AI kaiser has problems
				limit = {
					FROM = { original_tag = ABY is_ai = yes }
					ROOT = { is_in_faction = no }
				}
				ROOT = {
					every_owned_state = { transfer_state_to = ABY }
				}
			}
		}
	}

	# ROOT is capitulated country, FROM is winner
	# This is processed by the game DURING peace conference
	# If you have any effects that annex/change state ownership, DO NOT put them here
	# as that will crash the peace conference
	on_capitulation = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_capitulation"
			if = {
				limit = {
					tag = CHN
				}
				GRI = { country_event = changelingattache.14 }
				if = {
					limit = {
						FROM = {
							is_ai = no
							original_tag = OLE
							is_in_faction = no
							is_subject = no
							NOT = {
								is_guaranteed_by = EQS
							}
						}
					}
					FROM = {
						set_country_flag = OLE_defeated_changelings_alone
					}
				}
				if = {
					limit = {
						FROM = {
							tag = EQS
							has_country_flag = EQS_received_KIR_volunteers
						}
					}
					KIR = {
						country_event = { id = kirin.761 days = 7 }
					}
				}
			}
			else_if = {
				limit = {
					tag = CCN
					FROM = { tag = CHN }
				}
				CHN = { country_event = { id = changelings.63 days = 1 } }
			}
			else_if = {
				limit = {
					FROM = {
						OR = {
							tag = DED
							tag = EWI
						}
					}
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					tag = NLR
					FROM = { tag = EQS }
				}
				transfer_navy = { target = FROM }
				if = {
					limit = {
						EQS = {
							has_government = democratic
						}
					}
					EQS = { country_event = { id = equestria.186 days = 6 } }
					EQC = { EQC_fix_focus_after_civilwar_loss = yes}
				}
			}
			else_if = {
				limit = {
					tag = EQS
					FROM = { tag = NLR }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					original_tag = FAT
					FROM = { original_tag = FAW }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					tag = GRB
					has_global_flag = YAK_STG_simultaneous_invasion
					FROM = {		
						OR = {
							tag = STG
							tag = YAK
							tag = GRA
						}
					}
				}
				if = {
					limit = {
						country_exists = GRA
					}
					GRA = {
						every_core_state = {
							limit = {
								OR = {
									is_owned_by = GRA
									is_owned_by = STG
								}
								is_claimed_by = YAK
							}
							transfer_state_to = YAK
						}
						annex_country = {
							target = GRB
						}
					}
				}
				else = {
					GRB = {
						every_core_state = {
							limit = {
								OR = {
									is_owned_by = GRB
									is_owned_by = STG
								}
								is_claimed_by = YAK
							}
							transfer_state_to = YAK
						}		
					}
					STG = {
						release_puppet = GRF
					}
				}
				random_country_with_original_tag = {
					original_tag_to_check = GRF
					limit = {
						has_government = communism
						exists = yes
						has_country_flag = GRF_civil_war_flag
					}
					country_event = { id = griffons.142 days = 5 }
					every_core_state = {
						limit = {
							NOT = {
								is_claimed_by = YAK
							}
							OR = {
								is_owned_by = GRF
								is_owned_by = STG
							}
						}
						transfer_state_to = PREV
					}
				}
				clr_global_flag = YAK_STG_simultaneous_invasion
			}
			else_if = {
				limit = { 
					tag = GRB
					YAK = {
						has_completed_focus = YAK_intervene_in_nova_civil_war # this is uncompleted if refused
					}
					FROM = {
						OR = {
							tag = GRA
							tag = STG
							tag = YAK
						}
					}
				}
				GRA = {
					every_owned_state = {
						limit = {
							is_claimed_by = YAK
						}
						transfer_state_to = YAK
					}
				}
			}
			else_if = {
				limit = { 
					tag = GRA
					country_exists = GRB
					FROM = {
						OR = {
							tag = STG
							tag = YAK
						}
					}
				}
				GRB = {
					country_event = { id = griffons.142 days = 5 }
				}
			}
			else_if = {
				limit = {
					original_tag = FAW
					FROM = { original_tag = FAT }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					is_in_faction_with = EQC
					EQC = {
						exists = yes
						has_capitulated = no
						NOT = {
							any_owned_state = {
								is_controlled_by = FROM
							}
						}
						#all_owned_state = {
						#	is_fully_controlled_by = EQC
						#}
					}
					#EQC = { has_completed_focus = EQC_strengthen_equestrian_ties }
				}
				EQC = {
					if = {
						limit = { FROM = { tag = CHN } }
						ROOT = {
							transfer_navy = { target = EQC }
							every_character = {
								limit = {
									is_navy_leader = yes
								}
								set_unit_leader_flag = used_to_be_EQS
								set_nationality = EQC
							}
						}
					}

					if = {
						limit = { is_subject = yes }
						end_puppet_this = yes
					}
					if = {
						limit = { is_in_faction = yes }
						leave_faction = yes
					}
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
					}
					if = {
						limit = { FROM = { tag = CHN } }
						set_country_flag = EQC_govt_in_exile
						set_cosmetic_tag = EQC_EQS
					}
					else_if = {
						limit = { FROM = { is_ai = no } }
						FROM = {
							create_wargoal = { target = ROOT type = puppet_wargoal_focus }
						}
					}
				}
			}
			if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					FROM = {
						NOT = { has_wargoal_against = HIP }
					}
					HIP = {
						exists = yes
						has_capitulated = no
						NOT = {
							any_owned_state = {
								OR = {
									is_controlled_by = FROM
									CONTROLLER = {
										is_ally_with = FROM
									}
								}
							}
						}
						has_war_with = FROM
					}
				}
				HIP = {
					if = {
						limit = { is_in_faction_with = EQS }
						leave_faction = yes
					}
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						FROM = { set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 } }
						white_peace = FROM
						remove_wargoal = {
							type = all
							target = FROM
						}
					}
					if = {
						limit = {
							has_country_flag = HIP_alliance_member
						}
						create_faction = HIP_middle_sea_treaty
						every_other_country = {
							limit = {
								OR = {
									has_country_flag = HIP_alliance_member
									is_subject_of = HIP
								}
							}
							HIP = {add_to_faction = PREV}
						}
						every_other_country = {
							limit = {
								OR = {
									has_country_flag = HIP_alliance_member
									is_subject_of = HIP
									AND = {
										is_in_faction_with = HIP
										NOT = {
											is_in_faction_with = EQS
										}
									}
								}
							}
							if = {
								limit = { has_war_with = FROM }
								set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
								white_peace = FROM
							}
						}
					}
					HIP = {country_event = hippogriff.83}
				}
			}
			else_if = {
				limit = {
					OR = {
						original_tag = EQS
						original_tag = NLR
					}
					exists = yes
					has_government = fascism
					is_subject = no
					CES = {
						has_country_flag = CES_shadow_path
						has_capitulated = no
						is_subject = no
						has_war_with = PREV
					}
				}
				if = {
					limit = {
						original_tag = EQS
					}
					CES = {
						country_event = {
							id = daring_shadow.18
							days = 1
						}
					}
				}
				else = {
					CES = {
						country_event = {
							id = daring_shadow.20
							days = 1
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = BAL
				}
				if = {
					limit = {
						SIC = {
							exists = yes
						}
					}
					SIC = {
						country_event = {
							id = baltimare.28
							days = 7
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = NMS
					FROM = {
						OR = {
							original_tag = CES
							original_tag = EQS
						}
					}
					has_war_with = CES
					has_war_with = EQS
				}
				CES = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			else_if = {
				limit = {
					tag = CHN
					FROM = { tag = CCN }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					tag = CHN
					FROM = { tag = EQS }
				}
				if = {
					limit = {
						EQS = {
							has_government = democratic
						}
					}
					EQS = {
						country_event = {
							id = equestria.180
							days = 10
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = TRD
					FROM = { tag = GRD }
				}
				transfer_navy = { target = FROM }
			}
			if = {
				limit = {
					OR = {
						tag = BAN
						tag = ZES
					}
				}
				if = {
					limit = {
						SIC = { has_country_flag = don_is_in_blackrock }
						tag = BAN
					}
					SIC = { country_event = sicameon.96 }
				}
				if = {
					limit = {
						SIC = { has_country_flag = don_is_in_stripes }
						tag = ZES
					}
					SIC = { country_event = sicameon.97 }
				}
			}
			if = {
				limit = {
					FROM = {
						tag = DED
						NOT = { has_country_flag = DED_capitulated@ROOT }
					}
				}
				FROM = { set_country_flag = DED_capitulated@ROOT }
				if = {
					limit = { is_major = yes }
					FROM = { modify_country_flag = { flag = DED_killed_nations value = 5 } }
					else = {
						FROM = { modify_country_flag = { flag = DED_killed_nations value = 1 } }
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = MAN }
						FROM = { tag = CHN }
					}
					ROOT = { tag = ELF }
				}
				if = {
					limit = {
						MAN = { exists = yes }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = ROOT
						}
					}
				}
				if = {
					limit = {
						MAN = { exists = no }
					}
					CHN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = {
							target = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = MAN }
						FROM = { tag = CHN }
					}
					MAN = {
						has_war_together_with = CHN
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_stg_expansionist_war
						}
						ROOT = { tag = STG }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = STG }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_eqc_expansionist_war
						}
						ROOT = { tag = EQC }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = EQC }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_hau_expansionist_war
						}
						ROOT = { tag = HAU }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = HAU }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_drg_expansionist_war
						}
						ROOT = { tag = DRG }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = DRG }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_fez_expansionist_war
						}
						ROOT = { tag = FEZ }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = FEZ }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_png_expansionist_war
						}
						ROOT = { tag = PNG }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = PNG }
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_ved_expansionist_war
						}
						ROOT = { tag = VED }
					}
					MAN = {
						set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
						annex_country = { target = VED }
					}
				}
			}
			if = {
				limit = {
					ROOT = { tag = ZRS }
					FROM = { tag = CHN }
				}
				FROM = {
					annex_country = { target = ZRS }
					country_event = { id = changelings_paxchrysalia.8401 hours = 36 }
				}
				1 = { set_resistance = 100 }
				5 = { set_resistance = 100 }
			}
			if = {
				limit = {
					has_idea = EQC_funding_the_resistiance
				}
				remove_ideas = EQC_funding_the_resistiance
				EQS = { remove_ideas = EQC_resistance }
				ELF = { remove_ideas = EQC_resistance }
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = EQS }
						FROM = { tag = ELF }
					}
					ROOT = { tag = CHN }
				}
				FROM = { set_country_flag = EQS_or_ELF_has_capitulated_CHN }
			}
			handle_twilight_escaping = yes
			if = { # Peace out any countries at WAR with BAT when NLR capitulates on equestrian or griffonian continent
				limit = {
					country_exists = BAT
				}
				if = {
					limit = {
						FROM = {
							has_war_with = BAT
							OR = {
								is_on_equestrian_continent = yes
								is_on_griffon_continent = yes
							}
						}
						ROOT = {
							original_tag = NLR
						}
					}
					BAT = {
						for_each_scope_loop = {
							array = global.europe_states
							# we teleport all armies in Equestrian continent...
							teleport_armies = {
								limit = {
									# that belong to BAT...
									tag = BAT
								}
								# to owner's (so BAT's) owned_controlled_states
								to_state_array = owned_controlled_states
							}
						}
						for_each_scope_loop = {
							array = global.asia_states
							# we teleport all armies in Griffonian continent...
							teleport_armies = {
								limit = {
									# that belong to BAT...
									tag = BAT
								}
								# to owner's (so BAT's) owned_controlled_states
								to_state_array = owned_controlled_states
							}
						}
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						every_enemy_country = {
							if = {
								limit = {											
									OR = {
										is_on_equestrian_continent = yes
										is_on_griffon_continent = yes
									}
								}
								white_peace = BAT
							}
						}
					}
					BAT = {
						country_event = bat.17
					}
				}
			}
			if = {
				limit = {
					tag = BAT
					NLR = {
						any_enemy_country = {
							is_zebrican_continent_country = yes
						}
					}
				}
				leave_faction = yes
				#this is cancer
				every_other_country = {
					limit = {
						has_war_with = NLR
						is_zebrican_continent_country = yes
					}
					set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
					white_peace = NLR
					every_other_country = {
						limit = {
							OR = {
								is_in_faction_with = NLR
								is_subject_of = NLR
							}
						}
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = PREV
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = BAT
						NOT = {
							has_country_flag = BAT_national_catastrophe
						}
					}
					ROOT = {
						tag = TBK
						is_in_faction = no
					}
					728 = {
						is_controlled_by = BAT
					}
				}
				BAT = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = TBK
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = BAT
						NOT = {
							has_country_flag = BAT_national_catastrophe
						}
					}
					ROOT = {
						tag = ZAR
						is_in_faction = no
					}
					747 = {
						is_controlled_by = BAT
					}
				}
				BAT = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = {
						target = ZAR
					}
				}
			}
			#if = {
			#	limit = {
			#		tag = FEA
			#	}
			#	YAN = {
			#		if = {
			#			limit = {
			#				is_subject_of = ROOT
			#			}
			#			end_puppet_this = yes
			#		}
			#		if = {
			#			limit = { is_in_faction_with = ROOT }
			#			leave_faction = yes
			#		}
			#		every_other_country = {
			#			limit = {
			#				NOT = {
			#					is_zebrican_continent_country = yes
			#				}
			#				has_war_with = YAN
			#			}
			#			set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
			#			white_peace = YAN
			#		}
			#	}
			#}
			if = {
				limit = {
					original_tag = ABY
					FROM = { original_tag = WNG }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			if = {
				limit = {
					tag = WAR
					FROM = {
						tag = TBK
						has_completed_focus = TBK_claim_warzena
					}
				}
				TBK = {
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
					}
					country_event = { id = tobuck_baragzen.12 }
				}
			}
			if = {
				limit = {
					OR = {
						AND = {
							original_tag = ASS
							ANS = {
								exists = no
							}
						}
						AND = {
							original_tag = ANS
							ASS = {
								exists = no
							}
						}
					}
					FROM = {
						original_tag = ZAI
						OR = {
							has_cosmetic_tag = Terathopia
							has_cosmetic_tag = Terathopia_2
							has_cosmetic_tag = Terathopia_3
						}
					}
				}
				FROM = {
					country_event = { id = cityfall.1008 hours = 24 }
				}
			}
			IF = {
				limit = {
					has_global_flag = CHN_great_northern_war
					OR = {
						tag = CHN
						tag = PLB
					}
				}
				PLB_end_the_great_northern_war = yes
			}
			if = {
				limit = {
					FROM = {
						original_tag = ZAI
						OR = {
							has_cosmetic_tag = Terathopia
							has_cosmetic_tag = Terathopia_2
							has_cosmetic_tag = Terathopia_3
						}
						NOT = {
							has_country_flag = ZAI_totaler_weltkrieg
						}
					}
				}
				if = {
					limit = {
						NOT = {
							original_tag = ZAI
						}
						is_zebrican_continent_country = yes
					}
					every_other_country = {
						limit = {
							has_war_with = FROM
							is_zebrican_continent_country = no
						}
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
					}
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			if = {
				limit = {
					tag = EQS
					has_country_flag = EQS_received_KIR_volunteers
					FROM = {
						tag = CHN
					}
				}
				KIR = {
					country_event = { id = kirin.762 days = 7 }
				}
			}
			if = {
				limit = {
					original_tag = CTH
					has_country_flag = CTH_limited_CGI_war_flag
				}
				clr_country_flag = CTH_limited_CGI_war_flag
			}
			if = {
				limit = {
					tag = GFF
					FROM = {
						tag = GRF
					}
				}
				GRF = {
					country_event = {
						id = griffons.168
						days = 14
					}
				}
			}
		}
	}
	#ROOT is free nation FROM is releaser
	on_release_as_free = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_release_as_free"
			if = {
				limit = {
					FROM = { original_tag = GRW }
					ROOT = { original_tag = BRF }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			else_if = {
				limit = {
					FROM = { original_tag = BRF }
					ROOT = { original_tag = GRW }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			GRU_load_commie_tree = yes
			if = {
				limit = {
					FROM = { NOT = { tag = HLQ } }
					NOT = { tag = HLQ }
				}
				if = {
					limit = {
						owns_state = 387
					}
					reset_province_name = 8079
				}
				if = {
					limit = {
						owns_state = 619
					}
					reset_province_name = 5013
				}
				if = {
					limit = {
						owns_state = 645
					}
					reset_province_name = 11911
				}
			}
			if = {
				limit = { tag = DED }
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
					if = {
						limit = {
							NOT = {
								tag = HIE
								AND = {
									original_tag = ZAI
									OR = {
										has_cosmetic_tag = Terathopia
										has_cosmetic_tag = Terathopia_2
										has_cosmetic_tag = Terathopia_3
									}
								}
							}
						}
						country_event = { id = deadempire.29 days = 1 }
					}
				}
			}
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					original_tag = CRY
				}
				country_event = crysom.48
				country_event = solarempiresparkles.102
			}
			FLO_load_ideology_focus = yes
			WIT_load_ideology_focus = yes
			FRN_load_ideology_focus = yes
			CTH_load_ideology_focus = yes
			if = {
				limit = {
					original_tag = BRF
					has_government = communism
				}
				BRF_communist_GRW_not_communist = yes
			}

			if = {
				limit = { original_tag = BRF }
				BRF = {	country_event = brodfeld.27 }
			}

			if = {
				limit = {
					original_tag = GRW
					NOT = { has_government = communism }
				}
				BRF_communist_GRW_not_communist = yes
			}
			if = {
				limit = {
					original_tag = JAK
					FROM = {
						OR = {
							has_government = communism 
							has_government = democratic 
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}
			else_if = {
				limit = {
					original_tag = YAK
					FROM = {
						OR = {
							has_government = fascism 
							has_government = neutrality
						}
					}
				}
				YAK_nationalist_GRW_progressive = yes
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					FROM = {
						has_country_flag = FEA_STW_union
					}
					OR = {
						tag = STW
						tag = FEA
					}
				}
				FROM = {
					clr_country_flag = FEA_STW_union
					drop_cosmetic_tag = yes
					reapply_secondary_cosmetic_tags = yes
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_society
						NOT = { has_idea_with_trait = society_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = modern_society
							}
						}
					}
					FROM = { ROOT = { transfer_society_ideas = yes } }
					else = { add_ideas = modern_society }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_science
						NOT = { has_idea_with_trait = science_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = proper_science_base
							}
						}
					}
					FROM = { ROOT = { transfer_science_ideas = yes } }
					else = { add_ideas = proper_science_base }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_literacy
						NOT = { has_idea_with_trait = illiteracy_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = no_lack_of_scientists
							}
						}
					}
					FROM = { ROOT = { transfer_illiteracy_ideas = yes } }
					else = { add_ideas = no_lack_of_scientists }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_poverty
						NOT = { has_idea_with_trait = poverty_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = no_poverty
							}
						}
					}
					FROM = { ROOT = { transfer_poverty_ideas = yes } }
					else = { add_ideas = no_poverty }
				}
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}
			if = {
				limit = {
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = FRN
						NOT = {
							has_government = fascism
						}
					}
					ROOT = { original_tag = JES }
				}
				FROM = { country_event = francistria.77 }
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = FRN
						has_government = fascism
					}
					ROOT = { original_tag = JES }
				}
				FROM = {
					set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
					annex_country = { target = ROOT }
				}
			}
			if = {
				limit = {
					original_tag = FRN
					FROM = {
						original_tag = WNG
					}
				}
				FROM = {
					every_owned_state = {
						limit = {
							is_core_of = JES
						}
						transfer_state_to = ROOT
					}
				}
			}

			BRF_load_mason_focus = yes

			actually_fix_weapon_techs = yes
			FROM = { actually_fix_weapon_techs = yes }
		}
	}

	on_subject_free = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_subject_free"
			handle_cosmetic_tag_and_puppet_change_on_free = yes
			GRU_load_commie_tree = yes
			if = {
				limit = {
					has_cosmetic_tag = GRI_SUBJECT
				}
				fire_GRD_cosmetic_handling = yes
			}
			else_if = {
				limit = {
					has_country_flag = is_changeling_puppet
					NOT = { tag = EQS }
				}
				country_event = changelings.910
			}
			else_if = {
				limit = {
					has_country_flag = is_changeling_puppet
					original_tag = EQS
					num_of_controlled_states > 15
					controls_fillydelphia = yes
					controls_manehattan = yes
					controls_los_pegasus = yes
					controls_baltimare = yes
					controls_canterlot = yes
				}
				country_event = changelings.911
			}
			else_if = {
				limit = {
					NOT = { original_tag = EQS }
					has_country_flag = is_luna_puppet
				}
				country_event = lunas.910
			}
			else_if = {
				limit = {
					has_country_flag = EQC_puppet
				}
				country_event = mareland.79
			}
			else_if = {
				limit = {
					OR = {
						has_country_flag = is_solar_puppet
						has_country_flag = is_sol_puppet
					}
				}
				country_event = solarempire.1007
			}
			else_if = {
				limit = {
					has_country_flag = is_FAT_puppet
				}
				country_event = griffonRepublic.101
			}
		}
	}

	on_government_change = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_government_change"
			if = {
				limit = { original_tag = CRY }
				CRY_restore_establishment = yes
				country_event = { id = crysom.48 hours = 1 }
				if = {
					limit = {
						CRY_radiant_hope = { is_country_leader = yes }
						has_global_flag = sombra_returned
					}
					kill_country_leader = yes
				}
			}

			if = {
				limit = {
					original_tag = EQC
					has_country_flag = has_supported_equalists
					has_government = communism
				}
				country_event = { id = mareland.30 hours = 1 }
			}

			FIR_FBK_on_govt_change = yes

			if = {
				limit = {
					original_tag = FIR
					has_country_flag = FIR_is_necromancer
					NOT = { has_country_leader = { ruling_only = yes character = FIR_shinespark } }
				}
				add_opinion_modifier = {
					target = DED
					modifier = mortal_enemies
				}
				add_opinion_modifier = {
					target = DED
					modifier = CHN_embargo
				}
				reverse_add_opinion_modifier = {
					target = DED
					modifier = mortal_enemies
				}
				reverse_add_opinion_modifier = {
					target = DED
					modifier = CHN_embargo
				}
			}
			if = {
				limit = {
					original_tag = BAN
					has_government = neutrality
				}
				clr_country_flag = have_regular_puppets
			}
			if = {
				limit = {
					original_tag = GRU
				}
				if = {
					limit = { has_government = communism }
					load_focus_tree = gryphus_commie_tree
					else = {
						load_focus_tree = gryphus
					}
				}
			}
			if = {
				limit = {
					original_tag = STG
					is_subject = no
				}
				drop_cosmetic_tag = yes
				reapply_secondary_cosmetic_tags = yes
			}
			handle_generic_griffon_ideas_on_govt_change = yes
			if = {
				limit = {
					original_tag = FEA
					OR = {
						has_cosmetic_tag = FEA_PvdA_old_flag
						has_cosmetic_tag = FEA_PvdA_old_flag_GRI_Puppet
					}
					OR = {
						NOT = { has_government = communism }
						AND = {
							is_subject = yes
							overlord = { has_government = communism }
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					original_tag = GRI
					has_government = democratic
				}
				every_country = {
					limit = {
						has_opinion_modifier = RIV_hates_the_empire
						has_government = democratic
					}
					remove_opinion_modifier = { target = ROOT modifier = RIV_hates_the_empire }
				}
			}
			if = {
				limit = {
					original_tag = GRI
					WNG = {
						NOT = {
							has_war_with = GRI
							is_in_faction_with = GRI
							is_subject_of = GRI
						}
					}
					FROM = {
						has_idea = WNG_southern_shield
						NOT = {
							has_war_with = WNG
							is_in_faction_with = WNG
							is_subject_of = WNG
						}
					}
				}
				WNG = {
					country_event = wingbardy.96
				}
			}
			if = {
				limit = {
					original_tag = EQS
					NOT = {has_government = democratic}
				}
				if = {
					limit = {
						HIP = {
							OR = {
								is_in_faction_with = EQS
								has_war_together_with = EQS
							}
							is_subject = no
							NOT = {has_government = fascism}
						}
					}
					HIP = {
						every_country = {
							limit = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_country_flag = HIP_alliance_member
								}
								is_in_faction_with = EQS
							}
							leave_faction = yes
							add_ai_strategy = {
								type = alliance
								id = "EQS"
								value = -200
							}
							add_ai_strategy = {
								type = alliance
								id = "HIP"
								value = 200
							}
						}
						every_other_country = {
							limit = {
								OR = {
									is_on_equestrian_continent = yes
									is_in_faction_with = WNG
								}
								has_war_with = EQS
							}
							set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
							every_country = {
								limit = {
									OR = {
										tag = HIP
										is_subject_of = HIP
										has_country_flag = HIP_alliance_member
										AND = {
											is_in_faction_with = HIP
											NOT = {is_in_faction_with = EQS}
										}
									}
								}
								set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
								white_peace = PREV
								remove_wargoal = {
									type = all
									target = PREV
								}
							}
						}
						if = {
							limit = {
								has_country_flag = HIP_won_north_zebrican_war
							}
							create_faction = HIP_middle_sea_treaty
							every_other_country = {
								limit = {
									OR = {
										has_country_flag = HIP_alliance_member
										is_subject_of = HIP
									}
								}
								HIP = {add_to_faction = PREV}
							}
						}
					}
				}
			}
			if = {
				limit = {
					original_tag = FLO
					has_idea = FLO_poverty_virtue
				}
				swap_ideas = {
					remove_idea = FLO_poverty_virtue
					add_idea = no_poverty
				}
			}
			if = {
				limit = {
					original_tag = FLO
					has_idea = FLO_illiteracy_virtue
				}
				swap_ideas = {
					remove_idea = FLO_illiteracy_virtue
					add_idea = no_lack_of_scientists
				}
			}
			if = {
				limit = {
					original_tag = EQS
					tag = event_target:solar_empire
					OR = {
						is_subject = yes
						NOT = { has_government = fascism }
					}
				}
				kill_ideology_leader = fascism

				if = {
					limit = { event_target:equestria = { exists = no } }
					save_global_event_target_as = equestria
				}
				SOL = { save_global_event_target_as = solar_empire }
				country_event = { id = solarempire.1018 }
			}
			if = {
				limit = {
					original_tag = DMT
					DMT_rover_diamondshield = { is_unit_leader = yes }
					NOT = {	has_government = fascism }
				}
				DMT_rover_diamondshield = {
					remove_unit_leader_role = yes
				}
			}
			if = {
				limit = {
					original_tag = LUS
				}
				country_event = { id = lushi.155 hours = 1 }
			}
			if = {
				limit = {
					original_tag = VED
				}
				country_event = vedina.76
			}
		}
	}

	#ROOT is winner #FROM is loser
	on_peaceconference_started = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_peaceconference_started"
			save_owner_of_impassible_states = yes

			FROM = {
				if = {
					limit = {
						is_subject = yes
						has_country_flag = demilitarized
					}
					set_variable = {
						overlord_before_pc = overlord
					}
				}
			}
			#commented out as it crashes
			#if = {
			#	limit = {
			#		original_tag = ZAI
			#		OR = {
			#			has_cosmetic_tag = Terathopia
			#			has_cosmetic_tag = Terathopia_2
			#			has_cosmetic_tag = Terathopia_3
			#		}
			#	}
			#	set_country_flag = { flag = bypass_annex_compliance days = 1 value = 1 }
			#	annex_country = { target = FROM }
			#
			#}
		}
	}

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			FROM = {
				save_event_target_as = former_controller
			}
			FROM.FROM = {
				save_event_target_as = newly_controlled_state
			}
			force_potential_core_resistance_on_controlled_changed = yes
			#Idea changes from state control
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = {
							modifier = BAT_opium_plantation_mod
						}
					}
				}
				FROM.FROM = {
					owner = {
						BAT_get_opium_factories = yes
					}
				}
			}
			#Add tags here that shouldn't get "monuments"
			if = {
				limit = {
					NOT = {
						original_tag = DED
						AND = {
							original_tag = ZAI
							OR = {
								has_cosmetic_tag = Terathopia
								has_cosmetic_tag = Terathopia_2
								has_cosmetic_tag = Terathopia_3
							}
						}
					}
				}
				if = {
					limit = {
						FROM.FROM = { state = 344 }
						original_tag = CRY
						has_government = democratic
						NOT = { has_idea = crystal_heart }
					}
					add_ideas = crystal_heart
				}
				else_if = {
					limit = {
						FROM.FROM = { state = 381 }
						NOT = { has_idea = owns_skyfall }
						OR = { NOT = { num_of_civilian_factories > 50 } NOT = { num_of_military_factories > 25 } }
					}
					add_ideas = owns_skyfall
				}
				else_if = {
					limit = {
						FROM.FROM = { state = 627 }
						has_global_flag = WIT_canal_built
						NOT = { has_idea = WIT_grand_canal }
					}
					add_ideas = WIT_grand_canal
				}
				else_if = {
					limit = {
						FROM.FROM = { state = 616 }
						has_global_flag = WIT_mine_built
						NOT = { has_idea = WIT_silver_mine }
					}
					add_ideas = WIT_silver_mine
				}
			}
			if = {
				limit = {
					FROM.FROM = { state = 1036 }
					ROOT = {
						original_tag = HYE
					}
				}
				country_event = storm.3
			}
			if = { # YAK burying-nuke mechanic
				limit = {
					ROOT = {
						original_tag = CHN
					}
					FROM = {
						original_tag = YAK
					}
					FROM.FROM = {
						has_state_flag = YAK_underground_nuke_planted
					}
				}
				launch_nuke = {
					state = FROM.FROM
					controller = CHN
					use_nuke = no # accounted by decision
				}
				if = {
					limit = {
						NOT = {
							FROM = {
								has_country_flag = YAK_used_underground_nuke
							}
						}
					}
					FROM = {
						set_country_flag = YAK_used_underground_nuke
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						tag = ABY
						has_active_mission = ABY_AF_clock_is_ticking_kattail_mission
					}
				}
				ABY = {
					if = {
						limit = {
							is_ai = yes
							has_completed_focus = ABY_AF_the_kattown_pyramid
						}
						add_days_mission_timeout = {
							mission = ABY_AF_clock_is_ticking_kattail_mission
							days = 6
						}
					}
					else = {
						add_days_mission_timeout = {
							mission = ABY_AF_clock_is_ticking_kattail_mission
							days = 6
						}
						add_political_power = 5
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = ABY
						has_active_mission = ABY_AF_clock_is_ticking_kattail_mission
					}
				}
				ABY = {
					if = {
						limit = {
							is_ai = yes
							has_completed_focus = ABY_AF_the_kattown_pyramid
						}
						add_days_mission_timeout = {
							mission = ABY_AF_clock_is_ticking_kattail_mission
							days = -6
						}
					}
					else = {
						add_days_mission_timeout = {
							mission = ABY_AF_clock_is_ticking_kattail_mission
							days = -6
						}
					}
				}
			}
			if = { #### Griffon special project Universal Translator calculation
				limit = {
					ROOT = {
						has_dynamic_modifier = {
							modifier = griffon_universal_translator_modifier
						}
					}
				}
				ROOT = {
					sp_calculate_regionan_capital_amount = yes
				}
			}
			
		}
	}

	#FROM is country getting invited.
	on_offer_join_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_offer_join_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_government = communism
					FROM = {
						has_idea = LCT_anti_commie_pact
					}
				}
				FROM = {
					remove_ideas = LCT_anti_commie_pact
				}
			}
			if = {
				limit = {
					original_tag = HIP
				}
				FROM = {
					add_ai_strategy = {
						id = "HIP"
						type = alliance
						value = 100
					}
				}
			}
			if = {
				limit = {
					original_tag = MIT
					has_completed_focus = MIT_SIC_assistance
				}
				FROM = {
					add_to_tech_sharing_group = MIT_research_group
				}
			}
			if = {
				limit = {
					original_tag = MIT
					has_completed_focus = MIT_command_council
				}
				FROM = {
					add_ideas = MIT_command_council_idea
				}
			}
			if = {
				limit = {
					TBK = {
                        original_tag = TBK
                        has_government = democratic
                        has_country_leader = {
                            character = TBK_wallnut_drive
                            ruling_only = yes
                        }
                    }
				}
				clear_variable = TBK.TBK_hazrumenia_members
				for_each_scope_loop = {
    				array = faction_members
   					 if = {
       					limit = {
            				OR = {
								original_tag = TBK
								original_tag = WAR
								original_tag = ZAR
								original_tag = ZUM
							}
        				}
						add_to_variable = { TBK.TBK_hazrumenia_members = 1 }
    				}
				}
				clamp_variable = { var = TBK.TBK_hazrumenia_members min = 1 max = 4 }
				for_each_scope_loop = {
    				array = faction_members
   					if = {
       					limit = {
							is_in_faction_with = TBK
							TBK = {
								has_government = democratic
								has_country_leader = {
									character = TBK_wallnut_drive
									ruling_only = yes
								}
							}
            				OR = {
								original_tag = WAR
								original_tag = ZAR
								original_tag = ZUM
							}
        				}
						if = {
							limit = {
								TBK = {
									has_completed_focus = TBK_harmony_alliance_internal_development
								}
								NOT = {
									has_dynamic_modifier = {
										modifier = TBK_great_hazrumenian_family
									}
								}
							}
							add_dynamic_modifier = {
								modifier = TBK_great_hazrumenian_family
							}
						}
						if = {
							limit = {
								TBK = {
									has_completed_focus = TBK_harmony_alliance_economy
								}
								NOT = {
									has_dynamic_modifier = {
										modifier = TBK_hazrumenian_economic_cooperation
									}
								}
							}
							add_dynamic_modifier = {
								modifier = TBK_hazrumenian_economic_cooperation
							}
						}
						TBK_apply_hazrumenia_family_modifier_values = yes
						TBK_apply_hazrumenia_economic_cooperation_modifier_values = yes
    				}
				}
			}
			if = {
				limit = {
					has_completed_focus = GRI_AF_sc_assert_our_control
				}

				# Automaticly set the occupation laws for GRI APF
				FROM.FROM = {
					set_occupation_law_where_available = GRI_AF_inquisition
					set_occupation_law_where_available = GRI_AF_integration
					set_occupation_law_where_available = GRI_AF_protectorate
					set_occupation_law_where_available = GRI_AF_colony
				}
			}
			FROM = { update_global_arrays = yes }
		}
	}

	#FROM is faction leader on join faction requests. THIS DOES NOT FIRE ON ADD_TO_FACTION EFFECT! USE ON_OFFER_JOIN_FACTION!
	on_join_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_join_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_idea = LCT_anti_commie_pact
					FROM = {
						has_government = communism
					}
				}
				remove_ideas = LCT_anti_commie_pact
			}
			if = {
				limit = {
					FROM = { is_river_fed_member = yes }
					NOT = { tag = HLQ }
					HLQ = { has_idea = HLQ_honourary_member }
				}
				diplomatic_relation = {
					country = HLQ
					relation = non_aggression_pact
					active = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
					}
				}
				add_ai_strategy = {
					id = "HIP"
					type = alliance
					value = 100
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_SIC_assistance
					}
				}
				add_to_tech_sharing_group = MIT_research_group
			}
			if = {
				limit = {
					NOT = {
						has_idea = MIT_command_council_idea
					}
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_command_council
						NOT = {
							has_completed_focus = MIT_coalition_exchange_students
						}
					}
				}
				add_ideas = MIT_command_council_idea
			}
			if = {
				limit = {
					NOT = { has_idea = MIT_command_council_idea }
					NOT = { has_idea = MIT_command_council_idea2 }
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_coalition_exchange_students
					}
				}
				add_ideas = MIT_command_council_idea2
			}
			update_global_arrays = yes
		}
	}

	# country
	on_new_term_election = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_new_term_election"
			### Lake City ###
			if = {
				limit = { tag = LCT }
				country_event = { id = lakecity.9 }
				country_event = { id = lakecity.901 }
				country_event = { id = lakecity.902 }
			}
			### Puerto Caballo ###
			#else_if = {
			#	limit = { tag = PCB }
			#	country_event = { id = caballo.20 }
			#}
			### Bronzehill ###
			else_if = {
				limit = { tag = BRZ }
				country_event = { id = bronzehill_election_event.3 }
			}
			else_if = {
				limit = {
					tag = CTH
				}
				if = {
					limit = {
						has_country_flag = CTH_colthage_zarcaid
					}
					country_event = { id = colthage_other.57 }
				}
				else_if = {
					limit = {
						OR = {
							has_country_flag = CTH_colthage_constitutionalist
							has_country_flag = CTH_colthage_harmonite
						}
					}
					country_event = { id = colthage_other.139 }
				}
			}
		}
	}

	#ROOT is subject FROM is overlord
	on_subject_autonomy_level_change = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_subject_autonomy_level_change FROM = [From.GetName]"
			#Add to Equestria tech group
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}

			if = {
				limit = {
					overlord = {
						has_country_flag = river_federation_founder
					}
					OR = {
						has_autonomy_state = autonomy_integrated_puppet
						has_autonomy_state = autonomy_reichskommissariat
					}
					is_river_fed_member = yes
					NOT = {
						has_idea = RIV_river_union_member1
						has_idea = RIV_river_union_member2
					}
				}
				remove_ideas = {
					RIV_member_state
					RIV_rcsc_member
					RIV_rec_member1
					RIV_rec_member2
					RIV_rec_member3
					RIV_rec_member4
				}
				add_ideas = RIV_river_union_member1
			}
		}
	}

	on_leave_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_leave_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					tag = STG
				}
				country_event = { id = stalliongrad.151 hours = 1 }
			}
			if = {
				limit = {
					is_river_fed_member = yes
				}
				RIV_leave_fed_no_ally = yes
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep1
				}
				remove_ideas = RCT_subtle_creep1
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep1_NIM
				}
				remove_ideas = RCT_subtle_creep1_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep2
				}
				remove_ideas = RCT_subtle_creep2
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep2_NIM
				}
				remove_ideas = RCT_subtle_creep2_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep3
				}
				remove_ideas = RCT_subtle_creep3
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep3_NIM
				}
				remove_ideas = RCT_subtle_creep3_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep4
				}
				remove_ideas = RCT_subtle_creep4
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep4_NIM
				}
				remove_ideas = RCT_subtle_creep4_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep5
				}
				remove_ideas = RCT_subtle_creep5
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep5_NIM
				}
				remove_ideas = RCT_subtle_creep5_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep6
				}
				remove_ideas = RCT_subtle_creep6
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep6_NIM
				}
				remove_ideas = RCT_subtle_creep6_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep7
				}
				remove_ideas = RCT_subtle_creep7
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep8
				}
				remove_ideas = RCT_subtle_creep8
			}
			if = {
				limit = {
					OR = {
						has_dynamic_modifier = {
							modifier = TBK_great_hazrumenian_family
						}
						has_dynamic_modifier = {
							modifier = TBK_hazrumenian_economic_cooperation
						}
					}
				}
				remove_dynamic_modifier = {
					modifier = TBK_great_hazrumenian_family
				}
				remove_dynamic_modifier = {
					modifier = TBK_great_hazrumenian_family
				}
				TBK = {
					subtract_from_variable = {
						var = TBK_hazrumenia_members
						value = 1
					}
					clamp_variable = {
						var = TBK_hazrumenia_members
						min = 1
						max = 4
					}
				}
			}
			update_global_arrays = yes
		}
	}

	# From is owner country
	on_army_leader_lost_combat = {
		effect = {
			if = {
				limit = {
					has_id = 323
					set_temp_variable = { chance = 0.12 }
					check_variable = { random < chance }
					NOT = { has_trait = wounded }
				}
				retire = yes
				unit_leader_event = { id = wingbardy.1 }
			}
		}
	}

	on_army_leader_won_combat = {
		effect = {
			if = {
				limit = {
					has_id = 339111
				}
				unit_leader_event = { id = MAN_ELF_new.148 }
			}
		}
	}

	# FROM = country on whom the wargoal is being generated, ROOT = country generating wargoal
	on_generate_wargoal = {
		effect = {
			log = "[GetDateText] ROOT: [Root.GetName] FROM: [From.GetName] on_generate_wargoal"
		}
	}

	on_unit_leader_promote_from_ranks_veteran = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_veteran"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			handle_jachs_alcippe_promotion_bba = yes
			handle_generated_unit_leader_non_operative = yes
			if = {
				limit = {
					OWNER = {
						is_special_project_completed = sp:sp_long_term_tactical_divination
					}
				}
				ROOT = {
					add_logistics = 1
					add_planning = 1
				}
			}
		}
	}

	on_unit_leader_promote_from_ranks_green = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_green"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			handle_jachs_alcippe_promotion_bba = yes
			handle_generated_unit_leader_non_operative = yes
			if = {
				limit = {
					OWNER = {
						is_special_project_completed = sp:sp_long_term_tactical_divination
					}
				}
				ROOT = {
					add_logistics = 1
					add_planning = 1
				}
			}
		}
	}

	on_unit_leader_created = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_created"
			if = {
				limit = {
					has_global_flag = starting_operatives
				}
				if = {
					limit = { check_variable = { global.onstartup_operative = 4 } }
					set_variable = {
						global.con_mane = THIS
					}
				}
				add_to_variable = { global.onstartup_operative = 1 }
			}
			FROM = {
				set_temp_variable = {
					creator = THIS
				}
			}
			if = {
				limit = { is_exiled_leader = yes }
				set_temp_variable = {
					creator = FROM.FROM
				}
			}
			if = {
				limit = {
					is_operative = no
				}
				if = {
					limit = {
						OR = {
							NOT = { has_dlc = "By Blood Alone" }
							is_navy_leader = yes
						}
					}
					handle_generated_unit_leader_non_operative = yes
				}
			}
			else = {
				log = "on_unit_leader_created: ROOT: [Root.GetName] is operative"
				#operative_handle_secondary_cultures_races = yes
				log = "on_unit_leader_created: ROOT: [Root.GetName] call operative_add_starting_nationalities_and_race"
				operative_add_starting_nationalities_and_race = yes
				log = "on_unit_leader_created: ROOT: [Root.GetName] call operative_add_secondary_nationalities"
				operative_add_secondary_nationalities = yes
			}
			if = {
				limit = {
					is_army_leader = yes
					var:creator = {
						original_tag = CTH
						has_completed_focus = CTH_medical_science
					}
				}
				add_unit_leader_trait = healthy_trait
			}
			else_if = {
				limit = {
					is_army_leader = yes
					has_trait = zebra_race_trait
					var:creator = {
						original_tag = ZAI
						OR = {
							has_cosmetic_tag = Terathopia
							has_cosmetic_tag = Terathopia_2
						}
					}
				}
				remove_unit_leader_trait = zebra_race_trait
				add_unit_leader_trait = unspecified_race_trait
			}
			else_if = {
				limit = {
					is_army_leader = yes
					var:creator = {
						is_deer_race = yes
						is_special_project_completed = sp:sp_long_term_tactical_divination
					}
				}
				add_logistics = 1
				add_planning = 1
			}
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_created - End"
		}
	}

	# scope is operative
	# from scope is the country
	on_operative_recruited = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_operative_recruited"
			operative_add_starting_nationalities_and_race = yes
			operative_add_secondary_nationalities = yes
		}
	}

	# scope is operative
	# from scope is the country
	on_operative_created = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_operative_created"
			operative_handle_secondary_cultures_races = yes
			operative_add_starting_nationalities_and_race = yes
			operative_add_secondary_nationalities = yes
			if = {
				limit = {
					FROM = {
						original_tag = TBK
						has_completed_focus = TBK_vasile_breezies
					}
				}
				add_unit_leader_trait = operative_seducer
			}
		}
	}

	on_ruling_party_change = {
		# temp var old_ideology_token is available for effects
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_ruling_party_change"
			ZES_oppressive_countries_calculate = yes
			CRY_restore_establishment = yes
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
						has_country_leader = {
							ruling_only = yes
							character = GRI_emperor_grover_vi
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			if = {
				limit = { has_character = MQA_ceyda_vatosoa }

				if = {
					limit = { has_government = democratic }

					MQA_ceyda_vatosoa = {
						set_portraits = {
							civilian = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_harmony.tga"
							}
							army = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_harmony.tga"
							}
						}
					}
				}
				else_if = {
					limit = { has_government = fascism }

					MQA_ceyda_vatosoa = {
						set_portraits = {
							civilian = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_Supremacy.tga"
							}
							army = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_Supremacy.tga"
							}
						}
					}

					else = {
						MQA_ceyda_vatosoa = {
							set_portraits = {
								civilian = {
									large = "gfx/leaders/MQA/Ceyda_Vatosoa.tga"
								}
								army = {
									large = "gfx/leaders/MQA/Ceyda_Vatosoa.tga"
								}
							}
						}
					}
				}
			}
		}
	}
	on_liberate = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_liberate"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_country_flag = is_changeling_puppet
					NOT = { tag = EQS }
				}
				country_event = changelings.910
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}
			}
			if = {
				limit = {
					ROOT = {
						original_tag = CRY
					}
				}
				ROOT = {
					country_event = solarempiresparkles.102
				}
			}
		}
	}

	on_peace = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_peace"
			if = {
				limit = {
					tag = STG
				}
				country_event = { id = stalliongrad.151 hours = 1 }
			}
			if = {		#GRF disband the militia after the civil war
				limit = {
					original_tag = GRF
					has_country_flag = GRF_civil_war_flag
				}
				country_event = { id = griffons.142 days = 5 }
			}
			IF = {
				limit = {
					has_global_flag = CHN_great_northern_war
					OR = {
						tag = CHN
						tag = PLB
					}
				}
				PLB_end_the_great_northern_war = yes
			}

			if = {
				limit = {
					has_variable = inflicted_casualties
				}
				clear_current_inflicted_casualties = yes
			}
			remove_from_attaches_arrays = yes
			clear_puppet_wargoals = yes
			set_AI_strategies_on_every_possible_country_delayed = yes
		}
	}

	on_send_attache = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_send_attache"
			ROOT = {
				if = {
					limit = {
						NOT = {
							is_in_array = { attaches_sent_to = FROM }
						}
					}
					add_to_array = { attaches_sent_to = FROM }
				}
				if = {
					limit = {
						NOT = {
							is_in_array = { global.countries_that_sent_attaches = THIS }
						}
					}
					add_to_array = { global.countries_that_sent_attaches = THIS }
				}
			}
		}
	}
}
