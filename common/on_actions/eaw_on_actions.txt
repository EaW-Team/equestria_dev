on_actions = {

	#Not run on a specific country.
	on_startup = {
		effect = {
			EQS = { save_global_event_target_as = equestria }
			SOL = { save_global_event_target_as = solar_empire }
			OLE = { save_global_event_target_as = democratic_OLE }
			DED = {
				every_other_country = {
					add_opinion_modifier = { target = PREV modifier = mortal_enemies }
					add_opinion_modifier = { target = PREV modifier = embargo }
					add_opinion_modifier = { target = PREV modifier = CHN_Embargo }
					reverse_add_opinion_modifier = { target = PREV modifier = mortal_enemies }
					reverse_add_opinion_modifier = { target = PREV modifier = embargo }
					reverse_add_opinion_modifier = { target = PREV modifier = CHN_Embargo }
					set_country_flag = DED_opinion_applied
				}
				every_owned_state = {
					add_claim_by = HLR
				}
			}
			CHN = {
				add_opinion_modifier = { target = EQS modifier = embargo }
				reverse_add_opinion_modifier = { target = EQS modifier = embargo }
				add_opinion_modifier = { target = CRY modifier = embargo }
				reverse_add_opinion_modifier = { target = CRY modifier = embargo }
				add_opinion_modifier = { target = EQC modifier = embargo }
				reverse_add_opinion_modifier = { target = EQC modifier = embargo }
				add_opinion_modifier = { target = EQS modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = EQS modifier = CHN_Embargo }
				add_opinion_modifier = { target = CRY modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = CRY modifier = CHN_Embargo }
				add_opinion_modifier = { target = EQC modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = EQC modifier = CHN_Embargo }
			}
			if = {
				limit = { is_historical_focus_on = no }
				random_list = {
					10 = {
						set_global_flag = EQS_nice_celestia
					}
					65 = {

					}
					15 = {
						set_global_flag = EQS_evil_celestia
					}
				}
				random_list = {
					40 = {
						set_global_flag = OLE_no_servitude
					}
					60 = {

					}
				}
			}
			every_country = {
				limit = { is_generic_race = yes }
				set_technology = { generic_race = 1 }
				add_ideas = generic_race_idea
			}
			every_country = {
				limit = { is_pony_race = yes }
				add_ideas = pony_race
			}
			every_country = {
				limit = { is_changeling_race = yes }
				add_ideas = changeling_race
			}
			every_country = {
				limit = { is_deer_race = yes }
				add_ideas = deer_race
			}
			every_country = {
				limit = { is_griffon_race = yes }
				add_ideas = griffon_race
			}
			every_country = {
				limit = { NOT = { is_on_equestrian_continent = yes } }
				if = {
					limit = {
						num_of_civilian_factories > 2
						has_tech = melee_weapons1
						NOT = { owns_big_griffon_city = yes }
						NOT = { owns_major_griffon_city = yes }
					}
					add_ideas = better_science_base
					else = {
						if = {
							limit = { owns_big_griffon_city = yes }
							add_ideas = big_science_base
							else = {
								if = {
									limit = { owns_major_griffon_city = yes }
									add_ideas = proper_science_base
									else = {
										if = {
											limit = {
												NOT = { owns_major_griffon_city = yes }
												NOT = { owns_big_griffon_city = yes }
												OR = {
													NOT = { has_tech = melee_weapons1 }
													NOT = { num_of_civilian_factories > 2 }
												}
												is_griffon_continent_country = yes
											}
											add_ideas = poor_science_base
										}
									}
								}
							}
						}
					}
				}
			}
			#every_country = {
				#  limit = {
					#    is_ai = yes
					#  }
				#  country_event = utility.1
				#}

			every_country = {
				limit = {
					OR = {
						is_on_equestrian_continent = yes
						has_idea = dummy_idea_science
						NOT = {
							has_idea_with_trait = science_idea
						}
					}
				}
				add_ideas = proper_science_base
			}

			every_country = {
				limit = {
					OR = {
						has_idea = dummy_idea_society
						NOT = {
							has_idea_with_trait = society_idea
						}
					}
				}
				if = {
					limit = { is_griffon_continent_country = yes }
					add_ideas = outdated_industry
					else = { add_ideas = modern_society
					}
				}
				### Development End ####
				EQS = {
					set_country_flag = manpower_laws_blocked
					set_country_flag = economic_laws_blocked
					set_country_flag = { flag = celestia_evil_meter value = 0 }
				}
				BUF = {
					add_ideas = poor_science_base
				}
				PLB = {
					add_ideas = better_science_base
				}
			}
		}
	}
	#FROM is war target
	on_declare_war = {
		effect = {
			hidden_effect = {
				if = {
					limit = { tag = DED FROM = { tag = HLR } }
					FROM = { add_timed_idea = {idea = HLR_Dreads_Incoming_Idea days = 200} }
				}
				if = {
					limit = {
						OR = {
							original_tag = EQS
							FROM = { original_tag = EQS }
						}
					}
					clr_country_flag = manpower_laws_blocked
					clr_country_flag = economic_laws_blocked
					FROM = {
						clr_country_flag = manpower_laws_blocked
						clr_country_flag = economic_laws_blocked
					}
				}
				if = {
					limit = {
						original_tag = CRY
						FROM = { original_tag = CRY }
					}
					if = {
						limit = {
							has_government = democratic
							NOT = { has_completed_focus = CRY_oldorder }
						}
						complete_national_focus = CRY_oldorder
						else = {
							FROM = {
								if = {
									limit = {
										has_government = democratic
										NOT = { has_completed_focus = CRY_oldorder }
									}
									complete_national_focus = CRY_oldorder
								}
							}
						}
					}
				}
				if = {
					limit = {
						tag = BRF
						FROM = { tag = GRW }
					}
					country_event = brodfeld.26
				}
				if = {
					limit = {
						#original_tag = FROM
						OR = {
							has_idea = dummy_idea_society
							#has_idea = modern_society
							NOT = { has_idea_with_trait = society_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = modern_society
								}
							}
						}
						FROM = { ROOT = { transfer_society_ideas = yes } }
						else = { add_ideas = modern_society }
					}
				}
				if = {
					limit = {
						original_tag = FROM
					}
					if = {
						limit = { FROM = { NOT = { has_idea = generic_race_idea } } }
						FROM = { ROOT = { transfer_race_ideas = yes } }
					}
					if = {
						limit = {
							OR = {
								tag = FAT
								FROM = { has_focus_tree = generic_griffon_focus }
							}
							has_focus_tree = generic_griffon_focus
						}
						if = {
							limit = {
								#TODO make sure which countries can have monarchist civil wars
								always = yes
							}
							set_country_flag = have_regular_puppets
						}
					}
				}
				if = {
					limit = {
						#original_tag = FROM
						OR = {
							has_idea = dummy_idea_science
							#has_idea = proper_science_base
							NOT = { has_idea_with_trait = science_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = proper_science_base
								}
							}
						}
						FROM = { ROOT = { transfer_science_ideas = yes } }
						else = {add_ideas = proper_science_base }
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = GRI
							is_in_faction_with = GRI
							is_subject_of = GRI
						}
					}
					FROM = { has_idea = FAT_republican_pact }
				}
				FROM = {
					every_other_country = {
						limit = { has_idea = FAT_republican_pact }
						country_event = { id = griffonRepublic.80 days = 1 }
					}
				}
			}
			if = {
				limit = {
					FROM = {
						OR = {
							original_tag = GRI
							is_in_faction_with = GRI
							is_subject_of = GRI
						}
					}
					ROOT = { tag = FAT has_idea = FAT_republican_pact }
				}
				ROOT = {
					every_other_country = {
						limit = { has_idea = FAT_republican_pact }
						country_event = { id = griffonRepublic.80 days = 1 }
					}
				}
			}
		}
	}
	#FROM is state the nuke got dropped on
	on_nuke_drop = {

		effect = {
			FROM = {
				decrease_population_on_nuke = yes
			}
			if = {
				limit = {
					tag = EQS
					FROM = { state = 251 }
					NOT = { has_country_flag = nuked_the_hive }
				}
				news_event = { id = news.50 days = 1}
				set_country_flag = nuked_the_hive
			}
		}
	}

	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			if = {
				limit = { tag = DED }
				FROM = {
					annex_country = { target = ROOT }
					country_event = { id = deadempire.29 days = 1 }
				}
			}
			if = {
				limit = {
					FROM = { tag = GRW }
					ROOT = { tag = BRF }
					}
				FROM = { annex_country = { target = ROOT } }
			}
			if = {
				limit = {
					FROM = { tag = BRF }
					ROOT = { tag = GRW }
					}
				FROM = { annex_country = { target = ROOT } }
			}
			if = {
				limit = {
					FROM = { tag = FAT }
					is_griffon_continent_griffon_country = yes
				}
				if = {
					limit = {
						FROM = { has_idea = FAT_decentralized_republic_idea }
					}
					if = {
						limit = { has_dlc = "Together for Victory" }
						FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_integrated_puppet } }
						add_ideas = FAT_decentralized_republic_puppet
						add_to_tech_sharing_group = FAT_research_group
						else = { add_ideas = FAT_decentralized_republic_puppet_no_TfV }
					}
				}
				if = {
					limit = {
						FROM = { has_idea = FAT_griffonian_alliance_idea }
					}
					if = {
						limit = { has_dlc = "Together for Victory" }
						FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_dominion } }
						add_to_tech_sharing_group = FAT_research_group
					}
				}
			}
			if = {
				limit = {
					original_tag = JUN
					OR = {
						AND = {
							NOT = { has_completed_focus = JUN_alone }
							OR = {
								has_country_leader = { ruling_only = yes name = Caballeron }
								FROM = { AND = { original_tag = CHN has_government = fascism } }
								FROM = { AND = { original_tag = EQS has_government = democratic } }
							}
						}
						AND = {
							FROM = {
								OR = {
									original_tag = EQS
									original_tag = CHN
								}
								is_ai = yes
							}
						}
					}
				}
				FROM = { country_event = jungle.17 }
			}
			if = {
				limit = {
					tag = event_target:equestria
					has_country_flag = EQS_CRY_has_twilight
					FROM = { tag = event_target:solar_empire }
				}
				FROM = { country_event = solarempire.22 }
			}
			if = {
				limit = {
					original_tag = CRY
					has_country_flag = EQS_CRY_has_twilight
					FROM = { tag = event_target:solar_empire }
				}
				FROM = { news_event = solarempire.26 }
			}
			if = {
				limit = {
					FROM = {
						is_ai = yes
						original_tag = GRF
					}
					ROOT = {
						original_tag = GFF
					}
				}
				FROM = { annex_country =  { target = ROOT } }
			}
			if = {
				limit = {
					FROM = {
						is_ai = yes
						is_eqs_civil_war_tag = yes
						NOT = { original_tag = JUN }
					}
					ROOT = {
						is_ai = yes
						is_eqs_civil_war_tag = yes
						NOT = { original_tag = JUN }
					}
				}
				FROM = { annex_country =  { target = ROOT } }
			}
			if = {
				limit = {
					original_tag = CHN
					FROM = {
						original_tag = EQS
						is_ai = yes
						has_government = democratic
					}
					OR = {
						OLE = {
							has_country_flag = OLE_was_annexed
						}
						FROM = {
							any_owned_state = {
								is_core_of = OLE
							}
						}
					}
					any_owned_state = {
						is_core_of = OLE
					}
				}
				every_owned_state = {
					limit = { is_core_of = OLE }
					OLE = { transfer_state = PREV }
				}
				EQS = {
					every_owned_state = {
						limit = { is_core_of = OLE }
						OLE = { transfer_state = PREV }
					}
				}
				OLE = {
					set_politics = { ruling_party = democratic elections_allowed = no }
					set_political_party = { ideology = democratic popularity = 1.0 }
					clr_country_flag = OLE_was_annexed
				}
				EQS = {
					if = {
						limit = { OLE = { NOT = { is_subject_of = EQS } } }
						puppet = OLE
					}
				}
			}
			if = {
				limit = { original_tag = CHN overlord = { has_government = fascism } }
				country_event = { id = solarempire.906 }
			}
			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				if = {
					limit = { original_tag = CRY }
					if = {
						limit = {
							has_government = democratic
							FROM = { has_government = democratic }
							NOT = {
								has_country_leader = { ruling_only = yes name = "Princess Mi Amore Cadenza" }
								has_country_leader = { ruling_only = yes name = "Princess Twilight Sparkle" }
								has_country_leader = { ruling_only = yes name = "Princess Flurry Heart" }
							}
							OR = {
								AND = {
									OR = {
										has_country_flag = free_the_old_royalty
										has_country_flag = continue_imprisonment
										NOT = { has_completed_focus = CRY_miamorefate }
									}
								}
								AND = {
									has_country_flag = royalty_executed
									NOT = { country_exists = event_target:solar_empire }
									NOT = { has_global_flag = SOL_twilight_converted }
								}
							}
							has_global_flag = sombra_returned
						}
						country_event = { id = crysom.40 days = 1 }
					}
					if = {
						limit = {
							NOT = {
								has_idea = equestrian_overlord
								has_idea = equestrian_overlord2
							}
						}
						if = {
							limit = { has_completed_focus = CRY_eqsengineers }
							add_ideas = equestrian_overlord2
							else = { add_ideas = equestrian_overlord }
						}
					}
				}
				if = {
					limit = { tag = CHN }
                	remove_opinion_modifier = { target = FROM modifier = embargo }
			    	FROM = { remove_opinion_modifier = { target = ROOT modifier = embargo } }
                	remove_opinion_modifier = { target = CRY modifier = embargo }
			    	CRY = { remove_opinion_modifier = { target = ROOT modifier = embargo } }
                	remove_opinion_modifier = { target = EQC modifier = embargo }
			    	EQC = { remove_opinion_modifier = { target = ROOT modifier = embargo } }
				}
			}
			if = {
				limit = {
					original_tag = EQC
					FROM = {
						OR = {
							original_tag = EQS
							original_tag = NLR
						}
					}
				}
				country_event = equestriancolony.1
				if = {
					limit = {
						has_country_flag = EQC_destined_to_be_an_RK
						FROM = { is_EQS_SOL = yes }
					}
					FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_reichskommissariat } }
				}
			}
			if = {
				limit = {
					is_feudal_vassal = yes
					FROM = { has_country_flag = have_regular_puppets }
				}
				set_country_flag = have_regular_puppets
			}
			#COSMETIC TAG ON PUPPET BELOW, DO NOT USE break = yes ABOVE
			if = {
				limit = {
					FROM = {
						original_tag = GRI
						NOT = { has_country_flag = have_regular_puppets }
					}
					is_feudal_vassal = yes
				}
				country_event = griffonian.1
			}
			#sanity check
			if = {
				limit = {
					FROM = {
						is_ai = yes
						original_tag = JER
					}
					OR = {
						original_tag = HEL
						original_tag = FLO
						original_tag = POM
						original_tag = AET
						original_tag = FEZ
						original_tag = JEB
						original_tag = JES
						original_tag = JRR
						original_tag = VIN
						original_tag = JFT
					}
				}
				FROM = { annex_country = { target = ROOT transfer_troops = yes } }
				break = yes
			}
			if = {
				limit = {
					FROM = {
						is_ai = yes
						OR = {
							original_tag = JEB
							original_tag = JES
							original_tag = JRR
							original_tag = VIN
							original_tag = JFT
						}
					}
					original_tag = JER
				}
				FROM = { annex_country = { target = ROOT transfer_troops = yes } }
				break = yes
			}
			if = {
				limit = {
					FROM = {
						tag = event_target:solar_empire
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = CRY }
					FROM = {
						set_country_flag = SOL_twilight_unavailable
						set_country_flag = SOL_twilight_governor
						set_autonomy = { target = ROOT autonomy_state = autonomy_reichskommissariat }
					}
					set_cosmetic_tag = CRY_SOL
					add_autonomy_ratio = { value = -0.20 }
					set_country_flag = CRY_solar_governorship
					set_party_name = { ideology = fascism long_name = SOL_fascism_party_long name = SOL_fascism_party }
					if = {
						limit = { NOT = { has_global_flag = SOL_twilight_converted } }
						create_country_leader = {
							name = "Arcane Nova"
							#desc = "TWILIGHT_DESC"
							picture = "ArcaneNova.tga"
							expire = "1965.1.1"
							ideology = falangism
							traits = {
							}
						}
						else = {
							create_country_leader = {
								name = "Grand Inquisitor Sunrise Sparkle"
								#desc = "TWILIGHT_DESC"
								picture = "TwilightSunrise.tga"
								expire = "1965.1.1"
								ideology = falangism
								traits = {
									lady_inquisitor
								}
							}
						}
					}
					break = yes
				}
				if = {
					limit = { original_tag = PLB }
					country_event = solarempire.1000
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = solarempire.1001
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = solarempire.1002
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = solarempire.1003
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = solarempire.1004
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = solarempire.1005
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = solarempire.1006
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = solarempire.1008
					break = yes
				}
				if = {
					limit = { original_tag = BAL }
					country_event = solarempire.1009
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = solarempire.1010
					break = yes
				}
				if = {
					limit = { original_tag = JUN }
					country_event = solarempire.1011
					break = yes
				}
				if = {
					limit = { original_tag = SCS }
					country_event = solarempire.1012
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = solarempire.1013
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = solarempire.1015
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = solarempire.1010
					break = yes
				}
				if = {
					limit = { original_tag = CHN }
					country_event = solarempire.1016
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = solarempire.1017
					break = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = NLR
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = PLB }
					country_event = { id = lunas.900 }
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = { id = lunas.902 }
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = { id = lunas.901 }
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = { id = lunas.903 }
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = { id = lunas.904 }
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = { id = lunas.905 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = lunas.906 }
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = lunas.911 }
					break = yes
				}
				if = {
					limit = { original_tag = BAL }
					country_event = { id = lunas.912 }
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = { id = lunas.913 }
					break = yes
				}
				if = {
					limit = { original_tag = JUN }
					country_event = { id = lunas.914 }
					break = yes
				}
				if = {
					limit = { original_tag = SCS }
					country_event = { id = lunas.916 }
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = { id = lunas.917 }
					break = yes
				}
				if = {
					limit = { original_tag = CRY }
					country_event = { id = lunas.918 }
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = { id = lunas.919 }
					break = yes
				}
				if = {
					limit = { original_tag = CHN }
					country_event = { id = lunas.920 }
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = { id = lunas.921 }
					break = yes
				}
			}

			if = {
				limit = {
					FROM = {
						original_tag = CHN
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = olenia.718 }
					break = yes
				}
				if = {
					limit = { original_tag = PLB }
					country_event = { id = changelings.900 }
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = { id = changelings.902 }
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = { id = changelings.901 }
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = { id = changelings.903 }
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = { id = changelings.904 }
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = { id = changelings.905 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = changelings.906 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = changelings.906 }
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = olenia.718 }
					break = yes
				}
				if = {
					limit = { original_tag = CRY }
					country_event = { id = crystalemp.23 }
					break = yes
				}
				if = {
					limit = { original_tag = EQS }
					country_event = { id = equestriachn.3 }
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = { id = stalliongrad.98 }
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = { id = yakistan.12 }
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = { id = yakistan.13 }
					break = yes
				}
			}

			if = {
				limit = {
					FROM = {
						original_tag = FAT
					}
				}
				if = {
					limit = { original_tag = SRS }
					country_event = griffonRepublic.100
					break = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
				}
				if = {
					limit = { original_tag = BUF }
					country_event = bufstate.36
					break = yes
				}
			}
		}
	}

	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	on_release_as_puppet = {
		effect = {
			if = {
				limit = { tag = DED }
				FROM = {
					annex_country = { target = ROOT  }
					country_event = { id = deadempire.29 days = 1 }
				}
			}
			if = {
				limit = { FROM = { tag = DED } }
				annex_country = { target = FROM  }
			}
			if = {
				limit = {
					FROM = { tag = FAT }
					is_griffon_continent_griffon_country = yes
				}
				if = {
					limit = {
						FROM = { has_idea = FAT_decentralized_republic_idea }
					}
					if = {
						limit = { has_dlc = "Together for Victory" }
						FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_integrated_puppet } }
						add_ideas = FAT_decentralized_republic_puppet
						add_to_tech_sharing_group = FAT_research_group
						else = {
							add_ideas = FAT_decentralized_republic_puppet_no_TfV
						}
					}
				}
				if = {
					limit = {
						FROM = { has_idea = FAT_griffonian_alliance_idea }
					}
					if = {
						limit = { has_dlc = "Together for Victory" }
						FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_dominion } }
						add_to_tech_sharing_group = FAT_research_group
					}
				}
			}
			if = {
				limit = { original_tag = CHN overlord = { has_government = fascism } }
				country_event = { id = solarempire.906 }
			}
			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				if = {
					limit = { original_tag = CRY }
					if = {
						limit = {
							has_government = democratic
							FROM = { has_government = democratic }
							NOT = {
								has_country_leader = { ruling_only = yes name = "Princess Mi Amore Cadenza" }
								has_country_leader = { ruling_only = yes name = "Princess Twilight Sparkle" }
								has_country_leader = { ruling_only = yes name = "Princess Flurry Heart" }
							}
							OR = {
								AND = {
									OR = {
										has_country_flag = free_the_old_royalty
										has_country_flag = continue_imprisonment
										NOT = { has_completed_focus = CRY_miamorefate }
									}
								}
								AND = {
									has_country_flag = royalty_executed
									NOT = { country_exists = event_target:solar_empire }
									NOT = { has_global_flag = SOL_twilight_converted }
								}
							}
							has_global_flag = sombra_returned
						}
						country_event = { id = crysom.40 days = 1 }
					}
					if = {
						limit = {
							NOT = {
								has_idea = equestrian_overlord
								has_idea = equestrian_overlord2
							}
						}
						if = {
							limit = { has_completed_focus = CRY_eqsengineers }
							add_ideas = equestrian_overlord2
							else = {
								add_ideas = equestrian_overlord
							}
						}
					}
				}
			}
			if = {
				limit = {
					FROM = {
						NOT = { has_idea = modern_society }
					}
				}
				hidden_effect = { FROM = { ROOT = { transfer_society_ideas = yes } } }
				else = {
					hidden_effect = { add_ideas = modern_society }
				}
			}
			if = {
				limit = {
					FROM = {
						NOT = { has_idea = proper_science_base }
					}
				}
				hidden_effect = { FROM = { ROOT = { transfer_science_ideas = yes } } }
				else = {
					hidden_effect = { add_ideas = proper_science_base }
				}
			}
			if = {
				limit = {
					original_tag = EQC
					FROM = {
						OR = {
							original_tag = EQS
							original_tag = NLR
						}
					}
				}
				country_event = equestriancolony.1
			}
			#COSMETIC TAG ON PUPPET BELOW, DO NOT USE break = yes ABOVE
			if = {
				limit = {
					FROM = {
						original_tag = GRI
						NOT = { has_country_flag = have_regular_puppets }
					}
					is_feudal_vassal = yes
				}
				country_event = griffonian.1
			}
			if = {
				limit = {
					FROM = {
						tag = event_target:solar_empire
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = CRY }
					FROM = {
						set_country_flag = SOL_twilight_unavailable
						set_country_flag = SOL_twilight_governor
						set_autonomy = { target = ROOT autonomy_state = autonomy_reichskommissariat }
					}
					set_cosmetic_tag = CRY_SOL
					add_autonomy_ratio = { value = -0.20 }
					set_country_flag = CRY_solar_governorship
					set_party_name = { ideology = fascism long_name = SOL_fascism_party_long name = SOL_fascism_party }
					if = {
						limit = { NOT = { has_global_flag = SOL_twilight_converted } }
						create_country_leader = {
							name = "Arcane Nova"
							#desc = "TWILIGHT_DESC"
							picture = "ArcaneNova.tga"
							expire = "1965.1.1"
							ideology = falangism
							traits = {
							}
						}
						else = {
							create_country_leader = {
								name = "Grand Inquisitor Sunrise Sparkle"
								#desc = "TWILIGHT_DESC"
								picture = "TwilightSunrise.tga"
								expire = "1965.1.1"
								ideology = falangism
								traits = {
									lady_inquisitor
								}
							}
						}
					}
					break = yes
				}
				if = {
					limit = { original_tag = PLB }
					country_event = solarempire.1000
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = solarempire.1001
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = solarempire.1002
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = solarempire.1003
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = solarempire.1004
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = solarempire.1005
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = solarempire.1006
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = solarempire.1008
					break = yes
				}
				if = {
					limit = { original_tag = BAL }
					country_event = solarempire.1009
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = solarempire.1010
					break = yes
				}
				if = {
					limit = { original_tag = JUN }
					country_event = solarempire.1011
					break = yes
				}
				if = {
					limit = { original_tag = SCS }
					country_event = solarempire.1012
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = solarempire.1013
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = solarempire.1015
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = solarempire.1010
					break = yes
				}
				if = {
					limit = { original_tag = CHN }
					country_event = solarempire.1016
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = solarempire.1017
					break = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = NLR
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = PLB }
					country_event = { id = lunas.900 }
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = { id = lunas.902 }
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = { id = lunas.901 }
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = { id = lunas.903 }
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = { id = lunas.904 }
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = { id = lunas.905 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = lunas.906 }
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = lunas.911 }
					break = yes
				}
				if = {
					limit = { original_tag = BAL }
					country_event = { id = lunas.912 }
					break = yes
				}
				if = {
					limit = { original_tag = CES }
					country_event = { id = lunas.913 }
					break = yes
				}
				if = {
					limit = { original_tag = JUN }
					country_event = { id = lunas.914 }
					break = yes
				}
				if = {
					limit = { original_tag = SCS }
					country_event = { id = lunas.916 }
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = { id = lunas.917 }
					break = yes
				}
				if = {
					limit = { original_tag = CRY }
					country_event = { id = lunas.918 }
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = { id = lunas.919 }
					break = yes
				}
				if = {
					limit = { original_tag = CHN }
					country_event = { id = lunas.920 }
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = { id = lunas.921 }
					break = yes
				}
			}

			if = {
				limit = {
					FROM = {
						original_tag = CHN
						has_government = fascism
					}
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = olenia.718 }
					break = yes
				}
				if = {
					limit = { original_tag = PLB }
					country_event = { id = changelings.900 }
					break = yes
				}
				if = {
					limit = { original_tag = GRF }
					country_event = { id = changelings.902 }
					break = yes
				}
				if = {
					limit = { original_tag = PNG }
					country_event = { id = changelings.901 }
					break = yes
				}
				if = {
					limit = { original_tag = STL }
					country_event = { id = changelings.903 }
					break = yes
				}
				if = {
					limit = { original_tag = BUF }
					country_event = { id = changelings.904 }
					break = yes
				}
				if = {
					limit = { original_tag = DRG }
					country_event = { id = changelings.905 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = changelings.906 }
					break = yes
				}
				if = {
					limit = { original_tag = GFF }
					country_event = { id = changelings.906 }
					break = yes
				}
				if = {
					limit = { original_tag = OLE }
					country_event = { id = olenia.718 }
					break = yes
				}
				if = {
					limit = { original_tag = CRY }
					country_event = { id = crystalemp.23 }
					break = yes
				}
				if = {
					limit = { original_tag = EQS }
					country_event = { id = equestriachn.3 }
					break = yes
				}
				if = {
					limit = { original_tag = STG }
					country_event = { id = stalliongrad.98 }
					break = yes
				}
				if = {
					limit = { original_tag = YAK }
					country_event = { id = yakistan.12 }
					break = yes
				}
				if = {
					limit = { original_tag = JAK }
					country_event = { id = yakistan.13 }
					break = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = FAT
					}
				}
				if = {
					limit = { original_tag = SRS }
					country_event = griffonRepublic.100
					break = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
				}
				if = {
					limit = { original_tag = BUF }
					country_event = bufstate.36
					break = yes
				}
			}
		}
	}

	#ROOT is winner #FROM gets annexed - For civil wars on_civil_war_end is also fired
	on_annex = {
		effect = {
			if = {
				limit = {
					original_tag = OLE
					NOT = { tag = OLE }
					FROM = { original_tag = OLE }
				}
				set_cosmetic_tag = OLE_CWWON
				set_capital = 76
			}
			if = {
				limit = {
					tag = CCN
					FROM = { tag = CHN }
				}
				country_event = { id = thoraxian.41 days = 7 }
			}
			if = {
				limit = {
					tag = CHN
					FROM = { original_tag = OLE }
				}
				FROM = { set_country_flag = OLE_was_annexed }
			}

			if = {
				limit = {
					tag = event_target:solar_empire
					FROM = {
						has_country_flag = EQS_CRY_has_twilight
						original_tag = EQS
					}
				}
				country_event = solarempire.22
			}
			if = {
				limit = {
					tag = event_target:solar_empire
					FROM = {
						has_country_flag = EQS_CRY_has_twilight
						original_tag = CRY
					}
				}
				news_event = solarempire.26
			}
		}
	}

	#ROOT is winner FROM gets annexed
	on_civil_war_end = {
		effect = {
			if = {
				limit = {
					original_tag = EQS
					FROM = { original_tag = EQS has_government = communism }
				}
				country_event = { id = equestriadem.8 days = 60 }
			}
			if = {
				limit = {
					tag = event_target:equestria
					FROM = { tag = event_target:solar_empire }
				}
				set_capital = 3
				SOL = { save_global_event_target_as = solar_empire }
				break = yes
			}
			if = {
				limit = {
					FROM = {tag = event_target:equestria }
					tag = event_target:solar_empire
				}
				SOL = {
					set_politics = { ruling_party = democratic }
					save_global_event_target_as = equestria
				}
				break = yes
			}
			if = {
				limit = {
					original_tag = CRY
					FROM = { original_tag = CRY }
				}
				set_capital = 344
				break = yes
			}
			if = {
				limit = {
					original_tag = OLE
					FROM = { original_tag = OLE }
				}
				set_cosmetic_tag = OLE_CWWON
				drop_cosmetic_tag = yes
				if = {
					limit = {
						any_country = {
							original_tag = OLE
							has_government = democratic
						}
					}
					random_country = {
						limit = {
							original_tag = OLE
							has_government = democratic
							exists = yes
						}
						save_global_event_target_as = democratic_OLE
					}
					else = {
						random_country = {
							limit = { original_tag = OLE exists = yes}
							save_global_event_target_as = democratic_OLE
						}
					}
				}
				break = yes
			}
			#End of ideology Civil War

			# Give back WNG focus tree to Beakolini if he wins the civil war.
			if = {
				limit = {
					original_tag = WNG
					has_government = fascism
					FROM = {
						original_tag = WNG
						NOT = { has_government = fascism }
					}
				}
				load_focus_tree = { tree = Wingbardy keep_completed = no }
				unlock_national_focus = WNG_march_on_karthin
				unlock_national_focus = WNG_meet_with_beakolini
				unlock_national_focus = WNG_a_fascist_prime_minister
			}
			#End WNG Civil War Event
			if = {
				limit = {
					FROM = {
						original_tag = WNG
						has_government = fascism
					}
					original_tag = WNG
					has_government = communism
				}
				country_event = { id = wingbardy.51 days = 1 }
			}
		}
	}
	on_capitulation = {
		effect = {
			if = {
				limit = {
					tag = EQP
				}
				EQS = { annex_country = { target = EQP } }
			}
			if = {
				limit = {
					tag = GRI
					is_major = yes
				}
				set_major = no
			}
			if = {
				limit = {
					FROM = {
						tag = DED
						NOT = { has_country_flag = DED_capitulated@ROOT}
					}
				}
				set_country_flag = DED_capitulated@ROOT
				if = {
					limit = { is_major = yes }
					FROM = { modify_country_flag = { flag = DED_killed_nations value = 5 } }
					else = {
						FROM = { modify_country_flag = { flag = DED_killed_nations value = 1 } }
					}
				}
			}
			if = {
				limit = {
					tag = event_target:equestria
					has_country_flag = EQS_CRY_has_twilight
					FROM = { tag = event_target:solar_empire }
				}
				FROM = { country_event = solarempire.22 }
			}
			if = {
				limit = {
					original_tag = CRY
					has_country_flag = EQS_CRY_has_twilight
					FROM = { tag = event_target:solar_empire }
				}
				FROM = { news_event = solarempire.26 }
			}
		}
	}
	#ROOT is free nation FROM is releaser
	on_release_as_free = {
		effect = {
			if = {
				limit = { tag = DED }
				FROM = {
					annex_country = { target = ROOT  }
					country_event = { id = deadempire.29 days = 1 }
				}
			}
			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_society
						#has_idea = modern_society
						NOT = { has_idea_with_trait = society_idea }
					}
					FROM = {
						NOT = {
							has_idea = modern_society
						}
					}
				}
				FROM = { ROOT = { transfer_society_ideas = yes } }
				else = { add_ideas = modern_society }
			}
			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_science
						#has_idea = modern_society
						NOT = { has_idea_with_trait = science_idea }
					}
					FROM = {
						NOT = {
							has_idea = proper_science_base
						}
					}
				}
				FROM = { ROOT = { transfer_science_ideas = yes } }
				else = {
					add_ideas = proper_science_base
				}
			}
		}
	}

	on_subject_free = {
		effect = {
			if = {
				limit = {
					has_country_flag = griffon_empire_puppet
				}
				country_event = griffonian.2
				break = yes
			}
			if = {
				limit = {
					has_country_flag = is_changeling_puppet
					NOT = { tag = EQS }
				}
				country_event = changelings.910
				break = yes
			}
			if = {
				limit = {
					has_country_flag = is_changeling_puppet
					original_tag = EQS
					num_of_controlled_states > 15
					controls_fillydelphia = yes
					controls_manehattan = yes
					controls_los_pegasus = yes
					controls_baltimare = yes
					controls_canterlot = yes
				}
				country_event = changelings.911
				break = yes
			}
			if = {
				limit = {
					original_tag = EQC
					OR = {
						has_country_flag = is_sol_puppet
						has_country_flag = is_eqs_puppet
						has_country_flag = is_nlr_puppet
					}
				}
				country_event = equestriancolony.2
				break = yes
			}
			if = {
				limit = {
					NOT = { original_tag = EQS }
					has_country_flag = is_luna_puppet
				}
				country_event = lunas.910
				break = yes
			}
			if = {
				limit = {
					original_tag = CRY
					NOT = {
						is_subject_of = event_target:solar_empire
						is_in_faction_with = event_target:solar_empire
					}
					has_country_flag = is_sol_puppet
				}
				country_event = solarempiresparkles.104
				break = yes
			}
			if = {
				limit = {
					has_country_flag = is_solar_puppet
				}
				country_event = solarempire.1007
				break = yes
			}
			if = {
				limit = {
					has_country_flag = is_FAT_puppet
				}
				country_event = griffonRepublic.101
				break = yes
			}
		}
	}

	on_government_change = {
		effect = {
			if = {
				limit = {
					original_tag = CRY
					has_government = democratic
					NOT = {
						has_country_leader = { ruling_only = yes name = "Princess Mi Amore Cadenza" }
						has_country_leader = { ruling_only = yes name = "Princess Twilight Sparkle" }
						has_country_leader = { ruling_only = yes name = "Princess Flurry Heart" }
					}
					OR = {
						AND = {
							OR = {
								has_country_flag = free_the_old_royalty
								has_country_flag = continue_imprisonment
								NOT = { has_completed_focus = CRY_miamorefate }
							}
						}
						AND = {
							has_country_flag = royalty_executed
							NOT = { country_exists = event_target:solar_empire }
							NOT = { has_global_flag = SOL_twilight_converted }
						}
					}
					has_global_flag = sombra_returned
				}
				country_event = { id = crysom.40 days = 1 }
			}
			if = {
				limit = {
					original_tag = BAN
					has_government = neutrality
				}
				clr_country_flag = have_regular_puppets
			}
			if = {
				limit = {
					OR = {
						has_idea = griffon_neutrality_support_idea
						has_idea = griffon_monarchy_support_idea
					}
					NOT = { has_government = neutrality }
				}
				remove_ideas = { griffon_monarchy_support_idea griffon_neutrality_support_idea }
			}
			if = {
				limit = {
					OR = {
						has_idea = griffon_monarchy_dem_support_idea
						has_idea = griffon_harmony_support_idea
					}
					NOT = { has_government = democratic }
				}
				remove_ideas = { griffon_monarchy_dem_support_idea griffon_harmony_support_idea }
			}
			if = {
				limit = {
					OR = {
						has_idea = griffon_fascism_support_idea
						has_idea = griffon_monarchy_fas_support_idea
					}
					NOT = { has_government = fascism }
				}
				remove_ideas = { griffon_monarchy_fas_support_idea griffon_fascism_support_idea }
			}
			if = {
				limit = {
					has_idea = griffon_communism_support_idea
					NOT = { has_government = communism }
				}
				remove_ideas = griffon_communism_support_idea
			}
		}
	}

	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		effect = {
			if = {
				limit = {
					original_tag = EQS
					FROM = { is_major = yes NOT = { tag = CHN } }
				}
				set_country_flag = EQS_had_big_war
				country_event = { id = equestriadem.8 days = 60 }
			}
			if = {
				limit = {
					original_tag = EQS
					FROM = { tag = CHN }
				}
				country_event = { id = news.2101 days = 1 }
				country_event = { id = equestriadem.8 days = 60 }
			}

			if = {
				limit = {
					original_tag = STG
					FROM = { tag = CHN }
				}
				country_event = { id = news.2201 days = 1 }
			}

			if = {
				limit = {
					has_global_flag = equestrian_civil_war
					original_tag = EQS
					FROM = { tag = NLR }
				}
				country_event = { id = news.2031 days = 1 }
				country_event = { id = equestriadem.8 days = 60 }
			}

			if = {
				limit = {
					has_global_flag = equestrian_civil_war
					tag = NLR
					FROM = { original_tag = NLR }
				}
				country_event = { id = news.2041 days = 1 }
			}

			if = {
				limit = {
					tag = event_target:solar_empire
					FROM = { tag = event_target:equestria }
				}
				country_event = { id =  news.sol.31 days = 1 }
				every_other_country = {
					limit = {
						NOT = { is_subject_of = event_target:solar_empire }
						is_in_faction_with = event_target:solar_empire
					}
					leave_faction = yes
				}
			}

			if = {
				limit = {
					FROM = { tag = event_target:solar_empire  }
					tag = event_target:equestria
				}
				country_event = { id =  news.sol.21 days = 1 }
			}

			if = {
				limit = { FROM = { tag = DED } }
				annex_country = { target = FROM  }
				country_event = { id = deadempire.29 days = 1 }
			}

			if = {
				limit = {
					FROM = {
						tag = DED
						NOT = { has_country_flag = DED_capitulated@ROOT}
					}
				}
				set_country_flag = DED_capitulated@ROOT
				if = {
					limit = { is_major = yes }
					FROM = { modify_country_flag = { flag = DED_killed_nations value = 5 } }
					else = {
						FROM = { modify_country_flag = { flag = DED_killed_nations value = 1 } }
					}
				}
			}

		}
	}
}
