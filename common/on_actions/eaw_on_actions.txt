on_actions = {

	#Not run on a specific country.
	on_startup = {
		effect = {
			log = "[GetDateText] Equestria at War main on_startup begin"
			every_state = {
				limit = {
					is_core_of = CTH
				}
				remove_core_of = CTC
			}
			every_country = {
				limit = {
					OR = {
						has_idea = zebrica_legacy_of_storm1
						has_idea = zebrica_legacy_of_storm2
						has_idea = zebrica_legacy_of_storm3
						original_tag = HIP
					}
				}
				add_opinion_modifier = { target = THU modifier = distrustful_relations }
				add_opinion_modifier = { target = GYZ modifier = distrustful_relations }
				add_opinion_modifier = { target = STM modifier = distrustful_relations }
				add_opinion_modifier = { target = SLC modifier = distrustful_relations }
				add_opinion_modifier = { target = BLT modifier = distrustful_relations }
				add_opinion_modifier = { target = CZR modifier = distrustful_relations }
			}
			1093 = {
				add_dynamic_modifier = { modifier = coltvan_unrest }
			}
			1094 = {
				add_dynamic_modifier = { modifier = coltvan_defiance }
			}
			1095 = {
				add_dynamic_modifier = { modifier = coltvan_unrest }
			}
			every_state = {
				if = {
					limit = {
						is_on_continent = europe #Equestria
					}
					add_to_array = { global.europe_states = THIS }
				}
				else_if = {
					limit = {
						is_on_continent = africa #Zebrica
					}
					add_to_array = { global.africa_states = THIS }
				}
			}
			add_to_array = { global.river_cup_states = 619.id }
			add_to_array = { global.river_cup_states = 387.id }
			add_to_array = { global.river_cup_states = 637.id }
			add_to_array = { global.river_cup_states = 645.id }
			add_to_array = { global.river_cup_states = 617.id }
			add_to_array = { global.river_cup_states = 544.id }
			add_to_array = { global.river_cup_states = 649.id }
			add_to_array = { global.river_cup_states = 580.id }
			add_to_array = { global.river_cup_states = 455.id }
			add_to_array = { global.river_cup_states = 642.id }
			add_to_array = { global.river_cup_states = 454.id }
			add_to_array = { global.river_cup_states = 670.id }
			add_to_array = { global.river_cup_states = 550.id }
			add_to_array = { global.river_cup_states = 577.id }
			add_to_array = { global.river_cup_states = 682.id }
			add_to_array = { global.river_cup_states = 622.id }
			add_to_array = { global.river_cup_states = 438.id }
			add_to_array = { global.river_cup_states = 628.id }
			add_to_array = { global.river_cup_states = 646.id }
			add_to_array = { global.river_cup_states = 648.id }
			add_to_array = { global.river_cup_states = 499.id }
			add_to_array = { global.river_cup_states = 511.id }
			add_to_array = { global.river_cup_states = 491.id }
			add_to_array = { global.river_cup_states = 620.id }
			add_to_array = { global.river_coalition_members = RCT }
			add_to_array = { global.river_coalition_members = LCT }
			add_to_array = { global.river_coalition_members = NIM }
			add_to_array = { global.river_coalition_members = WIT }
			add_to_array = { global.river_coalition_members = BAK }
			add_to_array = { global.river_coalition_members = DEP }
			add_to_array = { global.river_coalition_members = FRE }
			add_to_array = { global.river_coalition_members = DMT }

			#SOL is used here as a random country selector
			#Thanks to Delincious from KR team for the idea <3
			SOL = {
				setup_generic_advisor_portraits = yes
				mark_land_connected_states = yes
				if = {
					limit = { is_ai = no }
					random_other_country = {
						limit = {
							is_ai = yes 
							NOT = {
								has_focus_tree = generic_focus
								has_focus_tree = generic_griffon_focus
								has_focus_tree = generic_zebra_focus
							}
						}
						set_variable = { eaw_welcome_screen = 1 }
						capital_scope = { SOL = { goto_state = PREV } }
						change_tag_from = PREV
					}
				}
			}
			SRS = {
				set_variable = { total_sum_of_internationalist_and_communalist_displeasure = 0 }
				add_to_variable = { total_sum_of_internationalist_and_communalist_displeasure = displeasure_towards_communards_var }
				add_to_variable = { total_sum_of_internationalist_and_communalist_displeasure = displeasure_towards_internationalists_var }
				set_temp_variable = { internationalist_displeasure_as_a_percentage_ersatz = displeasure_towards_internationalists_var }
				divide_temp_variable = { internationalist_displeasure_as_a_percentage_ersatz = total_sum_of_internationalist_and_communalist_displeasure }
				set_variable = { internationalist_displeasure_as_a_percentage = internationalist_displeasure_as_a_percentage_ersatz }
				set_temp_variable = { communalist_displeasure_as_a_percentage_ersatz = displeasure_towards_communards_var }
				divide_temp_variable = { communalist_displeasure_as_a_percentage_ersatz = total_sum_of_internationalist_and_communalist_displeasure }
				set_variable = { communalist_displeasure_as_a_percentage = communalist_displeasure_as_a_percentage_ersatz }
			}
			EQS = {
				save_global_event_target_as = equestria
				if = {
					limit = {
						NOT = {
							has_game_rule = {
								rule = equestria_united_status
								option = EQS_STATUS_CIVIL_WAR
							}
						}
					}
					country_event = { id = equestria.1 hours = 15 }
					country_event = { id = equestria.45 days = 160 }
					country_event = { id = news.1101 days = 210 }
					country_event = { id = news.300 days = 171 }
					news_event = { id = news.16 days = 200 random = 960 }#days to hours applied
				}
				set_country_flag = manpower_laws_blocked
				set_country_flag = economic_laws_blocked
				set_country_flag = { flag = celestia_evil_meter value = 0 }
			}
			STG = {
				country_event = { id = stalliongrad.0 days = 1 }
				country_event = { id = stalliongrad.12 days = 10 }
				country_event = { id = stalliongrad.13 days = 20 }
				country_event = { id = stalliongrad.24 days = 45 }
				country_event = { id = stalliongrad.2 days = 60 }
				country_event = { id = stalliongrad.115 days = 545 random = 960 }#days to hours applied
				country_event = { id = stalliongrad.139 days = 1095 random = 7200 }#days to hours applied
				if = {
					limit = { is_ai = yes }
					random_list = {
						5 = { set_country_flag = STG_darkwing_natbol }
						95 ={ }
					}
					else = { set_country_flag = STG_darkwing_natbol }
				}
				country_event = { id = starting_warning_event.3 }
			}
			STL = {
				country_event = { id = starting_warning_event.1 }
			}
			PNG = {
				country_event = { id = starting_warning_event.1 }
			}
			SOL = { save_global_event_target_as = solar_empire }
			GRI = {
				save_global_event_target_as = griffonian_empire
				set_variable = { global.griffonian_empire_var = THIS }
				country_event = { id = imperial.1 days = 6 random = 240 }#days to hours applied
				country_event = { id = imperial.60 days = 186 random = 480 }#days to hours applied
			}
			DED = {
				country_event = { id = starting_warning_event.1 }
				add_dynamic_modifier = {
					modifier = DED_crystal_cost
				}
				every_owned_state = {
					add_claim_by = HLR
				}
			}
			HLR = {
				country_event = { id = starting_warning_event.1 }
			}
			NCH = {
				country_event = { id = starting_warning_event.1 }
			}
			CHN = {
				add_opinion_modifier = { target = EQS modifier = distrustful_relations }
				reverse_add_opinion_modifier = { target = EQS modifier = distrustful_relations }
				add_opinion_modifier = { target = CRY modifier = distrustful_relations }
				reverse_add_opinion_modifier = { target = CRY modifier = distrustful_relations }
				add_opinion_modifier = { target = EQC modifier = distrustful_relations }
				reverse_add_opinion_modifier = { target = EQC modifier = distrustful_relations }
				add_opinion_modifier = { target = EQS modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = EQS modifier = CHN_Embargo }
				add_opinion_modifier = { target = CRY modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = CRY modifier = CHN_Embargo }
				add_opinion_modifier = { target = EQC modifier = CHN_Embargo }
				reverse_add_opinion_modifier = { target = EQC modifier = CHN_Embargo }
				add_opinion_modifier = { target = GRI modifier = CHN_GRI_Friendship }
				reverse_add_opinion_modifier = { target = GRI modifier = CHN_GRI_Friendship }
			}
			EYR = {
				add_opinion_modifier = { target = ERI modifier = mortal_enemies }
			}
			ERI = {
				add_opinion_modifier = { target = EYR modifier = mortal_enemies }
			}
			GRF = {
				country_event = { id = griffons.21 days = 943 random = 96 }#days to hours applied
				country_event = { id = griffons.22 days = 987 random = 96 }#days to hours applied
				country_event = { id = griffons.23 days = 931 random = 96 }#days to hours applied
				country_event = { id = griffons.24 days = 968 random = 96 }#days to hours applied
				country_event = { id = griffons.25 days = 938 random = 96 }#days to hours applied
			}
			FEA = {
				country_event = { id = feat.15 days = 60 random = 2880 }#days to hours applied
				country_event = { id = feat.20 days = 72 random = 144 }#days to hours applied
				country_event = { id = feat.21 days = 105 random = 144 }#days to hours applied
			}
			FAT = {
				country_lock_all_division_template = yes
				country_event = { id = griffonRepublic.60 days = 9 random = 38400 }#days to hours applied
				country_event = { id = griffonRepublic.61 days = 10 random = 13920 }#days to hours applied
				country_event = { id = griffonRepublic.62 days = 11 random = 9600 }#days to hours applied
				country_event = { id = griffonRepublic.63 days = 12 random = 28800 }#days to hours applied
				country_event = { id = griffonRepublic.64 days = 13 random = 22080 }#days to hours applied
				country_event = { id = griffonRepublic.65 days = 14 random = 48000 }#days to hours applied
				country_event = { id = griffonRepublic.266 days = 400 }
			}
			KAT = {
				country_event = { id = katerin.1 days = 1 } #the Ball, was set this in history files
				#country_event = { id = katerin.2 days = 9 } #Plague event starter - Dummied out for now.
				country_event = { id = katerin.135 days = 15 } #THE NEW Plague event
			}
			LNS = {
				country_lock_all_division_template = yes
			}
			BRF = {
				country_event = { id = prywhen.6 days = 1 }
			}
			GRW = {
				country_event = { id = starting_warning_event.1 }
			}
			JER = {
				country_event = { id = aquileia.30 days = 157 random = 480 }#days to hours applied
			}
			ARA = {
				country_event = { id = arantiga.2 days = 470 random = 480 }#days to hours applied
			}
			FIR = {
				country_event = { id = FIR.1 days = 1 random = 1200 }#days to hours applied
			}
			EQC = {
				country_event = { id = mareland.19 days = 20 random = 5760 }#days to hours applied
				country_event = { id = mareland.33 days = 1825 random = 43800 }#days to hours applied

			}
			SIC = {
				country_event = { id = sicameon.1 days = 240 }
				country_event = { id = sicameon.2 days = 104 }
			}
			NIM = {
				if = {
					limit = { is_historical_focus_on = no }
					random_list = {
						5 = {
							set_global_flag = NIM_have_helots_rebel
						}
						95 = {

						}
					}
				}
			}
			LNS = { save_global_event_target_as = longsword }
			GRU = { country_event = { id = jan_brazowy.1 days = 70 random_hours = 200 } } ## Jan BrÄ…zowy event chain ##
			ZES = { country_event = { id = kasa.92 days = 15 random_hours = 48 } } ## The Raid event
			# Operative setup
			if = {
				limit = {
					has_dlc = "La Resistance"
				}
				set_global_flag = starting_operatives
				set_variable = { global.onstartup_operative = 0 }
				CHN = {
					create_operative_leader = {
						name = "Spiracles"
						GFX = GFX_portrait_CHN_Spiracles
						bypass_recruitment = yes
						available_to_spy_master = yes
						female = yes
						nationalities = { 
						   CHN CCN MAN NCH
						}
						traits = { 
							operative_agentbio_spiracles
							operative_spiracles
							operative_seducer
							# changeling_race_trait
						}
					}
				}
				GRF = {
					create_operative_leader = {
						name = "Erich Werner"
						GFX = GFX_portrait_Erich_Werner
						bypass_recruitment = no
						available_to_spy_master = yes
						nationalities = { 
							EYR
							GRF
							GFF
							GRI
							FAT
							FAW
							TRD
							FEA
							PYT
							ROU
							BOI
							LAK
							YAL
							ANG
							STW
							HLQ
							KAT
							LNS
							HAU
							SRS
							LSM
							BAN
							JHZ
							JGF
							JOS
						}
						traits = { 
							operative_scientist
							operative_spyhunter
							griffon_race_trait
						}
					}
				}
				RCT = {
					create_operative_leader = {
						name = "Dead Drop"
						GFX = GFX_portrait_RCT_Dead_Drop
						bypass_recruitment = yes
						available_to_spy_master = yes
						female = yes
						nationalities = { 
							FIR
							WAT
							FBK
							NTR
							LCT
							RCT
							NIM
							WIT
							BAK
							DEP
							FRE
							BAR
							LSC
							JHP
							JRV
						}
						traits = { 
							operative_agentbio_deaddrop
							operative_seducer
							operative_linguist
							pony_race_trait
						}
					}

					create_operative_leader = {
						name = "False Flag"
						GFX = GFX_portrait_RCT_False_Flag
						bypass_recruitment = yes
						available_to_spy_master = yes
						female = yes
						nationalities = { 
							FIR
							WAT
							FBK
							NTR
							LCT
							RCT
							NIM
							WIT
							BAK
							DEP
							FRE
							BAR
							LSC
							JHP
							JRV
						}
						traits = { 
							operative_agentbio_falseflag
							operative_demolition_expert
							operative_linguist
							pony_race_trait
						}
					}
				}
				EQS = {
					create_operative_leader = {
						name = "Con Mane"
						GFX = GFX_portrait_Con_Mane
						bypass_recruitment = yes
						available_to_spy_master = yes
						nationalities = {
							EQS
							STG
							CRY
							STL
							NLR
							VAN
							SCS
							BAL
							NMS
							CES
							JUN
							TEM
							LSP
							ELF
							EQC
							PCB
						}
						traits = { 
							operative_agentbio_conmane
							operative_commando   operative_seducer  operative_tough  operative_linguist  operative_safe_cracker  operative_well_groomed  operative_natural_orator  operative_escape_artist
							pony_race_trait
						}
					}
				}
				# TODO: Once it's fixed, transfer EQS Con Mane to ELF instead.
				# Not possible to set operative nationality in Barbarossa 1.11.12
				ELF = {
					create_operative_leader = {
						name = "Con Mane"
						GFX = GFX_portrait_Con_Mane_ELF
						bypass_recruitment = yes
						available_to_spy_master = yes
						nationalities = {
							EQS
							STG
							CRY
							STL
							NLR
							VAN
							SCS
							BAL
							NMS
							CES
							JUN
							TEM
							LSP
							ELF
							EQC
							PCB
						}
						traits = { 
							operative_agentbio_conmane_elf
							operative_commando   operative_seducer  operative_tough  operative_linguist  operative_safe_cracker  operative_well_groomed  operative_natural_orator  operative_escape_artist
							pony_race_trait
						}
					}
				}
				clr_global_flag = starting_operatives
				clear_variable = global.onstartup_operative
			}
			HIP = {
				HIP_underwater_conscription_setup = yes
				country_event = { id = hippogriff.1000 days = 450 random = 1680 } #Rocket Neverfall Event Chain, randomness of 70 days. Fires around 1008.
				set_capital = {
					state = 1165
					remember_old_capital = no
				}
			}
			random_country = {
				set_continent_flags_on_every_possible_country = yes
			}

			every_possible_country = {
				add_ai_strategy = {
					type = pp_spend_priority
					id = guarantee
					value = -50
				}
				if = {
					limit = {
						exists = yes
					}
					# added in vanilla 1.9.2
					capital_scope = {
						set_variable = { historical_capital_for_country = PREV }
					}
				}
				if = {
					limit = {
						is_riverlands_country = yes
					}
					add_opinion_modifier = { target = GRI modifier = RIV_hates_the_empire }
					add_opinion_modifier = { target = event_target:longsword modifier = mortal_enemies }
					add_opinion_modifier = { target = HLQ modifier = mortal_enemies }
					add_opinion_modifier = { target = event_target:longsword modifier = CHN_Embargo }
					add_opinion_modifier = { target = HLQ modifier = CHN_Embargo }
					reverse_add_opinion_modifier = { target = event_target:longsword modifier = mortal_enemies }
					reverse_add_opinion_modifier = { target = HLQ modifier = mortal_enemies }
					reverse_add_opinion_modifier = { target = event_target:longsword modifier = CHN_Embargo }
					reverse_add_opinion_modifier = { target = HLQ modifier = CHN_Embargo }
					if = {
						limit = { tag = WIT }
						add_opinion_modifier = { target = BAR modifier = sworn_enemies }
						reverse_add_opinion_modifier = { target = BAR modifier = sworn_enemies }
						else = {
							add_opinion_modifier = { target = BAR modifier = distrustful_relations }
							reverse_add_opinion_modifier = { target = BAR modifier = distrustful_relations }
						}
					}
					if = {
						limit = { is_river_fed_member = yes }
						add_opinion_modifier = { target = OLV modifier = distrustful_relations }
						add_opinion_modifier = { target = ZES modifier = distrustful_relations }
						reverse_add_opinion_modifier = { target = OLV modifier = distrustful_relations }
						reverse_add_opinion_modifier = { target = ZES modifier = distrustful_relations }
						every_other_country = {
							limit = { is_river_fed_member = yes }
							add_ai_strategy = {
								id = PREV
								type = alliance
								value = 200
							}
						}
					}
					every_other_country = {
						limit = { is_griffon_continent_griffon_country = yes }
						add_ai_strategy = {
							id = PREV
							type = alliance
							value = -200
						}
						PREV = {
							add_ai_strategy = {
								id = PREV
								type = alliance
								value = -200
							}
						}
					}
				}
				
				if = {
					limit = { is_pony_race = yes }
					add_ideas = pony_race
				}
				else_if = {
					limit = { is_changeling_race = yes }
					add_ideas = changeling_race
				}
				else_if = {
					limit = { is_deer_race = yes }
					add_ideas = deer_race
				}
				else_if = {
					limit = { is_giraffe_race = yes }
					add_ideas = giraffe_race
				}
				else_if = {
					limit = { is_griffon_race = yes }
					add_ideas = griffon_race
					country_event = {
						id = fantasyflavor.11
						days = 345
					}
					if = {
						limit = {
							check_variable = { random > 0.90 }
							is_ai = no
							NOT = {
								tag = MNC
								tag = AET
							}
						}
						country_event = {
							id = fantasyflavor.12
							days = 400
							random = 25000
						}
					}
				}
				else_if = {
					limit = { is_cat_race = yes }
					add_ideas = cat_race
				}
				else_if = {
					limit = { is_camel_race = yes }
					add_ideas = camel_race
				}
				else_if = {
					limit = { is_centaur_race = yes }
					add_ideas = centaur_race
				}
				else_if = {
					limit = { is_diamond_dog_race = yes }
					add_ideas = diamond_dog_race
				}
				else_if = {
					limit = { is_donkey_race = yes }
					add_ideas = donkey_race
				}
				else_if = {
					limit = { is_gargoyle_race = yes }
					add_ideas = gargoyle_race
				}
				else_if = {
					limit = { is_horse_race = yes }
					add_ideas = horse_race
				}
				else_if = {
					limit = { is_hippogriff_race = yes }
					add_ideas = hippogriff_race
				}
				else_if = {
					limit = { is_zebra_race = yes }
					add_ideas = zebra_race
				}
				else_if = {
					limit = { is_kirin_race = yes }
					add_ideas = kirin_race
					#add_ideas = mare_society_hidden
				}
				else_if = {
					limit = { is_llama_race = yes }
					add_ideas = llama_race
				}
				else_if = {
					limit = { is_harpy_race = yes }
					add_ideas = harpy_race
				}
				else_if = {
					limit = { is_minotaur_race = yes }
					add_ideas = minotaur_race
				}
				else_if = {
					limit = { is_penguin_race = yes }
					add_ideas = penguin_race
				}
				else_if = {
					limit = { is_dragon_race = yes }
					add_ideas = dragon_race
				}
				else_if = {
					limit = { is_undead_race = yes }
					add_ideas = undead_race
				}
				else_if = {
					limit = { is_buffalo_race = yes }
					add_ideas = buffalo_race
				}
				else_if = {
					limit = { is_yak_race = yes }
					add_ideas = yak_race
				}
				else_if = {
					limit = { is_yeti_race = yes }
					add_ideas = yeti_race
				}
				else_if = {
					limit = { is_polar_race = yes }
					add_ideas = polar_race
				}
				else = {
					set_technology = { popup = no generic_race = 1 }
					add_ideas = generic_race_idea
				}

				if = {
					limit = {
						is_on_equestrian_continent = no
						OR = {
							has_idea = dummy_idea_science
							NOT = {
								has_idea_with_trait = science_idea
							}
						}
					}
					if = {
						limit = {
							num_of_civilian_factories > 2
							has_tech = melee_weapons1
							NOT = { owns_big_griffon_city = yes }
							NOT = { owns_major_griffon_city = yes }
							NOT = { owns_big_zebra_city = yes }
							NOT = { owns_major_zebra_city = yes }
						}
						#log = "[Root.GetName] better_science_base"
						add_ideas = better_science_base

					}
					else_if = {
						limit = {
							OR = {
								owns_big_griffon_city = yes
								owns_big_zebra_city = yes
							}
						}
						#log = "[Root.GetName] big_science_base"
						add_ideas = big_science_base
					}
					else_if = {
						limit = {
							OR = {
								owns_major_griffon_city = yes
								owns_major_zebra_city = yes
							}
						}
						#log = "[Root.GetName] proper_science_base"
						add_ideas = proper_science_base
					}
					else_if = {
						limit = {
							NOT = { owns_major_griffon_city = yes }
							NOT = { owns_big_griffon_city = yes }
							NOT = { owns_major_zebra_city = yes }
							NOT = { owns_big_zebra_city = yes }
							OR = {
								NOT = { has_tech = melee_weapons1 }
								NOT = { num_of_civilian_factories > 2 }
							}
							OR = {
								is_griffon_continent_country = yes
								is_zebrican_continent_country = yes
							}
						}
						#log = "[Root.GetName] poor_science_base"
						add_ideas = poor_science_base
					}
				}

				if = {
					limit = {
						OR = {
							is_on_equestrian_continent = yes
							has_idea = dummy_idea_science
							NOT = {
								has_idea_with_trait = science_idea
							}
						}
					}
					add_ideas = proper_science_base
				}

				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_society
							NOT = {
								has_idea_with_trait = society_idea
							}
						}
					}
					if = {
						limit = { 
							OR = {
								is_griffon_continent_country = yes
								is_zebrican_continent_country = yes
							}
						}
						add_ideas = outdated_industry
						else = {
							add_ideas = modern_society
						}
					}
				}

				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_literacy
							NOT = { has_idea_with_trait = illiteracy_idea }
						}
					}
					add_ideas = no_lack_of_scientists
				}

				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_poverty
							NOT = { has_idea_with_trait = poverty_idea }
						}
					}
					add_ideas = no_poverty
				}

				if = {
					limit = {
						is_ai = no
					}
					set_variable = { eaw_welcome_screen = 1 }
				}

				if = {
					limit = {
						is_griffon_continent_country = yes
						OR = {
							has_tribal_society = yes
							has_agrarian_society = yes
							has_pre_industrial_society = yes
							has_illiteracy = yes
						}
					}
					country_event = { id = griffonian.166 days = 912 } #comet sighted
				}

				if = {
					limit = {
						is_river_fed_member = yes
					}
					country_event = { id = river_cup.10 days = 193 }
					country_event = { id = river_cup.11 days = 1656 }
					country_event = { id = river_cup.12 days = 3119 }
					country_event = { id = river_cup.13 days = 4582 }
					country_event = { id = river_cup.14 days = 6045 }
					country_event = { id = river_cup.15 days = 7508 }
				}
				
				if = {
					limit = {
						is_ai = no
						NOT = {
							tag = DED
						}
					}
					if = {
						limit = { check_variable = { random > 0.90 } }
						country_event = {
							id = fantasyflavor.8
							days = 400
							random = 30000
						}
					}
					if = {
						limit = { check_variable = { random > 0.90 } }
						country_event = {
							id = fantasyflavor.5
							days = 400
							random = 25000
						}
					}
					if = {
						limit = { check_variable = { random > 0.90 } }
						country_event = {
							id = fantasyflavor.1
							days = 400
							random = 20000
						}
					}
					if = {
						limit = { check_variable = { random > 0.90 } }
						country_event = {
							id = fantasyflavor.14
							days = 400
							random = 35000
						}
					}
				}
				
				if = {
					limit = {
						NOT = {
							tag = GRI
							any_owned_state = {
								OR = {
									is_coastal = yes
									is_island_state = yes
								}
							}
						}
					}
					set_country_flag = started_out_as_landlocked
				}
				if = {
					limit = { 
						OR = {
							has_idea = agrarian_society
							has_idea = tribal_society
							has_idea = communal_society
							has_idea = detached_country
						}
					}
					add_fuel = 25000
				}
				every_owned_state = {
					if = {
						limit = {
							is_core_of = PREV
						}
						if = {
							limit = {
								PREV = { tag = CHN }
							}
							add_to_array = { CCN.original_cores = THIS }
							add_to_array = { state_original_cores = CCN }
						}
						if = {
							limit = {
								PREV = { tag = FAT }
							}
							add_to_array = { FAW.original_cores = THIS }
							add_to_array = { state_original_cores = FAW }
						}
						if = {
							limit = {
								PREV = { tag = BRF }
							}
							add_to_array = { GRW.original_cores = THIS }
							add_to_array = { state_original_cores = GRW }
						}
						if = {
							limit = {
								PREV = { tag = GRW }
							}
							add_to_array = { BRF.original_cores = THIS }
							add_to_array = { state_original_cores = BRF }
						}
						if = {
							limit = {
								PREV = { tag = EQS }
							}
							add_to_array = { NLR.original_cores = THIS }
							add_to_array = { state_original_cores = NLR }
						}
						if = {
							limit = {
								PREV = { tag = LNS }
							}
							add_to_array = { LSC.original_cores = THIS }
							add_to_array = { state_original_cores = LSC }
							add_to_array = { LSM.original_cores = THIS }
							add_to_array = { state_original_cores = LSM }
						}
					}
					for_each_scope_loop = {
						array = core_countries
						add_to_array = { original_cores = PREV }
						add_to_array = { PREV.state_original_cores = THIS }
					}
				}
				adjust_research_modifier = yes
				update_global_arrays = yes
				if = {
					limit = { NOT = { has_country_flag = weapons_fixed_at_start } }
					actually_fix_weapon_techs = yes
				}
			}

			BUF = {
				add_ideas = poor_science_base
				adjust_research_modifier = yes
				country_event = { id = starting_warning_event.1 }
			}
			PLB = {
				add_ideas = better_science_base
				adjust_research_modifier = yes
				country_event = { id = starting_warning_event.2 }
			}
			GFF = {
				add_ideas = big_science_base
				adjust_research_modifier = yes
			}
			CRY = {
				add_ideas = outdated_industry
				adjust_research_modifier = yes
			}
			YAK = {
				add_ideas = big_science_base
				adjust_research_modifier = yes
			}
			JAK = {
				add_ideas = big_science_base
				adjust_research_modifier = yes
			}
			ABY = {
				add_ideas = big_science_base
				adjust_research_modifier = yes
				country_event = { id = starting_warning_event.2 }
			}
			AES = {
				country_event = { id = starting_warning_event.2 }
			}
			ALO = {
				country_event = { id = starting_warning_event.2 }
			}
			ANS = {
				country_event = { id = starting_warning_event.2 }
			}
			ASS = {
				country_event = { id = starting_warning_event.2 }
			}
			BLT = {
				country_event = { id = starting_warning_event.2 }
			}
			BOI = {
				country_event = { id = starting_warning_event.2 }
			}
			BRS = {
				country_event = { id = starting_warning_event.2 }
			}
			CGI = {
				country_event = { id = starting_warning_event.2 }
			}
			CME = {
				country_event = { id = starting_warning_event.2 }
			}
			CNT = {
				country_event = { id = starting_warning_event.2 }
			}
			CZR = {
				country_event = { id = starting_warning_event.2 }
			}
			DEL = {
				country_event = { id = starting_warning_event.2 }
			}
			DEP = {
				country_event = { id = starting_warning_event.2 }
			}
			DRG = {
				country_event = { id = starting_warning_event.2 }
			}
			EMR = {
				country_event = { id = starting_warning_event.2 }
			}
			FRE = {
				country_event = { id = starting_warning_event.2 }
			}
			GAR = {
				country_event = { id = starting_warning_event.2 }
			}
			GAZ = {
				country_event = { id = starting_warning_event.2 }
			}
			GFS = {
				country_event = { id = starting_warning_event.2 }
			}
			GIF = {
				country_event = { id = starting_warning_event.2 }
			}
			GYZ = {
				country_event = { id = starting_warning_event.2 }
			}
			HAY = {
				country_event = { id = starting_warning_event.2 }
			}
			HEL = {
				country_event = { id = starting_warning_event.2 }
			}
			HIN = {
				country_event = { id = starting_warning_event.2 }
			}
			HMR = {
				country_event = { id = starting_warning_event.2 }
			}
			HRV = {
				country_event = { id = starting_warning_event.2 }
			}
			HYE = {
				country_event = { id = starting_warning_event.2 }
			}
			IDO = {
				country_event = { id = starting_warning_event.2 }
			}
			IDT = {
				country_event = { id = starting_warning_event.2 }
			}
			IST = {
				country_event = { id = starting_warning_event.2 }
			}
			JEB = {
				country_event = { id = starting_warning_event.2 }
			}
			JFT = {
				country_event = { id = starting_warning_event.2 }
			}
			JRR = {
				country_event = { id = starting_warning_event.2 }
			}
			KAR = {
				country_event = { id = starting_warning_event.2 }
			}
			KHM = {
				country_event = { id = starting_warning_event.2 }
			}
			KIR = {
				country_event = { id = starting_warning_event.2 }
			}
			KLG = {
				country_event = { id = starting_warning_event.2 }
			}
			KXN = {
				country_event = { id = starting_warning_event.2 }
			}
			LMB = {
				country_event = { id = starting_warning_event.2 }
			}
			MAZ = {
				add_ideas = better_science_base
				adjust_research_modifier = yes
				country_event = { id = starting_warning_event.2 }
			}
			MCW = {
				country_event = { id = starting_warning_event.2 }
			}
			MEL = {
				country_event = { id = starting_warning_event.2 }
			}
			MER = {
				country_event = { id = starting_warning_event.2 }
			}
			MGY = {
				country_event = { id = starting_warning_event.2 }
			}
			MQA = {
				country_event = { id = starting_warning_event.2 }
			#	country_event = { id = sambovato.1 days = 120 }
			}
			MSH = {
				country_event = { id = starting_warning_event.2 }
			}
			MSS = {
				country_event = { id = starting_warning_event.2 }
			}
			MTA = {
				country_event = { id = starting_warning_event.2 }
			}
			MTO = {
				country_event = { id = starting_warning_event.2 }
			}
			NTR = {
				country_event = { id = starting_warning_event.2 }
			}
			NVA = {
				country_event = { id = starting_warning_event.2 }
			}
			OSQ = {
				country_event = { id = starting_warning_event.2 }
			}
			PCB = {
				country_event = { id = starting_warning_event.2 }
			}
			POM = {
				country_event = { id = starting_warning_event.2 }
			}
			REE = {
				country_event = { id = starting_warning_event.2 }
			}
			ROA = {
				country_event = { id = starting_warning_event.2 }
			}
			SAM = {
				country_event = { id = starting_warning_event.2 }
			}
			SDC = {
				country_event = { id = starting_warning_event.2 }
			}
			SDF = {
				country_event = { id = starting_warning_event.2 }
			}
			SDL = {
				country_event = { id = starting_warning_event.2 }
			}
			SDS = {
				country_event = { id = starting_warning_event.2 }
			}
			SLC = {
				country_event = { id = starting_warning_event.2 }
			}
			SON = {
				country_event = { id = starting_warning_event.2 }
			}
			SPL = {
				country_event = { id = starting_warning_event.2 }
			}
			STM = {
				country_event = { id = starting_warning_event.2 }
			}
			TAI = {
				country_event = { id = starting_warning_event.2 }
			}
			THU = {
				country_event = { id = starting_warning_event.2 }
			}
			TIM = {
				country_event = { id = starting_warning_event.2 }
			}
			TSV = {
				country_event = { id = starting_warning_event.2 }
			}
			VIN = {
				country_event = { id = starting_warning_event.2 }
			}
			WAT = {
				country_event = { id = starting_warning_event.2 }
			}
			YAN = {
				country_event = { id = starting_warning_event.2 }
			}
			YMN = {
				country_event = { id = starting_warning_event.2 }
			}
			ZAI = {
				country_event = { id = starting_warning_event.2 }
			}
			ZEL = {
				country_event = { id = starting_warning_event.2 }
			}
			ZLU = {
				country_event = { id = starting_warning_event.2 }
			}
			ZOO = {
				country_event = { id = starting_warning_event.2 }
			}
			ZUG = {
				country_event = { id = starting_warning_event.2 }
			}
			ZWA = {
				country_event = { id = starting_warning_event.2 }
			}

			547 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 12874
						id = 12787
						id = 8039
					}
				}
			}
			506 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 1658 
						id = 3860 
						id = 3929 
						id = 11862 
						id = 3947 
						id = 5022 
						id = 7836
					}
				}
			}
			554 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 1139
						id = 4058
						id = 4538
						id = 12078
						id = 12344
						id = 12344
						id = 1203
						id = 4093
						id = 12062
					}
				}
			}
			423 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 12667
						id = 10606
						id = 12356
						id = 4880
						id = 4174
						id = 1519
						id = 10421
						id = 4606
						id = 4794
						id = 9892
						id = 9883
						id = 10676
						id = 12651
						id = 10532 
						id = 1867 
					}
				}
			}
			411 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 3981
						id = 10919
						id = 12785
						id = 4760
						id = 7862
						id = 12620
						id = 7888
						id = 3750
						id = 4871 
					}
				}
			}
			422 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 1718
						id = 10862
						id = 2050
						id = 12731
						id = 12026
						id = 6828
						id = 12900
						id = 2025
						id = 12589
						id = 12174
						id = 8034
						id = 12692 
						id = 10686 
					}
				}
			}
			471 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = { id = 10831 }
				}
			}
			488 = {
				add_province_modifier = {
					static_modifiers = { scheisswald_forest }
					province = {
						id = 11996
						id = 12648
						id = 7770
						id = 5036 
					}
				}
			}
			586 = {
				add_province_modifier = {
					static_modifiers = { eygsic_forest }
					province = {
						all_provinces = yes
					}
				}
			}
			1109 = {
				add_province_modifier = {
					static_modifiers = { centaur_forest }
					province = {
						all_provinces = yes
					}
				}
			}
			#barrad
			624 = {
				add_province_modifier = {
					static_modifiers = { barrad_climate }
					province = {
						all_provinces = yes
					}
				}
				set_state_flag = BAR_climate
			}
			625 = {
				add_province_modifier = {
					static_modifiers = { barrad_climate }
					province = {
						all_provinces = yes
					}
				}
				set_state_flag = BAR_climate
			}
			626 = {
				add_province_modifier = {
					static_modifiers = { barrad_climate }
					province = {
						all_provinces = yes
					}
				}
				set_state_flag = BAR_climate
			}
			648 = {
				add_province_modifier = {
					static_modifiers = { eygsic_forest }
					province = { 
						id = 8222 
						id = 12914
						id = 2178
					}
				}
			}
			491 = {
				add_province_modifier = {
					static_modifiers = { eygsic_forest }
					province = {
						id = 1161
						id = 1001
						id = 10008
						id = 4148
						id = 10783
						id = 12461
						id = 7094
						id = 12859
						id = 7094
						id = 1892
						id = 3834
						id = 2204
						id = 1302
						id = 12036
						id = 10040
						id = 4079
					}
				}
			}
			637 = {
				add_province_modifier = {
					static_modifiers = { eygsic_forest }
					province = { id = 13144 }
				}
			}
			544 = {
				add_province_modifier = {
					static_modifiers = { eygsic_forest }
					province = { 
						id = 1562 
						id = 1089
						id = 4091
					}
				}
			}
			1208 = {
				set_resistance = 20
				set_compliance = 20
				add_dynamic_modifier = { modifier = klugetown_criminals }
			}
			ZES = {
				country_lock_all_division_template = yes
				ZES_oppressive_countries_calculate = yes
			}
			CHN = {
				country_lock_all_division_template = yes
			}
			TBK = {
				country_lock_all_division_template = yes
			}
			1 = {
				add_dynamic_modifier = { modifier = everfree_forest_resistance_to_occupation_modifier }
				add_province_modifier = { ## Everfree Forest modifiers ##
					static_modifiers = { old_dragon_gardens }
					province = {
						all_provinces = yes
					}
				}
			}
			5 = {
				add_dynamic_modifier = { modifier = everfree_forest_resistance_to_occupation_modifier }
				add_province_modifier = {
					static_modifiers = { old_dragon_gardens }
					province = {
						all_provinces = yes
					}
				}
      		}
			FRN = {
				give_resource_rights = { receiver = WNG state = 481 }
				give_resource_rights = { receiver = WNG state = 652 }
			}
			TAL = {
				give_resource_rights = { receiver = WNG state = 366 }
				give_resource_rights = { receiver = WNG state = 367 }
			}
			CTH = {
				give_resource_rights = { receiver = WNG state = 703 }
				give_resource_rights = { receiver = SIC state = 706 }
				random_list = {
					99 = {
					
					}
					1 = {
						set_portraits = {
							character = CTH_zalathel_zarca 
							civilian = { large ="gfx/leaders/CTH/the_cooler_zalathel.tga" }
						}
					}
				}
			}
			WNG = {
				setup_WNG_parliament = yes
			}
			# this extra loop is intentional
			# adjust_research_modifier needs to be fired again after force_update_dynamic_modifier for the value to work correctly
			# first loop is above, in every_country
			for_each_scope_loop = {
				array = global.countries
				force_update_dynamic_modifier = yes
				adjust_research_modifier = yes
				make_hate_DED_and_EWI = yes
				set_ignore_AI_strategies = yes
				if = {
					limit = {
						NOT = { tag = NCR }
					}
					set_rule = {
						can_generate_female_aces = yes
						can_generate_female_unit_leaders  = yes
						can_generate_female_country_leaders = yes
					}
				}
			}
			every_state = {
				if = {
					limit = {
						OR = {
							is_core_of = STW
							is_core_of = BRZ
							is_core_of = FEA
							is_core_of = PYT
							is_core_of = YAL
							is_core_of = ROU
							is_core_of = KAT
							is_core_of = ANG				
							is_core_of = GRI						
						}
					}
					set_state_flag = JHZ_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = VED
							is_core_of = SRS
							is_core_of = FAT
							is_core_of = FAW
							is_core_of = MNC
							is_core_of = HAU
							is_core_of = NTR
						}
					}
					set_state_flag = JNG_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = ARA
							is_core_of = LAK
							is_core_of = BOI
							is_core_of = BAN
							is_core_of = EYR
						}
					}
					set_state_flag = JGF_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = WNG
							is_core_of = TAL
							is_core_of = FRN
							is_core_of = FAL
							is_core_of = SIC
						}
					}
					set_state_flag = JKR_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = HLQ
							is_core_of = LNS
							is_core_of = LSC
							is_core_of = LSM
						}
					}
					set_state_flag = JOS_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = WAT
							is_core_of = FBK
							is_core_of = FIR
							is_core_of = NCH
						}
					}
					set_state_flag = JHP_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = RCT
							is_core_of = LCT
							is_core_of = DEP
							is_core_of = BAK
							is_core_of = DMT
							is_core_of = NIM
							is_core_of = WIT
							is_core_of = ZES
							is_core_of = OLV
							is_core_of = BAR
							is_core_of = FRE
						}
					}
					set_state_flag = JRV_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = CYA
							is_core_of = MIT
						}
					}
					set_state_flag = JAS_cores
				}
				if = {
					limit = {
						OR = {
							is_core_of = BRF
							is_core_of = GRY
							is_core_of = LUS
							is_core_of = GRU
						}
					}
					set_state_flag = JEV_cores
				}
			}
			EQS = {
				STG = { add_to_PREV_potential_original_cores = yes }
				STL = { add_to_PREV_potential_original_cores = yes }
			}
			ZAR = {
				refresh_compliance_values = yes
				ZAR_save_starting_core_NZ = yes
			}
			log = "[GetDateText] Equestria at War main on_startup end"
		}
		
	}

	on_war_relation_added = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_war_relation_added"
			hidden_effect = {
				if = {
					limit = {
						OR = {
							original_tag = BAT
							original_tag = HIP
							AND = {
								original_tag = WNG
								has_government = fascism
							}
							original_tag = CTH
							original_tag = TBK
						}
						NOT = {
							has_country_flag = BAT_HIP_defeated
						}
						NOT = {
						    has_global_flag = BAT_won_civil_war
						}
						NOT = {
						    has_country_flag = HIE_BAT_alliance
						}
						FROM = {
							OR = {
								original_tag = BAT
								original_tag = HIP
								AND = {
									original_tag = WNG
									has_government = fascism
								}
								original_tag = CTH
								original_tag = TBK
							}
							NOT = {
								has_country_flag = BAT_HIP_defeated
							}
							NOT = {
								has_country_flag = HIP_won_north_zebrican_war
							}
							NOT = {
						    	has_global_flag = BAT_won_civil_war
							}
						}
					}
					if = {
						limit = {
							OR = {
								original_tag = BAT
								AND = {
									original_tag = WNG
									has_government = fascism
								}
								original_tag = CTH
								original_tag = TBK
							}
							NOT = {
							    OR = {
							    	has_country_flag = BAT_national_catastrophe
							    	AND = {
							    		original_tag = WNG
							    		NOT = { has_government = fascism }
							    	}
							    }
							}
							FROM = {
							    original_tag = HIP
								is_subject = no
								NOT = {
									has_country_flag = HIP_siren_takeover
								}
								NOT = {
									has_country_flag = HIP_second_war
								}
								NOT = {
									has_country_flag = HIP_won_north_zebrican_war
								}
								NOT = {
									has_country_flag = BAT_HIP_defeated
								}
							}
						}
						set_country_flag = partial_war
						set_country_flag = north_zebrican_war_participant
						FROM = {
							set_country_flag = north_zebrican_war_participant
						}
						if = {
							limit = {
								NOT = {
									has_global_flag = HIP_north_war_news_event_fired
								}
							}
							set_global_flag = HIP_north_war_news_event_fired
							news_event = {
								id = north_war.101
								hours = 8
							}
						}
						if = {
							limit = {
								OR = {
									tag = CTH
									tag = HIE
									tag = CVA
									tag = TRO
								}
								is_in_faction = yes
								is_major = no
							}
							set_major = yes
						}
					}
					if = {
						limit = {
							OR = {
								AND = {
									original_tag = HIP
									NOT = {
										has_country_flag = HIP_siren_takeover
									}
									FROM = {
										original_tag = HIE
										is_subject = no
									}
								}
								AND = {
									original_tag = HIE
									is_subject = no
									FROM = {
										AND = {
											original_tag = HIP
											NOT = {
												has_country_flag = HIP_siren_takeover
											}
										}
									}
								}
							}
						}
						HIP = {
							country_event = {
								id = hippogriff.63
								days = 30
							}
						}
					}
					if = {
						limit = {
						    original_tag = HIP
							is_subject = no
							NOT = {
								has_country_flag = HIP_siren_takeover
							}
							NOT = {
								has_country_flag = HIP_second_war
							}
							NOT = {
								has_country_flag = BAT_HIP_defeated
							}
							NOT = {
								has_country_flag = HIP_won_north_zebrican_war
							}
							FROM = {
								OR = {
									original_tag = BAT
									AND = {
										original_tag = WNG
										has_government = fascism
									}
									original_tag = CTH
									original_tag = TBK
								}
								NOT = {
									OR = {
							    		has_country_flag = BAT_national_catastrophe
										AND = {
											original_tag = WNG
											NOT = {has_government = fascism}
										}
									}
								}
							}
						}
						set_country_flag = north_zebrican_war_participant
						FROM = {
							set_country_flag = partial_war
							set_country_flag = north_zebrican_war_participant
						}
						if = {
							limit = {
								NOT = {
									has_global_flag = HIP_north_war_news_event_fired
								}
							}
							set_global_flag = HIP_north_war_news_event_fired
							news_event = {
								id = north_war.101
								hours = 8
							}
						}
					}
				}
				if = {
					limit = {
						original_tag = HIP
						has_completed_focus = HIP_sunset_atoll_test
					}
					FROM = {
						add_ideas = HIP_sunset_atoll_terror
					}
				}
				if = {
					limit = {
						FROM = {
							original_tag = HIP
							has_completed_focus = HIP_sunset_atoll_test
						}
					}
					ROOT = {
						add_ideas = HIP_sunset_atoll_terror
					}
				}
			}
		}
	}

	#FROM is war target
	on_declare_war = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_declare_war"
			hidden_effect = {
				save_puppet_wargoals = yes
				country_event = griffonian.2
				FROM = {
					country_event = griffonian.2
				}
				if = {
					limit = {
						OR = {
							AND = {
								FROM = { tag = DED }
								tag = HLR
							}
							AND = {
								FROM = { tag = HLR }
								tag = DED
							}
						}
					}
					if = {
						limit = {
							DED = {
								NOT = {has_country_flag = DED_AP_disable_weird_ded_shit}
							}
						}
						426 = { add_core_of = DED }
						564 = { add_core_of = DED }
					}
				}
				if = {
					limit = {
						is_trading_with_NCH = yes
						FROM = { tag = NCH }
					}
					remove_opinion_modifier = { modifier = NCH_negative_trading target = FROM }
					remove_opinion_modifier = { modifier = trading target = FROM }
					if = {
						limit = {
							has_idea = NCH_trading_with_NCH_harmonic
						}
						remove_ideas = NCH_trading_with_NCH_harmonic
					}
					if = {
						limit = {
							has_idea = NCH_trading_with_NCH_fascist
						}
						remove_ideas = NCH_trading_with_NCH_fascist
					}
					FROM = {
						hidden_effect = {
							add_to_variable = {
								var = NCH_trade_partners_iter
								value = -1
							}
							add_to_variable = { var = gytha_sanity value = 1 }
						}
						NCH_get_trading_idea = yes
					}
				}
				else_if = {
					limit = {
						FROM = { is_trading_with_NCH = yes }
						tag = NCH
					}
					FROM = {
						remove_opinion_modifier = { modifier = NCH_negative_trading target = ROOT }
						remove_opinion_modifier = { modifier = trading target = ROOT }
						if = {
							limit = {
								has_idea = NCH_trading_with_NCH_harmonic
							}
							remove_ideas = NCH_trading_with_NCH_harmonic
						}
						if = {
							limit = {
								has_idea = NCH_trading_with_NCH_fascist
							}
							remove_ideas = NCH_trading_with_NCH_fascist
						}
					}
					hidden_effect = {
						add_to_variable = {
							var = NCH_trade_partners_iter
							value = -1
						}
						add_to_variable = { var = gytha_sanity value = 1 }
					}
					NCH_get_trading_idea = yes
				}
				if = {
					limit = {
						FROM = {
							is_in_faction = yes
							is_river_fed_member = yes
							NOT = { original_tag = ROOT }
						}
					}
					FROM = { save_event_target_as = defender }
					every_country = {
						limit = {
							NOT = { tag = FROM }
							is_in_faction_with = FROM
							is_subject = no
						}
						country_event = {
							id = riverfed.30
							days = 1
						}
					}
				}
				clear_variable = delayed_merc_payment_@FROM
				FROM = { clear_variable = delayed_merc_payment_@ROOT }
				if = {
					limit = {
						OR = {
							original_tag = ERI
							original_tag = EYR
						}
						FROM = {
							OR = {
								original_tag = ERI
								original_tag = EYR
							}
						}
					}
					set_country_flag = { flag = block_white_peace value = 1 days = 21 }
					FROM = { set_country_flag = { flag = block_white_peace value = 1 days = 21 } }
				}
				else_if = {
					limit = { FROM = { tag = GRW } }
					if = {
						limit = {
							tag = BRF
						}
						country_event = brodfeld.26
					}
					if = {
						limit = {
							tag = LUS
						}
						if = {
							limit = { has_poverty = yes }
							country_event = { id = lushi.31 days = 1 }
						}
						if = {
							limit = {
								has_idea = LUS_prywhen_communist_influence
								NOT = {
									has_government = communism
								}
							}
							country_event = { id = lushi.30 days = 1 }
							add_ideas = LUS_munities_and_disorder
							FROM = {
								load_oob = "GRW_militia_against_LUS"
							}
						}
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								tag = GRW
								FROM = { tag = BAN }
							}
							AND = {
								tag = BAN
								FROM = { tag = GRW }
							}
							AND = {
								tag = GRW
								FROM = { tag = BRF }
							}
							AND = {
								tag = BRF
								FROM = { tag = GRW }
							}
						}
					}
					GRW = { load_oob = "GRW_fun_for_player" }
				}
				if = {
					limit = { tag = DED FROM = { tag = HLR } }
					FROM = { add_timed_idea = {idea = HLR_Dreads_Incoming_idea days = 200} }
				}
				if = {
					limit = {
						original_tag = OLE
						FROM = { original_tag = OLE }
					}
					if = {
						limit = {
							NOT = { tag = OLE }
							original_tag = OLE
						}
						if = {
							limit = {
								OR = {
									has_government = neutrality
									has_government = fascism
								}
							}
							set_cosmetic_tag = OLE_NEU
							else = {
								set_cosmetic_tag = OLE_DEM
							}
						}
					}
					FROM = {
						if = {
							limit = {
								NOT = { tag = OLE }
								original_tag = OLE
							}
							if = {
								limit = {
									OR = {
										has_government = neutrality
										has_government = fascism
									}
								}
								set_cosmetic_tag = OLE_NEU
								else = {
									set_cosmetic_tag = OLE_DEM
								}
							}
						}
					}
					if = {
						limit = {
							tag = OLE
							OR = {
								has_government = neutrality
								has_government = fascism
							}
						}
						set_cosmetic_tag = OLE_NEU
					}
				}
				else_if = {
					limit = {
						original_tag = CRY
						FROM = { original_tag = CRY }
					}
					if = {
						limit = {
							has_government = democratic
							NOT = { has_completed_focus = CRY_oldorder }
						}
						complete_national_focus = CRY_oldorder
						else = {
							FROM = {
								if = {
									limit = {
										has_government = democratic
										NOT = { has_completed_focus = CRY_oldorder }
									}
									complete_national_focus = CRY_oldorder
								}
							}
						}
					}
				}
				if = {
					limit = {
						original_tag = CRY has_government = democratic
					}
					country_event = { id = crysom.39 days = 1 }
				}
				else_if = {
					limit = {
						FROM = { original_tag = CRY has_government = democratic }
					}
					FROM = { country_event = { id = crysom.39 days = 1 } }
				}
				if = {
					limit = {
						original_tag = EQS
					}
					if = {
						limit = {
							FROM = {
								original_tag = BUF
								is_subject = no
							}
						}
						country_event = news.2001
					}
					else_if = {
						limit = {
							FROM = { original_tag = CHN }
						}
						set_variable = {
							var = mane_six_event_counter
							value = 0
						}
						country_event = {
							id = equestria.172
							days = 5
						}
					}
					else_if = {
						limit = {
							is_EQS_SOL = yes
							NOT = { has_completed_focus = SOL_bat_problems }
							FROM = { original_tag = EQS }
						}
						every_owned_state = {
							limit = { has_state_flag = eqs_bat_state }
							clr_state_flag = eqs_bat_state
							add_core_of = FROM
							FROM = { set_state_controller = PREV }
						}
					}
					else_if = {
						limit = {
							FROM = {
								is_EQS_SOL = yes
								NOT = { has_completed_focus = SOL_bat_problems }
							}
						}
						every_owned_state = {
							limit = { has_state_flag = eqs_bat_state }
							clr_state_flag = eqs_bat_state
							add_core_of = ROOT
							ROOT = { set_state_controller = PREV }
						}
					}
				}
				else_if = {
					limit = {
						OR = {
							AND = {
								original_tag = EQS
								FROM = { original_tag = CRY has_government = fascism }
							}
							AND = {
								original_tag = CRY has_government = fascism
								FROM = { original_tag = EQS }
							}
						}
					}
					news_event = { id = news.45 days = 1 }
				}
				else_if = {
					limit = { tag = CHN }
					if = {
						limit = {
							NOT = { has_global_flag = the_war }
							FROM = {
								original_tag = EQS
							}
						}
						country_event = { id = changelingattache.13 days = 1 }
						news_event = { id = news.3 days = 1 }
						EQS = {
							set_variable = {
								var = mane_six_event_counter
								value = 0
							}
							country_event = {
								id = equestria.172
								days = 5
							}
							if = {
								limit = {
									EQC = { is_ally_with = PREV }
								}
								EQC = { set_country_flag = together_with_EQS }
							}
						}
					}
					if = {
						limit = {
							has_government = fascism
							has_completed_focus = demand_equestria
							NOT = { country_exists = VAN EQS = { is_ai = yes } }
							FROM = {
								OR = {
									original_tag = EQS
									tag = NLR
								}
							}
						}
						country_event = { id = changelings.32 days = 1 random = 48 }#days to hours applied
					}
					if = {
						limit = {
							has_country_leader = { ruling_only = yes character = CHN_queen_chrysalis }
							FROM = {
								original_tag = OLE
							}
						}
						for_each_scope_loop = {
							array = global.majors
							if = {
								limit = {
									exists = yes
									is_major = yes
									is_on_equestrian_continent = yes
									NOT = {
										original_tag = CHN
										original_tag = OLE
										has_war_with = CHN
										has_capitulated = yes
										is_subject_of = CHN
									}
								}
								country_event = { id = changeling_diplo.4 days = 2 }
							}
						}
					}
				}
				else_if = {
					limit = {
						GRI = { GRI_synovial = { is_unit_leader = yes } }
						OR = {
							AND = {
								tag = CHN
								FROM = { tag = GRI }
							}
							AND = {
								tag = GRI
								FROM = { tag = CHN }
							}
						}
					}
					CHN = { remove_ideas = CHN_GRI_Attache_For_CHN }
					GRI = {
						remove_ideas = CHN_GRI_Attache_For_GRI
						GRI_thranx = { set_nationality = CHN }
						GRI_synovial = {
							set_nationality = CHN
							set_portraits = {
								army = { large ="GFX_Synovial_CHN_cap" }
							}
						}
						delete_unit_template_and_units = {
							division_template = "Panzergrenadier Division"
						}
					}
				}
				else_if = {
					limit = {
						STG = {
							exists = yes
							has_government = communism
							is_subject = no
						}
					}
					if = {
						limit = {
							OR = {
								AND = {
									tag = BAL
									FROM = { tag = EQS }
								}
								AND = {
									tag = EQS
									FROM = { tag = BAL }
								}
							}
						}
						BAL = { country_event = { id = civwar.14 days = 1 } }
					}
					else_if = {
						limit = {
							OR = {
								AND = {
									tag = BAL
									FROM = { tag = NLR }
								}
								AND = {
									tag = NLR
									FROM = { tag = BAL }
								}
							}
						}
						BAL = { country_event = { id = civwar.15 days = 1 } }
					}
				}
				#Remove BNPL bills if New Mareland goes to war
				if = {
					limit = {
						ROOT = { original_tag = EQC }
						ROOT = { EQC_has_bnpl_bills = yes }
						NOT = { FROM = { original_tag = EQC } } # Don't remove in a civil war
					}
					ROOT = {
						EQC_remove_bnpl_bills = yes
						set_country_flag = bnpl_bills_removed_through_war
					}
				}

				#Remove BNPL bills if New Mareland is declared war on
				else_if = {
					limit = {
						FROM = { original_tag = EQC }
						FROM = { EQC_has_bnpl_bills = yes }
					}
					FROM = {
						EQC_remove_bnpl_bills = yes
						set_country_flag = bnpl_bills_removed_through_war
					}
				}

				#Bronzehill Funded Rebels Rise Up in the Empire
				if = {
					limit = {
						FROM = {
							tag = BRZ
						}
						ROOT = {
							tag = GRI
							has_country_flag = BRZ_freikorps
						}
					}
					FROM = {
						country_event = bronzehill_revenge.5
					}
				}
				else_if = {
					limit = {
						ROOT = {
							tag = BRZ
						}
						FROM = {
							tag = GRI
							has_country_flag = BRZ_freikorps
						}
					}
					ROOT = {
						country_event = bronzehill_revenge.5
					}
				}

				#Gang up on Lake City
				if = {
					limit = {
						has_global_flag = LCT_holy_pony_empire_founded
						ROOT = { is_griffon_continent_griffon_country = yes }
						FROM = { original_tag = LCT }
					}
					ROOT = {
						country_event = { id = lakecity.91 days = 1 }
					}
				}
				
				#Gang up on Griffking Empire
				if = {
					limit = {
						ROOT = { is_griffon_continent_griffon_country = yes }
						FROM = { 
							original_tag = LSC 
							has_cosmetic_tag = LSC_griffking_empire_cosmetic
						}
					}
					ROOT = {
						country_event = { id = longsword.125 days = 1 }
					}
				}

				#Remove from LCT pact
				if = {
					limit = {
						tag = LCT
						FROM = {
							OR = {
								has_opinion_modifier = anti_comintern_pact_opinion
								has_idea = LCT_anti_commie_pact
							}
						}
					}
					FROM = {
						remove_opinion_modifier = { target = LCT modifier = anti_comintern_pact_opinion }
						remove_ideas = LCT_anti_commie_pact
					}
				}

				#Call LCT Anti-Commie pact members to war
				if = {
					limit = {
						ROOT = { has_government = communism }
						FROM = { has_idea = LCT_anti_commie_pact }
					}
					FROM = {
						country_event = { id = lakecity.81 days = 1 }
					}
					ROOT = {
						save_global_event_target_as = LCT_pact_war_starter
					}
				}


				if = {#If someone goes to war with Nova Whirl while they're infiltrated with her partisans
					limit = {
						FROM = {
							original_tag = RCT
						}
						ROOT = {
							OR = {
								has_idea = RCT_militants1
								has_idea = RCT_militants2
								has_idea = RCT_militants3
							}
						}
					}
					ROOT = {
						country_event = { id = rivercity.1920 days = 2}
					}
				}
				else_if = {#If Nova Whirl goes to war with someone while they're infiltrated with her partisans
					limit = {
						FROM = {
							OR = {
								has_idea = RCT_militants1
								has_idea = RCT_militants2
								has_idea = RCT_militants3
							}
						}
						ROOT = {
							original_tag = RCT
						}
					}
					FROM = {
						country_event = { id = rivercity.1920 days = 2}
					}
				}
				#Spawn the Scotts for FRe if fre declares war
				if = {
					limit = {
						ROOT = { original_tag = FRE }
						NOT = {
							has_country_flag = FRE_Scotts_arrived_already
						}
						NOT = { FROM = { original_tag = EQC } } # Don't spawn in cicil war
					}
					ROOT = {
						country_event = { id = freeponies.15 days = 2}
						set_country_flag = FRE_Scotts_arrived_already
					}
				}

				#Spawn the Scotts for FRe if Fre is attacked
				else_if = {
					limit = {
						FROM = { original_tag = FRE }
						NOT = {
							has_country_flag = FRE_Scotts_arrived_already
						}
					}
					FROM = {
						country_event = { id = freeponies.15 days = 2}
						set_country_flag = FRE_Scotts_arrived_already
					}
				}


				#Civil war transfer society/science ideas
				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_society
							NOT = { has_idea_with_trait = society_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = modern_society
								}
							}
						}
						FROM = { ROOT = { transfer_society_ideas = yes } }
						else = { add_ideas = modern_society }
					}
				}
				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_science
							NOT = { has_idea_with_trait = science_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = proper_science_base
								}
							}
						}
						FROM = { ROOT = { transfer_science_ideas = yes } }
						else = { add_ideas = proper_science_base }
					}
				}
				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_literacy
							NOT = { has_idea_with_trait = illiteracy_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = no_lack_of_scientists
								}
							}
						}
						FROM = { ROOT = { transfer_illiteracy_ideas = yes } }
						else = { add_ideas = no_lack_of_scientists }
					}
				}
				if = {
					limit = {
						OR = {
							has_idea = dummy_idea_poverty
							NOT = { has_idea_with_trait = poverty_idea }
						}
					}
					if = {
						limit = {
							FROM = {
								NOT = {
									has_idea = no_poverty
								}
							}
						}
						FROM = { ROOT = { transfer_poverty_ideas = yes } }
						else = { add_ideas = no_poverty }
					}
				}
				if = {
					limit = {
						original_tag = FROM
					}
					log = "on_declare_war: is civil war root: [?root.GetTag] from: [?from.GetTag]"
					#WORKAROUND_civil_war_load_tree_for_revolter = yes
					FROM = { ROOT = { transfer_race_ideas = yes } }
					if = {
						limit = { FROM = { has_country_flag = started_out_as_landlocked } }
						set_country_flag = started_out_as_landlocked
					}
					if = {
						limit = { has_country_flag = started_out_as_landlocked }
						FROM = { set_country_flag = started_out_as_landlocked }
					}
					if = {
						limit = {
							OR = {
								tag = FAT
								FROM = { has_focus_tree = generic_griffon_focus }
							}
							has_focus_tree = generic_griffon_focus
						}
						if = {
							limit = {
								#TODO make sure which countries can have monarchist civil wars
								always = yes
							}
							set_country_flag = have_regular_puppets
						}
					}
					set_rule = {
						can_generate_female_aces = yes
					}
					FROM = {
						set_rule = {
							can_generate_female_aces = yes
						}
					}
				}
			}
			if = {
				limit = {
					FROM = {
						OR = {
							tag = BRF
							tag = SIC
							tag = WNG
							tag = FAL
							tag = BOI
							tag = LAK
							tag = TAL
							tag = FRN
							tag = ARA
							tag = EYR
							tag = ERI
							tag = AVI
							tag = POM
							tag = HEL
							tag = AET
							tag = FEZ
							tag = TRD
							tag = JER
							tag = JEB
							tag = JRR
							tag = VIN
							tag = JFT
							tag = PYT
							tag = YAL
							tag = ANG
							tag = GRI
							tag = KAT
							tag = STW
							tag = FEA
							tag = FAT
							tag = VED
						}
					}
					ROOT = {
						original_tag = GRY
						has_country_flag = GRY_has_imperial_patronage
					}
				}
				GRI = { country_event = { id = gryphianhost.129 days = 2 } }
				ROOT = { country_event = { id = gryphianhost.130 days = 2 } }
			}
			if = {
				limit = {
					FROM = {
						tag = GRY
					}
					ROOT = {
						original_tag = LCT
					}
				}
				FROM = { country_event = { id = gryphianhost.163 days = 2 } }
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = GRD
							is_in_faction_with = GRD
							is_subject_of = GRD
						}
					}
					FROM = { has_idea = FAT_republican_pact }
				}
				FROM = {
					country_event = griffonRepublic.79
				}
			}
			if = {
				limit = {
					FROM = {
						OR = {
							tag = GRD
							is_in_faction_with = GRD
							is_subject_of = GRD
						}
					}
					ROOT = { tag = FAT has_idea = FAT_republican_pact }
				}
				ROOT = {
					country_event = griffonRepublic.79
				}
			}
			if = {
				limit = { FROM = { is_river_fed_member = yes } }
				custom_effect_tooltip = RivCol_capitulation_TT
			}
			if = {
				limit = {
					FROM = {
						original_tag = BRZ
						OR = {
							has_idea = BRZ_pacifism1
							has_idea = BRZ_pacifism2
							has_idea = BRZ_pacifism3
							has_idea = BRZ_pacifism4
						}
					}
				}
				FROM = {
					hidden_effect = {
						remove_ideas = BRZ_pacifism1
						remove_ideas = BRZ_pacifism2
						remove_ideas = BRZ_pacifism3
						remove_ideas = BRZ_pacifism4
					}
				}
			}

			if = {
				limit = {
					OR = {
						is_ai = no
						NOT = { has_country_flag = recently_fixed_weapons }
					}
				}
				actually_fix_weapon_techs = yes
				set_country_flag = { flag = recently_fixed_weapons days = 1 value = 1 }
			}
			FROM = {
				if = {
					limit = {
						OR = {
							is_ai = no
							NOT = { has_country_flag = recently_fixed_weapons }
						}
					}
					actually_fix_weapon_techs = yes
					set_country_flag = { flag = recently_fixed_weapons days = 1 value = 1 }
				}
			}
			if = {
				limit = {
					ROOT = {
						original_tag = HLQ
						has_country_flag = HLQ_commies_attack_lushi
					}
					FROM = {
						original_tag = LUS
					}
				}
				LUS = {
					country_event = { id = hellquill.251 }
				}
				HLQ = {
					country_event = { id = hellquill.253 days = 3 random_days = 7 }
				}
			}
			if = {
				limit = {
				    OR = {
					    tag = SCS
						tag = LSP
						tag = BUF
						tag = BAL
						tag = NMS
						tag = JUN
						tag = CES
						tag = OLE
						tag = CRY
						tag = CHN
						tag = CCN
						tag = DRG
						tag = EQC
						tag = PLB
						tag = PNG
						tag = GRF
						tag = GFF
						tag = YAK
						tag = JAK
					}
					FROM = {
						tag = NLR 
						has_country_flag = NLR_preparing_to_attack_country
					}
				}
				FROM = {
					clr_country_flag = NLR_preparing_to_attack_country
				}
				clr_country_flag = NLR_preparing_to_attack_country
			}
			if = {
				limit = {
					tag = FRN
					FROM = {
						tag = JES
					}
				}
				FRN = {
					activate_targeted_decision = {
						target = JES
						decision = FRN_JES_war_timer
					}
				}
				JES = {
					country_event = {
						id = tarrin.1
						days = 1
					}
				}
			}
			if = {
				limit = {
					OR = {
						AND = {
							tag = WNG
							FROM = {
								tag = FAL
							}
						}
						AND = {
							tag = FAL
							FROM = {
								tag = WNG
							}
						}
					}
				}
				FRN = {
					country_event = {
						id = francistria.87
						days = 1
					}
				}
			}
		}
	}

	#FROM is state the nuke got dropped on
	on_nuke_drop = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_nuke_drop FROM = [From.GetName]"
			FROM = {
				decrease_population_on_nuke = yes
			}
			if = {
				limit = {
					original_tag = EQS
					FROM = { state = 251 }
					NOT = { has_country_flag = nuked_the_hive }
				}
				save_event_target_as = hive_nuker
				set_country_flag = nuked_the_hive
				news_event = { id = news.50 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 389 }
					NOT = { has_global_flag = griffonstone_nuked }
				}
				set_temp_variable = {
					nuked = FROM.owner
				}
				save_global_event_target_as = griffonstone_nuker
				set_global_flag = griffonstone_nuked
				news_event = { id =  nuke_dropped.101 hours = 3 }
				every_other_country = {
					limit = { is_griffon_continent_griffon_country = yes }
					add_ai_strategy = {
						type = antagonize
						id = PREV
						value = 500
					}
					add_ai_strategy = {
						type = contain
						id = PREV
						value = 500
					}
					add_ai_strategy = {
						type = befriend
						id = PREV
						value = -500
					}
					add_ai_strategy = {
						type = alliance
						id = PREV
						value = -500
					}
					add_ai_strategy = {
						type = ignore
						id = PREV
						value = -200
					}
					var:nuked = {
						PREV = {
							add_ai_strategy = {
								type = protect
								id = PREV
								value = 500
							}
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = 500
							}
							add_ai_strategy = {
								type = send_volunteers_desire
								id = PREV
								value = 500
							}
							add_ai_strategy = {
								type = support
								id = PREV
								value = 500
							}
							add_ai_strategy = {
								type = ignore
								id = PREV
								value = -200
							}
						}
					}
					add_opinion_modifier = {
						target = event_target:griffonstone_nuker
						modifier = nuked_griffonstone
					}
					add_opinion_modifier = { 
						target = event_target:griffonstone_nuker 
						modifier = CHN_embargo 
					}
				}
			}
			if = {
				limit = {
					FROM = { state = 382 }
					NOT = { has_global_flag = greifenheim_nuked }
				}
				set_global_flag = greifenheim_nuked
				news_event = { id =  nuke_dropped.102 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 377 }
					NOT = { has_global_flag = aquila_nuked }
				}
				set_global_flag = aquila_nuked
				news_event = { id =  nuke_dropped.103 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 371 }
					NOT = { has_global_flag = karthin_nuked }
				}
				set_global_flag = karthin_nuked
				news_event = { id =  nuke_dropped.104 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 415 }
					NOT = { has_global_flag = magehold_nuked }
				}
				set_global_flag = magehold_nuked
				news_event = { id =  nuke_dropped.105 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 381 }
					NOT = { has_global_flag = skyfall_nuked }
				}
				set_global_flag = skyfall_nuked
				news_event = { id =  nuke_dropped.106 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 3 }
					NOT = { has_global_flag = canterlot_nuked }
				}
				set_country_flag = nuked_canterlot
				set_global_flag = canterlot_nuked
				news_event = { id =  nuke_dropped.107 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 619 }
					NOT = { has_global_flag = rijekograd_nuked }
				}
				set_global_flag = rijekograd_nuked
				news_event = { id =  nuke_dropped.108 hours = 3 }
			}
			if = {
				limit = {
					FROM = { 
						OR = { ##### There are 3 proinces named Crystal City 
							state = 53 
							state = 345 
							state = 344 
						}
					}
					NOT = { has_global_flag = crystalcity_nuked }
				}
				set_global_flag = crystalcity_nuked
				news_event = { id =  nuke_dropped.109 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 153 }
					153 = {is_capital = yes}
					NOT = { has_global_flag = stalliongrad_nuked }
				}
				set_global_flag = stalliongrad_nuked
				news_event = { id = nuke_dropped.110 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 875 }
					NOT = { has_global_flag = colthage_nuked }
				}
				set_global_flag = colthage_nuked
				news_event = { id = nuke_dropped.111 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 1165 }
					NOT = { has_global_flag = mount_aris_nuked }
				}
				set_global_flag = mount_aris_nuked
				news_event = { id = nuke_dropped.112 hours = 3 }
			}
			if = {
				limit = {
					FROM = { state = 712 }
					NOT = { has_global_flag = new_ayacachtli_nuked }
				}
				set_global_flag = new_ayacachtli_nuked
				news_event = { id = nuke_dropped.113 hours = 3 }
			}
		}
	}

	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_puppet"
			FROM = { remove_opinion_modifier = { target = ROOT modifier = cry_betrayal } }
			LUS_load_commie_focus = yes
			BRF_load_mason_focus = yes
			GRU_load_commie_tree = yes
			FLO_load_ideology_focus = yes
			WIT_load_ideology_focus = yes
			FRN_load_ideology_focus = yes
			CTH_load_ideology_focus = yes
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}
			if = {
				limit = { original_tag = BAK }
				load_focus_tree = generic_griffon_focus
			}
			if = {
				limit = {
					NOT = { original_tag = EQS }
					has_country_flag = is_luna_puppet
				}
				country_event = lunas.910
			}
			else_if = {
				limit = {
					has_country_flag = is_solar_puppet
				}
				country_event = solarempire.1007
			}
			else_if = {
				limit = {
					has_country_flag = EQC_puppet
				}
				country_event = mareland.79
			}
			else_if = {
				limit = {
					has_country_flag = OLE_CHN_puppet
				}
				country_event = olenia.720
			}
			else_if = {
				limit = {
					has_country_flag = is_FAT_puppet
				}
				country_event = griffonRepublic.101
			}
			if = {
				limit = {
					ROOT = {
						original_tag = ELF
					}
					FROM = {
						OR = {
							original_tag = CHN
							original_tag = MAN
						}
					}
				}
				if = {
					limit = {
						MAN = { is_subject_of = CHN }
						country_exists = MAN
					}
					MAN = {
						annex_country = {
							target = ELF
							transfer_troops = no
						}
					}
				}
				else = {
					CHN = {
						annex_country = {
							target = ELF
							transfer_troops = no
						}
					}
					CHN = {
						annex_country = {
							target = MAN
							transfer_troops = yes
						}
					}
				}
			}
			if = {
				limit = {
					ROOT = {
						is_river_fed_member = yes
					}
					FROM = {
						is_river_fed_member = no
					}
				}
				RIV_leave_fed_no_ally = yes
			}
			if = {#If RCT has done Friendship Without Borders, this will apply it to any future vassals they make
				limit = {
					FROM = {
						original_tag = RCT
						has_completed_focus = RCT_friendship_without_borders
					}
					ROOT = {
						NOT = {
							has_idea = RCT_friendship_without_borders_idea
						}
					}
				}
				add_ideas = RCT_friendship_without_borders_idea
			}

			if = {
				limit = {
					FROM = {
						tag = HIP
						has_government = fascism
						has_country_flag = HIP_arisfirst_government
					}
					ROOT = {
						tag = WAR
					}
				}
				ROOT = {
					add_country_leader_role = {
						character = WAR_king_zarizel_ii
						promote_leader = yes
						country_leader = {
							expire = "1965.1.1"
							ideology = oligarchism
						}
					}
					set_cosmetic_tag = WAR_HIP_protectorate
					remove_country_leader_trait = patriot_king
					add_stability = -0.05
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_party_name = {
						ideology = neutrality
						long_name = WAR_neutrality_party_HIP_long
						name = WAR_neutrality_party_HIP
					}
					add_popularity = {
						ideology = neutrality
						popularity = 0.20
					}
					add_popularity = {
						ideology = democratic
						popularity = 0.20
					}
					country_event = {
						id = arisfirst.712
						months = 14
					}
					add_ideas = fascist_influence
				}
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = {
					tag = NIM
				}
				NIM_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = { original_tag = CRY }
				country_event = solarempiresparkles.102
			}

			FAT_add_puppet_ideas = yes

			#JUN_handle_puppet = yes

			CRY_check_for_Sombra_when_released = yes

			handle_twilight_escaping = yes

			if = {
				limit = { original_tag = CHN }
				CHN_demilitarise = yes
				if = {
					limit = {
						FROM = {
							OR = {
								original_tag = EQS
								original_tag = CRY
							}
							has_government = democratic
						}
					}
					FROM = {
						country_event = { id = news.2101 days = 1 }
					}
					CHN = {
						drop_cosmetic_tag = yes
						set_cosmetic_tag = CHN_thorax
					}
					EQS_force_OLE_release_when_puppeting_CHN = yes
				}
				load_focus_tree = generic_focus
				CHN_handle_fascist_communist_overlord = yes
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				CRY_process_when_puppeted_by_EQS = yes
				CHN_remove_pony_opinion_maluses = yes
			}

			if = {
				limit = {
					FROM = {
						OR = {
							original_tag = CRY
							original_tag = EQC
						}
					}
				}
				remove_opinion_modifier = { target = FROM modifier = CHN_embargo }
				FROM = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
				remove_opinion_modifier = { target = FROM modifier = mortal_enemies }
				FROM = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
			}

			if = {
				limit = {
					original_tag = EQC
				}
				if = {
					limit = {
						FROM = {
							OR = {
								original_tag = EQS
								original_tag = NLR
							}
						}
					}
					country_event = equestriancolony.1
				}
				else_if = {
					limit = {
						has_country_flag = equalist_eqc
						NOT = { has_government = communism }
					}
					country_event = equestriancolony.4
				}
				else_if = {
					limit = {
						has_country_flag = is_maresoc
					}
					country_event = equestriancolony.3
				}
				else_if = {
					limit = { NOT = { has_focus_tree = new_mareland_focus } }
					load_focus_tree = new_mareland_focus
					country_event = equestriancolony.2
				}
				if = {
					limit = {
						has_idea = EQC_funding_the_resistiance
					}
					remove_ideas = EQC_funding_the_resistiance
					EQS = { remove_ideas = EQC_resistance }
					ELF = { remove_ideas = EQC_resistance }
				}
			}
			if = {
				limit = {
					original_tag = CRY
					FROM = {
						original_tag = NLR
					}
				}
				set_cosmetic_tag = CRY_NLR
				FROM = {
					set_autonomy = { target = ROOT autonomy_state = autonomy_reichsprotectorate }
				}
				set_country_flag = CRY_lunar_governorship
				set_country_flag = is_luna_puppet
				set_stability = 0.3
				set_war_support = 0.3
				load_focus_tree = crystal_empire_lunar_focus
				set_party_name = { ideology = fascism name = NLR_fascism_party long_name = NLR_fascism_party }
				add_country_leader_role = {
					character = CRY_nightmare_moon
					promote_leader = yes
					country_leader = {
						expire = "1965.1.1"
						ideology = nazism
						traits = { 
							provisional
						}
					}
				}
				hidden_effect = {
					if = {
						limit = {
							has_character = CRY_reese
						}
						CRY_reese = {
							set_nationality = SOL
						}
					}
					if = {
						limit = {
							has_character = CRY_cloudie
						}
						CRY_cloudie = {
							set_nationality = SOL
						}
					}
					if = {
						limit = {
							has_character = CRY_wondermane
						}
						CRY_wondermane = {
							set_nationality = SOL
						}
					}
				}
			}

			set_have_regular_puppets = yes

			GRI_remove_RIV_opinion_modifiers = yes

			if = {
				limit = {
					OR = {
						original_tag = JER
						original_tag = JEB
						original_tag = JFT
						original_tag = JRR
						original_tag = VIN
					}
					FROM = {
						OR = {
							original_tag = JER
							original_tag = JEB
							original_tag = JFT
							original_tag = JRR
							original_tag = VIN
						}
					}
				}
				country_event = {
					id = utility.13 hours = 1
				}
				FROM = {
					country_event = {
						id = utility.13 hours = 1
					}
				}
			}

			else_if = {
				limit = {
					original_tag = FEA
					OR = {
						has_cosmetic_tag = FEA_PvdA_old_flag
						has_cosmetic_tag = FEA_PvdA_old_flag_GRI_Puppet
					}
					FROM = { has_government = communism }
				}
				drop_cosmetic_tag = yes
			}

			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}

			AI_puppet_to_annex = yes

			if = {
				limit = {
					original_tag = BRF
					FROM = { has_government = communism }
				}
				country_event = prywhen.34
			}
			else_if = {
				limit = {
					original_tag = GRW
					FROM = { NOT = { has_government = communism } }
				}
				country_event = prywhen.34
			}
			else_if = {
				limit = {
					tag = NLR
					FROM = { NOT = { has_government = fascism } }
				}
				country_event = lunas.940
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
					original_tag = BUF
				}
				country_event = bufstate.36
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}	
			}   
			if = {
				limit = { 
					FROM = { 
						original_tag = CHN
						has_government = fascism
					}
					ROOT = { original_tag = EQS }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					FROM = { 
						original_tag = HIP
					}
					ROOT = { original_tag = BAT }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					FROM = { 
						original_tag = CVA
					}
					ROOT = { original_tag = CTH }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					FROM = { 
						original_tag = CVA
					}
					ROOT = { original_tag = CDR }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					FROM = { 
						original_tag = CVA
					}
					ROOT = { original_tag = CTC }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					ROOT = { original_tag = BAT }
				}
				ROOT = {
					load_focus_tree = { 
						tree = generic_zebra_focus
						keep_completed = yes		   
					}
				}
			}
			
			if = {
				limit = { 
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = { 
					ROOT = { 
						original_tag = BAL
					}
					FROM = {
						NOT = {
							has_government = communism
						}
					}
				}
				ROOT = {
					load_focus_tree = generic_focus
				}
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = HIN
							original_tag = CTL
							original_tag = SAM
							original_tag = BRS
						}
					}
					FROM = {
						OR = {
							original_tag = HIN
							original_tag = CTL
							original_tag = SAM
							original_tag = BRS
						}
					}
				}
				FROM = {
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
						has_country_flag = HIP_siren_takeover
					}
				}
				FROM = {
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}

			FROM = { ROOT = { apply_cosmetic_tags_on_puppet_PREV_is_overlord = yes } }
		}
	}

	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	on_release_as_puppet = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_release_as_puppet"
			GRU_load_commie_tree = yes
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}
			if = {
				limit = {
					FROM = { original_tag = GRW }
					ROOT = { original_tag = BRF }
				}
				FROM = { annex_country = { target = ROOT } }
			}
			else_if = {
				limit = {
					FROM = { original_tag = BRF }
					ROOT = { original_tag = GRW }
				}
				FROM = { annex_country = { target = ROOT } }
			}
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = HIP
						has_government = fascism
						has_country_flag = HIP_arisfirst_government
					}
					ROOT = {
						tag = WAR
					}
				}
				ROOT = {
					add_country_leader_role = {
						character = WAR_king_zarizel_ii
						promote_leader = yes
						country_leader = {
							expire = "1965.1.1"
							ideology = oligarchism
						}
					}
					set_cosmetic_tag = WAR_HIP_protectorate
					remove_country_leader_trait = patriot_king
					add_stability = -0.05
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_party_name = {
						ideology = neutrality
						long_name = WAR_neutrality_party_HIP_long
						name = WAR_neutrality_party_HIP
					}
					add_popularity = {
						ideology = neutrality
						popularity = 0.20
					}
					add_popularity = {
						ideology = democratic
						popularity = 0.20
					}
					country_event = {
						id = arisfirst.712
						months = 15
					}
					add_ideas = fascist_influence
				}
			}
			if = {
				limit = {
					FROM = { NOT = { tag = HLQ } }
					NOT = { tag = HLQ }
				}
				if = {
					limit = {
						owns_state = 387
					}
					reset_province_name = 8079
				}
				if = {
					limit = {
						owns_state = 619
					}
					reset_province_name = 5013
				}
				if = {
					limit = {
						owns_state = 645
					}
					reset_province_name = 11911
				}
			}
			GRI_give_released_puppet_special_cosmetic_tags = yes
			GRU_give_released_puppet_special_cosmetic_tags = yes
			FAT_add_puppet_ideas = yes
			
			if = {
				limit = { tag = DED }
				FROM = {
					annex_country = { target = ROOT  }
					country_event = { id = deadempire.29 days = 1 }
				}
			}
			if = {
				limit = { FROM = { tag = DED } }
				annex_country = { target = FROM  }
			}
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {#If RCT has done Friendship Without Borders, this will apply it to any future vassals they make
				limit = {
					FROM = {
						original_tag = RCT
						has_completed_focus = RCT_friendship_without_borders
					}
					ROOT = {
						NOT = {
							has_idea = RCT_friendship_without_borders_idea
						}
					}
				}
				add_ideas = RCT_friendship_without_borders_idea
			}
			if = {
				limit = {
					ROOT = {
						is_river_fed_member = yes
					}
					FROM = {
						is_river_fed_member = no
					}
				}
				RIV_leave_fed_no_ally = yes
			}
			
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = WIT
							original_tag = RCT
							original_tag = LCT
							original_tag = FRE
							original_tag = DEP
							original_tag = DMT
							original_tag = BAK
							original_tag = NIM
						}
						is_river_fed_member = no
					}
				}
				RIV_drop_cosmetic_tag = yes
			}

			LUS_load_commie_focus = yes

			BRF_load_mason_focus = yes

			FLO_load_ideology_focus = yes
	
			WIT_load_ideology_focus = yes

			if = {
				limit = { original_tag = BAK }
				load_focus_tree = generic_griffon_focus
			}
      
			FRN_load_ideology_focus = yes
      
			if = {
				limit = { original_tag = BRF }
				BRF = {	country_event = brodfeld.27 }
			}

			if = {
				limit = { original_tag = CHN }
				CHN_handle_fascist_communist_overlord = yes
				CHN_demilitarise = yes
			}

			if = {
				limit = { original_tag = CRY }
				country_event = solarempiresparkles.102
			}

			CRY_check_for_Sombra_when_released = yes

			if = {
				limit = { FROM = { original_tag = NLR } original_tag = EQS }
				FROM = { annex_country = { target = ROOT } }
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					FROM = {
						original_tag = EQS
					}
				}
				if = {
					limit = { original_tag = NLR }
					FROM = { annex_country = { target = ROOT } }
				}
				CRY_process_when_puppeted_by_EQS = yes
				CHN_remove_pony_opinion_maluses = yes
			}

			if = {
				limit = {
					original_tag = EQC
				}
				if = {
					limit = {
						FROM = {
							OR = {
								original_tag = EQS
								original_tag = NLR
							}
						}
					}
					country_event = equestriancolony.1
				}
				else_if = {
					limit = {
						has_country_flag = equalist_eqc
						NOT = { has_government = communism }
					}
					country_event = equestriancolony.4
				}
				else_if = {
					limit = {
						has_country_flag = is_maresoc
					}
					country_event = equestriancolony.3
				}
				else_if = {
					limit = { NOT = { has_focus_tree = new_mareland_focus } }
					load_focus_tree = new_mareland_focus
					country_event = equestriancolony.2
				}
				if = {
					limit = {
						has_idea = EQC_funding_the_resistiance
					}
					remove_ideas = EQC_funding_the_resistiance
					EQS = { remove_ideas = EQC_resistance }
					ELF = { remove_ideas = EQC_resistance }
				}
			}

			if = {
				limit = {
					original_tag = BRF
					FROM = { has_government = communism }
				}
				country_event = prywhen.34
			}

			if = {
				limit = {
					original_tag = GRW
					FROM = { NOT = { has_government = communism } }
				}
				country_event = prywhen.34
			}

			if = {
				limit = {
					tag = NLR
					FROM = { NOT = { has_government = fascism } }
				}
				country_event = lunas.940
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}

			if = {
				limit = {
					tag = NIM
				}
				NIM_load_focus_tree_on_puppet = yes
			}

			set_have_regular_puppets = yes

			#JER_complete_focuses_based_on_overlord = yes

			transfer_society_and_science_ideas_when_released = yes

			if = {
				limit = {
					FROM = {
						has_country_flag = FEA_STW_union
					}
					OR = {
						tag = STW
						tag = FEA
					}
				}
				FROM = {
					set_autonomy = {
						target = ROOT
						autonomy_state = autonomy_personal_union
					}
					clr_country_flag = FEA_STW_union
					drop_cosmetic_tag = yes
					reapply_secondary_cosmetic_tags = yes
				}
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQS
						has_government = democratic
					}
					original_tag = BUF
				}
				country_event = bufstate.36
			}
			if = {
				limit = { 
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					FROM = { 
						is_subject = no
						original_tag = CHN
						has_government = fascism
					}
					ROOT = {
						NOT = { ## insert tags with specially-named ruling parties as necessary ##
							original_tag = MAN
						}
					}
				}
				ROOT = {
					set_party_name = { 
						ideology = fascism 
						long_name = CHN_puppet_changeling_administration 
						name = CHN_puppet_changeling_administration 
					}
					add_popularity = {
						ideology = fascism
						popularity = 0.25
					}
				}
			}
			if = {
				limit = {
					FROM = { 
						original_tag = FRN
					}
					ROOT = { original_tag = JES }
				}
				FROM = { 
					country_event = {
						id = francistria.78
						days = 1
					}
				}
			}

			FROM = { ROOT = { apply_cosmetic_tags_on_puppet_PREV_is_overlord = yes } }

			actually_fix_weapon_techs = yes
			FROM = { actually_fix_weapon_techs = yes }
		}
	}

	#ROOT is subject FROM is overlord
	on_subject_annexed = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_subject_annexed FROM = [From.GetName]"
			if = {
				limit = {
					NOT = {
						has_country_flag = bypass_annex_compliance
						FROM = { has_country_flag = bypass_annex_compliance }
						is_in_array = {
							annex_compliance = FROM
						}
					}
				}
				add_to_array = {
					annex_compliance = FROM
				}
				add_to_array = {
					annex_compliance_subject = FROM
				}
				country_event = { id = utility.11 }
			}
			if = {
				limit = {
					OR = {
						tag = STW
						tag = FEA
					}
					OR = {
						has_country_flag = FEA_STW_marriage
						FROM = { has_country_flag = FEA_STW_marriage }
					}
					FROM = {
						OR = {
							tag = STW
							tag = FEA
						}
						OR = {
							has_country_leader = { ruling_only = yes character = STW_gabriela_eagleclaw }
							has_idea = FEA_beloved_monarch
							has_idea = FEA_beloved_monarch_2
							has_idea = FEA_beloved_monarch_3
						}
					}
					OR = {
						has_country_leader = { ruling_only = yes character = STW_gabriela_eagleclaw }
						has_idea = FEA_beloved_monarch
						has_idea = FEA_beloved_monarch_2
						has_idea = FEA_beloved_monarch_3
					}
				}
				FROM = {
					set_country_flag = FEA_STW_union
					set_cosmetic_tag = FEA_STW_union
				}
			}
		}
	}

	#ROOT is winner #FROM gets annexed - For civil wars on_civil_war_end is also fired
	on_annex = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_annex"
			FROM = { remove_from_global_arrays_on_annex = yes }
			
			if = {
				limit = {
					NOT = { has_global_flag = river_federation_founded }
					FROM = {
						AND = {
							is_river_fed_member = yes
							var:faction_leader = {
								is_river_fed_member = yes
							}
						}
					}
				}
				RIV_find_new_leader = yes
			}

			if = {
				limit = {
					NOT = {
						FROM = { tag = SOL }
						has_country_flag = bypass_annex_compliance
						FROM = { has_country_flag = bypass_annex_compliance }
						is_in_array = {
							annex_compliance = FROM
						}
					}
				}
				add_to_array = {
					annex_compliance = FROM
				}
				if = {
					limit = {
						FROM = { is_subject_of = ROOT }
					}
					add_to_array = {
						annex_compliance_subject = FROM
					}
				}
				country_event = { id = utility.11 }
			}
			if = {
				limit = {
					FROM = { tag = GRD }
				}
				FROM = {
					if = {
						limit = {
							has_puppet_cosmetic_flag = no
						}
						drop_cosmetic_tag = yes
						reapply_secondary_cosmetic_tags = yes
					}
					clr_country_flag = holds_griffon_capital
				}
				GRI = {
					save_global_event_target_as = griffonian_empire
					set_variable = { global.griffonian_empire_var = THIS }
				}
			}

			if = {
				limit = {
					OR = {
						tag = FAW
						original_tag = FAT
					}
					FROM = { tag = FAT }
				}
				hidden_effect = {
					FAT = { FAT_kill_kemerskai = yes }
				}
			}
			else_if = {
				limit = {
					FROM = { tag = FAW exists = no }
				}
				for_each_scope_loop = {
					array = FAW.core_states
					add_core_of = FAT
					remove_core_of = FAW
				}
			}

			if = {
				limit = {
					FROM = {
						OR = {
							tag = LNS
							tag = LSM
							tag = LSC
						}
					}
					OR = {
						tag = LNS
						tag = LSM
						tag = LSC
					}
				}
				save_global_event_target_as = longsword
			}

			FROM = {
				every_owned_state = {
					limit = {
						has_state_flag = eqs_bat_state
					}
					add_core_of = EQS
					clr_state_flag = eqs_bat_state
				}
			}
			every_owned_state = {
				limit = {
					has_state_flag = eqs_bat_state
				}
				add_core_of = EQS
				clr_state_flag = eqs_bat_state
			}

			if = {
				limit = {
					tag = CHN
					FROM = { original_tag = OLE }
				}
				FROM = { set_country_flag = OLE_was_annexed }
			}

			handle_twilight_escaping = yes

			if = {
				limit = {
					FROM = {
						tag = JER
						has_idea = JER_revolutionary
					}
					FAT = {
						exists = yes
						is_subject = no
					}
				}
				FAT = { country_event = { id = griffonRepublic.83 days = 15 } }
			}
			if = {
				limit = {
					FROM = {
					 tag = FAT 
					}
					FAW = {
						exists = no
					}
					485 = { 
						owner = {
							NOT = { has_country_flag = have_regular_puppets }
						}
					}
					HAU = {
						exists = yes
						is_subject = no
						NOT = {
							owns_state = 6
							owns_state = 7
							owns_state = 8
							owns_state = 9
							owns_state = 10
						}
					}
				}
				HAU = { country_event = { id = haukland.27 days = 8 } }
			}
			if = {
				limit = {
					OR = {
						tag = JEB
						tag = VIN
						tag = JFT
						tag = JRR
					}
					NOT = {
						has_government = democratic
						has_government = communism
						AND = {
							tag = JRR
							has_country_flag = JER_JRR_revolutionary
						}
					}
					FROM = {
						tag = JER
						has_completed_focus = JER_fight_for_freedom
					}
				}
				country_event = aquileia_news.4
			}

			if = {
				limit = {
					OR = {
						AND = {
							tag = JER
							has_completed_focus = JER_fight_for_freedom
							FROM = {
								OR = {
									tag = JEB
									tag = VIN
									tag = JFT
									tag = JRR
								}
							}
							OR = {
								has_government = democratic
								has_government = communism
							}
							JEB = { OR = { exists = no is_subject_of = ROOT } }
							JRR = { OR = { exists = no is_subject_of = ROOT } }
							VIN = { OR = { exists = no is_subject_of = ROOT } }
							JFT = { OR = { exists = no is_subject_of = ROOT } }
						}
						AND = {
							OR = {
								tag = JEB
								tag = VIN
								tag = JFT
								tag = JRR
							}
							FROM = {
								tag = JER
								NOT = { has_completed_focus = JER_fight_for_freedom }
							}
							OR = {
								has_government = democratic
								has_government = communism
								AND = {
									tag = JRR
									has_country_flag = JER_JRR_revolutionary
								}
							}
						}
					}
				}
				FEZ = {
					country_event = {
						id = fezera.126
						days = 5
					}
					country_event = {
						id = fezera.127
						days = 30
					}
				}
				country_event = fezera.131
			}
			if = {
				limit = {
					tag = BRF
					FROM = { tag = GRW }
				}
				country_event = { id = brodfeld.21 days = 1 }
			}
			else_if = {
				limit = {
					tag = GRW
					FROM = { tag = BRF }
				}
				country_event = { id = prywhen.1 days = 1 }
			}
			if = {
				limit = {
					OR = {
						original_tag = JER
						original_tag = JEB
						original_tag = JFT
						original_tag = JRR
						original_tag = VIN
					}
					FROM = {
						OR = {
							original_tag = JER
							original_tag = JEB
							original_tag = JFT
							original_tag = JRR
							original_tag = VIN
						}
					}
				}
				country_event = {
					id = utility.13 hours = 1
				}
				FROM = {
					country_event = {
						id = utility.13 hours = 1
					}
				}
			}
			if = {
				limit = {
					FROM = { has_idea = EQC_funding_the_resistiance }
				}
				FROM = { remove_ideas = EQC_funding_the_resistiance }
				EQS = { remove_ideas = EQC_resistance }
				ELF = { remove_ideas = EQC_resistance }
			}
			if = {
				limit = {
					FROM = { original_tag = EQC }
				}
				356 = {
					reset_state_name = yes
				}
			}

			if = {
				limit = {
					FROM = { tag = NCH }
				}
				set_variable = {
					NCH_trade_partners_iter = 0
				}
				NCH_get_trading_idea = yes
			}
			if = {
				limit = {
					FROM = {
						original_tag = BAR
					}
				}
				FROM = {
					BAR_clear_mess_puppet = yes
				}	
			}
			ZES_oppressive_countries_calculate = yes
			if = {
				limit = {
					FROM = {
						tag = GRI
						GRI_synovial = { is_unit_leader = yes }
					}
				}
				remove_ideas = CHN_GRI_Attache_For_GRI
				hidden_effect =  {
					CHN = { remove_ideas = CHN_GRI_Attache_For_CHN }
				}
				FROM = {
					GRI_thranx = { set_nationality = CHN }
					GRI_synovial = {
						set_nationality = CHN
						set_portraits = {
							army = { large ="GFX_Synovial_CHN_cap" }
						}
					}
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = LUS
					}
					ROOT = {
						original_tag = HLQ
						has_country_flag = HLQ_commies_attack_lushi
					}	
				}
				country_event = { id = hellquill.252 days = 2 }
			}
			if = {
				limit = {
					NOT = {
						original_tag = FRN
					}
					FROM = {
						OR = {
							original_tag = JES
							original_tag = FRN
						}
					}
				}
				FRN_reduce_tarrin_resistance = yes
			}
			if = {
				limit = {
					tag = WNG
					FROM = {
						tag = JES
					}
					FRN = {
						exists = yes
						OR = {
							is_in_faction_with = ROOT
							is_subject_of = ROOT
						}
					}
				}
				every_owned_state = {
					limit = {
						is_core_of = JES
					}
					transfer_state_to = FRN
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = WNG
						has_idea = WNG_garibald_talonuel_iii
					}
				}
				if = {
					limit = {
						FRN = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = FRN
						}
					}
					FRN = {
						country_event = wingbardy.35
					}
				}
				else_if = {
					limit = {
						TAL = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = TAL
						}
					}
					TAL = {
						country_event = wingbardy.35
					}
				}
				else_if = {
					limit = {
						ARA = {
							exists = yes
							NOT = {
								has_government = communism
							}
						}
						NOT = {
							tag = ARA
						}
					}
					ARA = {
						country_event = wingbardy.35
					}
				}
			}

			actually_fix_weapon_techs = yes
		}
	}

	#ROOT is winner #FROM gets annexed - This fires just before FROM gets annexed, meaning the country and everything it owns still exists. It will also fire on_annex and on_civil_war_end
	on_civil_war_end_before_annexation = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_civil_war_end_before_annexation FROM = [From.GetName]"
			FROM = {
				transfer_navy = { target = ROOT }
			}
			if = {
				limit = {
					OR = {
						original_tag = WNG
						original_tag = OLE
					}
				}
				if = {
					limit = { original_tag = OLE }
					FROM = {
						every_character = {
							limit = {
								is_unit_leader = yes
								is_country_leader = no
							}
							set_nationality = SOL
						}
					}
				}
			}
		}
	}

	#ROOT is winner FROM gets annexed
	on_civil_war_end = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_civil_war_end"
			if = {
				limit = {
					original_tag = FBK
				}
				if = {
					limit = { NCH = { has_country_flag = NCH_Farbrook_Civil_War_Flag } }
					if = {
						limit = { NOT = { has_government = fascism } }
						NCH = { country_event = { id = greneclyf.43 days = 2 } }
						else = {
							NCH = { country_event = { id = greneclyf.37 days = 1 } }
						}
					}
				}
				else_if = {
					limit = { NCH = { has_country_flag = NCH_Farbrook_Commie_Civil_War_Flag } }
					if = {
						limit = { NOT = { has_government = communism } }
						NCH = { country_event = { id = greneclyf.55 days = 2 } }
						else = {
							NCH = { country_event = { id = greneclyf.49 days = 1 } }
						}
					}
				}
			}
			if = {
				limit = {
					is_EQS_SOL = yes
					FROM = {
						original_tag = EQS
					}
					has_global_flag = equestrian_civil_war_daybreaker
					NOT = { has_global_flag = equestrian_civil_war_daybreaker_ended }
				}
				country_event = { id =  news.sol.31 days = 1 }
			}
			else_if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					has_global_flag = equestrian_civil_war_daybreaker
					NOT = { has_global_flag = equestrian_civil_war_daybreaker_ended }
				}
				country_event = { id = news.sol.21 days = 1 }
			}
			if = {
				limit = {
					original_tag = EQS
					FROM = { original_tag = EQS has_government = communism }
					NOT = {
						has_country_flag = EQS_april_fools
					}
				}
				country_event = { id = equestriadem.8 days = 60 }
				country_event = { id = equestria.44 days = 1 }
			}
			if = {
				limit = {
					tag = event_target:equestria
					FROM = { tag = event_target:solar_empire }
				}
				set_capital = { state = 3 }
				SOL = { save_global_event_target_as = solar_empire }
			}
			else_if = {
				limit = {
					FROM = { tag = event_target:equestria }
					tag = event_target:solar_empire
				}
				SOL = {
					set_politics = { ruling_party = democratic }
					save_global_event_target_as = equestria
				}
				set_country_flag = { flag = SOL_next_civ_war_delay value = 1 days = 180 }
			}
			else_if = {
				limit = {
					original_tag = CRY
					FROM = { original_tag = CRY }
				}
				if = {
					limit = {
						has_government = fascism
						CRY_sombra = { is_country_leader = yes }
					}
					country_event = { id = crysom.16 hours = 12 }
					if = {
						limit = { event_target:equestria = { exists = yes } }
						random_list = {
							30 = {
								event_target:equestria = {
									country_event = { id = crysom.49 hours = 2 }
								}
								country_event = { id = crysom.50 hours = 1 }
							}
							70 = { country_event = { id = crysom.41 hours = 1 } }
						}
						else = { country_event = { id = crysom.41 hours = 1 } }
					}
				}
				if = {
					limit = {
						has_government = communism
						FROM = { has_government = democratic }
					}
					news_event = { id = news.cry.1 days = 1 }
				}
				set_capital = { state = 344 }
			}
			else_if = {
				limit = {
					original_tag = OLE
				}
				set_capital = { state = 76 }
				drop_cosmetic_tag = yes
			}
			else_if = {
				limit = {
					original_tag = RCT
				}
				set_capital = { state = 619 }
			}
			#End of ideology Civil War
			else_if = {
				limit = {
					original_tag = WNG
				}
				set_capital = { state = 371 }
				# Give back WNG focus tree to Beakolini if he wins the civil war.
				if = {
					limit = {
						has_government = fascism
						FROM = {
							NOT = { has_government = fascism }
						}
					}
					news_event = { id = news_wingbardy.9 days = 1 }
					if = {
						limit = { is_in_faction = no is_subject = no }
						create_faction = Southern_Kingdoms
					}
					setup_WNG_parliament = yes
					setup_WNG_only_fascism_government = yes
				}
				#End WNG Civil War Event
				if = {
					limit = {
						FROM = {
							has_government = fascism
						}
						NOT = { has_government = fascism }
					}
					country_event = { id = wingbardy.51 days = 1 }
					news_event = { id = news_wingbardy.8 days = 1 }
				}
			}
			#End of EQC MARESOC Civil War
			else_if = {
				limit = {
					FROM = {
						original_tag = EQC
						has_country_flag = is_maresoc
					}
					original_tag = EQC
				}
				country_event = { id = mareland.26 days = 1 }
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = EQC
					}
					original_tag = EQC
					has_country_flag = is_maresoc
				}
				country_event = { id = mareland.27 days = 1 }
			}
			else_if = {
				limit = {
					original_tag = LUS
					FROM = { original_tag = LUS has_government = neutrality }
				}
				country_event = { id = lushi_peasants.1 days = 50 random = 480 }#days to hours applied
			}
			else_if = {
				limit = {
					original_tag = FIR
					FROM = { original_tag = FIR }
				}
				country_event = { id = FIR.29 days = 1 }
			}
			else_if = {
				limit = {
					tag = CTA
					FROM = {
						tag = CTC
					}
				}
				country_event = colthage_civil_war.8
			}
			else_if = {
				limit = {
					tag = CTC
					FROM = {
						tag = CTA
					}
				}
				country_event = colthage_civil_war.9
				if = {
					limit = {
						CVA = {
							exists = yes
						}
					}
					CVA = {
						country_event = colthage_civil_war.16
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						tag = CTC
						tag = CTB
					}
					FROM = {
						original_tag = CTH
						has_country_flag = CTH_colthage_militarists
					}
				}
				CTC = {
					country_event = {
						id = colthage_civil_war.12
						days = 7
					}
				}
				CTB = {
					country_event = {
						id = colthage_civil_war.12
						days = 7
					}
				}
			}
			else_if = {
				limit = {
					tag = CTC
					FROM = {
						tag = CTB
					}
				}
				country_event = colthage_civil_war.13
			}
			else_if = {
				limit = {
					tag = CTB
					FROM = {
						tag = CTC
					}
				}
				country_event = colthage_civil_war.14
			}
			else_if = {
				limit = {
					original_tag = CTH
					has_country_flag = CTH_colthage_militarists
					OR = {
						AND = {
							FROM = {
								tag = CTC
							}
							CTB = {
								exists = no
							}
						}
						AND = {
							FROM = {
								tag = CTB
							}
							CTC = {
								exists = no
							}
						}
					}
				}
				country_event = colthage_civil_war.15
			}
			else_if = {
				limit = {
					original_tag = VED
				}
				country_event = vedina.76
			}
		}
	}
	# ROOT is capitulated country, FROM is winner
	on_capitulation = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_capitulation"
			if = {
				limit = {
					is_in_faction = yes
					all_allied_country = {
						NOT = {
							has_war_with = FROM
						}
					}
				}
				leave_faction = yes
			}
			if = {
				limit = {
					tag = CHN
				}
				GRI = { country_event = changelingattache.14 }
				if = {
					limit = {
						FROM = {
							is_ai = no
							original_tag = OLE
							is_in_faction = no
							is_subject = no
							NOT = {
								is_guaranteed_by = EQS
							}
						}
					}
					FROM = {
						set_country_flag = OLE_defeated_changelings_alone
					}
				}
			}
			else_if = {
				limit = {
					tag = CCN
					FROM = { tag = CHN }
				}
				CHN = { country_event = { id = changelings.63 days = 1 } }
			}
			else_if = {
				limit = {
					FROM = {
						OR = {
							tag = DED
							tag = EWI
						}
					}
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					tag = NLR
					FROM = { tag = EQS }
				}
				transfer_navy = { target = FROM }
				if = {
					limit = {
						EQS = {
							has_government = democratic
						}
					}
					EQS = { country_event = { id = equestria.186 days = 6 } }
				}
			}
			else_if = {
				limit = {
					tag = EQS
					FROM = { tag = NLR }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					original_tag = FAT
					FROM = { original_tag = FAW }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					original_tag = FAW
					FROM = { original_tag = FAT }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					is_in_faction_with = EQC
					EQC = {
						exists = yes
						has_capitulated = no
						NOT = {
							any_owned_state = {
								is_controlled_by = FROM
							}
						}
						#all_owned_state = {
						#	is_fully_controlled_by = EQC
						#}
					}
					#EQC = { has_completed_focus = EQC_strengthen_equestrian_ties }
				}
				EQC = {
					if = {
						limit = { FROM = { tag = CHN } }
						ROOT = {
							transfer_navy = { target = EQC }
							every_character = {
								limit = {
									is_navy_leader = yes
								}
								set_unit_leader_flag = used_to_be_EQS
								set_nationality = EQC
							}
						}
					}
					
					if = {
						limit = { is_subject = yes }
						end_puppet_this = yes
					}
					if = {
						limit = { is_in_faction = yes }
						leave_faction = yes
					}
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
					}
					if = {
						limit = { FROM = { tag = CHN } }
						set_country_flag = EQC_govt_in_exile
					}
					else_if = {
						limit = { FROM = { is_ai = no } }
						FROM = {
							create_wargoal = { target = ROOT type = puppet_wargoal_focus }
						}
					}
				}
			}
			else_if = {
				limit = {
					original_tag = EQS
					has_government = democratic
					HIP = {
						exists = yes
						has_capitulated = no
						NOT = {
							any_owned_state = {
								OR = {
									is_controlled_by = FROM
									CONTROLLER = {
										is_ally_with = FROM
									}
								}
							}
						}
						has_war_with = FROM
					}
				}
				HIP = {
					if = {
						limit = { is_in_faction_with = EQS }
						leave_faction = yes
					}
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
						remove_wargoal = {
							type = all
							target = FROM
						}
					}
					if = {
						limit = {
							has_country_flag = HIP_alliance_member
						}
						create_faction = HIP_middle_sea_treaty
						every_other_country = {
							limit = {
								OR = {
									has_country_flag = HIP_alliance_member
									is_subject_of = HIP
								}
							}
							HIP = {add_to_faction = PREV}
						}
						every_other_country = {
							limit = {
								OR = {
									has_country_flag = HIP_alliance_member
									is_subject_of = HIP
									AND = {
										is_in_faction_with = HIP
										NOT = {
											is_in_faction_with = EQS
										}
									}
								}
							}
							if = {
								limit = { has_war_with = FROM }
								set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
								white_peace = FROM
							}
						}
					}
					HIP = {country_event = hippogriff.83}
				}
			}
			else_if = {
				limit = {
					tag = BAL
				}
				if = {
					limit = {
						SIC = {
							exists = yes
						}
					}
					SIC = {
						country_event = {
							id = baltimare.28
							days = 7
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = NMS
					FROM = {
						OR = {
							original_tag = CES
							original_tag = EQS
						}
					}
					has_war_with = CES
					has_war_with = EQS
				}
				CES = {
					annex_country = { target = ROOT }
				}
			}
			else_if = {
				limit = {
					tag = CHN
					FROM = { tag = CCN }
				}
				transfer_navy = { target = FROM }
			}
			else_if = {
				limit = {
					tag = CHN
					FROM = { tag = EQS }
				}
				if = {
					limit = {
						EQS = {
							has_government = democratic
						}
					}
					EQS = {
						country_event = {
							id = equestria.180
							days = 10
						}
					}
				}
			}
			else_if = {
				limit = {
					tag = TRD
					FROM = { tag = GRD }
				}
				transfer_navy = { target = FROM }
			}
			if = {
				limit = {
					OR = {
						tag = BAN
						tag = ZES
					}
				}
				if = {
					limit = {
						SIC = { has_country_flag = don_is_in_blackrock }
						tag = BAN
					}
					SIC = { country_event = sicameon.96 }
				}
				if = {
					limit = {
						SIC = { has_country_flag = don_is_in_stripes }
						tag = ZES
					}
					SIC = { country_event = sicameon.97 }
				}
			}
			if = {
				limit = {
					FROM = {
						tag = DED
						NOT = { has_country_flag = DED_capitulated@ROOT }
					}
				}
				FROM = { set_country_flag = DED_capitulated@ROOT }
				if = {
					limit = { is_major = yes }
					FROM = { modify_country_flag = { flag = DED_killed_nations value = 5 } }
					else = {
						FROM = { modify_country_flag = { flag = DED_killed_nations value = 1 } }
					}
				}
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = MAN }
						FROM = { tag = CHN }
					}
					ROOT = { tag = ELF }
				}
				if = {
					limit = {
						MAN = { exists = yes }
					}
					MAN = { annex_country = { target = ROOT } }
				}
				if = {
					limit = {
						MAN = { exists = no }
					}
					CHN = { annex_country = { target = ROOT } }
				}
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = MAN }
						FROM = { tag = CHN }
					}
					MAN = {
						has_war_together_with = CHN
					}
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_stg_expansionist_war
						}
						ROOT = { tag = STG }
					}
					MAN = { annex_country = { target = STG } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_eqc_expansionist_war
						}
						ROOT = { tag = EQC }
					}
					MAN = { annex_country = { target = EQC } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_hau_expansionist_war
						}
						ROOT = { tag = HAU }
					}
					MAN = { annex_country = { target = HAU } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_drg_expansionist_war
						}
						ROOT = { tag = DRG }
					}
					MAN = { annex_country = { target = DRG } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_fez_expansionist_war
						}
						ROOT = { tag = FEZ }
					}
					MAN = { annex_country = { target = FEZ } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_png_expansionist_war
						}
						ROOT = { tag = PNG }
					}
					MAN = { annex_country = { target = PNG } }
				}
				if = {
					limit = {
						MAN = {
							has_country_flag = MAN_this_is_the_ved_expansionist_war
						}
						ROOT = { tag = VED }
					}
					MAN = { annex_country = { target = VED } }
				}
			}
			if = {
				limit = {
					ROOT = { tag = ZRS }
					FROM = { tag = CHN }
				}
				FROM = {
					annex_country = { target = ZRS }
					country_event = { id = changelings_paxchrysalia.8401 hours = 36 }
				}
				1 = { set_resistance = 100 }
				5 = { set_resistance = 100 }
			}
			if = {
				limit = {
					has_idea = EQC_funding_the_resistiance
				}
				remove_ideas = EQC_funding_the_resistiance
				EQS = { remove_ideas = EQC_resistance }
				ELF = { remove_ideas = EQC_resistance }
			}
			if = {
				limit = {
					OR = {
						FROM = { tag = EQS }
						FROM = { tag = ELF }
					}
					ROOT = { tag = CHN }
				}
				FROM = { set_country_flag = EQS_or_ELF_has_capitulated_CHN }
			}
			handle_twilight_escaping = yes
			if = {
				limit = {
					country_exists = BAT
				}
				if = {
					limit = {
						FROM = {
							original_tag = EQS
							has_war_with = BAT
						}
						ROOT = { 
							original_tag = NLR
						}
					}
					BAT = {
						for_each_scope_loop = {
							array = global.europe_states
							# we teleport all armies in Equestrian continent...
							teleport_armies = {
								limit = {
									# that belong to BAT...
									tag = BAT
								}
								# to owner's (so BAT's) owned_controlled_states
								to_state_array = owned_controlled_states
							}
						}
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						if = {
							limit = {
								has_war_with = CRY
							}
							white_peace = CRY
						}
						if = {
							limit = {
								has_war_with = EQS
							}
							white_peace = EQS
						}
						if = {
							limit = {
								has_war_with = EQC
							}
							white_peace = EQC
						}
						if = {
							limit = {
								has_war_with = BUF
							}
							white_peace = BUF
						}
					}
					BAT = { 
						country_event = bat.17
					}
				}
			}
			if = {
				limit = {
					tag = BAT
					NLR = {
						any_enemy_country = {
							is_zebrican_continent_country = yes
						}
					}
				}
				leave_faction = yes
				#this is cancer
				every_other_country = {
					limit = {
						has_war_with = NLR
						is_zebrican_continent_country = yes
					}
					set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
					white_peace = NLR
					every_other_country = {
						limit = {
							OR = {
								is_in_faction_with = NLR
								is_subject_of = NLR
							}
						}
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = PREV
					}
				}
			}
			if = {
				limit = {
					tag = JES
					FROM = {
						tag = FRN
					}
				}
				FROM = {
					country_event = francistria.82
				}
			}
			#if = {
			#	limit = {
			#		tag = FEA
			#	}
			#	YAN = {
			#		if = {
			#			limit = {
			#				is_subject_of = ROOT
			#			}
			#			end_puppet_this = yes
			#		}
			#		if = {
			#			limit = { is_in_faction_with = ROOT }
			#			leave_faction = yes
			#		}
			#		every_other_country = {
			#			limit = {
			#				NOT = {
			#					is_zebrican_continent_country = yes
			#				}
			#				has_war_with = YAN
			#			}
			#			set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
			#			white_peace = YAN
			#		}
			#	}
			#}
			if = {
				limit = {
					original_tag = ABY
					FROM = { original_tag = WNG }
				}
				FROM = {
					annex_country = { target = ROOT }
				}
			}
			if = {
				limit = {
					tag = WAR
					FROM = {
						tag = TBK
						has_completed_focus = TBK_claim_warzena
					}
				}
				TBK = {
					if = {
						limit = { has_war_with = FROM }
						set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
						white_peace = FROM
					}
					country_event = { id = tobuck_baragzen.12 }
				}
			}
		}
	}
	#ROOT is free nation FROM is releaser
	on_release_as_free = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_release_as_free"
			if = {
				limit = {
					FROM = { original_tag = GRW }
					ROOT = { original_tag = BRF }
				}
				FROM = { annex_country = { target = ROOT } }
			}
			else_if = {
				limit = {
					FROM = { original_tag = BRF }
					ROOT = { original_tag = GRW }
				}
				FROM = { annex_country = { target = ROOT } }
			}
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
					if = {
						limit = { is_advisor = yes }

						remove_advisor_role = { slot = army_chief }
					}
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			GRU_load_commie_tree = yes
			if = {
				limit = {
					FROM = { NOT = { tag = HLQ } }
					NOT = { tag = HLQ }
				}
				if = {
					limit = {
						owns_state = 387
					}
					reset_province_name = 8079
				}
				if = {
					limit = {
						owns_state = 619
					}
					reset_province_name = 5013
				}
				if = {
					limit = {
						owns_state = 645
					}
					reset_province_name = 11911
				}
			}
			if = {
				limit = { tag = DED }
				FROM = {
					annex_country = { target = ROOT  }
					if = {
						limit = {
							NOT = {
								tag = HIE
							}
						}
						country_event = { id = deadempire.29 days = 1 }
					}
				}
			}
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					original_tag = CRY
				}
				country_event = crysom.48
				country_event = solarempiresparkles.102
			}
			FLO_load_ideology_focus = yes
			WIT_load_ideology_focus = yes
			FRN_load_ideology_focus = yes
			if = {
				limit = {
					original_tag = BRF
					has_government = communism
				}
				country_event = prywhen.34
			}

			if = {
				limit = { original_tag = BRF }
				BRF = {	country_event = brodfeld.27 }
			}

			if = {
				limit = {
					original_tag = GRW
					NOT = { has_government = communism }
				}
				country_event = prywhen.34
			}

			if = {
				limit = {
					original_tag = EQS
				}
				if = {
					limit = {
						tag = event_target:solar_empire
						OR = {
							is_subject = yes
							NOT = { has_government = fascism }
						}
					}
					kill_ideology_leader = fascism
					if = {
						limit = { event_target:equestria = { exists = no } }
						save_global_event_target_as = equestria
					}
					SOL = { save_global_event_target_as = solar_empire }
				}
				country_event = { id = solarempire.1018 }
			}

			if = {
				limit = {
					tag = NLR
					NOT = { has_government = fascism }
				}
				country_event = lunas.940
			}

			if = {
				limit = {
					FROM = {
						has_country_flag = FEA_STW_union
					}
					OR = {
						tag = STW
						tag = FEA
					}
				}
				FROM = {
					clr_country_flag = FEA_STW_union
					drop_cosmetic_tag = yes
					reapply_secondary_cosmetic_tags = yes
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_society
						NOT = { has_idea_with_trait = society_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = modern_society
							}
						}
					}
					FROM = { ROOT = { transfer_society_ideas = yes } }
					else = { add_ideas = modern_society }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_science
						NOT = { has_idea_with_trait = science_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = proper_science_base
							}
						}
					}
					FROM = { ROOT = { transfer_science_ideas = yes } }
					else = { add_ideas = proper_science_base }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_literacy
						NOT = { has_idea_with_trait = illiteracy_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = no_lack_of_scientists
							}
						}
					}
					FROM = { ROOT = { transfer_illiteracy_ideas = yes } }
					else = { add_ideas = no_lack_of_scientists }
				}
			}

			if = {
				limit = {
					OR = {
						has_idea = dummy_idea_poverty
						NOT = { has_idea_with_trait = poverty_idea }
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								has_idea = no_poverty
							}
						}
					}
					FROM = { ROOT = { transfer_poverty_ideas = yes } }
					else = { add_ideas = no_poverty }
				}
			}

			if = {
				limit = {
					ROOT = {
						original_tag = GRY
						#has_focus_tree = GRY_focus_neutral_rebellion
						NOT = {
							has_government = neutrality
						}
					}
				}
				GRY_load_focus_tree_on_puppet = yes
			}
			if = {
				limit = { 
					FROM = { original_tag = ELF }
					ROOT = { original_tag = EQS }
				}
				FROM = {
					annex_country = { target = ROOT  }
				}
			}
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}	
			}
			if = {
				limit = {
					FROM = { 
						original_tag = FRN 
						NOT = {
							has_government = fascism
						}
					}
					ROOT = { original_tag = JES }
				}
				FROM = { country_event = francistria.77 }
			}
			else_if = {
				limit = {
					FROM = {
						original_tag = FRN 
						has_government = fascism
					}
					ROOT = { original_tag = JES }
				}
				FROM = { annex_country = { target = ROOT } }
			}

			BRF_load_mason_focus = yes
		
			actually_fix_weapon_techs = yes
			FROM = { actually_fix_weapon_techs = yes }
		}
	}

	on_subject_free = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_subject_free"
			GRU_load_commie_tree = yes
			if = {
				limit = {
					has_cosmetic_tag = GRI_SUBJECT
				}
				country_event = griffonian.2
			}
			else_if = {
				limit = {
					has_country_flag = is_changeling_puppet
					NOT = { tag = EQS }
				}
				country_event = changelings.910
			}
			else_if = {
				limit = {
					has_country_flag = is_changeling_puppet
					original_tag = EQS
					num_of_controlled_states > 15
					controls_fillydelphia = yes
					controls_manehattan = yes
					controls_los_pegasus = yes
					controls_baltimare = yes
					controls_canterlot = yes
				}
				country_event = changelings.911
			}
			else_if = {
				limit = {
					original_tag = EQC
					OR = {
						has_cosmetic_tag = EQC_EQS
						has_cosmetic_tag = EQC_SOL
						has_cosmetic_tag = EQC_NLR
						has_cosmetic_tag = EQC_NLR_thestralia
					}
				}
				country_event = equestriancolony.2
			}
			else_if = {
				limit = {
					NOT = { original_tag = EQS }
					has_country_flag = is_luna_puppet
				}
				country_event = lunas.910
			}
			else_if = {
				limit = {
					has_country_flag = EQC_puppet
				}
				country_event = mareland.79
			}
			else_if = {
				limit = {
					OR = {
						has_country_flag = is_solar_puppet
						has_country_flag = is_sol_puppet
					}
				}
				country_event = solarempire.1007
			}
			else_if = {
				limit = {
					original_tag = OLE
					has_country_flag = OLE_CHN_puppet
				}
				country_event = olenia.720
			}
			else_if = {
				limit = {
					has_country_flag = is_FAT_puppet
				}
				country_event = griffonRepublic.101
			}
			else_if = {
				limit = {
					OR = {
						has_cosmetic_tag = BAT_puppet
						has_cosmetic_tag = CTH_BAT
						has_cosmetic_tag = HIP_BAT
						has_cosmetic_tag = CGI_BAT
					}
				}
				country_event = bat.77
			}
		}
	}

	on_government_change = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_government_change"
			if = {
				limit = { original_tag = CRY }
				CRY_restore_establishment = yes
				country_event = { id = crysom.48 hours = 1 }
				if = {
					limit = {
						CRY_radiant_hope = { is_country_leader = yes }
						has_global_flag = sombra_returned
					}
					kill_country_leader = yes
				}
			}

			if = {
				limit = {
					original_tag = EQC
					has_country_flag = has_supported_equalists
					has_government = communism
				}
				country_event = { id = mareland.30 hours = 1 }
			}

			FIR_FBK_on_govt_change = yes

			if = {
				limit = {
					original_tag = FIR
					has_country_flag = FIR_is_necromancer
					NOT = { has_country_leader = { ruling_only = yes character = FIR_shinespark } }
				}
				add_opinion_modifier = {
					target = DED
					modifier = mortal_enemies
				}
				add_opinion_modifier = {
					target = DED
					modifier = CHN_embargo
				}
				reverse_add_opinion_modifier = {
					target = DED
					modifier = mortal_enemies
				}
				reverse_add_opinion_modifier = {
					target = DED
					modifier = CHN_embargo
				}
			}
			if = {
				limit = {
					original_tag = BAN
					has_government = neutrality
				}
				clr_country_flag = have_regular_puppets
			}
			if = {
				limit = {
					original_tag = GRU
				}
				if = {
					limit = { has_government = communism }
					load_focus_tree = gryphus_commie_tree
					else = {
						load_focus_tree = gryphus
					}
				}
			}
			if = {
				limit = {
					original_tag = STG
					is_subject = no
				}
				drop_cosmetic_tag = yes
				reapply_secondary_cosmetic_tags = yes
			}
			handle_generic_griffon_ideas_on_govt_change = yes
			if = {
				limit = {
					original_tag = FEA
					OR = {
						has_cosmetic_tag = FEA_PvdA_old_flag
						has_cosmetic_tag = FEA_PvdA_old_flag_GRI_Puppet
					}
					OR = {
						NOT = { has_government = communism }
						AND = {
							is_subject = yes
							overlord = { has_government = communism }
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					original_tag = GRI
					has_government = democratic
				}
				every_country = {
					limit = {
						has_opinion_modifier = RIV_hates_the_empire
						has_government = democratic
					}
					remove_opinion_modifier = { target = ROOT modifier = RIV_hates_the_empire }
				}
			}
			if = {
				limit = {
					original_tag = GRI
					WNG = {
						NOT = {
							has_war_with = GRI
							is_in_faction_with = GRI
							is_subject_of = GRI
						}
					}
					FROM = {
						has_idea = WNG_southern_shield
						NOT = {
							has_war_with = WNG
							is_in_faction_with = WNG
							is_subject_of = WNG
						}
					}
				}
				WNG = {
					country_event = wingbardy.96
				}
			}
			if = {
				limit = {
					original_tag = EQS
					NOT = {has_government = democratic}
				}
				if = {
					limit = {
						HIP = {
							OR = {
								is_in_faction_with = EQS
								has_war_together_with = EQS
							}
							is_subject = no
							NOT = {has_government = fascism}
						}
					}
					HIP = {
						every_country = {
							limit = {
								OR = {
									tag = HIP
									is_subject_of = HIP
									has_country_flag = HIP_alliance_member
								}
								is_in_faction_with = EQS
							}
							leave_faction = yes
							add_ai_strategy = {
								type = alliance
								id = "EQS"
								value = -200
							}
							add_ai_strategy = {
								type = alliance
								id = "HIP"
								value = 200
							}
						}
						every_other_country = {
							limit = {
								OR = {
									is_on_equestrian_continent = yes
									is_in_faction_with = WNG
								}
								has_war_with = EQS
							}
							set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
							every_country = {
								limit = {
									OR = {
										tag = HIP
										is_subject_of = HIP
										has_country_flag = HIP_alliance_member
										AND = {
											is_in_faction_with = HIP
											NOT = {is_in_faction_with = EQS}
										}
									}
								}
								set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 }
								white_peace = PREV
								remove_wargoal = {
									type = all
									target = PREV
								}
							}
						}
						if = {
							limit = {
								has_country_flag = HIP_won_north_zebrican_war
							}
							create_faction = HIP_middle_sea_treaty
							every_other_country = {
								limit = {
									OR = {
										has_country_flag = HIP_alliance_member
										is_subject_of = HIP
									}
								}
								HIP = {add_to_faction = PREV}
							}
						}
					}
				}
			}
			if = {
				limit = {
					original_tag = FLO
					has_idea = FLO_poverty_virtue
				}
				swap_ideas = {
					remove_idea = FLO_poverty_virtue
					add_idea = no_poverty
				}
			}
			if = {
				limit = {
					original_tag = FLO
					has_idea = FLO_illiteracy_virtue
				}
				swap_ideas = {
					remove_idea = FLO_illiteracy_virtue
					add_idea = no_lack_of_scientists
				}
			}
			if = {
				limit = {
					original_tag = EQS
					tag = event_target:solar_empire
					OR = {
						is_subject = yes
						NOT = { has_government = fascism }
					}
				}
				kill_ideology_leader = fascism
				
				if = {
					limit = { event_target:equestria = { exists = no } }
					save_global_event_target_as = equestria
				}
				SOL = { save_global_event_target_as = solar_empire }
				country_event = { id = solarempire.1018 }
			}
			if = {
				limit = {
					original_tag = DMT
					DMT_rover_diamondshield = { is_unit_leader = yes }
					NOT = {	has_government = fascism }
				}
				DMT_rover_diamondshield = {
					remove_unit_leader_role = yes
				}
			}
			if = {
				limit = {
					original_tag = LUS
				}
				country_event = { id = lushi.155 hours = 1 }
			}
			if = {
				limit = {
					original_tag = VED
				}
				country_event = vedina.76
			}
		}
	}

	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		effect = {
			# PUT EVERYTHING IN THE IF BELOW
			# THE bypass_on_peaceconference_ended FLAG **HAS** TO BE SET BEFORE CALLING THE white_peace COMMAND AND CLEARED AFTERWARDS
			if = {
				limit = {
					NOT = {
						has_country_flag = bypass_on_peaceconference_ended
						FROM = { has_country_flag = bypass_on_peaceconference_ended }
					}
				}
				log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_peaceconference_ended"
				transfer_impassible_states_back = yes
				if = {
					limit = {
						FROM = {
							is_subject = yes
						}
					}
					every_country_with_original_tag = {
						original_tag_to_check = FROM
						limit = {
							NOT = { tag = FROM }
							is_subject = yes
							is_ai = yes
							overlord = { is_ai = yes }
						}
						FROM = {
							annex_country = { target = PREV transfer_troops = yes }
						}
					}
				}
				if = {
					limit = {
						is_in_array = { annex_compliance = FROM }
					}
					remove_from_array = {
						annex_compliance = FROM
					}
				}
				if = {
					limit = {
						is_in_array = { annex_compliance_subject = FROM }
					}
					remove_from_array = {
						annex_compliance_subject = FROM
					}
				}
				set_AI_strategies_on_every_possible_country_delayed = yes
				FROM = { clr_country_flag = already_capitulated }
				if = {
					limit = {
						FROM = { tag = FAW exists = no }
					}
					for_each_scope_loop = {
						array = FAW.core_states
						add_core_of = FAT
						remove_core_of = FAW
					}
				}
				if = {
					limit = {
						NOT = { HLQ = { owns_state = 387 } }
					}
					reset_province_name = 8079
				}
				if = {
					limit = {
						NOT = { HLQ = { owns_state = 619 } }
					}
					reset_province_name = 5013
				}
				if = {
					limit = {
						NOT = { HLQ = { owns_state = 645 } }
					}
					reset_province_name = 11911
				}
				handle_op_paperclip = yes
				if = {
					limit = {
						original_tag = SCS 
						FROM = {
							owns_state = 3
						}
						
					}
					SCS = {
						country_event = { id = scs.776 days = 4 }
					}
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = GFF
							is_subject_of = ROOT
						}
						GRF = { is_subject_of = ROOT }
					}
					GRF = {
						annex_country = { target = FROM }
					}
				}
				else_if = {
					limit = {
						tag = CHN
						FROM = {
							tag = CCN
						}
					}
					annex_country = { target = FROM }
				}
				else_if = {
					limit = {
						tag = CCN
						FROM = {
							tag = CHN
						}
					}
					annex_country = { target = FROM }
				}
				else_if = {
					limit = {
						tag = STG
						is_ai = yes
						has_government = communism
						FROM = {
							tag = PLB
							PLB = { is_subject_of = ROOT }
						}
					}
					every_owned_state = {
						limit = {
							is_core_of = PLB
							NOT = {
								is_core_of = ROOT
								is_claimed_by = ROOT
							}
						}
						transfer_state_to = PLB
					}
				}
				else_if = {
					limit = {
						is_eqs_civil_war_tag = yes
						NOT = {
							original_tag = EQS
							original_tag = NLR
						}
						FROM = {
							is_eqs_civil_war_tag = yes
						}
					}
					annex_country = { target = FROM }
				}
				else_if = {
					limit = {
						original_tag = HLQ
						FROM = {
							OR = {
								original_tag = LNS
								original_tag = LSC
								original_tag = LSM
							}
							is_subject_of = ROOT
						}
					}
					annex_country = { target = FROM }
				}
				else_if = {
					limit = {
						OR = {
							original_tag = LNS
							original_tag = LSC
							original_tag = LSM
						}
						FROM = {
							OR = {
								original_tag = LNS
								original_tag = LSC
								original_tag = LSM
								original_tag = HLQ
							}
							is_subject_of = ROOT
						}
					}
					annex_country = { target = FROM }
				}

				if = {
					limit = {
						NOT = { has_global_flag = river_federation_founded }
						OR = {
							AND = {
								is_river_fed_member = yes
								var:faction_leader = {
									is_river_fed_member = yes
								}
							}
							FROM = {
								AND = {
									is_river_fed_member = yes
									var:faction_leader = {
										is_river_fed_member = yes
									}
								}
							}
						}
					}
					RIV_find_new_leader = yes
				}


				if = {
					limit = {
						FROM = { has_idea = EQC_funding_the_resistiance }
					}
					FROM = { remove_ideas = EQC_funding_the_resistiance }
					EQS = { remove_ideas = EQC_resistance }
					ELF = { remove_ideas = EQC_resistance }
				}

				if = {
					limit = {
						FROM = {
							tag = GRI
							GRI_synovial = { is_unit_leader = yes }
						}
					}
					remove_ideas = CHN_GRI_Attache_For_GRI
					hidden_effect =  {
						CHN = { remove_ideas = CHN_GRI_Attache_For_CHN }
					}
					FROM = {
						GRI_thranx = { set_nationality = CHN }
						GRI_synovial = {
							set_nationality = CHN
							set_portraits = {
								army = { large ="GFX_Synovial_CHN_cap" }
							}
						}
					}
				}

				if = {
					limit = {
						tag = CHN
						has_country_leader = { ruling_only = yes character = CHN_queen_chrysalis }
					}
					country_event = { id = changelings_paxchrysalia.1000 hours = 1 } #it has triggers inside
					if = {
						limit = {
							FROM = {
								OR = {
									original_tag = EQS
									original_tag = NLR
								}
							}
						}
						if = {
							limit = { country_exists = FROM FROM = { is_subject_of = ROOT } }
							annex_country = { target = FROM }
						}
						country_event = news.1121
					}
				}

				else_if = {
					limit = { 
						FROM = { tag = CHN }
					}
					STG = { country_event = { id = stalliongrad.151 days = 2 } }
					GRI = { country_event = { id = changelingattache.14 days = 1 } }
					if = {
						limit = {
							FROM = {
								OR = {
									has_government = democratic
									has_government = communism
								}
								OR = {
									has_character = CHN_trimmel
									has_character = CHN_vect
									has_character = CHN_opteris
								}
							}
						}
						hidden_effect = {
							# SOL is used as limbo
							CHN_trimmel = { set_nationality = SOL }
							CHN_vect = { set_nationality = SOL }
							CHN_opteris = { set_nationality = SOL }
						}
						if = {
							limit = { original_tag = STG }
							country_event = { id = news.2201 days = 1 }
						}
					}
				}

				if = {
					limit = {
						has_government = communism
						FROM = {
							is_subject_of = ROOT
						}
					}
				}

				if = {
					limit = { original_tag = EQS }
					if = {
						limit = {
							FROM = {
								is_major = yes
								NOT = {
									tag = CHN
									original_tag = OLE
								}
							}
						}
						set_country_flag = EQS_had_big_war
						country_event = { id = equestriadem.8 days = 60 }
					}
					if = {
						limit = {
							is_ai = yes
							has_government = democratic
							any_owned_state = {
								is_core_of = OLE
							}
						}
						if = {
							limit = { NOT = { country_exists = OLE } }
							release_puppet = OLE
						}
						if = {
							limit = { OLE = { OR = { is_in_faction_with = ROOT is_subject_of = ROOT } } }
							every_state = {
								limit = {
									owner = {
										OR = {
											tag = ROOT
											AND = {
												is_in_faction_with = ROOT
												is_ai = yes
											}
										}
									}
									is_core_of = OLE
								}
								OLE = { transfer_state = PREV }
							}
							if = {
								limit = {
									OLE = {
										NOT = { 
											has_country_leader = { ruling_only = yes character = OLE_queen_velvet }
										}
									}
								}
								OLE = {
									promote_character = {
										character = OLE_queen_velvet
										ideology = conservatism
									}
								}
							}
						}
					}
					if = {
						limit = {
							FROM = { tag = CHN }
						}
						country_event = { id = news.2101 days = 1 }
						country_event = { id = equestriadem.8 days = 60 }
					}
					if = {
						limit = {
							has_global_flag = equestrian_civil_war
							FROM = { tag = NLR }
						}
						country_event = { id = news.2031 days = 1 }
						country_event = { id = equestriadem.8 days = 60 }
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
					}
					if = {
						limit = {
							FROM = { original_tag = CRY }

						}
						if = {
							limit = {
								has_global_flag = the_crystal_war
							}
							news_event = { id = news.42 days = 1}
							clr_global_flag = the_crystal_war
						}
						remove_opinion_modifier = { target = FROM modifier = mortal_enemies }
						FROM = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
					}
				}

				else_if = {
					limit = {
						original_tag = CRY
						FROM = { tag = NLR }
						has_government = democratic
						has_global_flag = SOL_wartime_change
						has_country_flag = Supported_SOL
						event_target:solar_empire = { has_war = no }
						is_subject_of = event_target:solar_empire
						NOT = {
							event_target:solar_empire = { has_completed_focus = Crystal_Fair }
							has_country_flag = supported_SOL
							has_country_flag = CRY_solar_governorship
							has_country_flag = CRY_dont_give_SOL_cosmetic
						}
					}
					set_country_flag = CRY_thinking_about_staying_a_SOL_puppet
					country_event = { id = solarempire.15 days = 1 }
				}

				if = {
					limit = {
						has_global_flag = the_crystal_war
						FROM = { original_tag = EQS  }
						original_tag = CRY
					}
					news_event = { id = news.43 days = 1}
					clr_global_flag = the_crystal_war
					remove_opinion_modifier = { target = FROM modifier = mortal_enemies }
					FROM = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
				}
				else_if = {
					limit = {
						FROM = { original_tag = EQS }
						tag = NLR
					}
					FROM = {
						kill_country_leader = yes
					}
					if = {
						limit = { country_exists = FROM }
						annex_country = { target = FROM }
					}
					country_event = { id = news.2041 days = 1 }
					country_event = { id = lunas.35 days = 1 random = 4800 }#days to hours applied
				}

				if = {
					limit = { FROM = { tag = DED } }
					annex_country = { target = FROM  }
					country_event = { id = deadempire.29 days = 1 }
				}

				else_if = {
					limit = {
						tag = HLR
						FROM = { tag = EWI }
					}
					country_event = { id = arcturian.50 days = 1 }
				}

				else_if = {
					limit = {
						tag = BRF
						FROM = { tag = GRW }
					}
					country_event = { id = brodfeld.21 days = 1 }
				}
				else_if = {
					limit = {
						tag = GRW
						FROM = { tag = BRF }
					}
					country_event = { id = prywhen.1 days = 1 }
				}

				else_if = {
					limit = {
						tag = LSC
						OR = {
							AND = {
								NOT = { country_exists = LNS }
								FROM = { tag = LSM }
							}
							AND = {
								NOT = { country_exists = LSM }
								FROM = { tag = LNS }
							}
						}
					}
					country_event = { id = longsword.31 days = 1 }
				}
				else_if = {
					limit = {
						tag = LSM
						OR = {
							AND = {
								NOT = { country_exists = LNS }
								FROM = { tag = LSC }
							}
							AND = {
								NOT = { country_exists = LSC }
								FROM = { tag = LNS }
							}
						}
					}
					country_event = { id = longsword.57 days = 1 }
				}
				else_if = {
					limit = {
						tag = LNS
						OR = {
							AND = {
								NOT = { country_exists = LSM }
								FROM = { tag = LSC }
							}
							AND = {
								NOT = { country_exists = LSC }
								FROM = { tag = LSM }
							}
						}
					}
					country_event = { id = longsword.78 days = 1 }
				}
				else_if = {
					limit = {
						tag = JER
						has_completed_focus = JER_state_of_aquileia
						OR = {
							AND = {
								OR = {
									NOT = {country_exists = JRR }
									JRR = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
								}
								FROM = { tag = JEB }
							}
							AND = {
								OR = {
									NOT = {country_exists = JEB }
									JEB = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
								}
								FROM = { tag = JRR }
							}
							AND = {
								OR = {
									NOT = {country_exists = JEB }
									JEB = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = JRR }
									JRR = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
								}
								FROM = { tag = VIN }
							}
							AND = {
								OR = {
									NOT = { country_exists = JEB }
									JEB = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = JRR }
									JRR = { is_subject_of = JER }
								}
								OR = {
									NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
								}
								FROM = { tag = JFT }
							}
						}
					}
					country_event = { id = aquileia.48 days = 1 }
				}
                if = {
					limit = {
						tag = JER
						has_completed_focus = JER_fight_for_freedom
						OR = {
							AND = {
                                OR = {
								    NOT = {country_exists = JRR }
									JRR = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
                                }
								FROM = { tag = JEB }
							}
							AND = {
                                OR = {
								    NOT = {country_exists = JEB }
									JEB = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
                                }
								FROM = { tag = JRR }
							}
							AND = {
                                OR = {
								    NOT = {country_exists = JEB }
									JEB = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = JRR }
									JRR = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = JFT }
									JFT = { is_subject_of = JER }
                                }
								FROM = { tag = VIN }
							}
							AND = {
                                OR = {
								    NOT = { country_exists = JEB }
									JEB = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = JRR }
									JRR = { is_subject_of = JER }
                                }
                                OR = {
								    NOT = { country_exists = VIN }
									VIN = { is_subject_of = JER }
                                }
								FROM = { tag = JFT }
							}
						}
					}
					country_event = { id = aquileia.18 days = 1 }
				}
				if = {
					limit = {
						has_opinion_modifier = NIM_atrocities
						FROM = { tag = NIM }
					}
					FROM = {
						every_other_country = {
							remove_opinion_modifier = { target = FROM modifier = NIM_atrocities }
						}
					}
				}
				if = {
					limit = {
						FROM = {
							original_tag = YAL
							YAL_emperor_grover_ii = { is_unit_leader = yes }
							NOT = {
								has_country_leader = {
									ruling_only = yes
									character = YAL_emperor_grover_ii
								}
							}
						}
					}
					FROM = {
						YAL_emperor_grover_ii = {
							remove_unit_leader_role = yes
							if = {
								limit = { is_advisor = yes }

								remove_advisor_role = { slot = army_chief }
							}
						}
						remove_opinion_modifier = {
							target = NIM
							modifier = mortal_enemies
						}
						NIM = {
							remove_opinion_modifier = {
								target = PREV
								modifier = mortal_enemies
							}
						}
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								ROOT = { tag = SRS }
								FROM = { tag = NTR }
							}
							AND = {
								has_global_flag = SRS_has_triggered_civilwar_in_NTR
								ROOT = { tag = NTR }
								FROM = { original_tag = NTR }
							}
						}
					}
					SRS = {
						country_event = { id = socrep_grif.83 hours = 12 }
					}
				}
				if = {
					limit = {
						has_country_flag = SRS_has_triggered_civilwar_in_themselves
						ROOT = { tag = SRS }
						FROM = { original_tag = SRS }
					}
					SRS = {
						country_event = { id = socrep_grif.91 hours = 2 }
					}
				}

				# Delete tribal templates
				if = {
					limit = {
						OR = {
							tag = CES
							tag = JUN
							tag = NMS
						}
						FROM = {
							OR = {
								tag = CES
								tag = JUN
								tag = NMS
								tag = BAL
							}
						}
					}
					# more triggers in event
					country_event = { id = civwar.24 days = 1 random = 48 }
				}

				if = {
					limit = {
						has_global_flag = equestrian_civil_war
						NOT = { has_global_flag = equestrian_civil_war_ended }
						FROM = {
							OR = {
								original_tag = EQS
								tag = NLR
							}
						}
					}
					set_global_flag = equestrian_civil_war_ended
				}

				if = {
					limit = {
						has_global_flag = the_war
						NOT = { has_global_flag = the_war_ended }
						FROM = {
							tag = CHN
						}
					}
					set_global_flag = the_war_ended
				}

				if = {
					limit = {
						NOT = { has_global_flag = prywhen_civil_war_is_over }
						FROM = {
							OR = {
								tag = GRW
								tag = BRF
							}
						}
					}
					set_global_flag = prywhen_civil_war_is_over
				}

				if = {
					limit = {
					    AND = {
					        ROOT = {
								OR = {
								    has_country_flag = north_zebrican_war_participant
									AND = {
										original_tag = BAT
										has_global_flag = BAT_won_civil_war
									}
								}
						    }
						    FROM = {
							    original_tag = HIP
						        NOT = {
								    has_country_flag = BAT_HIP_defeated
							    }
						    }
						}
					}
					set_country_flag = BAT_HIP_defeated
					clr_country_flag = north_zebrican_war_participant
				}
				if = {
					limit = {
					    AND = {
					        ROOT = {
							    original_tag = HIP
								NOT = {
								    has_country_flag = BAT_HIP_defeated
								}
						    }
						    FROM = {
								OR = {
									AND = {
							   			OR = {
											tag = BAT
											tag = CTH
											tag = TBK
											tag = WNG
										}
						       			has_country_flag = north_zebrican_war_participant
									}
									tag = HIE
								}
						    }
							NOT = {
								ROOT = {
									any_enemy_country = {
										AND = {
											is_subject = no
											has_country_flag = north_zebrican_war_participant
											has_capitulated = no
										}
									}
								}
							}
						}
					}
					set_country_flag = HIP_won_north_zebrican_war
					ROOT = {clr_country_flag = north_zebrican_war_participant}
					FROM = {clr_country_flag = north_zebrican_war_participant}
					mark_focus_tree_layout_dirty = yes
				}
				else_if = {
					limit = {
						ROOT = {
							original_tag = HIP
							has_completed_focus = HIP_strike_first
						}
						FROM = {
							OR = {
								original_tag = TBK
								original_tag = ZAR
								original_tag = BAT
								original_tag = WAR
							}
						}
						OR = {
							FROM = {
								owns_state = 712
							}
							ROOT = {
								owns_state = 712
							}
						}
					}
					set_country_flag = HIP_won_north_zebrican_war
					mark_focus_tree_layout_dirty = yes
				}
				if = {
					limit = {
						FROM = {
							original_tag = BAT
						}
						NOT = {
							OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
					}
					every_state = {
						limit = {
							is_core_of = BAT
							NOT = {
								state = 689
								state = 690
								state = 691
								state = 712
								state = 713
								state = 815
							}
						}
						remove_core_of = BAT
					}
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						NOT = {
							OR = {
								WAR = {
									exists = yes
									is_subject = no
								}
								ZAR = {
									exists = yes
									is_subject = no
								}
								TBK = {
									exists = yes
									is_subject = no
								}
							}
						}
						NOT = {
						    has_global_flag = BAT_won_civil_war
						}
						OR = {
						    has_country_flag = total_war
							has_country_flag = partial_war
							has_country_flag = permenant_total_war
						    has_country_flag = HIE_BAT_alliance
						}
						FROM = {
						    original_tag = HIP
						}
					}
					if = {
						limit = {
							is_in_faction_with = CTH
							CTH = {
								has_country_leader = {
									character = CTH_zalathel_zarca
									ruling_only = yes
								}
							}
						}
						CTH = {
							country_event = {
								id = colthage_other.211
							}
						}
					}
					else = {
						country_event = bat.81
					}
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						OR = {
							WAR = {
								exists = yes
								is_subject = no
							}
							ZAR = {
								exists = yes
								is_subject = no
							}
							TBK = {
								exists = yes
								is_subject = no
							}
						}
						NOT = {
						    has_global_flag = BAT_won_civil_war
						}
						OR = {
						    has_country_flag = total_war
							has_country_flag = partial_war
							has_country_flag = permenant_total_war
						    has_country_flag = HIE_BAT_alliance
						}
						FROM = {
						    original_tag = HIP
						}
					}
					country_event = { 
						id = bat.79
					}
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						has_global_flag = BAT_won_civil_war
						FROM = {
						    original_tag = HIP
						}
						NOT = {
							OR = {
								WAR = {
									exists = yes
									is_subject = no
								}
								ZAR = {
									exists = yes
									is_subject = no
								}
								TBK = {
									exists = yes
									is_subject = no
								}
							}
						}
					}
					country_event = { 
						id = bat.130
					}
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						has_global_flag = BAT_won_civil_war
						FROM = {
						    original_tag = HIP
						}
						NOT = {
							OR = {
								WAR = {
									exists = yes
									is_subject = no
								}
								ZAR = {
									exists = yes
									is_subject = no
								}
								TBK = {
									exists = yes
									is_subject = no
								}
							}
						}
					}
					country_event = { 
						id = bat.79
					}
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						has_country_flag = BAT_HIP_defeated
						NOT = {
							has_global_flag = BAT_won_civil_war
						}
						OR = {
							AND = {
								FROM = {
									original_tag = TBK
								}
								WAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
							AND = {
								FROM = {
									original_tag = WAR
								}
								TBK = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
							AND = {
								FROM = {
									original_tag = WAR
								}
								TBK = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
							AND = {
								FROM = {
									original_tag = CTH
									has_country_flag = CTH_war_with_bats
								}
								TBK = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								has_country_flag = BAT_HIP_defeated
							}
						}
					}
					country_event = bat.81
				}
				if = {
					limit = {
						original_tag = BAT
						NOT = {
						    OR = {
						        has_country_flag = BAT_commonwealth_established
								has_country_flag = BAT_national_catastrophe
							}
						}
						has_country_flag = BAT_HIP_defeated
						has_global_flag = BAT_won_civil_war
						OR = {
							AND = {
								FROM = {
									original_tag = TBK
								}
								WAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
							AND = {
								FROM = {
									original_tag = WAR
								}
								TBK = {
									OR = {
										exists = no
										is_subject_of = BAT
										is_in_faction_with = NLR
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
							AND = {
								FROM = {
									original_tag = WAR
								}
								TBK = {
									OR = {
										exists = no
										is_subject_of = BAT
										is_in_faction_with = NLR
									}
								}
								ZAR = {
									OR = {
										exists = no
										is_subject_of = BAT
									}
								}
							}
						}
					}
					country_event = bat.130
				}
				if = {
					limit = {
					    country_exists = BAT
						ROOT = {
							tag = NLR
						}
						FROM = { 
							original_tag = EQS
						}
					}
					BAT = {
						country_event = bat.18
					}
				}
				if = {
					limit = {
						ROOT = {
							tag = BAT
						}
						FROM = {
							tag = WAR
						}
					}
					annex_country = { target = FROM }
				}
				if = {
					limit = {
						original_tag = BAT
						has_country_flag = BAT_triarchy_formed
						NOT = {
						    OR = {
						        has_country_flag = BAT_socialist_victory
								has_country_flag = BAT_harmonist_victory
								has_country_flag = BAT_neutrality_victory
								has_country_flag = BAT_supremacy_victory
								has_country_flag = BAT_stirling_victory
							}
						}
						FROM = {
						    has_country_flag = BAT_took_BAT_states
						}
					}
					country_event = { 
						id = bat.156
					}
				}
				if = {
					limit = {
						original_tag = HIE
						has_country_flag = HIE_BAT_alliance
						NOT = {
						    has_global_flag = BAT_won_civil_war
						}
						is_in_faction_with = BAT
						FROM = {
						    original_tag = HIP
						}
					}
					country_event = { 
						id = hippone_sekrit.38
					}
				}
				if = {
					limit = {
						original_tag = CVA
						NOT = {
							country_exists = CTC
							country_exists = CTB
						}
						NOT = {
							has_country_flag = CVA_zeirutid_assassinated
						}
						FROM = {
							original_tag = CTH
						}
					}
					country_event = { 
						id = zebra_zapata.3
					}
				}
				if = {
					limit = {
						original_tag = CVA
						NOT = {
							has_country_flag = CVA_zeirutid_assassinated
						}
						FROM = {
							tag = CTC
						}
					}
					country_event = { 
						id = zebra_zapata.4
					}
				}
				if = {
					limit = {
						original_tag = CVA
						has_country_flag = CVA_zeirutid_assassinated
						FROM = {
						    tag = CTC
						}
					}
					country_event = { 
						id = zebra_zapata.5
					}
				}
				if = {
					limit = {
						original_tag = WIN
						has_country_flag = WIN_bean_takeover
						FROM = {
							tag = HIP
						}
					}
					country_event = { 
						id = legation.79
					}
				}
				if = {
					limit = {
						original_tag = WIN
						has_country_flag = WIN_WNG_takeover
						FROM = {
							tag = HIP
						}
					}
					country_event = { 
						id = legation.99
					}
				}
				if = {
					limit = {
						original_tag = WIN
						has_country_flag = WIN_BAT_takeover
						FROM = {
							tag = HIP
						}
					}
					country_event = { 
						id = legation.108
					}
				}
				if = {
					limit = {
						has_global_flag = CTH_third_civil_war
					}
					if = {
						limit = {
							original_tag = TRO
							OR = {
								AND = {
									NOT = { 
										country_exists = HIE 
									}
									FROM = { 
										tag = MZN 
									}
								}
								AND = {
									NOT = { 
										country_exists = MZN 
									}
									FROM = { 
										tag = HIE
									}
								}
							}
							CVA = {
							    OR = {
								    exists = no
									is_subject_of = ROOT
								}
							}
						}
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
						country_event = { 
							id = trotkart_colthage.8 hours = 1 #For end of civil war event when added
						}
					}
					if = {
						limit = {
							original_tag = TRO
							OR = {
								AND = {
									NOT = { 
										country_exists = HIE 
									}
									FROM = { 
										tag = MZN 
									}
								}
								AND = {
									NOT = { 
										country_exists = MZN 
									}
									FROM = { 
										tag = HIE
									}
								}
							}
							CVA = {
							    OR = {
								    exists = yes
									NOT = {
										is_subject_of = ROOT
									}
								}
							}
						}
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
						country_event = { 
							id = trotkart_colthage.29 hours = 1 #For end of civil war event when added
						}
					}
					if = {
						limit = {
							original_tag = TRO
							NOT = { 
							    OR = {
									country_exists = HIE 
									country_exists = MZN 
								}
							}
							FROM = { 
								tag = CVA 
							}
						}
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
						country_event = { 
							id = trotkart_colthage.8 hours = 1 #For end of civil war event when added
						}
					}
					if = {
						limit = {
							tag = MZN
							OR = {
								AND = {
									NOT = { 
										country_exists = HIE 
									}
									FROM = { 
										tag = TRO 
									}
								}
								AND = {
									NOT = { 
										country_exists = TRO 
									}
									FROM = { 
										tag = HIE
									}
								}
							}
						}
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
						country_event = { 
							id = colthage_monzano_cw_untriggered.1 hours = 1 #For end of civil war event when added
						}
					}
					if = {
						limit = {
							original_tag = HIE
							OR = {
								AND = {
									NOT = { 
										country_exists = MZN 
									}
									FROM = { 
										tag = TRO 
									}
								}
								AND = {
									NOT = { 
										country_exists = TRO 
									}
									FROM = { 
										tag = MZN
									}
								}
							}
						}
						if = {
							limit = { country_exists = FROM }
							annex_country = { target = FROM }
						}
						country_event = { 
							id = hippone_sekrit.12 hours = 1
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							tag = ZAR
						}
						#This thing was just pointless I think. I hate NZ peace deals.
						#NOT = { 
						#	country_exists = BAT 
						#}
						FROM = {
							tag = BAT
						}
					}
					if = {
						limit = {
							country_exists = TBK
						}

						#ZAR beat Chiropterra with Tobuck, transfers states to it.
						if = {
							limit = {
								BAT = {
									exists = yes
									is_puppet_of = ZAR
								}
							}
							TBK = { 
								annex_country = { 
									target = BAT 
									transfer_troops = no
								} 
							}
						}
						if = {
							limit = {
								ZAR = {
									any_owned_state = {
										is_core_of = BAT
									}
								}
							}
							every_owned_state = {
								if = {
									limit = {
										is_core_of = BAT
									}
									TBK = {
										transfer_state = PREV
									}
								}
							}
						}
					}
					else = {

						if = {
							limit = {
								BAT = {
									exists = yes
									is_puppet_of = ZAR
								}
							}
							ZAR = { 
								annex_country = { 
									target = BAT 
									transfer_troops = no
								} 
							}
						}
						if = {
							limit = {
								OR = {		
									ZAR = {
										has_country_flag = ZAR_wormy
									}
									BAT = {
										has_country_flag = BAT_national_catastrophe
									}
								}
							}
							#Nothing happens, ZAR is in worm path, or BAT came in for a revenge and died again. This will not release BAT.
						}

						else_if = {
							limit = {
								all_of_scopes = {
									array = ZAR_BAT_states
									owner = {
										tag = ZAR
									}
								}
							}
							#ZAR beat Chiropterra on it's own

							ZAR = {

								country_event = {
									id = zarantia.44
									days = 1
								}
							}
						}
						else_if = {
							limit = {
								any_of_scopes = {
									array = ZAR_BAT_states
									owner = {
										tag = HIP
									}
								}
							}
							#Foreign Intervention
							every_owned_state = {
								limit = {
									is_in_array = {
										array = ZAR.ZAR_BAT_states
										value = THIS
									}
								}
								transfer_state_to = HIP
							}

							country_event = {
								id = zarantia.445
								days = 1
							}
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							tag = ZAR
						}
						NOT = { 
							country_exists = TBK 
							country_exists = BAT 
						}
						any_owned_state = {
							is_core_of = BAT
						}
						FROM = {
							tag = TBK
						}
					}
					#Release BAT after killing Tobuck if Tobuck didn't release it by itself.

					country_event = {
						id = zarantia.444
						days = 1
					}

				}
				if = {
					limit = {
						ROOT = {
							tag = TBK
						}
						NOT = { 
							country_exists = BAT 
						}
						FROM = {
							tag = BAT
						}
					}
					if = {
						limit = {
							has_completed_focus = TBK_new_tobuck
							has_completed_focus = TBK_wallnut_start
						}
						country_event = { id = tobuck_wallnut.3 }
					}
					if = {
						limit = {
							has_completed_focus = TBK_new_tobuck
							has_completed_focus = TBK_baragzen_start
						}
						country_event = { id = tobuck_baragzen.5 }
						ZAR = {
							add_timed_idea = {
								idea = ZAR_timed_looting
								days = 365
							}
						}
					}
					if = {
						limit = {
							has_completed_focus = TBK_new_tobuck
							has_completed_focus = TBK_alesia_start
						}
						country_event = { id = tobuck_alesia.5 }
					}
					if = {
						limit = {
							has_completed_focus = TBK_vasile_start
						}
						country_event = { id = tobuck_vasile.42 }
						ZAR = {
							add_timed_idea = {
								idea = ZAR_timed_looting
								days = 365
							}
						}
					}
				}

				if = {
					limit = {
						original_tag = WIN
						has_country_flag = WIN_BAT_takeover
						FROM = {
							tag = HIP
						}
					}
					country_event = { 
						id = legation.108
					}
				}

				FROM = {
					every_owned_state = {
						limit = {
							has_state_flag = eqs_bat_state
						}
						add_core_of = EQS
						clr_state_flag = eqs_bat_state
					}
				}
				every_owned_state = {
					limit = {
						has_state_flag = eqs_bat_state
					}
					add_core_of = EQS
					clr_state_flag = eqs_bat_state
				}

				# if a country is an AI puppet with only one state and surrounded by another country, annex them to reduce bordergore
				FROM = { country_event = { id = utility.10 hours = 1 } }

				update_global_arrays_all = yes
			}
		}
	}

	#ROOT is winner #FROM is loser
	on_peaceconference_started = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_peaceconference_started"
			save_owner_of_impassible_states = yes
		}
	}

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			FROM = {
				save_event_target_as = former_controller
			}
			FROM.FROM = {
				save_event_target_as = newly_controlled_state
			}
			force_potential_core_resistance_on_controlled_changed = yes
			#Idea changes from state control
			if = {
				limit = {
					FROM.FROM = {
						has_dynamic_modifier = {
							modifier = BAT_opium_plantation_mod
						}
					}
				}
				FROM.FROM = {
					owner = {
						BAT_get_opium_factories = yes
					}
				}
			}

			if = {
				limit = {
					FROM.FROM = { state = 344 }
					original_tag = CRY
					has_government = democratic
					NOT = { has_idea = crystal_heart }
				}
				add_ideas = crystal_heart
			}
			else_if = {
				limit = {
					FROM.FROM = { state = 381 }
					NOT = { has_idea = owns_skyfall }
					OR = { NOT = { num_of_civilian_factories > 50 } NOT = { num_of_military_factories > 25 } }
				}
				add_ideas = owns_skyfall
			}
			else_if = {
				limit = {
					FROM.FROM = { state = 627 }
					has_global_flag = WIT_canal_built
					NOT = { has_idea = WIT_grand_canal }
				}
				add_ideas = WIT_grand_canal
			}
			else_if = {
				limit = {
					FROM.FROM = { state = 616 }
					has_global_flag = WIT_mine_built
					NOT = { has_idea = WIT_silver_mine }
				}
				add_ideas = WIT_silver_mine
			}
			else_if = {
				limit = {
					FROM.FROM = { state = 1036 }
					ROOT = {
						original_tag = HYE
					}
				}
				country_event = storm.3
			}

			#Liberation stuff
			if = {
				limit = {
					FROM = { tag = CHN }
					original_tag = EQS
					has_war_with = FROM
					FROM.FROM = { owner = { original_tag = EQS } }
				}
				if = {
					limit = {
						FROM.FROM = {
							NOT = { has_state_flag =  state_taken_chn_timeout }
						}
					}
					if = {#Acornage
						limit = {
							FROM.FROM = { state = 136 }
						}
						news_event = { id = cityfall.22 }
					}
					else_if = {#Tall Tales
						limit = {
							FROM.FROM = { state = 59 }
						}
						news_event = { id = cityfall.23 }
					}
					else_if = {#Vanhoover
						limit = {
							FROM.FROM = { state = 14 }
						}
						news_event = { id = cityfall.24 }
					}
				}
				FROM.FROM = {
					clr_state_flag =  state_taken_chn_timeout
				}
			}

			if = {
				limit = {
					has_war_with = FROM
					FROM = {
						NOT = { original_tag = ROOT }
					}
					FROM.FROM = {
						is_owned_by = FROM
						NOT = { has_state_flag = state_has_fallen }
					}
				}
				if = {
					limit = {
						tag = YAK
						FROM = { tag = JAK }
						FROM.FROM = { state = 274 }
					}
					country_event = yakistan.29
				}
				else_if = {
					limit = { tag = CHN }
					if = {
						limit = { FROM = { original_tag = OLE } }
						if = {#Vaverfront
							limit = {
								NOT = { has_global_flag = fall_of_vaverfront_CHN }
								FROM.FROM = { state = 69 }
							}
							news_event = { id = cityfall.1 }
						}
						else_if = {#Hjortland
							limit = {
								NOT = { has_global_flag = fall_of_hjortland_CHN }
								FROM.FROM = { state = 76 }
							}
							news_event = { id = cityfall.2 }
						}
						else_if = {#Cervus
							limit = {
								NOT = { has_global_flag = fall_of_cervus_CHN }
								FROM.FROM = { state = 191 }
							}
							news_event = { id = cityfall.3 }
						}
						else_if = {#Sakara
							limit = {
								NOT = { has_global_flag = fall_of_sakara_CHN }
								FROM.FROM = { state = 194 }
							}
							news_event = { id = cityfall.4 }
						}
					}
					else_if = {
						limit = { FROM = { OR = { original_tag = EQS original_tag = NLR } } }
						if = {#Shire
							limit = {
								NOT = { has_global_flag = fall_of_shire_chn }
								FROM.FROM = { state = 132 }
							}
							news_event = { id = cityfall.7 }
						}
						else_if = {#Los Pegasus
							limit = {
								NOT = { has_global_flag = fall_of_lospegasus_chn }
								FROM.FROM = { state = 66 }
							}
							news_event = { id = cityfall.8 }
						}
						else_if = {#Vanhoover
							limit = {
								FROM.FROM = { state = 14 }
							}
							FROM.FROM = {
								set_state_flag = { flag = state_taken_chn_timeout value = 1 days = 60 }
							}
							if = {
								limit = { NOT = { has_global_flag = fall_of_vanhoover_chn } }
								news_event = { id = cityfall.13 }
							}
						}
						else_if = {#Tall Tales
							limit = {
								FROM.FROM = { state = 59 }
							}
							FROM.FROM = {
								set_state_flag = { flag = state_taken_chn_timeout value = 1 days = 60 }
							}
							if = {
								limit = { NOT = { has_global_flag = fall_of_tall_tales_chn } }
								news_event = { id = cityfall.19 }
							}
						}
						else_if = {#Acornage
							limit = {
								FROM.FROM = { state = 136 }
							}
							FROM.FROM = {
								set_state_flag = { flag = state_taken_chn_timeout value = 1 days = 60 }
							}
							if = {
								limit = { NOT = { has_global_flag = acornage_taken_chn } }
								FROM = { news_event = { id = cityfall.21 } }
							}
						}
						else_if = {#Baltimare
							limit = {
								NOT = { has_global_flag = fall_of_baltimare_chn }
								FROM.FROM = { state = 13 }
							}
							news_event = { id = cityfall.20 }
						}
					}
					else_if = {
						limit = { FROM = { original_tag = CRY } }
						if = {#Crystal City
							limit = {
								NOT = { has_global_flag = fall_of_crystal_chn }
								FROM.FROM = { state = 344 }
							}
							news_event = { id = cityfall.15 }
						}
					}
				}
				if = {#Manehattan
					limit = {
						FROM.FROM = { state = 75 }
					}
					if = {
						limit = {
							FROM = { OR = { original_tag = EQS original_tag = NLR } }
							tag = CHN
							NOT = { has_global_flag = fall_of_manehattan_chn }
						}
						news_event = { id = cityfall.9 }
					}
					else_if = {
						limit = {
							FROM = { original_tag = NLR }
							original_tag = EQS
							NOT = { has_global_flag = fall_of_manehattan_eqs }
						}
						news_event = { id = cityfall.18 }
					}
				}
				else_if = {#Canterlot
					limit = {
						FROM.FROM = { state = 3 }
						FROM = { original_tag = EQS }
					}
					if = {
						limit = {
							tag = NLR
							NOT = { has_global_flag = fall_of_canterlot_nlr }
						}
						news_event = { id = cityfall.10 }
					}
					else_if = {
						limit = {
							tag = STG
							NOT = { has_global_flag = fall_of_canterlot_stg }
						}
						news_event = { id = cityfall.12 }
					}
					else_if = {
						limit = {
							tag = CHN
							NOT = { has_global_flag = fall_of_canterlot_chn }
						}
						news_event = { id = cityfall.14 }
					}
					else_if = {
						limit = {
							original_tag = CRY
							has_government = fascism
							has_country_leader = { ruling_only = yes character = CRY_sombra }
							NOT = { has_global_flag = fall_of_canterlot_cry }
						}
						news_event = { id = cityfall.17 }
					}
				}
				else_if = {#Stalliongrad
					limit = {
						FROM.FROM = { state = 153 }
						FROM = { tag = STG }
					}
					if = {
						limit = {
							OR = { original_tag = EQS original_tag = NLR }
							NOT = { has_global_flag = fall_of_stalliongrad_eqs }
						}
						news_event = { id = cityfall.11 }
					}
					else_if = {
						limit = {
							tag = CHN
							NOT = { has_global_flag = fall_of_stalliongrad_chn }
						}
						news_event = { id = cityfall.16 }
					}
				}
				else_if = {#River City
					limit = {
						FROM.FROM = { state = 619 }
						NOT = { has_global_flag = fall_of_river_city }
					}
					news_event = { id = cityfall.5 }
				}
				else_if = {#Sunset
					limit = {
						FROM.FROM = { state = 356 }
						NOT = { has_global_flag = fall_of_sunset_city }
					}
					news_event = { id = cityfall.6 }
				}
				else_if = {#Hellquill
					limit = {
						FROM = { tag = HLQ }
						AND = {
							ROOT = { original_tag = DMT }
							OR = {
								ROOT = { has_government = fascism }
								ROOT = { has_government = communism }
							}
						}
						FROM.FROM = { state = 537 }
						NOT = { has_global_flag = fall_of_Hellquill_city }
					}
					ROOT = {
						country_event = { id = diamond_mountain.102 }
					}
				}
				else_if = {#Vesalipolis
					limit = {
						FROM.FROM = { state = 251 }
						NOT = { has_global_flag = fall_of_vesalipolis }
					}
					news_event = cityfall.25
					if = {
						limit = {
							FROM = {
								tag = CHN
							}
						}
						GRI = { country_event = changelingattache.14 }
					}
				}
				else_if = {#Yakistown
					limit = {
						FROM.FROM = { state = 11 }
						NOT = { has_global_flag = fall_of_yakistown }
					}
					news_event = cityfall.26
				}
				else_if = {#Vraks
					limit = {
						FROM.FROM = { state = 259 }
						NOT = { has_global_flag = fall_of_vraks }
					}
					news_event = cityfall.27
				}
				else_if = {#Weter
					limit = {
						FROM.FROM = { state = 243 }
						NOT = { has_global_flag = fall_of_weter }
					}
					news_event = cityfall.28
				}
				else_if = {#Griffenheim
					limit = {
						FROM.FROM = { state = 382 }
						NOT = { has_global_flag = fall_of_griffenheim }
					}
					news_event = cityfall.29
				}
				else_if = {#Griffonstone
					limit = {
						FROM.FROM = { state = 389 }
						NOT = { has_global_flag = fall_of_griffonstone }
					}
					news_event = cityfall.30
				}
				else_if = {#Aquila
					limit = {
						ROOT = {
							is_jer_country = no
						}
						FROM.FROM = { state = 377 }
						NOT = { has_global_flag = fall_of_aquila }
					}
					news_event = cityfall.31
				}
				else_if = {#Karthin
					limit = {
						FROM.FROM = { state = 371 }
						NOT = { has_global_flag = fall_of_karthin }
					}
					news_event = cityfall.32
				}
				else_if = {#Lake City
					limit = {
						FROM.FROM = { state = 387 }
						NOT = { has_global_flag = fall_of_lakecity }
					}
					news_event = cityfall.33
				}
				else_if = {#Skyfall
					limit = {
						FROM.FROM = { state = 381 }
						NOT = { has_global_flag = fall_of_skyfall }
					}
					news_event = cityfall.34
				}
				else_if = {#New Skynavia
					limit = {
						FROM.FROM = { state = 522 }
						NOT = { has_global_flag = fall_of_new_skynavia }
					}
					news_event = cityfall.35
				}
				else_if = {#Cloudbury
					limit = {
						FROM.FROM = { state = 485 }
						NOT = { has_global_flag = fall_of_cloudbury }
					}
					news_event = cityfall.36
				}
				else_if = {#Bronzecross
					limit = {
						FROM.FROM = { state = 492 }
						NOT = { has_global_flag = fall_of_bronzecross }
					}
					news_event = cityfall.37
				}
				else_if = {#Mount Aris
					limit = {
						FROM.FROM = { state = 1165 }
						NOT = { has_global_flag = fall_of_mount_aris }
					}
					news_event = cityfall.38
				}
				else_if = {#Colthage
					limit = {
						FROM.FROM = { state = 875 }
						NOT = { has_global_flag = fall_of_colthage }
						ROOT = {
							NOT = {
								original_tag = CTH
							}
						}
					}
					news_event = cityfall.39
				}
				else_if = {#New Ayacachtli
					limit = {
						FROM.FROM = { state = 712 }
						NOT = { has_global_flag = fall_of_new_ayacachtli }
					}
					news_event = cityfall.40
				}
				else_if = { ## the ELF liberates Manehattan ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 75 }
						NOT = { has_global_flag = ELF_liberation_of_manehattan }
					}
					ROOT = { news_event = cityfall.300 }
				}
				else_if = { ## the ELF liberates Fillydelphia ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 12 }
						NOT = { has_global_flag = ELF_liberation_of_fillydelphia }
					}
					ROOT = { news_event = cityfall.301 }
				}
				else_if = { ## the ELF liberates Whinnyapolis ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 70 }
						NOT = { has_global_flag = ELF_liberation_of_whinnyapolis }
					}
					ROOT = { news_event = cityfall.302 }
				}
				else_if = { ## the ELF liberates Bales ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 74 }
						NOT = { has_global_flag = ELF_liberation_of_bales }
					}
					ROOT = { news_event = cityfall.303 }
				}
				else_if = { ## the ELF liberates Baltimare ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
								AND = { 
									original_tag = BAL
									BAL = { is_subject_of = CHN }
								}
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 13 }
						NOT = { has_global_flag = ELF_liberation_of_baltimare }
					}
					ROOT = { news_event = cityfall.304 }
				}
				else_if = { ## the ELF liberates Canterlot ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 3 }
						NOT = { has_global_flag = ELF_liberation_of_canterlot }
					}
					ROOT = { news_event = cityfall.305 }
				}
				else_if = { ## the ELF liberates Appleloosa ##
					limit = {
						FROM = {
							OR = {
								original_tag = CHN 
								original_tag = MAN
								AND = { 
									original_tag = SCS
									SCS = { is_subject_of = CHN }
								}
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 21 }
						NOT = { has_global_flag = ELF_liberation_of_appleloosa }
					}
					ROOT = { news_event = cityfall.306 }
				}
				else_if = { ## the ELF liberates Las Pegasus ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 66 }
						NOT = { has_global_flag = ELF_liberation_of_laspegasus }
					}
					ROOT = { news_event = cityfall.307 }
				}
				else_if = { ## the ELF liberates Ponyville ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 2 }
						NOT = { has_global_flag = ELF_liberation_of_ponyville }
					}
					ROOT = { news_event = cityfall.308 }
				}
				else_if = { ## the ELF liberates Vanhoover ##
					limit = {
						FROM = { 
							OR = { 
								original_tag = CHN 
								original_tag = MAN
							}
						}
						ROOT = { original_tag = ELF }
						FROM.FROM = { state = 14 }
						NOT = { has_global_flag = ELF_liberation_of_vanhoover }
					}
					ROOT = { news_event = cityfall.309 }
				} ## Tall Tale and Rockville omitted ##
				else_if = { ## CHN takes Two Sisters Castle during ZRS uprising ##
					limit = {
						FROM = { original_tag = ZRS }
						ROOT = { 
							original_tag = CHN 
							has_country_flag = CHN_ZRS_uprising_has_happened
						}
						FROM.FROM = { state = 5 }
						NOT = { has_global_flag = CHN_conquest_of_two_sisters_castle }
						NOT = { has_global_flag = CHN_ZRS_everfree_not_tamed }
					}
					ROOT = { news_event = cityfall.310 }
				}
				else_if = {#Vermilion
					limit = {
						FROM.FROM = { state = 1059 }
						NOT = { has_global_flag = fall_of_vermilion }
					}
					news_event = cityfall.50
				}
				else_if = {#Fragrance
					limit = {
						FROM.FROM = { state = 1071 }
						NOT = { has_global_flag = fall_of_fragrance }
					}
					news_event = cityfall.51
				}
				else_if = {#Verdant
					limit = {
						FROM.FROM = { state = 1073 }
						NOT = { has_global_flag = fall_of_verdant }
					}
					news_event = cityfall.52
				}
			}
		}
	}

	#FROM is country getting invited.
	on_offer_join_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_offer_join_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_government = communism
					FROM = {
						has_idea = LCT_anti_commie_pact
					}
				}
				FROM = {
					remove_ideas = LCT_anti_commie_pact
				}
			}
			if = {
				limit = {
					original_tag = HIP
				}
				FROM = {
					add_ai_strategy = {
						id = "HIP"
						type = alliance
						value = 100
					}
				}
			}
			if = {
				limit = {
					original_tag = MIT
					has_completed_focus = MIT_SIC_assistance
				}
				FROM = {
					add_to_tech_sharing_group = MIT_research_group
				}
			}
			if = {
				limit = {
					original_tag = MIT
					has_completed_focus = MIT_command_council
				}
				FROM = {
					add_ideas = MIT_command_council_idea
				}
			}
			if = {
				limit = {
					TBK = {
                        original_tag = TBK
                        has_government = democratic
                        has_country_leader = {
                            character = TBK_wallnut_drive
                            ruling_only = yes
                        }
                    }
				}
				clear_variable = TBK.TBK_hazrumenia_members 
				for_each_scope_loop = {
    				array = faction_members
   					 if = {
       					limit = {
            				OR = {
								original_tag = TBK
								original_tag = WAR
								original_tag = ZAR
								original_tag = ZUM
							}
        				}
						add_to_variable = { TBK.TBK_hazrumenia_members = 1 }
    				}
				}
				clamp_variable = { var = TBK.TBK_hazrumenia_members min = 1 max = 4 }
				for_each_scope_loop = {
    				array = faction_members
   					if = {
       					limit = {
							is_in_faction_with = TBK
							TBK = {
								has_government = democratic
								has_country_leader = {
									character = TBK_wallnut_drive
									ruling_only = yes
								}
							}
            				OR = {
								original_tag = WAR
								original_tag = ZAR
								original_tag = ZUM
							}
        				}
						if = {
							limit = {
								TBK = {
									has_completed_focus = TBK_harmony_alliance_internal_development
								}
								NOT = {
									has_dynamic_modifier = {
										modifier = TBK_great_hazrumenian_family
									}
								}
							}
							add_dynamic_modifier = {
								modifier = TBK_great_hazrumenian_family
							}
						}
						if = {
							limit = {
								TBK = {
									has_completed_focus = TBK_harmony_alliance_economy
								}
								NOT = {
									has_dynamic_modifier = {
										modifier = TBK_hazrumenian_economic_cooperation
									}
								}
							}
							add_dynamic_modifier = {
								modifier = TBK_hazrumenian_economic_cooperation
							}
						}
						TBK_apply_hazrumenia_family_modifier_values = yes
						TBK_apply_hazrumenia_economic_cooperation_modifier_values = yes
    				}
				}
			}
			FROM = { update_global_arrays = yes }
		}
	}

	#FROM is faction leader on join faction requests. THIS DOES NOT FIRE ON ADD_TO_FACTION EFFECT! USE ON_OFFER_JOIN_FACTION!
	on_join_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_join_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					has_idea = LCT_anti_commie_pact
					FROM = {
						has_government = communism
					}
				}
				remove_ideas = LCT_anti_commie_pact
			}
			if = {
				limit = {
					FROM = { is_river_fed_member = yes }
					NOT = { tag = HLQ }
					HLQ = { has_idea = HLQ_honourary_member }
				}
				diplomatic_relation = {
					country = HLQ
					relation = non_aggression_pact
					active = yes
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = HIP
					}
				}
				add_ai_strategy = {
					id = "HIP"
					type = alliance
					value = 100
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_SIC_assistance
					}
				}
				add_to_tech_sharing_group = MIT_research_group
			}
			if = {
				limit = {
					NOT = {
						has_idea = MIT_command_council_idea
					}
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_command_council
						NOT = {
							has_completed_focus = MIT_coalition_exchange_students
						}
					}
				}
				add_ideas = MIT_command_council_idea
			}
			if = {
				limit = {
					NOT = { has_idea = MIT_command_council_idea }
					NOT = { has_idea = MIT_command_council_idea2 }
					FROM = {
						original_tag = MIT
						has_completed_focus = MIT_coalition_exchange_students
					}
				}
				add_ideas = MIT_command_council_idea2
			}
			update_global_arrays = yes
		}
	}

	# ROOT is country, this is ran for every country
	on_daily = {
		effect = {
			if = {
				limit = {
					has_military_access_to = ROOT
				}
				diplomatic_relation = { country = ROOT relation = military_access active = no }
			}
			if = {
				limit = {
					has_guaranteed = ROOT
				}
				diplomatic_relation = { country = ROOT relation = guarantee active = no }
			}
			update_global_arrays = yes
			adjust_research_modifier = yes
			daily_fix_weapon_techs = yes
			if = {
				limit = {
					NOT = { has_global_flag = river_federation_founded }
					is_river_fed_member = yes
					is_faction_leader = yes
					any_allied_country = {
						has_capitulated = no
					}
					NOT = { has_idea = RIV_leader_surrender_bonus }
				}
				add_ideas = RIV_leader_surrender_bonus
			}
			if = {
				limit = { has_idea = GRF_got_mercs_delayed }
				add_to_variable = { delayed_merc_payment_GRF = 1 }
			}
			if = {
				limit = { has_idea = TRD_got_mercs_delayed }
				add_to_variable = { delayed_merc_payment_TRD = 1 }
			}
			if = {
				limit = {
					has_tech = nukes
				}
				if = {
					limit = {
						has_idea = no_crystals_reactor_prevent
						check_variable = { resource@crystals > -1 }
					}
					remove_ideas = no_crystals_reactor_prevent
				}
				else_if = {
					limit = { check_variable = { resource@crystals < 0 } }
					add_ideas = no_crystals_reactor_prevent
				}
				if = {
					limit = {
						NOT = { has_global_flag = first_nuke_done }
						num_of_nukes > 0.99
					}
					news_event = { id = nuke_first.1 days = 1 }
					set_global_flag = first_nuke_done
				}
			}
			if = {
				limit = {
					OR = {
						NOT = { has_event_target = griffonian_empire }
						if = {
							limit = { has_event_target = griffonian_empire }
							event_target:griffonian_empire = { exists = no }
						}
					}
					exists = yes
					OR = {
						AND = {
							owns_state = 382
							has_cosmetic_tag = GRIF_EMPIRE
						}
						if = {
							limit = {
								382 = {
									owner = { NOT = { has_cosmetic_tag = GRIF_EMPIRE } }
								}
							}
							tag = GRI
						}
					}
				}
				save_global_event_target_as = griffonian_empire
				set_variable = { global.griffonian_empire_var = THIS }
			}
			if = {
				limit = {
					NOT = { has_event_target = longsword }
					exists = yes
					OR = {
						original_tag = LNS
						original_tag = LSM
						original_tag = LSC
					}
				}
				save_global_event_target_as = longsword
			}
			if = {
				limit = {
					OR = {
						NOT = { has_event_target = equestria }
						AND = {
							has_event_target = equestria
							event_target:equestria = {
								NOT = {
									original_tag = EQS
									original_tag = ELF
									original_tag = SOL
								}
							}
						}
					}
				}
				if = {
					limit = {
						has_event_target = solar_empire
						event_target:solar_empire = { exists = yes has_government = fascism }
					}
					SOL = { save_global_event_target_as = equestria }
				}
				else_if = {
					limit = {
						ELF = {
							exists = yes
							has_completed_focus = ELF_middle_4
						}
					}
					ELF = { save_global_event_target_as = equestria }
				}
				else = {
					EQS = { save_global_event_target_as = equestria }
				}
			}
			if = {
				limit = {
					original_tag = EQS
					tag = event_target:solar_empire
					OR = {
						is_subject = yes
						NOT = { has_government = fascism }
					}
				}
				kill_ideology_leader = fascism
				if = {
					limit = { event_target:equestria = { exists = no } }
					save_global_event_target_as = equestria
				}
				SOL = { save_global_event_target_as = solar_empire }
				country_event = { id = solarempire.1018 }
			}
			else_if = {
				limit = {
					tag = CHN
					NOT = { has_idea = CHN_operation_river_idea }
					has_tech = CHN_operation_river_tech
				}
				hidden_effect = {
					set_technology = {
						popup = no
						CHN_operation_river_tech = 0
					}
				}
			}
			else_if = {
                limit = { 
					tag = BAL
					has_country_flag = is_changeling_puppet						
				}
				get_BAL_PRO_no_recruits = yes
				get_BAL_PRO_resistance = yes
				get_BAL_PRO_natives = yes
				if = {
					limit = { 
						has_country_flag = BAL_PRO_blood_cult					
					}
					get_BAL_PRO_cults = yes
				}
			}
			else_if = {
				limit = {
					original_tag = MAN
				}
				if = {
					limit = { 
						has_country_flag = MAN_unlocked_dynamic_modifier_flag	
					}
					set_temp_variable = { MAN_dynamic_modifier_central_variable_TEMP = MAN_lovetax_variable }
					divide_temp_variable = { MAN_dynamic_modifier_central_variable_TEMP = 100 }
					set_variable = { MAN_dynamic_modifier_central_variable = MAN_dynamic_modifier_central_variable_TEMP }
					if = {
						limit = {
							check_variable = {
								var = MAN_dynamic_modifier_central_variable
								value = 0.5
								compare = less_than_or_equals
							}
						}
						set_variable = { MAN_dynamic_modifier_central_variable_final = MAN_dynamic_modifier_central_variable }
					}
					else = {
						set_variable = { MAN_dynamic_modifier_central_variable_final = 0.5 }
					}
				}
				if = {
					limit = { 
						has_country_flag = MAN_continuous_love_distribution_country_flag	
					}
					subtract_from_variable = { var = MAN_lovetax_variable value = 0.005 }
				}
			}
			else_if = {
				limit = {
					original_tag = CHN
				}
				if = { ### Changeling Division Limiter-cum-Love Consumption Mechanic ###
					limit = {
						has_completed_focus = CHN_post_war_5
					}
					### State Total (S) :  [ directly-controlled non-core states + (indirectly-controlled states / 2) ]
					set_temp_variable = { CHN_weekly_love_gain_state_var_TEMP = CHN.num_of_controlled_states }
					subtract_from_temp_variable = { CHN_weekly_love_gain_state_var_TEMP = CHN.num_core_states }
					set_variable = { CHN_directly_controlled_noncorestates_var = CHN_weekly_love_gain_state_var_TEMP }
					set_temp_variable = { CHN_weekly_love_gain_state_PUPPETS_var_TEMP = 0 }
					for_each_scope_loop = { 
						array = subjects 
						add_to_temp_variable = { PREV.CHN_weekly_love_gain_state_PUPPETS_var_TEMP = num_controlled_states } 
					}
					set_variable = { CHN_weekly_love_gain_state_PUPPETS_var = CHN_weekly_love_gain_state_PUPPETS_var_TEMP }
					divide_temp_variable = { CHN_weekly_love_gain_state_PUPPETS_var_TEMP = 2 }
					add_to_temp_variable = { CHN_weekly_love_gain_state_var_TEMP = CHN_weekly_love_gain_state_PUPPETS_var_TEMP }
					set_variable = { CHN_weekly_love_gain_state_var = CHN_weekly_love_gain_state_var_TEMP }
					### The above gives us (S)
					set_temp_variable = { CHN_amount_of_allowed_battalions_TEMP = CHN_weekly_love_gain_state_var }
					add_to_temp_variable = { CHN_amount_of_allowed_battalions_TEMP = 10 } ### base of 10 states
					multiply_temp_variable = { CHN_amount_of_allowed_battalions_TEMP = 10 } ### 10 Battalions for each State
					if = {
						limit = {
							has_idea = CHN_billeting_system
						}
						multiply_temp_variable = { CHN_amount_of_allowed_battalions_TEMP = 1.15 } ## +15% bonus from focus-unlocked idea ##
					}
					set_variable = { CHN_amount_of_allowed_battalions = CHN_amount_of_allowed_battalions_TEMP }
					round_variable = CHN_amount_of_allowed_battalions
					### ( ( 10 + (S) ) x 10 ) = Amount of Battalions allowed for Free ###
					set_variable = { CHN_excess_battalions = 0 } 
					set_variable = { CHN_excess_battalions_cost = 0 }
					if = {
						limit = {
							check_variable = { CHN_amount_of_allowed_battalions < CHN.num_battalions } ### if battalions exceed carrying capacity
						}
						set_temp_variable = { CHN_excess_battalions_TEMP = CHN.num_battalions }
						subtract_from_temp_variable = { CHN_excess_battalions_TEMP = CHN_amount_of_allowed_battalions }
						add_to_variable = { CHN_excess_battalions = CHN_excess_battalions_TEMP } ### total amount of excess battalions
						set_temp_variable = { CHN_excess_battalions_cost_TEMP = CHN_excess_battalions }
						multiply_temp_variable = { CHN_excess_battalions_cost_TEMP = 0.001 } ### extra Love cost of 0.001 erots per battalion 
						add_to_variable = { CHN_excess_battalions_cost = CHN_excess_battalions_cost_TEMP } ### total cost of excess battalions
					} ### and then on_weekly to subtract Love cost from above, and a dynamic modifier that penalises having negative Love
				}
				if = {
					limit = {
						check_variable = { CHN_love_variable < 0 }
					}
					set_temp_variable = { CHN_penalty_from_love_deficit_var_TEMP = CHN_love_variable }
					divide_temp_variable = { CHN_penalty_from_love_deficit_var_TEMP = 4 }
					set_variable = { CHN_penalty_from_love_deficit_var = CHN_penalty_from_love_deficit_var_TEMP }
					clamp_variable = {
						var = CHN_penalty_from_love_deficit_var
						min = -1.50
						max = 0
					}
					add_dynamic_modifier = { modifier = CHN_love_deficit_dynamic_modifier }
				}
				if = {
					limit = {
						has_country_flag = CHN_continuous_love_harvesting_flag
					}
					set_temp_variable = { CHN_continuous_love_harvesting_LOVE_var_TEMP = CHN_weekly_love_gain_state_var }
					divide_temp_variable = { CHN_continuous_love_harvesting_LOVE_var_TEMP = 20000 } ## that is, multiply by 0.005% ##
					### Average Resistance Level Calculations ###
					set_variable = { CHN_number_of_states_under_occupation_var = 0 }
					set_variable = { CHN_resistance_level_of_number_of_states_under_occupation_var = 0 }
					for_each_scope_loop = {
						array = controlled_states
						add_to_variable = { PREV.CHN_number_of_states_under_occupation_var = 1 } 
						add_to_variable = { PREV.CHN_resistance_level_of_number_of_states_under_occupation_var = THIS.resistance } 
					}
					subtract_from_variable = { CHN_number_of_states_under_occupation_var = CHN.num_core_states }
					set_temp_variable = { CHN_number_of_states_under_occupation_var_TEMP = CHN_number_of_states_under_occupation_var }
					set_temp_variable = { CHN_resistance_level_of_number_of_states_under_occupation_var_TEMP = CHN_resistance_level_of_number_of_states_under_occupation_var }
					divide_temp_variable = { CHN_resistance_level_of_number_of_states_under_occupation_var_TEMP = CHN_number_of_states_under_occupation_var_TEMP }
					set_variable = { CHN_average_resistance_level_of_states_under_occupation_var = CHN_resistance_level_of_number_of_states_under_occupation_var_TEMP }
					set_variable = { CHN_average_resistance_level_100_TEMP = 100 }
					subtract_from_variable = { CHN_average_resistance_level_100_TEMP = CHN_average_resistance_level_of_states_under_occupation_var }
					divide_variable = { CHN_average_resistance_level_100_TEMP = 100 } ## change to percentage ##
					set_variable = { CHN_average_resistance_level_of_states_under_occupation_var_TEMP = CHN_average_resistance_level_100_TEMP }
					###
					multiply_temp_variable = { CHN_continuous_love_harvesting_LOVE_var_TEMP = CHN_average_resistance_level_of_states_under_occupation_var_TEMP }
					if = {
						limit = {
							has_idea = CHN_love_refineries
						}
						multiply_temp_variable = { CHN_continuous_love_harvesting_LOVE_var_TEMP = 1.25 } ## +25% bonus from focus-unlocked idea ##
					}
					set_variable = { CHN_continuous_love_harvesting_LOVE_var = CHN_continuous_love_harvesting_LOVE_var_TEMP }
					add_to_variable = { var = CHN_love_variable value = CHN_continuous_love_harvesting_LOVE_var }
				}
				if = {
					limit = {
						has_country_flag = CHN_acquired_pony_slave_dynamic_modifier
					}
					set_temp_variable = { CHN_acquired_pony_slave_dynamic_modifier_var_TEMP = CHN.core_compliance@EQS }
					divide_temp_variable = { CHN_acquired_pony_slave_dynamic_modifier_var_TEMP = 1000 }
					set_variable = { CHN_acquired_pony_slave_dynamic_modifier_var = CHN_acquired_pony_slave_dynamic_modifier_var_TEMP }
				}
				if = {
					limit = {
						has_global_flag = ZRS_uprising_has_happened
						has_global_flag = CHN_ZRS_everfree_not_tamed
						has_active_mission = CHN_chaos_in_the_everfree_ticking_mission
					}
					if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 0 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3768 }
							}
						}
						ZRS = { set_province_controller = 3768 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 1 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 776 }
							}
						}
						ZRS = { set_province_controller = 776 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 2 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6631 }
							}
						}
						ZRS = { set_province_controller = 6631 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 3 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 603 }
							}
						}
						ZRS = { set_province_controller = 603 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 4 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3598 }
							}
						}
						ZRS = { set_province_controller = 3598 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 5 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11723 }
							}
						}
						ZRS = { set_province_controller = 11723 }
						CHN_up_the_ante_set_1 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 6 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11521 }
							}
						}
						ZRS = { set_province_controller = 11521 }
						CHN_up_the_ante_set_1 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 7 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 539 }
							}
						}
						ZRS = { set_province_controller = 539 }
						CHN_up_the_ante_set_1 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 8 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3604 }
							}
						}
						ZRS = { set_province_controller = 3604 }
						CHN_up_the_ante_set_1 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 9 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9598 }
							}
						}
						ZRS = { set_province_controller = 9598 }
						CHN_up_the_ante_set_1 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 10 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11570 }
							}
						}
						ZRS = { set_province_controller = 11570 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 11 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 762 }
							}
						}
						ZRS = { set_province_controller = 762 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 12 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11869 }
							}
						}
						ZRS = { set_province_controller = 11869 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 13 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 12169 }
							}
						}
						ZRS = { set_province_controller = 12169 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 14 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6651 }
							}
						}
						ZRS = { set_province_controller = 6651 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 15 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3549 }
							}
						}
						ZRS = { set_province_controller = 3549 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 16 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6547 }
							}
						}
						ZRS = { set_province_controller = 6547 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 17 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6644 }
							}
						}
						ZRS = { set_province_controller = 6644 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 18 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3493 }
							}
						}
						ZRS = { set_province_controller = 3493 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 19 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3741 }
							}
						}
						ZRS = { set_province_controller = 3741 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 20 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6747 }
							}
						}
						ZRS = { set_province_controller = 6747 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 21 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9745 }
							}
						}
						ZRS = { set_province_controller = 9745 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 22 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 764 }
							}
						}
						ZRS = { set_province_controller = 764 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 23 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11463 }
							}
						}
						ZRS = { set_province_controller = 11463 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 24 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9495 }
							}
						}
						ZRS = { set_province_controller = 9495 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 25 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 743 }
							}
						}
						ZRS = { set_province_controller = 743 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 26 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6777 }
							}
						}
						ZRS = { set_province_controller = 6777 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 27 } }
						327 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 929 }
							}
						}
						ZRS = { set_province_controller = 929 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 28 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11833 }
							}
						}
						ZRS = { set_province_controller = 11833 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 29 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11734 }
							}
						}
						ZRS = { set_province_controller = 11734 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 30 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 1616 }
							}
						}
						ZRS = { set_province_controller = 1616 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 31 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 780 }
							}
						}
						ZRS = { set_province_controller = 780 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 32 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6946 }
							}
						}
						ZRS = { set_province_controller = 6946 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 33 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9741 } ## ponyville ##
							}
						}
						ZRS = { set_province_controller = 9741 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						country_event = { id = changelings_paxchrysalia.412 hours = 2 }
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 34 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 620 }
							}
						}
						ZRS = { set_province_controller = 620 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 35 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9751 }
							}
						}
						ZRS = { set_province_controller = 9751 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 36 } }
						106 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6688 }
							}
						}
						ZRS = { set_province_controller = 6688 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 37 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3976 }
							}
						}
						ZRS = { set_province_controller = 3976 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 38 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 669 }
							}
						}
						ZRS = { set_province_controller = 669 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 39 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 651 }
							}
						}
						ZRS = { set_province_controller = 651 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 40 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11631 }
							}
						}
						ZRS = { set_province_controller = 11631 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 41 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9622 }
							}
						}
						ZRS = { set_province_controller = 9622 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 42 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 13124 }
							}
						}
						ZRS = { set_province_controller = 13124 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 43 } }
						2 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11655 }
							}
						}
						ZRS = { set_province_controller = 11655 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 44 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6789 }
							}
						}
						ZRS = { set_province_controller = 6789 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 45 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 641 }
							}
						}
						ZRS = { set_province_controller = 641 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 46 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9590 }
							}
						}
						ZRS = { set_province_controller = 9590 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 47 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9752 }
							}
						}
						ZRS = { set_province_controller = 9752 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 48 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3770 }
							}
						}
						ZRS = { set_province_controller = 3770 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 49 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11628 }
							}
						}
						ZRS = { set_province_controller = 11628 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 50 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 771 }
							}
						}
						ZRS = { set_province_controller = 771 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 51 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6973 }
							}
						}
						ZRS = { set_province_controller = 6973 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 52 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9507 }
							}
						}
						ZRS = { set_province_controller = 9507 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 53 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11726 }
							}
						}
						ZRS = { set_province_controller = 11726 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 54 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3772 }
							}
						}
						ZRS = { set_province_controller = 3772 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 55 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6195 }
							}
						}
						ZRS = { set_province_controller = 6195 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 56 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9478 }
							}
						}
						ZRS = { set_province_controller = 9478 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 57 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 9492 }
							}
						}
						ZRS = { set_province_controller = 9492 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 58 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 3671 }
							}
						}
						ZRS = { set_province_controller = 3671 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						CHN_up_the_ante_set_12 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 59 } }
						65 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11596 }
							}
						}
						ZRS = { set_province_controller = 11596 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						CHN_up_the_ante_set_12 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					} 
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 60 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 6985 }
							}
						}
						ZRS = { set_province_controller = 6985 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						CHN_up_the_ante_set_12 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 61 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11276 }
							}
						}
						ZRS = { set_province_controller = 11276 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						CHN_up_the_ante_set_12 = yes
						add_to_variable = { var = CHN_chaos_in_the_everfree_days_elapsed_var value = 1 }
					}
					else_if = {
						limit = { check_variable = { CHN_chaos_in_the_everfree_days_elapsed_var = 62 } }
						97 = {
							add_province_modifier = {
								static_modifiers = { old_dragon_gardens }
								province = { id = 11568 }
							}
						}
						ZRS = { set_province_controller = 11568 }
						CHN_up_the_ante_set_1 = yes
						CHN_up_the_ante_set_2 = yes
						CHN_up_the_ante_set_3 = yes
						CHN_up_the_ante_set_4 = yes
						CHN_up_the_ante_set_5 = yes
						CHN_up_the_ante_set_6 = yes
						CHN_up_the_ante_set_7 = yes
						CHN_up_the_ante_set_8 = yes
						CHN_up_the_ante_set_9 = yes
						CHN_up_the_ante_set_10 = yes
						CHN_up_the_ante_set_11 = yes
						CHN_up_the_ante_set_12 = yes
					}
					## end ##
				}
			}
			else_if = {
				limit = {
					original_tag = ZRS
					has_war_with = CHN
				}
				if = {
					limit = {
						CHN = {
							NOT = {
								has_country_flag = CHN_everfree_thoroughly_defeated_decision_check_flag
							}
						}
					}
					ZRS = {
						set_state_controller = 1
						set_state_controller = 5
					}
				}
				else_if = {
					limit = {
						CHN = {
							has_country_flag = CHN_everfree_thoroughly_defeated_decision_check_flag
						}
					}
					ZRS = {
						random_list = {
							1 = { set_state_controller = 1 }
							2 = { }
						}
						random_list = {
							1 = { set_state_controller = 5 }
							2 = { }
						}
					}
				}
			}
			if = {
				limit = {
					original_tag = JER
					has_dynamic_modifier = {
						modifier = JER_stability_weekly_mod
					}
					is_subject = no
					has_stability < 0.6
					NOT = {
			            has_country_flag = JER_no_assembly
			        }
				}
				update_JER_stability_weekly_mod = yes
			}
			#if = {
			#	limit = {
			#		SRS = {
			#			exists = yes
			#			is_subject = no
			#			has_government = communism
			#			NOT = { has_country_flag = SRS_turned_into_the_PGSC }
			#		}
			#	}
			#	set_variable = { total_sum_of_internationalist_and_communalist_displeasure = 0 }
			#   add_to_variable = { total_sum_of_internationalist_and_communalist_displeasure = displeasure_towards_communards_var }
			#   add_to_variable = { total_sum_of_internationalist_and_communalist_displeasure = displeasure_towards_internationalists_var }
			#   set_temp_variable = { internationalist_displeasure_as_a_percentage_ersatz = displeasure_towards_internationalists_var }
			#   divide_temp_variable = { internationalist_displeasure_as_a_percentage_ersatz = total_sum_of_internationalist_and_communalist_displeasure }
			#   set_variable = { internationalist_displeasure_as_a_percentage = internationalist_displeasure_as_a_percentage_ersatz }
			#   set_temp_variable = { communalist_displeasure_as_a_percentage_ersatz = displeasure_towards_communards_var }
			#   divide_temp_variable = { communalist_displeasure_as_a_percentage_ersatz = total_sum_of_internationalist_and_communalist_displeasure }
			#   set_variable = { communalist_displeasure_as_a_percentage = communalist_displeasure_as_a_percentage_ersatz }
			#}
			if = {
				limit = {
					tag = BAT
					has_country_flag = BAT_resistance_enabled
					OR = {
						has_completed_focus = BAT_special_zones
						has_completed_focus = BAT_special_zones_2
					}
				}
				if = {
					limit = {
						has_country_flag = BAT_tobuck_alive
					}
					for_each_scope_loop = {
						array = WAR.core_states
						if = {
							limit = {
								is_controlled_by = ROOT
								has_resistance = yes
								occupation_law = BAT_local_commissariat
							}
							ROOT = {
								add_to_variable = {
									BAT_tobuck_intel = 0.05
								}
							}
						}
					}
					for_each_scope_loop = {
						array = ZUM.core_states
						if = {
							limit = {
								is_controlled_by = ROOT
								has_resistance = yes
								occupation_law = BAT_local_commissariat
							}
							ROOT = {
								add_to_variable = {
									BAT_tobuck_intel = 0.05
								}
							}
						}
					}
				}
				if = {
					limit = {
						has_country_flag = BAT_zarantia_alive
					}
					for_each_scope_loop = {
						array = ZAR.core_states
						if = {
							limit = {
								is_controlled_by = ROOT
								has_resistance = yes
								occupation_law = BAT_local_commissariat
							}
							ROOT = {
								add_to_variable = {
									BAT_zarantia_intel = 0.05
								}
							}
						}
					}
				}
				if = {
					limit = {
						has_country_flag = BAT_slave_alive
					}
					for_each_scope_loop = {
						array = TBK.core_states
						if = {
							limit = {
								is_controlled_by = ROOT
								has_resistance = yes
								occupation_law = BAT_local_commissariat
							}
							ROOT = {
								add_to_variable = {
									BAT_slave_intel = 0.05
								}
							}
						}
					}
				}
				calculate_intel_levels = yes
			}
			else_if = {
				limit = {
					original_tag = CTH
					has_country_flag = CTH_limited_CGI_war_flag
					has_war_with = CGI
					CGI = {
						surrender_progress > 0.29
					}
				}
				country_event = colthage_other.8
			}
			if = {
			    limit = { 
					tag = OLV
                    has_country_flag = OLV_character_creation_finished						
				}
				get_OLV_warriors_idea = yes
				get_OLV_commoners_idea = yes
                get_OLV_noble_idea = yes
			}
			
			if = {
				limit = {
					tag = ZES
				}
				if = {
					limit = {
						OR = {
							559 = { is_owned_and_controlled_by = ROOT }
							599 = { is_owned_and_controlled_by = ROOT }
							600 = { is_owned_and_controlled_by = ROOT }
							512 = { is_owned_and_controlled_by = ROOT }
							514 = { is_owned_and_controlled_by = ROOT }
							630 = { is_owned_and_controlled_by = ROOT }
							594 = { is_owned_and_controlled_by = ROOT }
							595 = { is_owned_and_controlled_by = ROOT }
							623 = { is_owned_and_controlled_by = ROOT }
						}
					}
					country_event = { id = kasa.85 days = 85 random_hours = 120 }
				}
				if = {
					limit = {
						has_idea = modern_society
						has_idea = proper_science_base
					}
					country_event = { id = kasa.91 days = 65 random_hours = 200 }
				}
			}
			if = {
				limit = {
					OR = {
						is_in_faction_with = JER
						is_subject_of = JER	
					}
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_joint_research_effort
						}
						NOT = {
							is_in_tech_sharing_group = JER_research_group 
						}	
					}
					add_to_tech_sharing_group = JER_research_group
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_pan_socialist_science_committee
						}
						NOT = {
							is_in_tech_sharing_group = JER_research_group_2 
						}	
					}
					add_to_tech_sharing_group = JER_research_group_2
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_permenant_transport_ties
						}
						NOT = {
							has_idea = JER_permenant_transport_ties_idea
						}		
					}
					add_ideas = JER_permenant_transport_ties_idea
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_no_tarrifs
						}
						NOT = {
							has_idea = JER_no_tarrifs_idea
						}	
					}
					add_ideas = JER_no_tarrifs_idea
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_joint_nuclear_research
						}
						NOT = {
							has_idea = JER_joint_nuclear_research_idea
						}	
					}
					add_ideas = JER_joint_nuclear_research_idea
				}
				if = {
					limit = { 
						JER = {
							has_completed_focus = JER_bind_the_economies
						}
						is_subject_of = JER	
						NOT = {
							has_idea = JER_bind_the_economies_idea
						}
					}
					add_ideas = JER_bind_the_economies_idea
				}
			}
			else_if = {
                limit = { 
					EQC = {
                        has_completed_focus = EQC_economic_exploitation
					}
					is_subject_of = EQC	
                    NOT = {
						has_idea = EQC_economic_exploitation_idea
                    }	
			    }
				add_ideas = EQC_economic_exploitation_idea
            }
			if = {
                limit = { 
					CVA = {
                        has_completed_focus = CVA_CTH_2_i3
					}
					OR = {
					    is_subject_of = CVA
						is_in_faction_with = CVA
					}
                    NOT = {
						has_idea = CVA_CTH_mutual_assistance_fund
                    }	
			    }
				add_ideas = CVA_CTH_mutual_assistance_fund
            }
			if = {
                limit = { 
					CVA = {
                        has_completed_focus = CVA_CTH_2_i5
					}
					OR = {
						is_in_faction_with = CVA
						is_subject_of = CVA	
					}
					NOT = {
						is_in_tech_sharing_group = CVA_CTH_research_group 
                    }	
			    }
				add_to_tech_sharing_group = CVA_CTH_research_group
            }
		}
	}

	# country
	on_new_term_election = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_new_term_election"
			### Lake City ###
			if = {
				limit = { tag = LCT }
				country_event = { id = lakecity.9 }
				country_event = { id = lakecity.901 }
				country_event = { id = lakecity.902 }
			}
			### Puerto Caballo ###
			#else_if = {
			#	limit = { tag = PCB }
			#	country_event = { id = caballo.20 }
			#}
			### Bronzehill ###
			else_if = {
				limit = { tag = BRZ }
				country_event = { id = bronzehill_election_event.3 }
			}
			else_if = {
				limit = { 
					tag = CTH 
				}
				if = {
					limit = {
						has_country_flag = CTH_colthage_zarcaid
					}
					country_event = { id = colthage_other.57 }
				}
				else_if = {
					limit = {
						OR = {
							has_country_flag = CTH_colthage_constitutionalist
							has_country_flag = CTH_colthage_harmonite
						}
					}
					country_event = { id = colthage_other.139 }
				}
			}
		}
	}

	#ROOT is subject FROM is overlord
	on_subject_autonomy_level_change = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_subject_autonomy_level_change FROM = [From.GetName]"
			#Add to Equestria tech group
			if = {
				limit = {
					FROM = {
						original_tag = EQS
						is_in_tech_sharing_group = equestrian_research
					}
				}
				add_to_tech_sharing_group = equestrian_research
			}

			if = {
				limit = {
					overlord = {
						has_country_flag = river_federation_founder
					}
					OR = {
						has_autonomy_state = autonomy_integrated_puppet
						has_autonomy_state = autonomy_reichskommissariat
					}
					is_river_fed_member = yes
					NOT = {
						has_idea = RIV_river_union_member1
						has_idea = RIV_river_union_member2
					}
				}
				remove_ideas = {
					RIV_member_state
					RIV_rcsc_member
					RIV_rec_member1
					RIV_rec_member2
					RIV_rec_member3
					RIV_rec_member4
				}
				add_ideas = RIV_river_union_member1
			}
		}
	}

	on_leave_faction = {
		effect = {
			log = "[GetDateText] [Root.GetName] on_leave_faction FROM = [From.GetName]"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					is_river_fed_member = yes
				}
				RIV_leave_fed_no_ally = yes
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep1
				}
				remove_ideas = RCT_subtle_creep1
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep1_NIM
				}
				remove_ideas = RCT_subtle_creep1_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep2
				}
				remove_ideas = RCT_subtle_creep2
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep2_NIM
				}
				remove_ideas = RCT_subtle_creep2_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep3
				}
				remove_ideas = RCT_subtle_creep3
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep3_NIM
				}
				remove_ideas = RCT_subtle_creep3_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep4
				}
				remove_ideas = RCT_subtle_creep4
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep4_NIM
				}
				remove_ideas = RCT_subtle_creep4_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep5
				}
				remove_ideas = RCT_subtle_creep5
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep5_NIM
				}
				remove_ideas = RCT_subtle_creep5_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep6
				}
				remove_ideas = RCT_subtle_creep6
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep6_NIM
				}
				remove_ideas = RCT_subtle_creep6_NIM
			}
			if = {
				limit = {
					has_idea = RCT_subtle_creep7
				}
				remove_ideas = RCT_subtle_creep7
			}
			else_if = {
				limit = {
					has_idea = RCT_subtle_creep8
				}
				remove_ideas = RCT_subtle_creep8
			}
			if = {
				limit = {
					OR = {
						has_dynamic_modifier = {
							modifier = TBK_great_hazrumenian_family
						}
						has_dynamic_modifier = {
							modifier = TBK_hazrumenian_economic_cooperation
						}
					}
				}
				remove_dynamic_modifier = {
					modifier = TBK_great_hazrumenian_family
				}
				remove_dynamic_modifier = {
					modifier = TBK_great_hazrumenian_family
				}
				TBK = {
					subtract_from_variable = {
						var = TBK_hazrumenia_members
						value = 1
					}
					clamp_variable = {
						var = TBK_hazrumenia_members
						min = 1
						max = 4
					}
				}
			}
			update_global_arrays = yes
		}
	}

	# From is owner country
	on_army_leader_lost_combat = {
		effect = {
			if = {
				limit = {
					has_id = 323
					set_temp_variable = { chance = 0.12 }
					check_variable = { random < chance }
					NOT = { has_trait = wounded }
				}
				retire = yes
				unit_leader_event = { id = wingbardy.1 }
			}
		}
	}
	
	on_army_leader_won_combat = {
		effect = {
			if = {
				limit = {
					has_id = 339111
				}
				unit_leader_event = { id = MAN_ELF_new.148 }
			}
		}
	}

	# FROM = country on whom the wargoal is being generated, ROOT = country generating wargoal
	on_generate_wargoal = {
		effect = {
			log = "[GetDateText] ROOT: [Root.GetName] FROM: [From.GetName] on_generate_wargoal"
		}
	}

	on_unit_leader_promote_from_ranks_veteran = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_veteran"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			handle_generated_unit_leader_non_operative = yes
		}
	}

	on_unit_leader_promote_from_ranks_green = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_green"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			handle_generated_unit_leader_non_operative = yes
		}
	}

	on_unit_leader_created = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_created"
			if = {
				limit = {
					has_global_flag = starting_operatives
				}
				if = {
					limit = { check_variable = { global.onstartup_operative = 4 } }
					set_variable = {
						global.con_mane = THIS
					}
				}
				add_to_variable = { global.onstartup_operative = 1 }
			}
			FROM = {
				set_temp_variable = {
					creator = THIS
				}
			}
			if = {
				limit = { is_exiled_leader = yes }
				set_temp_variable = {
					creator = FROM.FROM
				}
			}
			if = {
				limit = {
					is_operative = no
				}
				if = {
					limit = {
						OR = {
							NOT = { has_dlc = "By Blood Alone" }
							is_navy_leader = yes
						}
					}
					handle_generated_unit_leader_non_operative = yes
				}
			}
			else = {
				log = "on_unit_leader_created: ROOT: [Root.GetName] is operative"
				#operative_handle_secondary_cultures_races = yes
				log = "on_unit_leader_created: ROOT: [Root.GetName] call operative_add_starting_nationalities_and_race"
				operative_add_starting_nationalities_and_race = yes
				log = "on_unit_leader_created: ROOT: [Root.GetName] call operative_add_secondary_nationalities"
				operative_add_secondary_nationalities = yes
			}
			if = {
				limit = {
					is_army_leader = yes
					var:creator = {
						original_tag = CTH
						has_completed_focus = CTH_medical_science
					}
				}
				add_unit_leader_trait = healthy_trait
			}
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_created - End"
		}
	}

	# scope is operative
	# from scope is the country 
	on_operative_recruited = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_operative_recruited"
			operative_add_starting_nationalities_and_race = yes
			operative_add_secondary_nationalities = yes
		}
	}
	
	# scope is operative
	# from scope is the country 
	on_operative_created = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_operative_created"
			operative_handle_secondary_cultures_races = yes
			operative_add_starting_nationalities_and_race = yes
			operative_add_secondary_nationalities = yes
			if = {
				limit = {
					FROM = {
						original_tag = TBK
						has_completed_focus = TBK_vasile_breezies
					}
				}
				add_unit_leader_trait = operative_seducer
			}
		}
	}

	on_ruling_party_change = { 
		# temp var old_ideology_token is available for effects
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_ruling_party_change"
			ZES_oppressive_countries_calculate = yes
			if = {
				limit = {
					original_tag = YAL
					YAL_emperor_grover_ii = { is_unit_leader = yes }
					NOT = {
						has_country_leader = {
							ruling_only = yes
							character = YAL_emperor_grover_ii
						}
						has_country_leader = {
							ruling_only = yes
							character = GRI_emperor_grover_vi
						}
					}
				}
				YAL_emperor_grover_ii = {
					remove_unit_leader_role = yes
				}
				remove_opinion_modifier = {
					target = NIM
					modifier = mortal_enemies
				}
				NIM = {
					remove_opinion_modifier = {
						target = PREV
						modifier = mortal_enemies
					}
				}
			}
			if = {
				limit = { has_character = MQA_ceyda_vatosoa }

				if = {
					limit = { has_government = democratic }

					MQA_ceyda_vatosoa = {
						set_portraits = {
							civilian = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_harmony.tga"
							}
							army = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_harmony.tga"
							}
						}
					}
				}
				else_if = {
					limit = { has_government = fascism }

					MQA_ceyda_vatosoa = {
						set_portraits = {
							civilian = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_Supremacy.tga"
							}
							army = {
								large = "gfx/leaders/MQA/Ceyda_Vatosoa_Supremacy.tga"
							}
						}
					}

					else = {
						MQA_ceyda_vatosoa = {
							set_portraits = {
								civilian = {
									large = "gfx/leaders/MQA/Ceyda_Vatosoa.tga"
								}
								army = {
									large = "gfx/leaders/MQA/Ceyda_Vatosoa.tga"
								}
							}
						}
					}
				}
			}
		}
	}
	on_liberate = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_liberate"
			set_AI_strategies_on_every_possible_country_delayed = yes
			if = {
				limit = {
					ROOT = {
						original_tag = BAR
					}
				}
				ROOT = {
					BAR_clear_mess_puppet = yes
				}	
			}
			if = {
				limit = {
					ROOT = {
						original_tag = CRY
					}
				}
				ROOT = {
					country_event = solarempiresparkles.102
				}	
			}
		}
	}

	on_peace = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] on_peace"
			if = {
				limit = {
					has_variable = inflicted_casualties
				}
				clear_current_inflicted_casualties = yes
			}
			remove_from_attaches_arrays = yes
			clear_puppet_wargoals = yes
			set_AI_strategies_on_every_possible_country_delayed = yes
		}
	}

	on_send_attache = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_send_attache"
			ROOT = {
				if = {
					limit = {
						NOT = {
							is_in_array = { attaches_sent_to = FROM }
						}
					}
					add_to_array = { attaches_sent_to = FROM }
				}
				if = {
					limit = {
						NOT = {
							is_in_array = { global.countries_that_sent_attaches = THIS }
						}
					}
					add_to_array = { global.countries_that_sent_attaches = THIS }
				}
			}
		}
	}
}
