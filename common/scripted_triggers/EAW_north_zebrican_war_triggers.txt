# All the triggers for the NZW War

# NZ1 = island party = normally (currently exclusively even) Hippogriffia
# NZ2 = northern party = normally Colthage
# NZ3 = southern party = normally Chiropterra

NZW_is_north_zebrican_tag = {
	OR = {
		original_tag = HIP # Hippogriffia
		original_tag = CTH # Colthage
		original_tag = CVA # Coltva
		original_tag = CDR # Coltdar
		original_tag = HIE # Hippone (Star Father)
		original_tag = TRO # Trotkat (Gerza)
		original_tag = CGI # Quaggatai
		original_tag = BKH # Buckhara
		original_tag = BAT # Chiropterra
		original_tag = TBK # Tobuck
		original_tag = ZAR # Zarantia
		original_tag = WAR # Warzena
	}
}

#### Alignment/readyness conditions ####

# Is the country aligned with the island party
NZW_is_aligned_with_NZ1 = {
	OR = {
		has_country_flag = NZW_country_is_aligned_with_NZ1 # Country flag for special situations
		is_subject_of = NZ1 # Subject counts as aligned
		
		# Owned by NZ1
		all_of_scopes = {
			array = original_cores
			owner = {
				OR = {
					tag = NZ1
					is_subject_of = NZ1
				}
			}
		}
	}
}

# Is the country aligned with the northern party
NZW_is_aligned_with_NZ2 = {
	OR = {
		has_country_flag = NZW_country_is_aligned_with_NZ1 # Country flag for special situations
		is_subject_of = NZ2 # Subject counts as aligned
		
		# Owned by NZ2
		all_of_scopes = {
			array = original_cores
			owner = {
				OR = {
					tag = NZ2
					is_subject_of = NZ2
				}
			}
		}
	}
}

# Is the country aligned with the southern party
NZW_is_aligned_with_NZ3 = {
	OR = {
		has_country_flag = NZW_country_is_aligned_with_NZ1 # Country flag for special situations
		is_subject_of = NZ3 # Subject counts as aligned
		
		# Owned by NZ3
		all_of_scopes = {
			array = original_cores
			owner = {
				OR = {
					tag = NZ3
					is_subject_of = NZ3
				}
			}
		}
	}
}

# Is the country not aligned with anyone
NZW_is_unaligned = {
	AND = {
		NOT = { NZW_is_aligned_with_NZ1 = yes }
		NOT = { NZW_is_aligned_with_NZ2 = yes }
		NOT = { NZW_is_aligned_with_NZ3 = yes }
	}
}

# Is the northern party ready for war
NZW_is_northern_party_ready = {
	custom_trigger_tooltip = {
		tooltip = NZW_is_northern_party_ready_tooltip
		NOT = { CTH = { NZW_is_unaligned = yes } }
		NOT = { CVA = { NZW_is_unaligned = yes } }
		NOT = { CDR = { NZW_is_unaligned = yes } }
		NOT = { ZUM = { NZW_is_unaligned = yes } }
	}
}

# Is the southern party ready for war
NZW_is_southern_party_ready = {
	custom_trigger_tooltip = {
		tooltip = NZW_is_southern_party_ready_tooltip
		NOT = { BAT = { NZW_is_unaligned = yes } }
		NOT = { TBK = { NZW_is_unaligned = yes } }
		NOT = { ZAR = { NZW_is_unaligned = yes } }
		NOT = { WAR = { NZW_is_unaligned = yes } }
	}
}

#### TAG alias conditions ####

# Is this country NZ1 (Island party tag)
NZW_is_NZ1_trigger = {
	# This is going to be made more complicated once (if ever) it actually matters
	original_tag = HIP
}

# Is this country NZ2 (Northern party tag)
NZW_is_NZ2_trigger = {
	# For now, this should be a sufficent condition to figure out the dominant power in North NZ
	875 = { # Colthage
		owner = {
			# first prev -> Colthage state scope, second prev -> scope prior to Colthage state scope (meaning caller scope)	
			OR = {
				tag = PREV.PREV
				is_subject_of = PREV.PREV
			}
			# If you're worried that the subject condition allows outsiders to become a NZW participant, 
			# it doesn't because the tag alias itself is constraint to certain tags
		}
	}
}

# Is this country NZ3 (Southern party tag)
NZW_is_NZ3_trigger = {
	# This one is a bit of a funny one, but everyone winning against BAT takes 691 from them, so this works
	# Can be made more complicated if needed
	691 = { # New Mareidian
		owner = {
			# first prev -> New Mareidian state scope, second prev -> scope prior to Colthage state scope (meaning caller scope)
			OR = {
				tag = PREV.PREV
				is_subject_of = PREV.PREV
			}
			# If you're worried that the subject condition allows outsiders to become a NZW participant, 
			# it doesn't because the tag alias itself is constraint to certain tags
		}
	}
}

#### Hostility conditions ####
# Note: To add hostility conditions add them under NZW_is_hostile_to_NZX_TAG, with X = the party the condition is against and TAG is the relevant tag
# Do check if your tag is correctly distributed in NZW_is_hostile_to_NZX
# Don't write hostility conditions directly into NZW_is_hostile_to_NZX, because it makes a mess
# Yes, this section is ungodly long, just use the search function. It is *NOT* complicated (just structured)

# NZ1 = island party (hippogriffia + equivalents)
NZW_is_hostile_to_NZ1 = {
	if = {
		limit = {
			original_tag = CTH
		}
		NZW_is_hostile_to_NZ1_CTH = yes
	}
	else_if = {
		limit = {
			original_tag = CVA
		}
		NZW_is_hostile_to_NZ1_CVA = yes
	}
	else_if = {
		limit = {
			original_tag = HIE
		}
		NZW_is_hostile_to_NZ1_HIE = yes
	}
	else_if = {
		limit = {
			original_tag = TRO
		}
		NZW_is_hostile_to_NZ1_TRO = yes
	}
	else_if = {
		limit = {
			original_tag = CGI
		}
		NZW_is_hostile_to_NZ1_CGI = yes
	}
	else_if = {
		limit = {
			original_tag = BAT
		}
		NZW_is_hostile_to_NZ1_BAT = yes
	}
	else_if = {
		limit = {
			original_tag = TBK
		}
		NZW_is_hostile_to_NZ1_TBK = yes
	}
	else_if = {
		limit = {
			original_tag = ZAR
		}
		NZW_is_hostile_to_NZ1_ZAR = yes
	}
	else_if = {
		limit = {
			original_tag = WAR
		}
		NZW_is_hostile_to_NZ1_WAR = yes
	}
	else = { # default
		always = no
	}
}

# NZ2 = northern party (colthage + equivalents)
NZW_is_hostile_to_NZ2 = {
	if = {
		limit = {
			original_tag = HIP
		}
		NZW_is_hostile_to_NZ2_HIP = yes
	}
	else_if = {
		limit = {
			original_tag = BAT
		}
		NZW_is_hostile_to_NZ2_BAT = yes
	}
	else_if = {
		limit = {
			original_tag = TBK
		}
		NZW_is_hostile_to_NZ2_TBK = yes
	}
	else_if = {
		limit = {
			original_tag = ZAR
		}
		NZW_is_hostile_to_NZ2_ZAR = yes
	}
	else_if = {
		limit = {
			original_tag = WAR
		}
		NZW_is_hostile_to_NZ2_WAR = yes
	}
	else = { # default
		always = no
	}
}

# NZ3 = southern party (chiropterra + equivalents)
NZW_is_hostile_to_NZ3 = {
	if = {
		limit = {
			original_tag = HIP
		}
		NZW_is_hostile_to_NZ3_HIP = yes
	}
	else_if = {
		limit = {
			original_tag = CTH
		}
		NZW_is_hostile_to_NZ3_CTH = yes
	}
	else_if = {
		limit = {
			original_tag = CVA
		}
		NZW_is_hostile_to_NZ3_CVA = yes
	}
	else_if = {
		limit = {
			original_tag = HIE
		}
		NZW_is_hostile_to_NZ3_HIE = yes
	}
	else_if = {
		limit = {
			original_tag = TRO
		}
		NZW_is_hostile_to_NZ3_TRO = yes
	}
	else_if = {
		limit = {
			original_tag = CGI
		}
		NZW_is_hostile_to_NZ3_CGI = yes
	}
	else = { # default
		always = no
	}
}

# NZ1 section
NZW_is_hostile_to_NZ1_CTH = {
	if = {
		limit = {
			has_country_flag = CTH_colthage_zarcaid
		}
		ZUM = {
			NZW_is_aligned_with_NZ1 = yes
		}
	}
	else_if = {
		limit = {
			has_country_flag = CTH_colthage_militarists
		}
		ZUM = {
			NZW_is_aligned_with_NZ1 = yes
		}
	}
	else = {
		always = no
	}
}

NZW_is_hostile_to_NZ1_CVA = {
	# No Coltva path has interest Zumidia / other territory
	always = no
}

NZW_is_hostile_to_NZ1_HIE = {
	# Star Father always hostile
	always = yes
}

NZW_is_hostile_to_NZ1_TRO = {
	# Gerza has no interest in NZW
	always = no
}

NZW_is_hostile_to_NZ1_CGI = {
	# Quaggatai wants Zumidia
	ZUM = {
		NZW_is_aligned_with_NZ1 = yes
	}
}

NZW_is_hostile_to_NZ1_BAT = {
	# Either Warzena or Zumidia
	OR = {
		ZUM = {
			NZW_is_aligned_with_NZ1 = yes
		}
		WAR = {
			NZW_is_aligned_with_NZ1 = yes
		}
	}
}

NZW_is_hostile_to_NZ1_TBK = {
	OR = {
		if = { # Alesia
			limit = {
				has_country_flag = TBK_alesia_bat_victory
			}
			OR = {
				ZUM = {
					NZW_is_aligned_with_NZ1 = yes
				}
				WAR = {
					NZW_is_aligned_with_NZ1 = yes
				}
			}
		}
		else_if = { # Baragzen
			limit = {
				has_country_flag = TBK_baragzen_bat_victory
			}
			WAR = {
				NZW_is_aligned_with_NZ1 = yes
			}
		}
		else_if = { # Wallnut - path not yet decided (hostility so NZW doesn't get bypassed)
			limit = {
				has_country_flag = TBK_wallnut_bat_victory
				NOT = { has_country_flag = TBK_wallnut_harmonist_flag }
				NOT = { has_country_flag = TBK_wallnut_communist_flag }
			}
			always = yes
		}
		else_if = { # Wallnut - Harmony
			limit = {
				has_country_flag = TBK_wallnut_bat_victory
				has_country_flag = TBK_wallnut_harmonist_flag
			}
			OR = {
				AND = {
					WAR = { NOT = { has_government = democratic } }
					WAR = {
						NZW_is_aligned_with_NZ1 = yes
					}
				}
				AND = {
					ZUM = { # There can be diplomacy, but it would end with ZUM being handed over, at which point ZUM is no longer "aligned" with NZ1
						NZW_is_aligned_with_NZ1 = yes
					}
				}
			}
		}
		else_if = { # Wallnut - Communism
			limit = {
				has_country_flag = TBK_wallnut_bat_victory
				has_country_flag = TBK_wallnut_communist_flag
			}
			OR = {
				WAR = {
					NZW_is_aligned_with_NZ1 = yes
				}
				ZUM = { # There can be diplomacy, but it would end with ZUM being handed over, at which point ZUM is no longer "aligned" with NZ1
					NZW_is_aligned_with_NZ1 = yes
				}
			}
		}
		else_if = { # Vasile
			limit = {
				OR = {
					has_focus_tree = tobuck_vasile
					has_focus_tree = tobuck_vasile_legimate_continued
					has_focus_tree = tobuck_vasile_criminal_continued
				}
			}
			WAR = {
				NZW_is_aligned_with_NZ1 = yes
			}
		}
		else = { # Path not yet picked or something like that, stop NZW bypassing
			always = yes
		}
	}
}

NZW_is_hostile_to_NZ1_ZAR = {
	# todo
	always = no
}

NZW_is_hostile_to_NZ1_WAR = {
	# Current Warzena content
	ZUM = {
		NZW_is_aligned_with_NZ1 = yes
	}
	NZ1 = { # Different government
		NOT = { has_government = WAR }
	}
}

# NZ2 section
NZW_is_hostile_to_NZ2_HIP = {
	OR = {
		AND = { # Queen Novo
			has_government = democratic
			NZ2 = {
				OR = {
					has_government = fascism
					has_government = neutrality
				}
			}
		}
		AND = { # Posada
			has_government = communism
			NZ2 = {
				OR = {
					has_government = fascism
					has_government = neutrality
					has_government = democratic
				}
			}
		}
		AND = { # Aris First
			OR = {
				has_government = fascism
				has_government = neutrality
			}
			always = yes # No enemy government condition
		}
	}
}

NZW_is_hostile_to_NZ2_BAT = {
	# Chiropterra has no NZW claims on Colthage
	always = no
}

NZW_is_hostile_to_NZ2_TBK = {
	# Warzena has no NZW claims on Colthage
	always = no
}

NZW_is_hostile_to_NZ2_ZAR = {
	# Zarantia has no NZW claims on Colthage
	always = no
}

NZW_is_hostile_to_NZ2_WAR = {
	# Warzena has no NZW claims on Colthage
	always = no
}

# NZ3 section
NZW_is_hostile_to_NZ3_HIP = {
	OR = {
		AND = { # Queen Novo
			has_government = democratic
			NZ3 = {
				OR = {
					has_government = fascism
					has_government = neutrality
				}
			}
		}
		AND = { # Posada
			has_government = communism
			NZ3 = {
				OR = {
					has_government = fascism
					has_government = neutrality
					has_government = democratic
				}
			}
		}
		AND = { # Aris First
			OR = {
				has_government = fascism
				has_government = neutrality
			}
			always = yes # No enemy government condition
		}
	}
}

NZW_is_hostile_to_NZ3_CTH = {
	AND = {
		has_country_flag = CTH_colthage_harmonite
		NZ3 = {
			has_government = fascism
		}
		OR = { # Ally with the island party (hippogriffia)
			NZ1 = {
				NZW_is_hostile_to_NZ3 = yes
			}
			NZ3 = {
				NZW_is_hostile_to_NZ1 = yes
			}
		}
	}
}

NZW_is_hostile_to_NZ3_CVA = {
	# Coltva has no position in the NZW
	always = no
}

NZW_is_hostile_to_NZ3_HIE = {
	# Star Father's hate is towards avians
	always = no
}

NZW_is_hostile_to_NZ3_TRO = {
	# Gerza is occupied elsewhere
	always = no
}

NZW_is_hostile_to_NZ3_CGI = {
	# Quaggatai doesn't care so far south
	always = no
}

#### Limited Peace Trigger conditions ####
NZW_no_mainland_control_for_NZ1 = {
	NOT = {
		any_state_in = {
			# This array gets calculated as states join and contains the mainland states for every war participant
			array = global.NZW_mainland_state_array
			
			owner = {
				OR = {
					tag = NZ1
					is_ally_with = NZ1
				}
			}
		}
	}
}