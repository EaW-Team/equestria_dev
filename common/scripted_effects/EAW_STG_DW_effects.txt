# Function    : STG_DW_setup_reforms_minigame_f
# Description : Setup the variables used by the reforms minigame
# Inputs  : None
# Outputs : SRG_DW_reform_point_step_values_array - Arrays defining the ranges for the point increase tooltips
STG_DW_setup_reforms_minigame_f = {
	clr_country_flag = STG_DW_reform_crisis_in_progress
	clr_country_flag = STG_DW_reform_decision_in_progress

	clear_array  =   STG_DW_reform_point_step_values_array
	add_to_array = { STG_DW_reform_point_step_values_array = 20 }
	add_to_array = { STG_DW_reform_point_step_values_array = 50 }
	add_to_array = { STG_DW_reform_point_step_values_array = 80 }
	add_to_array = { STG_DW_reform_point_step_values_array = 120 }

	clear_array  =  STG_DW_reform_point_stage_values_array
	add_to_array = { STG_DW_reform_point_stage_values_array = 200 }
	add_to_array = { STG_DW_reform_point_stage_values_array = 800 }
	add_to_array = { STG_DW_reform_point_stage_values_array = 1500 }
	add_to_array = { STG_DW_reform_point_stage_values_array = 3000 }
	add_to_array = { STG_DW_reform_point_stage_values_array = 8000 }
	clear_array  = STG_DW_reform_point_stage_titles_array
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_0 }
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_1 }
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_2 }
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_3 }
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_4 }
	add_to_array = { STG_DW_reform_point_stage_titles_array = token:STG_DW_reform_stage_title_5 }
	clear_array  = STG_DW_reform_point_stage_descs_array
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_0 }
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_1 }
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_2 }
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_3 }
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_4 }
	add_to_array = { STG_DW_reform_point_stage_descs_array = token:STG_DW_reform_stage_desc_5 }

	# A better system upgradable decision
	clr_country_flag = STG_DW_reform_better_system_decision_in_progress
	clear_array = STG_DW_reform_better_system_modifier_stability_array
	clear_array = STG_DW_reform_better_system_modifier_pp_gain_array
	clear_array = STG_DW_reform_better_system_days_remove_array
	clear_array = STG_DW_reform_better_system_pp_cost
	clear_array = STG_DW_reform_better_system_reform_points_array
	# Level 0
	add_to_array = { STG_DW_reform_better_system_modifier_stability_array = 0.01 }
	add_to_array = { STG_DW_reform_better_system_modifier_pp_gain_array = -0.20 }
	add_to_array = { STG_DW_reform_better_system_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_system_pp_cost = 20 }
	add_to_array = { STG_DW_reform_better_system_reform_points_array = 10 }
	# Level 1
	add_to_array = { STG_DW_reform_better_system_modifier_stability_array = 0.02 }
	add_to_array = { STG_DW_reform_better_system_modifier_pp_gain_array = -0.15 }
	add_to_array = { STG_DW_reform_better_system_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_system_pp_cost = 30 }
	add_to_array = { STG_DW_reform_better_system_reform_points_array = 20 }
	# Level 2
	add_to_array = { STG_DW_reform_better_system_modifier_stability_array = 0.025 }
	add_to_array = { STG_DW_reform_better_system_modifier_pp_gain_array = -0.15 }
	add_to_array = { STG_DW_reform_better_system_days_remove_array = 42 }
	add_to_array = { STG_DW_reform_better_system_pp_cost = 40 }
	add_to_array = { STG_DW_reform_better_system_reform_points_array = 40 }

	set_variable = { STG_DW_reform_better_system_desired_level = 0 }
	STG_DW_set_better_system_decisions_level_f = yes

	# A better industry upgradable decision
	clr_country_flag = STG_DW_reform_better_industry_decision_in_progress
	clear_array = STG_DW_reform_better_industry_modifier_stability_array
	clear_array = STG_DW_reform_better_industry_modifier_pp_gain_array
	clear_array = STG_DW_reform_better_industry_days_remove_array
	clear_array = STG_DW_reform_better_industry_pp_cost
	clear_array = STG_DW_reform_better_industry_reform_points_array
	# Level 0
	add_to_array = { STG_DW_reform_better_industry_modifier_stability_array = -0.01 }
	add_to_array = { STG_DW_reform_better_industry_modifier_pp_gain_array = 0.20 }
	add_to_array = { STG_DW_reform_better_industry_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_industry_pp_cost = 20 }
	add_to_array = { STG_DW_reform_better_industry_reform_points_array = 10 }
	# Level 1
	add_to_array = { STG_DW_reform_better_industry_modifier_stability_array = -0.02 }
	add_to_array = { STG_DW_reform_better_industry_modifier_pp_gain_array = 0.15 }
	add_to_array = { STG_DW_reform_better_industry_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_industry_pp_cost = 30 }
	add_to_array = { STG_DW_reform_better_industry_reform_points_array = 20 }
	# Level 2
	add_to_array = { STG_DW_reform_better_industry_modifier_stability_array = -0.025 }
	add_to_array = { STG_DW_reform_better_industry_modifier_pp_gain_array = 0.15 }
	add_to_array = { STG_DW_reform_better_industry_days_remove_array = 42 }
	add_to_array = { STG_DW_reform_better_industry_pp_cost = 40 }
	add_to_array = { STG_DW_reform_better_industry_reform_points_array = 40 }

	set_variable = { STG_DW_reform_better_industry_desired_level = 0 }
	STG_DW_set_better_industry_decisions_level_f = yes

	# A better tomorrow upgradable decision
	clr_country_flag = STG_DW_reform_better_tomorrow_decision_in_progress
	clear_array = STG_DW_reform_better_tomorrow_modifier_stability_array
	clear_array = STG_DW_reform_better_tomorrow_modifier_pp_gain_array
	clear_array = STG_DW_reform_better_tomorrow_days_remove_array
	clear_array = STG_DW_reform_better_tomorrow_pp_cost
	clear_array = STG_DW_reform_better_tomorrow_reform_points_array
	# Level 0
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_stability_array = 0.01 }
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_pp_gain_array = 0.20 }
	add_to_array = { STG_DW_reform_better_tomorrow_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_tomorrow_pp_cost = 20 }
	add_to_array = { STG_DW_reform_better_tomorrow_reform_points_array = 10 }
	# Level 1
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_stability_array = 0.02 }
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_pp_gain_array = 0.15 }
	add_to_array = { STG_DW_reform_better_tomorrow_days_remove_array = 35 }
	add_to_array = { STG_DW_reform_better_tomorrow_pp_cost = 30 }
	add_to_array = { STG_DW_reform_better_tomorrow_reform_points_array = 20 }
	# Level 2
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_stability_array = 0.025 }
	add_to_array = { STG_DW_reform_better_tomorrow_modifier_pp_gain_array = 0.15 }
	add_to_array = { STG_DW_reform_better_tomorrow_days_remove_array = 42 }
	add_to_array = { STG_DW_reform_better_tomorrow_pp_cost = 40 }
	add_to_array = { STG_DW_reform_better_tomorrow_reform_points_array = 40 }

	set_variable = { STG_DW_reform_better_tomorrow_desired_level = 0 }
	STG_DW_set_better_tomorrow_decisions_level_f = yes
	

	set_variable = { STG_DW_reform_stage = 0 }
	set_variable = { STG_DW_reform_points = 0 }
	add_to_variable = { STD_DW_update_reform_gui = 1 }
}

# Function : STG_DW_add_points_f
# Description : Use to add reforms points. Provide an effect tooltip
# Inputs  : temp_STG_DW_reform_points_increase_value - The value to increment the point with
# Outputs : None
STG_DW_add_points_f = {
	custom_effect_tooltip = "[GetReformPointIncrLoc]"
	add_to_variable = {
		STG_DW_reform_points = temp_STG_DW_reform_points_increase_value
	}

	set_temp_variable = { temp_stage_changed = 0 }
	# Handle stage change
	for_each_loop = {
		array = STG_DW_reform_point_stage_values_array
		index = stage_index
		value = stage_value
		break = stage_break

		if = {
			limit = {
				check_variable = { STG_DW_reform_points < stage_value }
			}

			if = {
				limit = {
					check_variable = { stage_index > STG_DW_reform_stage }
				}

				set_variable = { STG_DW_reform_stage = stage_index }
				set_temp_variable = { temp_stage_changed = 1 }
			}
			set_temp_variable = { stage_break = 1 }
		}
	}
	set_temp_variable = { temp_size_array = STG_DW_reform_point_stage_values_array^num }
	add_to_temp_variable = { temp_size_array = -1 }
	if = {
		limit = {
			check_variable = { STG_DW_reform_point_stage_values_array^num > STG_DW_reform_stage }
			check_variable = { STG_DW_reform_points > STG_DW_reform_point_stage_values_array^temp_size_array }
		}

		set_variable = { STG_DW_reform_stage = STG_DW_reform_point_stage_values_array^num }
		set_temp_variable = { temp_stage_changed = 1 }
	}

	if = {
		limit = {
			check_variable = { temp_stage_changed = 1 }
		}

		meta_effect = {
			text = {
				country_event = stalliongrad_dark_wing_reform_stages.[ID_EVENT]
			}
			ID_EVENT = "[?STG_DW_reform_stage]"
		}
	}

	add_to_variable = { STD_DW_update_reform_gui = 1 }
}

# Function : STG_DW_set_better_system_decisions_level_f
# Description : Set the level of the Better System upgradable decision
# Inputs  : STG_DW_reform_better_system_desired_level - The level will be set to this variable
# Outputs : None
STG_DW_set_better_system_decisions_level_f = {
	set_variable = { STG_DW_reform_better_system_level = STG_DW_reform_better_system_desired_level }
	set_variable = {
		var   = STG_DW_reform_better_system_modifier_stability
		value = STG_DW_reform_better_system_modifier_stability_array^STG_DW_reform_better_system_level
	}
	set_variable = {
		var   = STG_DW_reform_better_system_modifier_pp_gain
		value = STG_DW_reform_better_system_modifier_pp_gain_array^STG_DW_reform_better_system_level
	}
	set_variable = {
		var   = STG_DW_reform_better_system_days_remove
		value = STG_DW_reform_better_system_days_remove_array^STG_DW_reform_better_system_level
	}
	set_variable = {
		var   = STG_DW_reform_better_system_pp_cost
		value = STG_DW_reform_better_system_pp_cost^STG_DW_reform_better_system_level
	}
	set_variable = {
		var   = STG_DW_reform_better_system_reform_points
		value = STG_DW_reform_better_system_reform_points_array^STG_DW_reform_better_system_level
	}
	custom_effect_tooltip = STG_DW_reforms_better_system_upgrade_tt
}

# Function : STG_DW_set_better_industry_decisions_level_f
# Description : Set the level of the Better industry upgradable decision
# Inputs  : STG_DW_reform_better_industry_desired_level - The level will be set to this variable
# Outputs : None
STG_DW_set_better_industry_decisions_level_f = {
	set_variable = { STG_DW_reform_better_industry_level = STG_DW_reform_better_industry_desired_level }
	set_variable = {
		var   = STG_DW_reform_better_industry_modifier_stability
		value = STG_DW_reform_better_industry_modifier_stability_array^STG_DW_reform_better_industry_level
	}
	set_variable = {
		var   = STG_DW_reform_better_industry_modifier_pp_gain
		value = STG_DW_reform_better_industry_modifier_pp_gain_array^STG_DW_reform_better_industry_level
	}
	set_variable = {
		var   = STG_DW_reform_better_industry_days_remove
		value = STG_DW_reform_better_industry_days_remove_array^STG_DW_reform_better_industry_level
	}
	set_variable = {
		var   = STG_DW_reform_better_industry_pp_cost
		value = STG_DW_reform_better_industry_pp_cost^STG_DW_reform_better_industry_level
	}
	set_variable = {
		var   = STG_DW_reform_better_industry_reform_points
		value = STG_DW_reform_better_industry_reform_points_array^STG_DW_reform_better_industry_level
	}
	custom_effect_tooltip = STG_DW_reforms_better_industry_upgrade_tt
}

# Function : STG_DW_set_better_tomorrow_decisions_level_f
# Description : Set the level of the Better tomorrow upgradable decision
# Inputs  : STG_DW_reform_better_tomorrow_desired_level - The level will be set to this variable
# Outputs : None
STG_DW_set_better_tomorrow_decisions_level_f = {
	set_variable = { STG_DW_reform_better_tomorrow_level = STG_DW_reform_better_tomorrow_desired_level }
	set_variable = {
		var   = STG_DW_reform_better_tomorrow_modifier_stability
		value = STG_DW_reform_better_tomorrow_modifier_stability_array^STG_DW_reform_better_tomorrow_level
	}
	set_variable = {
		var   = STG_DW_reform_better_tomorrow_modifier_pp_gain
		value = STG_DW_reform_better_tomorrow_modifier_pp_gain_array^STG_DW_reform_better_tomorrow_level
	}
	set_variable = {
		var   = STG_DW_reform_better_tomorrow_days_remove
		value = STG_DW_reform_better_tomorrow_days_remove_array^STG_DW_reform_better_tomorrow_level
	}
	set_variable = {
		var   = STG_DW_reform_better_tomorrow_pp_cost
		value = STG_DW_reform_better_tomorrow_pp_cost^STG_DW_reform_better_tomorrow_level
	}
	set_variable = {
		var   = STG_DW_reform_better_tomorrow_reform_points
		value = STG_DW_reform_better_tomorrow_reform_points_array^STG_DW_reform_better_tomorrow_level
	}
	custom_effect_tooltip = STG_DW_reforms_better_tomorrow_upgrade_tt
}

STG_DW_setup_regional_influence_f = {
	clear_array = STG_DW_regions_array
	add_to_array = { STG_DW_regions_array = 100 }
	add_to_array = { STG_DW_regions_array = 20 }
	add_to_array = { STG_DW_regions_array = 70 }

	clear_array = STG_DW_regions_weekly_influence_array
	add_to_array = { STG_DW_regions_weekly_influence_array = 0 }
	add_to_array = { STG_DW_regions_weekly_influence_array = -1 }
	add_to_array = { STG_DW_regions_weekly_influence_array = 1 }

	clear_array = STG_DW_region_names_array
	clear_array = STG_DW_region_descs_array
	add_to_array = { STG_DW_region_names_array = token:STG_DW_reform_region_name_0 }
	add_to_array = { STG_DW_region_names_array = token:STG_DW_reform_region_name_1 }
	add_to_array = { STG_DW_region_names_array = token:STG_DW_reform_region_name_2 }
	add_to_array = { STG_DW_region_descs_array = token:STG_DW_reform_region_desc_0 }
	add_to_array = { STG_DW_region_descs_array = token:STG_DW_reform_region_desc_1 }
	add_to_array = { STG_DW_region_descs_array = token:STG_DW_reform_region_desc_2 }

	set_variable = { STG_DW_region_selected = -1 }
	set_variable = { STG_DW_selected_region_displayed_name = token:STG_DW_reform_region_name_99 }

	set_country_flag = STG_DW_minigame_regional_influence_enabled

	# Building slots
	clear_array = STG_DW_regions_building_slots_array
	add_to_array = { STG_DW_regions_building_slots_array = 1 }
	add_to_array = { STG_DW_regions_building_slots_array = 4 }
	add_to_array = { STG_DW_regions_building_slots_array = 2 }

	# Current building array
	for_loop_effect = {
		end = STG_DW_regions_array^num
		value = index_region

		meta_effect = {
			text = {
				clear_array = STG_DW_region_[ID_REGION]_buildings_array
				resize_array = {
					array = STG_DW_region_[ID_REGION]_buildings_array
					value = 0
					size = STG_DW_regions_building_slots_array^index_region
				}
			}

			ID_REGION = "[?index_region]"
		}
	}

	# Building name & desc
	clear_array = STG_DW_building_names_array
	add_to_array = { STG_DW_building_names_array = token:STG_DW_reform_building_name_0 }
	add_to_array = { STG_DW_building_names_array = token:STG_DW_reform_building_name_1 }
	add_to_array = { STG_DW_building_names_array = token:STG_DW_reform_building_name_2 }
	add_to_array = { STG_DW_building_names_array = token:STG_DW_reform_building_name_3 }
	clear_array = STG_DW_building_descs_array
	add_to_array = { STG_DW_building_descs_array = token:STG_DW_reform_building_desc_0 }
	add_to_array = { STG_DW_building_descs_array = token:STG_DW_reform_building_desc_1 }
	add_to_array = { STG_DW_building_descs_array = token:STG_DW_reform_building_desc_2 }
	add_to_array = { STG_DW_building_descs_array = token:STG_DW_reform_building_desc_3 }

	set_variable = { STG_DW_details_building_id = 0 }
	
	STG_DW_display_region_list_f = yes
}

# Function : STG_DW_add_regional_influence_f
# Description : Add regional influence. Provide an effect tooltip
# Inputs  : temp_STG_DW_regional_influence_increase_value - The value to increment the influence with
#           temp_STG_DW_regional_influence_region_id      - The region to add influence
# Outputs : None
STG_DW_add_regional_influence_f = {
	add_to_variable = {
		var   = STG_DW_regions_array^temp_STG_DW_regional_influence_region_id
		value = temp_STG_DW_regional_influence_increase_value
		tooltip = STG_DW_regional_influence_add
	}
	clamp_variable = {
		var = STG_DW_regions_array^temp_STG_DW_regional_influence_region_id
		min = 0
		max = 100
	}
}

# Function : STG_DW_add_regional_weekly_influence_f
# Description : Add weekly regional influence. Provide an effect tooltip
# Inputs  : temp_STG_DW_regional_influence_weekly_increase_value - The value to increment the weekly influence with
#           temp_STG_DW_regional_influence_region_id             - The region to add influence
# Outputs : None
STG_DW_add_regional_weekly_influence_f = {
	add_to_variable = {
		var   = STG_DW_regions_weekly_influence_array^temp_STG_DW_regional_influence_region_id
		value = temp_STG_DW_regional_influence_weekly_increase_value
		tooltip = STG_DW_regional_weekly_influence_add
	}
}

# Function : STG_DW_display_region_list_f
# Description : Display the region list in the regional influence GUI.
# Inputs  : None
# Outputs : None
STG_DW_display_region_list_f = {
	 set_variable = { STG_DW_region_list_id = 0 }
	 clear_array = STG_DW_region_list_array
	 resize_array = {
		array = STG_DW_region_list_array
		value = 0
		size = STG_DW_regions_array^num
	 }
	 add_to_variable = { STG_DW_update_regional_influence_gui = 1 }
}

# Function : STG_DW_display_building_list_f
# Description : Display the building list of the current region in the regional influence GUI.
# Inputs  : None
# Outputs : None
STG_DW_display_building_list_f = {
	 set_variable = { STG_DW_region_list_id = 1 }
	 clear_array = STG_DW_region_list_array
	 meta_effect = {
		text = {
			for_each_loop = {
				array = STG_DW_region_[ID_REGION]_buildings_array
				value = building_value

				add_to_array = { STG_DW_region_list_array = building_value }
			}
		}
		
		ID_REGION = "[?STG_DW_region_selected]"
	 }
	 add_to_variable = { STG_DW_update_regional_influence_gui = 1 }
}
