ABY_AF_form_UFS = {
	ABY = {
		if = {
			limit = {
				NOT = { has_idea = ABY_AF_grand_crusade_idea }
			}
			country_event = { id = katzen_AF.5000 days = 30 }
		}
	}
	UFS = {
		save_global_event_target_as = ABY_AF_world_federation
		declare_war_on = {
			target = ABY
			type = annex_everything
		}
		every_other_country = {
			limit = {
				is_ai = yes
				NOT = { tag = ABY }
				NOT = { has_idea = detached_country }
			}

			every_unit_leader = { set_nationality = UFS }
			UFS = {
				if = {
					limit = { check_variable = { tmp_first_country > 0 } }
					# Have to check the technology that UFS doesn't have yet
					for_each_loop = {
						array = PREV.researched_techs
						value = tech_token

						if = {
							limit = {
								NOT = { is_in_array = { UFS.researched_techs = tech_token } }
							}
							meta_effect = {
								text = {
									set_technology = {
										[TECH] = 1
									}
								}
								TECH = "[?tech_token.GetTokenKey]"
							}
						}
					}

				} 
				else = {
					set_temp_variable = { tmp_first_country = 1 }
					inherit_technology = PREV
				}
				annex_country = {
					target = PREV
					transfer_troops = yes
				}
			}
		}
	}
	HIE ={
		every_unit_leader = { set_nationality = UFS }
	}
	event_target:ABY_AF_world_federation = {
		add_ideas = service_by_requirement
		add_ideas = tot_economic_mobilisation
		add_ideas = closed_economy
		set_research_slots = 7 #It's the entire world
		increase_society_development = yes
		increase_society_development = yes
		increase_society_development = yes
		decrease_poverty = yes
		decrease_poverty = yes
		decrease_poverty = yes
		every_state = { add_core_of = event_target:ABY_AF_world_federation }
		add_ideas = ABY_AF_world_federation_last_stand
		set_politics = {
			ruling_party = democratic
			elections_allowed = no
			long_name = "UFS_party_name"
			name = "UFS_party_name"
		}
		add_popularity = {
			ideology = democratic
			popularity = 1.00
		}
		load_focus_tree = BAR_empty_tree
		if = {
			limit = { is_in_faction = yes }
			leave_faction = yes
		}
	}
	set_global_flag = ABY_AF_musicflag2
	scoped_play_song = "Brad_Cypy-Battle_For_Supremacy"
}