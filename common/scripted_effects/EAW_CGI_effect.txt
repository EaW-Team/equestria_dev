# Update all the variables for the diamond road
CGI_update_diamond_road = {
	set_variable = { CGI_diamond_road_civs = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_civs = CGI_diamond_road_civ_cost }
	subtract_from_variable = { CGI_diamond_road_civs = 0.499 } # Round down
	round_variable = CGI_diamond_road_civs
	
	set_variable = { CGI_diamond_road_mils = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_mils = CGI_diamond_road_mil_cost }
	subtract_from_variable = { CGI_diamond_road_mils = 0.499 } # Round down
	round_variable = CGI_diamond_road_mils
	
	set_variable = { CGI_diamond_road_manpower = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_manpower = CGI_diamond_road_manpower_cost }
	subtract_from_variable = { CGI_diamond_road_manpower = 0.499 } # Round down
	round_variable = CGI_diamond_road_manpower
	
	set_variable = { CGI_diamond_road_steel = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_steel = CGI_diamond_road_steel_cost }
	subtract_from_variable = { CGI_diamond_road_steel = 0.499 } # Round down
	round_variable = CGI_diamond_road_steel
	
	set_variable = { CGI_diamond_road_tungsten = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_tungsten = CGI_diamond_road_tungsten_cost }
	subtract_from_variable = { CGI_diamond_road_tungsten = 0.499 } # Round down
	round_variable = CGI_diamond_road_tungsten
	
	set_variable = { CGI_diamond_road_rubber = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_rubber = CGI_diamond_road_rubber_cost }
	subtract_from_variable = { CGI_diamond_road_rubber = 0.499 } # Round down
	round_variable = CGI_diamond_road_rubber
	
	set_variable = { CGI_diamond_road_guns = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_guns = CGI_diamond_road_gun_cost }
	subtract_from_variable = { CGI_diamond_road_guns = 0.499 } # Round down
	round_variable = CGI_diamond_road_guns
	
	set_variable = { CGI_diamond_road_arty = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_arty = CGI_diamond_road_arty_cost }
	subtract_from_variable = { CGI_diamond_road_arty = 0.499 } # Round down
	round_variable = CGI_diamond_road_arty
	
	set_variable = { CGI_diamond_road_support = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_support = CGI_diamond_road_support_cost }
	subtract_from_variable = { CGI_diamond_road_support = 0.499 } # Round down
	round_variable = CGI_diamond_road_support
	
	set_variable = { CGI_diamond_road_construction = CGI_diamond_road_strength }
	multiply_variable = { CGI_diamond_road_construction = CGI_diamond_road_construction_factor }
	
	set_variable = { CGI_diamond_road_research = CGI_diamond_road_strength }
	multiply_variable = { CGI_diamond_road_research = CGI_diamond_road_research_factor }
	
	set_variable = { CGI_diamond_road_trade_opinion = CGI_diamond_road_strength }
	multiply_variable = { CGI_diamond_road_trade_opinion = CGI_diamond_road_trade_opinion_factor }
	
	set_variable = { CGI_diamond_road_development_cost = CGI_diamond_road_strength }
	divide_variable = { CGI_diamond_road_development_cost = 20 }
	round_variable = CGI_diamond_road_development_cost
	
	# Show new effects
	force_update_dynamic_modifier = yes
}

CGI_end_bop_and_apply_idea = {
	if = {
		limit = {
			has_power_balance = {
				id = CGI_crossroads_bop
			}
		}
		
		if = {
			limit = {
				power_balance_value = {
					id = CGI_crossroads_bop
					value < -0.5
				}
			}
			add_ideas = CGI_powerbalance_end_ascending_clans
			set_country_flag = CGI_moderate_khanate
		}
		else_if = {
			limit = { 
				power_balance_value = {
					id = CGI_crossroads_bop
					value < -0.25
				}
			}
			add_ideas = CGI_powerbalance_end_powerful_clans
			set_country_flag = CGI_moderate_khanate
		}
		else_if = {
			limit = {
				power_balance_value = {
					id = CGI_crossroads_bop
					value < 0.25
				}
			}
			add_ideas = CGI_powerbalance_end_balanced_government
			set_country_flag = CGI_moderate_khanate
		}
		else_if = {
			limit = {
				power_balance_value = {
					id = CGI_crossroads_bop
					value < 0.5
				}
			}
			add_ideas = CGI_powerbalance_end_powerful_khanate
			set_country_flag = CGI_moderate_khanate
		}
		else_if = {
			limit = {
				power_balance_value = {
					id = CGI_crossroads_bop
					value < 0.75
				}
			}
			add_ideas = CGI_powerbalance_end_ascending_khanate
			set_country_flag = CGI_moderate_khanate
		}
		else = {
			add_ideas = CGI_powerbalance_end_dominant_khanate
		}

		remove_power_balance = {
			id = CGI_crossroads_bop
		}
	}
}