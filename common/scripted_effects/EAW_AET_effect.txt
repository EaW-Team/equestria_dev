AET_style_meter_update = {
	hidden_effect = {
		clamp_variable = {
			var = AET_style_score
			min = 0
			max = 125
		}
		set_temp_variable = {
			AET_style_score_temp_var = AET_style_score
		}
		### Weekly Manpower
		multiply_temp_variable = {
			AET_style_score_temp_var = 10
		}
		set_variable = {
			AET_style_modifier_weekly_manpower_factor_var = AET_style_score_temp_var
		}
		### Stability/War Support factor
		set_temp_variable = {
			AET_style_score_temp_var = AET_style_score
		}
		multiply_temp_variable = {
			AET_style_score_temp_var = 0.005
		}
		set_variable = {
			AET_style_modifier_stability_factor_var = AET_style_score_temp_var
		}
		set_variable = {
			aet_style_modifier_production_gain_factor_var = AET_style_score_temp_var
		}
		multiply_temp_variable = {
			AET_style_score_temp_var = 2
		}
		set_variable = {
			AET_style_modifier_planning_speed_factor_var = AET_style_score_temp_var
		}
		force_update_dynamic_modifier = yes
	}
}

AET_style_meter_add = {
	custom_effect_tooltip = AET_add_style_score_tt
	if = {
		limit = {
			check_variable = {
				AET_style_score_add > 0
			}
		}
		set_country_flag = AET_style_done_this_month
	}
	add_to_variable = {
		AET_style_score = AET_style_score_add
	}
	clamp_variable = {
		var = AET_style_score
		min = 0
		max = 125
	}
	AET_style_meter_update = yes
}

# Helldivers GUI

AET_HLDV_start = {
	clear_array = AET_HLDV_current_arrows
	for_each_loop = {
		array = AET_HLDV_stratagem_list
		clear_array = AET_HLDV_stratagem_code_list_@var:v
	}
	clear_array = AET_HLDV_stratagem_list

	set_country_flag = AET_HLDV_active

	add_to_array = { AET_HLDV_stratagem_list = 1 }
	add_to_array = { AET_HLDV_stratagem_code_list_1 = 2 }
	add_to_array = { AET_HLDV_stratagem_code_list_1 = 3 }
	add_to_array = { AET_HLDV_stratagem_code_list_1 = 4 }
	add_to_array = { AET_HLDV_stratagem_code_list_1 = 4 }
	add_to_array = { AET_HLDV_stratagem_code_list_1 = 4 }

	add_to_array = { AET_HLDV_stratagem_list = 2 }
	add_to_array = { AET_HLDV_stratagem_code_list_2 = 1 }
	add_to_array = { AET_HLDV_stratagem_code_list_2 = 2 }
	add_to_array = { AET_HLDV_stratagem_code_list_2 = 3 }
	add_to_array = { AET_HLDV_stratagem_code_list_2 = 3 }
	add_to_array = { AET_HLDV_stratagem_code_list_2 = 3 }

	add_to_array = { AET_HLDV_stratagem_list = 3 }
	add_to_array = { AET_HLDV_stratagem_code_list_3 = 1 }
	add_to_array = { AET_HLDV_stratagem_code_list_3 = 2 }
	add_to_array = { AET_HLDV_stratagem_code_list_3 = 3 }

	add_to_variable = { AET_HLDV_dirty = 0.001 }
}

AET_HLDV_key_press = {
	add_to_array = { AET_HLDV_current_arrows = temp_arrow_direction }
	set_variable = { AET_HLDV_last_arrow_direction = temp_arrow_direction }

	AET_HLDV_highlight = yes

	if = {
		limit = {
			OR = {
				# Reset if number reaches 6
				check_variable = { AET_HLDV_current_arrows^num = 7 }
				# Reset if current code doesn't match any
				NOT = {
					any_of = {
						array = AET_HLDV_stratagem_list
						index = check_i
						value = check_j

						all_of = {
							array = AET_HLDV_current_arrows
							index = check_k
							value = check_l

							check_variable = { check_l = AET_HLDV_stratagem_code_list_@var:check_j^check_k }
						}
						check_variable = { var = AET_HLDV_current_arrows^num value = AET_HLDV_stratagem_code_list_@var:check_j^num compare = less_than_or_equals }
					}
				}
			}
		}
		clear_array = AET_HLDV_current_arrows
		clear_variable = AET_HLDV_last_arrow_direction
		AET_HLDV_highlight = yes
	}
	add_to_variable = { AET_HLDV_dirty = 0.001 }
}

AET_HLDV_evaluate_sequence = {
	for_each_loop = {
		array = AET_HLDV_stratagem_list
		index = effect_i
		value = effect_j

		if = {
			limit = {
				all_of = {
					array = AET_HLDV_stratagem_code_list_@var:effect_j
					index = effect_k
					value = effect_l

					check_variable = { effect_l = AET_HLDV_current_arrows^effect_k }
				}
				check_variable = { var = AET_HLDV_current_arrows^num value = AET_HLDV_stratagem_code_list_@var:effect_j^num compare = less_than_or_equals }
			}
			meta_effect = {
				text = {
					AET_HLDV_effect_[INPUT] = yes
				}
				INPUT = "[?effect_j]"
			}
			clear_array = AET_HLDV_current_arrows
			clear_variable = AET_HLDV_last_arrow_direction
			AET_HLDV_highlight = yes
		}
	}
	add_to_variable = { AET_HLDV_dirty = 0.001 }
}

AET_HLDV_highlight = {
	if = {
		limit = {
			check_variable = { AET_HLDV_last_arrow_direction = 1 }
		}
		set_variable = { key_left_frame = 2 }
		set_variable = { key_up_frame = 1 }
		set_variable = { key_right_frame = 1 }
		set_variable = { key_down_frame = 1 }
	}
	else_if = {
		limit = {
			check_variable = { AET_HLDV_last_arrow_direction = 2 }
		}
		set_variable = { key_left_frame = 1 }
		set_variable = { key_up_frame = 2 }
		set_variable = { key_right_frame = 1 }
		set_variable = { key_down_frame = 1 }
	}
	else_if = {
		limit = {
			check_variable = { AET_HLDV_last_arrow_direction = 3 }
		}
		set_variable = { key_left_frame = 1 }
		set_variable = { key_up_frame = 1 }
		set_variable = { key_right_frame = 2 }
		set_variable = { key_down_frame = 1 }
	}
	else_if = {
		limit = {
			check_variable = { AET_HLDV_last_arrow_direction = 4 }
		}
		set_variable = { key_left_frame = 1 }
		set_variable = { key_up_frame = 1 }
		set_variable = { key_right_frame = 1 }
		set_variable = { key_down_frame = 2 }
	}
	else = {
		set_variable = { key_left_frame = 1 }
		set_variable = { key_up_frame = 1 }
		set_variable = { key_right_frame = 1 }
		set_variable = { key_down_frame = 1 }
	}
}

AET_HLDV_effect_1 = {
	log = "AET_HLDV_effect_1 executed"
	add_to_variable = { AET_HLDV_dirty = 0.001 }
}

AET_HLDV_effect_2 = {
	log = "AET_HLDV_effect_2 executed"
	add_to_variable = { AET_HLDV_dirty = 0.001 }
}

AET_HLDV_effect_3 = {
	log = "AET_HLDV_effect_3 executed"
	add_to_variable = { AET_HLDV_dirty = 0.001 }
}