#HAY_NM refers to the National Mood system. HAY_FC refers to the Federal Cohesion system.


HAY_setup = {
	HAY_national_mood_setup = yes
	HAY_state_arrays_setup = yes
}

HAY_weekly_effect = {
	HAY_national_mood_weekly = yes
}



HAY_national_mood_setup = {

	###INITIALISED CORE VARIABLES FOR NATIONAL MOOD
		set_variable = { HAY_NM_zealotry = 0.30 }
		set_variable = { HAY_NM_plotting = 0.10 }
	
	###INITIALISED VARIABLE FOR ANTAGONISM
		set_variable = { HAY_NM_antagonism = 0} #This is a boolean used for a scripted localisation's checks

	###CONFIG VALUES FOR NATIONAL MOOD RELATIVE DRIFT CALC

		#Check Values
		set_variable = { HAY_NM_antagonism_h = 0.30 }
		set_variable = { HAY_NM_antagonism_m = 0.20 }
		set_variable = { HAY_NM_antagonism_l = 0.10 }

		#Drift Values
		set_variable = { HAY_NM_drift_h = 0.05 }
		set_variable = { HAY_NM_drift_m = 0.02 }
		set_variable = { HAY_NM_drift_l = 0.01 }

	###CONFIG VALUES FOR NATIONAL MOOD WAR/PEACE DRIFT

		#/!\ Positive values only, unless you want to reverse the effect (say, gaining zealotry at peace for example.)

		#War values
		set_variable = { HAY_NM_Z_war_drift = 0.01 }
		set_variable = { HAY_NM_P_war_drift = 0.01 }

		#Peace values
		set_variable = { HAY_NM_P_peace_drift = 0.01 }
		set_variable = { HAY_NM_Z_peace_drift = 0.01 }


	HAY_NM_value_update = yes
	add_dynamic_modifier = {
		modifier = HAY_national_mood_modifier
	}
}

HAY_state_arrays_setup = {
	for_each_scope_loop = {
		array = ZUG.owned_states
		if = {
			limit = {
				is_core_of = ZUG
			}
			add_to_array = {
				array = HAY.HAY_ZUG_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = ZWA.owned_states
		if = {
			limit = {
				is_core_of = ZWA
			}
			add_to_array = {
				array = HAY.HAY_ZWA_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = ZEL.owned_states
		if = {
			limit = {
				is_core_of = ZEL
			}
			add_to_array = {
				array = HAY.HAY_ZEL_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = MSH.owned_states
		if = {
			limit = {
				is_core_of = MSH
			}
			add_to_array = {
				array = HAY.HAY_MSH_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = SON.owned_states
		if = {
			limit = {
				is_core_of = SON
			}
			add_to_array = {
				array = HAY.HAY_SON_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = TIM.owned_states
		if = {
			limit = {
				is_core_of = TIM
			}
			add_to_array = {
				array = HAY.HAY_TIM_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = MAZ.owned_states
		if = {
			limit = {
				is_core_of = MAZ
			}
			add_to_array = {
				array = HAY.HAY_MAZ_states
				value = THIS
			}
		}
	}
	for_each_scope_loop = {
		array = MSS.owned_states
		if = {
			limit = {
				is_core_of = MSS
			}
			add_to_array = {
				array = HAY.HAY_MSS_states
				value = THIS
			}
		}
	}
}



HAY_national_mood_weekly = {
	HAY_NM_value_update = yes

	#This applies the values.

	add_to_variable = { HAY_NM_zealotry = HAY_NM_Z_drift }
	add_to_variable = { HAY_NM_plotting = HAY_NM_P_drift }
	clamp_variable = {
		var = HAY_NM_zealotry
		min = 0
		max = 1
	}
	clamp_variable = {
		var = HAY_NM_plotting
		min = 0
		max = 1
	}

	HAY_NM_dynamic_modifier_calc = yes

	HAY_NM_value_update = yes
}



HAY_NM_dynamic_modifier_calc = {
	set_variable = {HAY_NM_pp_factor = 0}
	set_variable = {HAY_NM_stability_factor = 0}
	set_variable = {HAY_NM_war_support_factor = 0}
	set_variable = {HAY_NM_conscription_factor = 0}
	set_variable = {HAY_NM_morale_factor = 0}
	set_variable = {HAY_NM_org_factor = 0}
	set_variable = {HAY_NM_attack_factor = 0}

	set_temp_variable = {
		var = HAY_NM_plotting_half
		value = HAY_NM_plotting
	}
	multiply_temp_variable = {
		var = HAY_NM_plotting_half
		value = 0.5
	}
	set_temp_variable = {
		var = HAY_NM_plotting_quarter
		value = HAY_NM_plotting
	}
	multiply_temp_variable = {
		var = HAY_NM_plotting_quarter
		value = 0.25
	}
	subtract_from_variable = {
		var = HAY_NM_pp_factor
		value = HAY_NM_plotting_half
	}
	subtract_from_variable = {
		var = HAY_NM_stability_factor
		value = HAY_NM_plotting_quarter
	}
	subtract_from_variable = {
		var = HAY_NM_org_factor
		value = HAY_NM_plotting_quarter
	}
	set_temp_variable = {
		var = HAY_NM_zealotry_tenth
		value = HAY_NM_zealotry
	}
	multiply_temp_variable = {
		var = HAY_NM_zealotry_tenth
		value = 0.1
	}
	set_temp_variable = {
		var = HAY_NM_zealotry_fifth
		value = HAY_NM_zealotry
	}
	multiply_temp_variable = {
		var = HAY_NM_zealotry_fifth
		value = 0.2
	}
	set_temp_variable = {
		var = HAY_NM_zealotry_half
		value = HAY_NM_zealotry
	}
	multiply_temp_variable =  {
		var = HAY_NM_zealotry_half
		value = 0.5
	}
	set_temp_variable = {
		var = HAY_NM_zealotry_third
		value = HAY_NM_zealotry
	}
	multiply_temp_variable = {
		var = HAY_NM_zealotry_third
		value = 0.3
	}
	subtract_from_variable = {
		var = HAY_NM_stability_factor
		value = HAY_NM_zealotry_tenth
	}
	add_to_variable = {
		var = HAY_NM_war_support_factor
		value = HAY_NM_zealotry_half
	}
	add_to_variable = {
		var = HAY_NM_conscription_factor
		value = HAY_NM_zealotry_third
	}
	add_to_variable = {
		var = HAY_NM_morale_factor
		value = HAY_NM_zealotry_third
	}
	add_to_variable = {
		var = HAY_NM_attack_factor
		value = HAY_NM_zealotry_fifth
	}
}



HAY_NM_value_update = {
	set_variable = { HAY_NM_P_drift = 0 }
	set_variable = { HAY_NM_Z_drift = 0 }

	HAY_NM_relative_drift = yes

	add_to_variable = { HAY_NM_P_drift = modifier@HAY_weekly_plotting }
	add_to_variable = { HAY_NM_Z_drift = modifier@HAY_weekly_zealotry }
	
	if = {
		limit = {
			has_war = yes
		}
		add_to_variable = { HAY_NM_P_drift = HAY_NM_P_war_drift }
		add_to_variable = { HAY_NM_Z_drift = HAY_NM_Z_war_drift }
	}
	else = {
		subtract_from_variable = { HAY_NM_P_drift = HAY_NM_P_peace_drift }
		subtract_from_variable = { HAY_NM_Z_drift = HAY_NM_Z_peace_drift }
	}
}



HAY_NM_relative_drift = {

	#This effect serves to determine which of Zealotry or Plotting is lower. Based on the difference between the two, the lowest variable will get a weekly drift bonus.

	if = {	
		limit = { check_variable = { HAY_NM_zealotry > HAY_NM_plotting } }
		#Plotting Rubber banding
		set_variable = { HAY_NM_diff = HAY_NM_zealotry }
		subtract_from_variable = { HAY_NM_diff = HAY_NM_plotting }

		HAY_NM_relative_drift_calc = yes

		add_to_variable = { HAY_NM_P_drift = HAY_NM_calc_drift}

		set_variable = { HAY_NM_antagonism = 0}
	}
	else = {
		#Zealotry Rubber banding
		set_temp_variable = { HAY_NM_diff = HAY_NM_plotting }
		subtract_from_temp_variable = { HAY_NM_diff = HAY_NM_zealotry }

		HAY_NM_relative_drift_calc = yes

		add_to_variable = { HAY_NM_Z_drift = HAY_NM_calc_drift}

		set_variable = { HAY_NM_antagonism = 1}
	}
}



HAY_NM_relative_drift_calc = {

	#This effect calculates the drift of zealotry or plotting based on the current difference.

	if = {
		limit = { check_variable = { HAY_NM_diff > HAY_NM_antagonism_h } } #High Drift
		set_variable = { HAY_NM_calc_drift = HAY_NM_drift_h }
	}
	else_if = {
		limit = { check_variable = { HAY_NM_diff > HAY_NM_antagonism_m } } #Medium Drift
		set_variable = { HAY_NM_calc_drift = HAY_NM_drift_m }
	}
	else_if = {
		limit = { check_variable = { HAY_NM_diff > HAY_NM_antagonism_l } } #Low Drift
		set_variable = { HAY_NM_calc_drift = HAY_NM_drift_l }
	}
	else = {
		set_variable = { HAY_NM_calc_drift = 0 } #NO DRIFT
	}
}



HAY_federal_cohesion_setup = {
	
}

HAY_federal_cohesion_weekly = {

}

HAY_FC_display_update = {
	
}

### CIVIL WAR MECHANICS ###


# HAY_civil_war_setup = {
# 	news_event = { id = hayzeb_news.4 hours = 6 }
# 	HAY_slumdog_preacher = {
# 		set_nationality = HAR
# 	}
# 	HAY_nahantzi = {
# 		set_nationality = HAR
# 	}
# 	HAY_slumdog_preacher = {
# 		set_nationality = HAR
# 	}

# 	HAY_general_1 = {
# 		set_nationality = HAR
# 	}

# 	HAY_general_3 = {
# 		set_nationality = HAR
# 	}

# 	#HAP = {
# 	#	set_state_owner = 976
# 	#	set_state_owner = 974
# 	#	set_state_owner = 977
# 	#	set_state_owner = 1038
# 	#	set_state_owner = 1037
# 	#	transfer_state = 976
# 	#	transfer_state = 974
# 	#	transfer_state = 977
# 	#	transfer_state = 1038
# 	#	transfer_state = 1037
# 	#}
# 	HAR = {
# 		set_state_owner = 975
# 		set_state_owner = 971
# 		set_state_owner = 973
# 		set_state_owner = 972
# 		set_state_owner = 970
# 		set_state_owner = 949
# 		set_state_owner = 963
# 		set_state_owner = 965
# 		set_state_owner = 966
# 		set_state_owner = 967
# 		set_state_owner = 964
# 		set_state_owner = 969
# 		set_state_owner = 968
# 		transfer_state = 975
# 		transfer_state = 971
# 		transfer_state = 973
# 		transfer_state = 972
# 		transfer_state = 970
# 		transfer_state = 949
# 		transfer_state = 963
# 		transfer_state = 965
# 		transfer_state = 966
# 		transfer_state = 967
# 		transfer_state = 964
# 		transfer_state = 969
# 		transfer_state = 968
# 	}
# 	HAY = {
# 		transfer_units_fraction = {
# 			target = HAR
# 			size = 0.3
# 			stockpile_ratio = 0.3
# 			army_ratio = 0.3
# 			navy_ratio = 0.3
# 			air_ratio = 0.3
# 			keep_unit_leaders_trigger = {
# 				has_trait = zebra_race_trait
# 			}
# 		}
# 	}
	
# 	HAR = {
# 		add_country_leader_role = {
# 			character = HAY_zaria
# 			promote_leader = yes
# 			country_leader={
# 				desc = zaria_leader_desc
# 				expire = "1965.1.1"
# 				ideology = socialist_monarchism
# 				traits = {
# 					HAY_terrified_teenager
# 					HAY_puppet_of_seer
# 				}
# 			}
# 		}
# 		set_politics = {
# 			ruling_party = communism
# 			elections_allowed = no
# 		}
# 		drop_cosmetic_tag = yes
# 		set_cosmetic_tag = HAY_revenge
# 	}

# 	HAR = {
# 		load_oob = "HAY_rebel_armies"
# 	}
	
# }