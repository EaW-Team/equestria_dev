improve_roaman_economy_medium = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_production_speed_buildings_factor = 0.04
		tooltip = production_speed_buildings_factor_tt
	}
	add_to_variable = {
		ROA_economy_dm_production_factory_efficiency_gain_factor = 0.04
		tooltip = production_factory_efficiency_gain_factor_tt
	}
}
improve_roaman_economy_small = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_production_speed_buildings_factor = 0.02
		tooltip = production_speed_buildings_factor_tt
	}
	add_to_variable = {
		ROA_economy_dm_global_building_slots_factor = 0.02
		tooltip = global_building_slots_factor_tt
	}
}
resistance_dm_calculations = { # expected modifier = [ (non_core + recent_core*1/2)/overall ]*1/2
	for_each_scope_loop = { # it won't trigger if ROA is ai - TODO?
		array = ROOT.eaw_successfully_integrated_states
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.recently_integrated_states
						value = THIS.id
					}
				}
			}
			add_to_array = { ROOT.recently_integrated_states = THIS }
		}
	}
	for_each_scope_loop = {
		array = ROOT.owned_controlled_states
		add_to_temp_variable = { overall_population = THIS.state_population_k }
		add_to_temp_variable = { overall_industry = THIS.arms_factory_level }
		add_to_temp_variable = { overall_industry = THIS.industrial_complex_level }
		if = {
			limit = {
				is_in_array = {
					array = ROOT.recently_integrated_states
					value = THIS.id
				}
			}
			add_to_temp_variable = { recent_core_population = THIS.state_population_k }
			add_to_temp_variable = { recent_core_industry = THIS.arms_factory_level }
			add_to_temp_variable = { recent_core_industry = THIS.industrial_complex_level }
		}
		else_if = {
			limit = { 
				is_core_of = ROOT
			}
			add_to_temp_variable = { core_population = THIS.state_population_k }
			add_to_temp_variable = { core_industry = THIS.arms_factory_level }
			add_to_temp_variable = { core_industry = THIS.industrial_complex_level }
		}
		else = {
			add_to_temp_variable = { controlled_population_2 = THIS.state_population_k }
			add_to_temp_variable = { controlled_population_3 = THIS.state_population_k }
			add_to_temp_variable = { controlled_industry = THIS.arms_factory_level }
			add_to_temp_variable = { controlled_industry = THIS.industrial_complex_level }
			add_to_temp_variable = { controlled_industry_2 = THIS.arms_factory_level }
			add_to_temp_variable = { controlled_industry_2 = THIS.industrial_complex_level }
		}
	}
	log = "[GetDateText]: Overall population: [?overall_population|G]k"
	log = "[GetDateText]: Core population: [?core_population|G]k"
	log = "[GetDateText]: Recently cored population: [?recent_core_population|G]k"
	log = "[GetDateText]: Non-core population: [?controlled_population_2|G]k"

	log = "[GetDateText]: Overall industry: [?overall_industry|C]"
	log = "[GetDateText]: Core industry: [?core_industry|C]"
	log = "[GetDateText]: Recently cored industry: [?recent_core_industry|C]"
	log = "[GetDateText]: Non-core industry: [?controlled_industry|C]"
	
	divide_temp_variable = { recent_core_population = 2 }
	divide_temp_variable = { recent_core_industry = 2 }

	divide_temp_variable = { controlled_population_2 = overall_population }
	divide_temp_variable = { controlled_industry_2 = overall_industry }

	log = "[GetDateText]: Army Percentage (non-core divided by overall): [?controlled_population_2|%R]"
	log = "[GetDateText]: Industry Percentage (non-core divided by overall): [?controlled_industry_2|%R]"

	add_to_temp_variable = { controlled_population_3 = recent_core_population }
	divide_temp_variable = { controlled_population_3 = overall_population }
	divide_temp_variable = { controlled_population_3 = -1 }
	add_to_temp_variable = { controlled_population_3 = ROA_conscription_factor_calibration_var }
	clamp_temp_variable = {
		var = controlled_population_3
		max = 0
	}
	log = "[GetDateText]: Army Calibration Var: [?ROA_conscription_factor_calibration_var|%G]"
	log = "[GetDateText]: Army Expected Modifier: [?controlled_population_3|%R]"
	set_variable = { ROA_resistance_dm_conscription_factor = controlled_population_3 }

	add_to_temp_variable = { controlled_industry = recent_core_industry }
	divide_temp_variable = { controlled_industry = overall_industry }
	divide_temp_variable = { controlled_industry = -1 }
	add_to_temp_variable = { controlled_industry = ROA_efficiency_gain_calibration_var }
	clamp_temp_variable = {
		var = controlled_industry
		max = 0
	}
	log = "[GetDateText]: Industry Calibration Var: [?ROA_efficiency_gain_calibration_var|%G]"
	log = "[GetDateText]: Industry Expected Modifier: [?controlled_industry|%R]"
	set_variable = { ROA_resistance_dm_production_factory_efficiency_gain_factor = controlled_industry }
}
ROA_alsa_bop_mission_effect = {
	every_unit_leader = {
		limit = {
			NOT = { is_character = ROA_dassal }
		}
		add_attack = 1
		add_defense = 1
	}
	custom_effect_tooltip = ROA_modify_army_tt
	add_to_variable = {
		ROA_army_dm_army_attack_factor = 0.04
		tooltip = army_attack_factor_tt
	}
}
ROA_dassal_bop_mission_effect = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_industrial_capacity_factory = 0.08
		tooltip = industrial_capacity_factory_tt
	}
	add_to_variable = {
		ROA_economy_dm_industrial_capacity_dockyard = 0.08
		tooltip = industrial_capacity_dockyard_tt
	}
}
decrease_resistance_army_modifier = {
	custom_effect_tooltip = {
		localization_key = ROA_modify_resistance_tt
		MODIFIER = "MODIFIER_CONSCRIPTION_FACTOR"
	}
	add_to_variable = {
		ROA_conscription_factor_calibration_var = 0.02
		tooltip = conscription_factor_tt
	}
}
decrease_resistance_industry_modifier = {
	custom_effect_tooltip = {
		localization_key = ROA_modify_resistance_tt
		MODIFIER = "MODIFIER_PRODUCTION_FACTORY_EFFICIENCY_GAIN_FACTOR"
	}
	add_to_variable = {
		ROA_efficiency_gain_calibration_var = 0.02
		tooltip = production_factory_efficiency_gain_factor_tt
	}
}
ROA_civil_war_effect = { # United effect for Lansin's Uprising and Civil War after death of Augustus
	if = {
		limit = {
			NOT = { has_country_flag = uprising_suppressed }
			NOT = { has_country_flag = uprising_happened }
		}
		retire_character = ROA_lansin
		create_dynamic_country = {
			original_tag = ROA
   	 		inherit_technology = ROA
			save_global_event_target_as = lansin_uprising
			set_cosmetic_tag = ROA_lansin_uprising
			create_country_leader = {
				name = ROA_lansin
				picture = "gfx/leaders/ROA/ROA_Lansin.tga"
				ideology = stalinism
			}
			add_country_leader_role = {
				character = "ROA_lansin"
				promote_leader = yes
				country_leader = {
					ideology = stalinism
					expire = "1965.1.1.1"
				}
			}
			set_politics = {
				ruling_party = communism
				elections_allowed = no
			}
			set_popularities = {
				communism = 100
			}
			set_political_power = 200
			set_stability = 0.8
			set_war_support = 1.0
			add_ideas = {
				war_economy
				service_by_requirement
			}
			division_template = {
				name = "Militia"
				is_locked = yes
				template_counter = 6
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
				}
				priority = 0
			}
			load_focus_tree = {
				tree = roam_lansin_focus
				keep_completed = yes
			}
			mark_focus_tree_layout_dirty = yes
		}
		every_controlled_state = {
			limit = {
				NOT = { is_core_of = ROOT }
			}
			add_core_of = event_target:lansin_uprising
			transfer_state_to = event_target:lansin_uprising
			clamp_variable = {
				var = ROA.ROA_divs_calibration_var
				min = 1
			}
			create_unit = {
				division = "division_template = \"Militia\" start_experience_factor = 0.1"
				owner = event_target:lansin_uprising
				count = ROA.ROA_divs_calibration_var
				allow_spawning_on_enemy_provs = yes
			}
		}
		every_enemy_country = { # Every country in war with ROA declares war on uprising too
			declare_war_on = {
				target = event_target:lansin_uprising
				type = annex_everything
			}
		}
		set_country_flag = uprising_happened
	}
	if = { # Legate with lower influence will go to Lansin
		limit = {
			NOT = { has_country_flag = augustus_dead }
		}
		if = {
			limit = {
				is_power_balance_in_range = {
					id = ROA_bop
					range < ROA_Alsa_side_1
				}
			}
			set_nationality = {
    			target_country = event_target:lansin_uprising
    			character = ROA_dassal
			}
			every_unit_leader = {
				limit = {
					has_trait = dassal_supporter
				}
				set_nationality = { target_country = event_target:lansin_uprising }
			}
		}
		else_if = {
			limit = {
				is_power_balance_in_range = {
					id = ROA_bop
					range > ROA_Dassal_side_1
				}
			}
			set_nationality = {
    			target_country = event_target:lansin_uprising
    			character = ROA_alsa
			}
			every_unit_leader = {
				limit = {
					has_trait = alsa_supporter
				}
				set_nationality = { target_country = event_target:lansin_uprising }
			}
		}
	}
	else_if = { # Civil War in case of Augustus's death
		limit = {
			# If ROA doesn't have on of them, he/she went to Lansin previously, so new CW won't happen
			has_character = ROA_dassal
			has_character = ROA_alsa
		}
		# Divs amount calculation for legate's uprising
		subtract_from_variable = { legate_power_var = 1 }
		multiply_variable = { legate_power_var = -10 }
		clamp_variable = {
			var = legate_power_var
			min = 2
			max = 8
		}
		create_dynamic_country = { # Dynamic country is always assumed as non-player
			original_tag = ROA
   	 		inherit_technology = ROA
			save_global_event_target_as = legate_uprising
			if = {
				limit = {
					ROA = {
						has_country_leader = {
    						character = ROA_alsa
    						ruling_only = yes
						}
					}
				}
				ROA = { 
					retire_character = ROA_dassal 
					every_unit_leader = {
						limit = {
							has_trait = dassal_supporter
						}
						set_nationality = { target_country = event_target:legate_uprising }
					}
				}
				new_leader_is_dassal = yes
			}
			else_if = {
				limit = {
					ROA = {
						has_country_leader = {
    						character = ROA_dassal
    						ruling_only = yes
						}
					}
				}
				ROA = { 
					retire_character = ROA_alsa 
					every_unit_leader = {
						limit = {
							has_trait = alsa_supporter
						}
						set_nationality = { target_country = event_target:legate_uprising }
					}
				}
				new_leader_is_alsa = yes
			}
			set_political_power = 200
			set_stability = 0.8
			set_war_support = 1.0
			add_ideas = {
				slavery_economy
				service_by_requirement
			}
			division_template = {
				name = "Militia"
				is_locked = yes
				template_counter = 6
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
				}
				priority = 0
			}
		}
		every_controlled_state = {
			limit = {
				OR = {
					is_core_of = IBZ
					is_core_of = TSV
					state = 921
				}
			}
			add_core_of = event_target:legate_uprising
			transfer_state_to = event_target:legate_uprising
			create_unit = {
				division = "division_template = \"Militia\" start_experience_factor = 0.1"
				owner = event_target:legate_uprising
				count = ROA.legate_power_var
				allow_spawning_on_enemy_provs = yes
			}
		}
		every_enemy_country = { # Every country in war with ROA declares war on uprising too
			declare_war_on = {
				target = event_target:legate_uprising
				type = annex_everything
			}
		}
	}
	every_country_with_original_tag = { # Every participant of the civil war declares war on each other
		original_tag_to_check = ROA
		declare_war_on = {
			target = ROA
			type = civil_war
		}
		declare_war_on = {
			target = event_target:legate_uprising
			type = civil_war
		}
		declare_war_on = {
			target = event_target:lansin_uprising
			type = civil_war
		}
		add_civil_war_target = ROA
		add_civil_war_target = event_target:legate_uprising
		add_civil_war_target = event_target:lansin_uprising
		add_ideas = ROA_civil_war_idea
	}
}
new_leader_is_dassal = {
	custom_effect_tooltip = new_leader_is_dassal
	hidden_effect = {
		create_country_leader = {
			name = ROA_dassal
			picture = "gfx/leaders/ROA/ROA_dassal.tga"
			ideology = conservatism
		}
		add_country_leader_role = {
			character = "ROA_dassal"
			promote_leader = yes
			country_leader = {
				ideology = conservatism
				expire = "1965.1.1.1"
			}
		}
		set_politics = {
			ruling_party = democratic
			elections_allowed = no
		}
		set_popularities = {
			democratic = 100
		}
		load_focus_tree = {
			tree = roam_dassal_focus
			keep_completed = yes
		}
		mark_focus_tree_layout_dirty = yes
	}
}
new_leader_is_alsa = {
	custom_effect_tooltip = new_leader_is_alsa
	hidden_effect = {
		create_country_leader = {
			name = ROA_alsa
			picture = "gfx/leaders/ROA/ROA_alsa.tga"
			ideology = nazism
		}
		add_country_leader_role = {
			character = "ROA_alsa"
			promote_leader = yes
			country_leader = {
				ideology = nazism
				expire = "1965.1.1.1"
			}
		}
		set_politics = {
			ruling_party = fascism
			elections_allowed = no
		}
		set_popularities = {
			fascism = 100
		}
		load_focus_tree = {
			tree = roam_alsa_focus
			keep_completed = yes
		}
		mark_focus_tree_layout_dirty = yes
	}
}
increase_lansin_uprising_strength = {
	custom_effect_tooltip = increase_lansin_uprising_strength_tt
	add_to_variable = {
		ROA_divs_calibration_var = 1
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
decrease_lansin_uprising_strength = {
	custom_effect_tooltip = decrease_lansin_uprising_strength_tt
	add_to_variable = {
		ROA_divs_calibration_var = -1
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
increase_lansin_uprising_strength_by_two = {
	custom_effect_tooltip = increase_lansin_uprising_strength_by_two_tt
	add_to_variable = {
		ROA_divs_calibration_var = 2
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
decrease_lansin_uprising_strength_by_two = {
	custom_effect_tooltip = decrease_lansin_uprising_strength_by_two_tt
	add_to_variable = {
		ROA_divs_calibration_var = -2
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
increase_lansin_uprising_probability = {
	custom_effect_tooltip = increase_lansin_uprising_probability_tt
	set_temp_variable_to_random = {
		var = temp_var
		min = -60
		max = -30
		integer = yes
	}
	hidden_effect = {
		add_days_mission_timeout = {
			mission = ROA_uprising_mission_timeout
			days = temp_var
		}
	}
}
decrease_lansin_uprising_probability = {
	custom_effect_tooltip = decrease_lansin_uprising_probability_tt
	set_temp_variable_to_random = {
		var = temp_var
		min = 30
		max = 60
		integer = yes
	}
	hidden_effect = {
		add_days_mission_timeout = {
			mission = ROA_uprising_mission_timeout
			days = temp_var
		}
	}
}
increase_lansin_uprising_probability_by_two = {
	custom_effect_tooltip = increase_lansin_uprising_probability_by_two_tt
	set_temp_variable_to_random = {
		var = temp_var
		min = -120
		max = -60
		integer = yes
	}
	hidden_effect = {
		add_days_mission_timeout = {
			mission = ROA_uprising_mission_timeout
			days = temp_var
		}
	}
}
decrease_lansin_uprising_probability_by_two = {
	custom_effect_tooltip = decrease_lansin_uprising_probability_by_two_tt
	set_temp_variable_to_random = {
		var = temp_var
		min = 60
		max = 120
		integer = yes
	}
	hidden_effect = {
		add_days_mission_timeout = {
			mission = ROA_uprising_mission_timeout
			days = temp_var
		}
	}
}
create_legio_praetoriani_div = {
	add_to_variable = { legio_praetoriani_divs_cap_var = 1 }
	custom_effect_tooltip = legio_praetoriani_spawn_tt
	hidden_effect = {
		set_division_template_cap = { 
			division_template = "Legio Praetoriani" 
			division_cap = var:legio_praetoriani_divs_cap_var
		}
		capital_scope = {
			create_unit = { division = "division_template = \"Legio Praetoriani\" start_equipment_factor = 1.0 start_experience_factor = 0.5" owner = ROOT count = 1 }
		}
	}
}