improve_roaman_economy_medium = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_production_speed_buildings_factor = 0.04
		tooltip = production_speed_buildings_factor_tt
	}
	add_to_variable = {
		ROA_economy_dm_production_factory_efficiency_gain_factor = 0.04
		tooltip = production_factory_efficiency_gain_factor_tt
	}
}
improve_roaman_economy_small = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_production_speed_buildings_factor = 0.02
		tooltip = production_speed_buildings_factor_tt
	}
	add_to_variable = {
		ROA_economy_dm_global_building_slots_factor = 0.02
		tooltip = global_building_slots_factor_tt
	}
}
resistance_dm_calculations = { # expected modifier = [ (non_core + recent_core*1/2)/overall ]*1/2
	for_each_scope_loop = { # it won't trigger if ROA is ai - TODO?
		array = ROOT.eaw_successfully_integrated_states
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.recently_integrated_states
						value = THIS.id
					}
				}
			}
			add_to_array = { ROOT.recently_integrated_states = THIS }
		}
	}
	for_each_scope_loop = {
		array = ROOT.owned_controlled_states
		add_to_temp_variable = { overall_population = THIS.state_population_k }
		add_to_temp_variable = { overall_industry = THIS.arms_factory_level }
		add_to_temp_variable = { overall_industry = THIS.industrial_complex_level }
		if = {
			limit = {
				is_in_array = {
					array = ROOT.recently_integrated_states
					value = THIS.id
				}
			}
			add_to_temp_variable = { recent_core_population = THIS.state_population_k }
			add_to_temp_variable = { recent_core_industry = THIS.arms_factory_level }
			add_to_temp_variable = { recent_core_industry = THIS.industrial_complex_level }
		}
		else_if = {
			limit = { 
				is_core_of = ROOT
			}
			add_to_temp_variable = { core_population = THIS.state_population_k }
			add_to_temp_variable = { core_industry = THIS.arms_factory_level }
			add_to_temp_variable = { core_industry = THIS.industrial_complex_level }
		}
		else = {
			add_to_temp_variable = { controlled_population_2 = THIS.state_population_k }
			add_to_temp_variable = { controlled_population_3 = THIS.state_population_k }
			add_to_temp_variable = { controlled_industry = THIS.arms_factory_level }
			add_to_temp_variable = { controlled_industry = THIS.industrial_complex_level }
			add_to_temp_variable = { controlled_industry_2 = THIS.arms_factory_level }
			add_to_temp_variable = { controlled_industry_2 = THIS.industrial_complex_level }
		}
	}
	log = "[GetDateText]: Overall population: [?overall_population|G]k"
	log = "[GetDateText]: Core population: [?core_population|G]k"
	log = "[GetDateText]: Recently cored population: [?recent_core_population|G]k"
	log = "[GetDateText]: Non-core population: [?controlled_population_2|G]k"

	log = "[GetDateText]: Overall industry: [?overall_industry|C]"
	log = "[GetDateText]: Core industry: [?core_industry|C]"
	log = "[GetDateText]: Recently cored industry: [?recent_core_industry|C]"
	log = "[GetDateText]: Non-core industry: [?controlled_industry|C]"
	
	divide_temp_variable = { recent_core_population = 2 }
	divide_temp_variable = { recent_core_industry = 2 }

	divide_temp_variable = { controlled_population_2 = overall_population }
	divide_temp_variable = { controlled_industry_2 = overall_industry }

	log = "[GetDateText]: Army Percentage (non-core divided by overall): [?controlled_population_2|%R]"
	log = "[GetDateText]: Industry Percentage (non-core divided by overall): [?controlled_industry_2|%R]"

	add_to_temp_variable = { controlled_population_3 = recent_core_population }
	divide_temp_variable = { controlled_population_3 = overall_population }
	divide_temp_variable = { controlled_population_3 = -2 }
	add_to_temp_variable = { controlled_population_3 = ROA_conscription_factor_calibration_var }
	clamp_temp_variable = {
		var = controlled_population_3
		max = 0
	}
	log = "[GetDateText]: Army Calibration Var: [?ROA_conscription_factor_calibration_var|%G]"
	log = "[GetDateText]: Army Expected Modifier: [?controlled_population_3|%R]"
	set_variable = { ROA_resistance_dm_conscription_factor = controlled_population_3 }

	add_to_temp_variable = { controlled_industry = recent_core_industry }
	divide_temp_variable = { controlled_industry = overall_industry }
	divide_temp_variable = { controlled_industry = -2 }
	add_to_temp_variable = { controlled_industry = ROA_efficiency_gain_calibration_var }
	clamp_temp_variable = {
		var = controlled_industry
		max = 0
	}
	log = "[GetDateText]: Industry Calibration Var: [?ROA_efficiency_gain_calibration_var|%G]"
	log = "[GetDateText]: Industry Expected Modifier: [?controlled_industry|%R]"
	set_variable = { ROA_resistance_dm_production_factory_efficiency_gain_factor = controlled_industry }
}
ROA_alsa_bop_mission_effect = {
	every_unit_leader = {
		limit = {
			NOT = { is_character = ROA_dassal }
		}
		add_attack = 1
		add_defense = 1
	}
	custom_effect_tooltip = ROA_modify_army_tt
	add_to_variable = {
		ROA_army_dm_army_attack_factor = 0.04
		tooltip = army_attack_factor_tt
	}
}
ROA_dassal_bop_mission_effect = {
	custom_effect_tooltip = ROA_modify_economy_tt
	add_to_variable = {
		ROA_economy_dm_industrial_capacity_factory = 0.08
		tooltip = industrial_capacity_factory_tt
	}
	add_to_variable = {
		ROA_economy_dm_industrial_capacity_dockyard = 0.08
		tooltip = industrial_capacity_dockyard_tt
	}
}
decrease_resistance_army_modifier = {
	custom_effect_tooltip = {
		localization_key = ROA_modify_resistance_tt
		MODIFIER = "MODIFIER_CONSCRIPTION_FACTOR"
	}
	add_to_variable = {
		ROA_conscription_factor_calibration_var = 0.02
		tooltip = conscription_factor_tt
	}
}
decrease_resistance_industry_modifier = {
	custom_effect_tooltip = {
		localization_key = ROA_modify_resistance_tt
		MODIFIER = "MODIFIER_PRODUCTION_FACTORY_EFFICIENCY_GAIN_FACTOR"
	}
	add_to_variable = {
		ROA_efficiency_gain_calibration_var = 0.02
		tooltip = production_factory_efficiency_gain_factor_tt
	}
}
ROA_civil_war_effect = {
	retire_character = ROA_lansin
	create_dynamic_country = {
		original_tag = ROA
   	 	inherit_technology = ROA
		save_global_event_target_as = lansin_uprising
		set_cosmetic_tag = ROA_lansin_uprising
		create_country_leader = {
			name = ROA_lansin
			picture = "GFX_army_zebra_7"
			ideology = stalinism
		}
		promote_leader = ROA_lansin
		set_politics = {
			ruling_party = communism
			elections_allowed = no
		}
		set_popularities = {
			communism = 100
		}
	}
	every_controlled_state = {
		limit = {
			NOT = { is_core_of = ROOT }
		}
		add_core_of = event_target:lansin_uprising
		transfer_state_to = event_target:lansin_uprising
		add_to_temp_array = {
			initial_uprising_states_temp_array = THIS
		}
	}
	set_temp_variable = { divs_amount_var = ROA_divs_calibration_var }
	clamp_temp_variable = {
		var = divs_amount_var
		min = 1
		max = 10
	}
	event_target:lansin_uprising = {
		division_template = {
			name = "Militia"
			is_locked = yes
			template_counter = 6
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				infantry = { x = 0 y = 2 }
				infantry = { x = 1 y = 0 }
				infantry = { x = 1 y = 1 }
				infantry = { x = 1 y = 2 }
			}
			priority = 0
		}
		for_each_scope_loop = { # Creates Divisions
			array = ROA.initial_uprising_states_temp_array
			create_unit = {
				division = "division_template = \"Militia\" start_experience_factor = 0.1"
				owner = PREV
				count = ROA.divs_amount_var
				allow_spawning_on_enemy_provs = yes
			}
		}
		add_civil_war_target = ROA
		declare_war_on = {
			target = ROA
			type = civil_war
		}
	}
}
increase_lansin_uprising_strength = {
	custom_effect_tooltip = increase_lansin_uprising_strength_tt
	add_to_variable = {
		ROA_divs_calibration_var = 1
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
decrease_lansin_uprising_strength = {
	custom_effect_tooltip = decrease_lansin_uprising_strength_tt
	add_to_variable = {
		ROA_divs_calibration_var = -1
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
increase_lansin_uprising_strength_by_two = {
	custom_effect_tooltip = increase_lansin_uprising_strength_by_two_tt
	add_to_variable = {
		ROA_divs_calibration_var = 2
	}
	clamp_variable = {
		var = ROA_divs_calibration_var
		min = 0
		max = 10
	}
}
increase_lansin_uprising_probability = {
	custom_effect_tooltip = increase_lansin_uprising_probability_tt
	add_to_variable = {
		ROA_probabylity_calibration_var = 1

	}
	clamp_variable = {
		var = ROA_probabylity_calibration_var
		min = 0
		max = 10
	}
}
decrease_lansin_uprising_probability = {
	custom_effect_tooltip = decrease_lansin_uprising_probability_tt
	add_to_variable = {
		ROA_probabylity_calibration_var = -1
	}
	clamp_variable = {
		var = ROA_probabylity_calibration_var
		min = 0
		max = 10
	}
}
increase_lansin_uprising_probability_by_two = {
	custom_effect_tooltip = increase_lansin_uprising_probability_by_two_tt
	add_to_variable = {
		ROA_probabylity_calibration_var = 2
	}
	clamp_variable = {
		var = ROA_probabylity_calibration_var
		min = 0
		max = 10
	}
}
decrease_lansin_uprising_probability_by_two = {
	custom_effect_tooltip = decrease_lansin_uprising_probability_by_two_tt
	add_to_variable = {
		ROA_probabylity_calibration_var = -2
	}
	clamp_variable = {
		var = ROA_probabylity_calibration_var
		min = 0
		max = 10
	}
}
lansin_uprising_random_event_dispatcher = {
	hidden_effect = {
		random_list = {
    		10 = {
     			modifier = {
					check_variable = { event_5_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var = 10 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 5 }
					factor = 0.75
				}
				country_event = {
					id = roam_lansin_uprising.5
			    }
   			}
			10 = {
     			modifier = {
					check_variable = { event_6_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var = 10 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 5 }
					factor = 0.75
				}
				country_event = {
					id = roam_lansin_uprising.6
			    }
   			}
			10 = {
     		    modifier = {
					check_variable = { event_7_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var = 10 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 5 }
					factor = 0.75
				}
				country_event = {
					id = roam_lansin_uprising.7
				}
   			}
			10 = {
     			modifier = {
					check_variable = { event_8_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 6 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var < 4 }
					factor = 1.25
				}
				country_event = {
					id = roam_lansin_uprising.8
			    }
   			}
			20 = {
     			modifier = {
					check_variable = { event_9_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 5 }
					factor = 1.25
				}
				country_event = {
					id = roam_lansin_uprising.9
			    }
   			}
			20 = {
     			modifier = {
					check_variable = { event_10_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_divs_calibration_var > 5 }
					factor = 1.25
				}
				country_event = {
					id = roam_lansin_uprising.10
			    }
   			}
			20 = {
     			modifier = {
					check_variable = { event_11_fired > 0 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_probabylity_calibration_var > 6 }
					factor = 0
				}
				modifier = {
					check_variable = { ROA_probabylity_calibration_var < 4 }
					factor = 1.25
				}
				country_event = {
					id = roam_lansin_uprising.11
			    }
   			}
		}
		clear_variable = event_5_fired
		clear_variable = event_6_fired
		clear_variable = event_7_fired
		clear_variable = event_8_fired
		clear_variable = event_9_fired
		clear_variable = event_10_fired
		clear_variable = event_11_fired
	}
}