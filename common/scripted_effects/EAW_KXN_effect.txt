KXN_TALLY_CASUALTIES_EFFECT = {
	clear_variable = KXN.KXNHarvest_Kills_Var
	add_to_variable = { KXN.KXNHarvest_Kills_Var = KXN.inflicted_casualties }
	add_to_variable = { KXN.KXNHarvest_Kills_Var = KXN.total_inflicted_civilian_casualties }
	subtract_from_variable = { KXN.KXNHarvest_Kills_Var = KXN.KXNHarvest_Total_Kills_Var }
	
	set_variable = { KXN.KXNHarvest_Total_Inflicted_Casualties_Var = KXN.inflicted_casualties }
	add_to_variable = { KXN.KXNHarvest_Total_Inflicted_Casualties_Var = KXN.total_inflicted_civilian_casualties }
	
	set_variable = { KXN.KXNHarvestProgBar_Var = KXN.KXNHarvest_Kills_Var }
	divide_variable = { KXN.KXNHarvestProgBar_Var = KXN.KXNHarvest_Max_Var }
	multiply_variable = { KXN.KXNHarvestProgBar_Var = 100 }
}
KXN_OCCUPY_STATE_EFFECT = {
	custom_effect_tooltip = KIR_line_break
	if = {
		limit = {
			KXN = { has_country_flag = KXN_OCCUPY_STATE_EFFECT_PROCURE }
		}
		custom_effect_tooltip = KXN_PROCURE_BUILDING_REMOVE
		if = {
			limit = {
				OR = {
					check_variable = { building_level@arms_factory > 0 }
					check_variable = { building_level@industrial_complex > 0 }
					check_variable = { building_level@dockyard > 0 }
					check_variable = { building_level@synthetic_refinery > 0 }
					check_variable = { building_level@fuel_silo > 0 }
					#check_variable = { building_level@nuclear_reactor > 0 }
				}
			}
			every_country = {
				limit = { tag = ROOT }
				
				if = {
					limit = {
						check_variable = { PREV.building_level@industrial_complex > 0 }
					}
					set_temp_variable = { PROCURE_industrial_complex_level = PREV.building_level@industrial_complex }
					multiply_temp_variable = { PROCURE_industrial_complex_level = PROCURE_building_level }
					add_offsite_building = { type = industrial_complex level = PROCURE_industrial_complex_level }
				}
				
				if = {
					limit = {
						check_variable = { PREV.building_level@arms_factory > 0 }
					}
					set_temp_variable = { PROCURE_arms_factory_level = PREV.building_level@arms_factory }
					multiply_temp_variable = { PROCURE_arms_factory_level = PROCURE_building_level }
					add_offsite_building = { type = arms_factory level = PROCURE_arms_factory_level }
				}
				
				if = {
					limit = {
						check_variable = { PREV.building_level@dockyard > 0 }
					}
					set_temp_variable = { PROCURE_dockyard_level = PREV.building_level@dockyard }
					multiply_temp_variable = { PROCURE_dockyard_level = PROCURE_building_level }
					add_offsite_building = { type = dockyard level = PROCURE_dockyard_level }
				}
				
				if = {
					limit = {
						check_variable = { PREV.building_level@synthetic_refinery > 0 }
					}
					set_temp_variable = { PROCURE_synthetic_refinery_level = PREV.building_level@synthetic_refinery }
					multiply_temp_variable = { PROCURE_synthetic_refinery_level = PROCURE_building_level }
					KXN = { add_offsite_building = { type = synthetic_refinery level = PROCURE_synthetic_refinery_level } }
				}
				
				if = {
					limit = {
						check_variable = { PREV.building_level@fuel_silo > 0 }
					}
					set_temp_variable = { PROCURE_fuel_silo_level = PREV.building_level@fuel_silo }
					multiply_temp_variable = { PROCURE_fuel_silo_level = PROCURE_building_level }
					add_offsite_building = { type = fuel_silo level = PROCURE_fuel_silo_level }
				}
				
				#if = {
				#	limit = {
				#		check_variable = { PREV.building_level@nuclear_reactor > 0 }
				#	}
				#	set_temp_variable = { PROCURE_nuclear_reactor_level = PREV.building_level@nuclear_reactor }
				#	multiply_temp_variable = { PROCURE_nuclear_reactor_level = PROCURE_building_level }
				#	add_offsite_building = { type = nuclear_reactor level = PROCURE_nuclear_reactor_level }
				#}
			}
		}
		
		hidden_effect = {
			remove_building = { type = arms_factory level = building_level@arms_factory }
			remove_building = { type = industrial_complex level = building_level@industrial_complex }
			remove_building = { type = dockyard level = building_level@dockyard }
			remove_building = { type = synthetic_refinery level = building_level@synthetic_refinery }
			remove_building = { type = fuel_silo level = building_level@fuel_silo }
			#remove_building = { type = nuclear_reactor level = building_level@nuclear_reactor }
		}
	}
	else = {
		KXN = {
			add_to_variable = { KXN.total_states_pacified = 1 }
			hidden_effect = {
				add_political_power = -15
			}
		}
		add_dynamic_modifier = { modifier = KXN_Pacified_State days = 365 }
		custom_effect_tooltip = KXN_CF_OCCUPY_BUTTON_COST
	}
}
KXN_PILLAGE_STATE_EFFECT = {
	custom_effect_tooltip = KIR_line_break
	KXN = {
		add_to_variable = { KXN.total_inflicted_civilian_casualties = 7.5 }
		add_to_variable = { KXN.total_states_pillaged = 1 }
		KXN_TALLY_CASUALTIES_EFFECT = yes
		save_current_manpower = yes
	}
	add_manpower = -7500
	custom_effect_tooltip = KXN_PILLAGE_BUILDING_DAMAGE
	hidden_effect = {
		KXN = { restore_previous_manpower = yes }
		damage_building = { type = infrastructure damage = 1.5 }
		damage_building = { type = nuclear_reactor damage = 1.5 }
		damage_building = { type = industrial_complex damage = 1.5 }
		damage_building = { type = arms_factory damage = 1.5 }
		damage_building = { type = dockyard damage = 1.5 }
		damage_building = { type = fuel_silo damage = 1.5 }
		damage_building = { type = synthetic_refinery damage = 1.5 }
	}
	add_dynamic_modifier = { modifier = KXN_Plundered_State days = 365 }
}
KXN_BURN_STATE_EFFECT = {
	custom_effect_tooltip = KIR_line_break
	KXN = {
		add_to_variable = { KXN.total_inflicted_civilian_casualties = 25 }
		add_to_variable = { KXN.total_states_burned = 1 }
		KXN_TALLY_CASUALTIES_EFFECT = yes
		save_current_manpower = yes
	}
	add_manpower = -25000
	custom_effect_tooltip = KXN_BURN_BUILDING_REMOVE
	hidden_effect = {
		KXN = { restore_previous_manpower = yes }
		remove_building = { type = infrastructure level = 3 }
		remove_building = { type = nuclear_reactor level = 3 }
		remove_building = { type = industrial_complex level = 3 }
		remove_building = { type = arms_factory level = 3 }
		remove_building = { type = dockyard level = 3 }
		remove_building = { type = fuel_silo level = 3 }
		remove_building = { type = synthetic_refinery level = 3 }
	}
	add_dynamic_modifier = { modifier = KXN_Purified_State days = 365 }
	add_resistance = -15
}

KXN_INCREASE_UNREST = {
	if = {
		limit = {
			KXN = {
				is_ai = no
				num_subjects > 0
				any_subject_country = {
					has_idea = KXN_Tributary_State
				}
			}
		}
		custom_effect_tooltip = KIR_line_break
		KXN = {
			every_subject_country = {
				limit = {
					has_idea = KXN_Tributary_State
				}
				custom_effect_tooltip = KXN_Increase_Tributary_Unrest_tt
				add_to_variable = { KXN_Tributary_Unrest_Var = 1 }
			}
			custom_effect_tooltip = KIR_line_break
		}
	}
}
KXN_SPAWN_REVOLT_UNITS = {
	division_template = {
		name = "Rebel Infantry"
		regiments = {
			infantry = { x = 0 y = 0 }
			infantry = { x = 0 y = 1 }
			infantry = { x = 0 y = 2 }
			infantry = { x = 1 y = 0 }
			infantry = { x = 1 y = 1 }
			infantry = { x = 1 y = 2 }
		}
		support = {
			artillery = { x = 0 y = 0 }
		}
	}
	division_template = {
		name = "Rebel Militia"
		regiments = {
			militia = { x = 0 y = 0 }
			militia = { x = 0 y = 1 }
			militia = { x = 0 y = 2 }
			militia = { x = 1 y = 0 }
			militia = { x = 1 y = 1 }
			militia = { x = 1 y = 2 }
		}
	}
	capital_scope = {
		create_unit = {
			division = "division_template = \"Rebel Infantry\" start_experience_factor = 0.25 start_equipment_factor = 1"
			owner = ROOT
			count = 2
		}
		create_unit = {
			division = "division_template = \"Rebel Militia\" start_experience_factor = 0.15 start_equipment_factor = 0.75"
			owner = ROOT
			count = 4
		}
	}
}
KXN_REFRESH_VALIANTS_EFFECT = {
	set_technology = { popup = no KXN_Valiants_Reset = 1 }
	set_technology = { popup = no KXN_Valiants_Reset = 0 }
}
KXN_SET_NIRIK_PORTRAITS_EFFECT = {
	set_portraits = {
		character = KXN_Long_Dusk
		army = { large = "GFX_portrait_KXN_Long_Dusk_Nirik" }
		civilian = { large = "GFX_portrait_KXN_Long_Dusk_Nirik" }
	}
	set_portraits = {
		character = KXN_Clarion_Call
		army = { large = "GFX_portrait_KXN_Clarion_Call_Nirik" }
		civilian = { large = "GFX_portrait_KXN_Clarion_Call_Nirik" }
	}
	set_portraits = {
		character = KXN_Prairie_Spark
		army = { large = "GFX_portrait_KXN_Prairie_Spark_Nirik" }
		civilian = { large = "GFX_portrait_KXN_Prairie_Spark_Nirik" }
	}
}
KXN_SET_KIRIN_PORTRAITS_EFFECT = {
	set_portraits = {
		character = KXN_Long_Dusk
		army = { large = "GFX_portrait_KXN_Long_Dusk" }
		civilian = { large = "GFX_portrait_KXN_Long_Dusk" }
	}
	set_portraits = {
		character = KXN_Clarion_Call
		army = { large = "GFX_portrait_KXN_Clarion_Call" }
		civilian = { large = "GFX_portrait_KXN_Clarion_Call" }
	}
	set_portraits = {
		character = KXN_Prairie_Spark
		army = { large = "GFX_portrait_KXN_Prairie_Spark" }
		civilian = { large = "GFX_portrait_KXN_Prairie_Spark" }
	}
}