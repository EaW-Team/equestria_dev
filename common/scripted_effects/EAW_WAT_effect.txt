
WAT_calculate_religion_secularism_balance = {
	#Clamp religous lean
	clamp_variable = {
		var = secular_religious_lean
		min = 0
		max = 100
	}
	#Calculates difference from balanced aka 50
	if = {
		limit = { 
			check_variable = {
				var = secular_religious_lean
				value = 50
				compare = greater_than
			}
		}
		set_temp_variable = { diff_from_balanced = -50 }
		add_to_temp_variable = { diff_from_balanced = secular_religious_lean }
		#Research speed calculation, scale 50/30
		set_variable = { WAT_religion_secularism_balance_research_var = diff_from_balanced }
		divide_variable = { WAT_religion_secularism_balance_research_var = 5 }
		multiply_variable = { WAT_religion_secularism_balance_research_var = 3 }
		#Factory output calculation, scale 50/15
		set_variable = { WAT_religion_secularism_balance_fac_output_var = diff_from_balanced }
		divide_variable = { WAT_religion_secularism_balance_fac_output_var = 5 }
		multiply_variable = { WAT_religion_secularism_balance_fac_output_var = 1.5 }
		#Reset other modifiers to 0
		set_variable = { WAT_religion_secularism_balance_pop_var = 0 }
		set_variable = { WAT_religion_secularism_balance_conscription_var = 0 }
	}
	else = {
		set_temp_variable = { diff_from_balanced = 50 }
		subtract_from_temp_variable = { diff_from_balanced = secular_religious_lean }
		#Pop growth calculation, scale 50/75 (=2.5)
		set_variable = { WAT_religion_secularism_balance_pop_var = diff_from_balanced }
		multiply_variable = { WAT_religion_secularism_balance_pop_var = 2.5 }
		#Recruitable pop modifier calculation, scale 50/10 (=5)
		set_variable = { WAT_religion_secularism_balance_conscription_var = diff_from_balanced }
		divide_variable = { WAT_religion_secularism_balance_conscription_var = 5 }
		#Reset other modifiers to 0
		set_variable = { WAT_religion_secularism_balance_research_var = 0 }
		set_variable = { WAT_religion_secularism_balance_fac_output_var = 0 }
	}
	#Stability calculation don't add any more calculations after this, scale abs(diff-50)
	multiply_temp_variable = { diff_from_balanced = -1 }
	add_to_temp_variable = { diff_from_balanced = 15}
	clamp_variable = {
		var = diff_from_balanced
		min = 0
		max = 15
	}
	set_variable = { WAT_religion_secularism_balance_stab_var = diff_from_balanced }
	#Divide by 100 to scale to modifiers
	divide_variable = { WAT_religion_secularism_balance_research_var = 100 }
	divide_variable = { WAT_religion_secularism_balance_fac_output_var = 100 }
	divide_variable = { WAT_religion_secularism_balance_stab_var = 100 }
	divide_variable = { WAT_religion_secularism_balance_pop_var = 100 }
	divide_variable = { WAT_religion_secularism_balance_conscription_var = 100 }
	#Update dynamic modifier with new values
	force_update_dynamic_modifier = yes
}

WAT_calculate_religion_secularism_minus_5 = {
	subtract_from_variable = { secular_religious_lean = 5 }
	WAT_calculate_religion_secularism_balance = yes
}

WAT_calculate_religion_secularism_plus_5 = {
	add_to_variable = { secular_religious_lean = 5 }
	WAT_calculate_religion_secularism_balance = yes
}