
LCT_DIET_initiate = {
	clear_array = LCT_DIET_seats_array
	
	add_to_array = { LCT_DIET_seats_array = 40 }
	add_to_array = { LCT_DIET_seats_array = 67 }
	add_to_array = { LCT_DIET_seats_array = 26 }
	add_to_array = { LCT_DIET_seats_array = 27 }
	
	clear_array = LCT_DIET_seats_display_array
	
	resize_array = { LCT_DIET_seats_display_array = 40 value = 0 }
	resize_array = { LCT_DIET_seats_display_array = 107 value = 1 }
	resize_array = { LCT_DIET_seats_display_array = 133 value = 2 }
	resize_array = { LCT_DIET_seats_display_array = 160 value = 3 }
	
	set_country_flag = LCT_Diet_Visible
	add_to_variable = { LCT_Diet_Dirty = 0.01 }
}

#### Indexes
# 0 = TBD
# 1 = LDP
# 2 = CTT
# 3 = Independents

## How to use:
# set_temp_variable = { temp_faction = 1 }
# set_temp_variable = { temp_seats = 10 }
# LCT_DIET_change_seats = yes

## This will change the LDP's (1) seat count by 10, deducting it from other factions.
## The scripted effect will generate its own tooltip so don't worry about that.

LCT_DIET_change_seats = {
	
	## Normalize values
	set_temp_variable = { future_value = LCT_DIET_seats_array^temp_faction }
	add_to_temp_variable = { future_value = temp_seats }
	if = {
		limit = {
			check_variable = { future_value > 160 }
		}
		set_temp_variable = { min_temp_seats = future_value }
		subtract_from_temp_variable = { min_temp_seats = 160 }
		subtract_from_temp_variable = { temp_seats = min_temp_seats }
	}
	else_if = {
		limit = {
			check_variable = { future_value < 0 }
		}
		subtract_from_temp_variable = { temp_seats = future_value }
	}
	
	## Tooltip generation + seperating positive/negative
	if = {
		limit = {
			check_variable = { temp_seats > 0 }
		}
		set_temp_variable = { positive_negative = 1 }
		custom_effect_tooltip = LCT_DIET_change_seats_positive_tt
	}
	else = {
		set_temp_variable = { positive_negative = -1 }
		multiply_temp_variable = { temp_seats = -1 }
		custom_effect_tooltip = LCT_DIET_change_seats_negative_tt
	}
	
	## Subtracting seats from other factions based on:
	#	if positive: more seats means you are more likely to be subtracted from
	#	if negative: less seats means you are more likely to be added upon
	for_loop_effect = {
		start = 0
		end = temp_seats

		for_each_loop = {
			array = LCT_DIET_seats_array
			value = x
			index = y
			
			if = {
				limit = {
					check_variable = { positive_negative = 1 }
				}
				add_to_temp_array = { chance = x }
			}
			else = {
				set_temp_variable = { chance_n = 160 }
				subtract_from_temp_variable = { chance_n = x }
				add_to_temp_array = { chance = chance_n }
			}

			if = {
				limit = {
					OR = {
						check_variable = { temp_faction = y }
						AND = {
							check_variable = { positive_negative = 1 }
							check_variable = { x = 0 }
						}
					}
				}
				set_temp_variable = { chance^y = 0 }
			}
		}
		
		random_list = {
			chance^0 = {
				subtract_from_variable = { LCT_DIET_seats_array^0 = positive_negative }
			}
			chance^1 = {
				subtract_from_variable = { LCT_DIET_seats_array^1 = positive_negative }
			}
			chance^2 = {
				subtract_from_variable = { LCT_DIET_seats_array^2 = positive_negative }
			}
			chance^3 = {
				subtract_from_variable = { LCT_DIET_seats_array^3 = positive_negative }
			}
		}
		clear_temp_array = chance
	}
	multiply_temp_variable = { temp_seats = positive_negative }
	add_to_variable = { LCT_DIET_seats_array^temp_faction = temp_seats }
	
	LCT_DIET_re_render = yes
	
	clear_variable = temp_seats
	clear_variable = temp_faction
}

## How to use:
# add_to_temp_array = { bill_support_ratio = 0.8 } # This is for the TBD
# add_to_temp_array = { bill_support_ratio = 0.3 } # This is for the LDP
# add_to_temp_array = { bill_support_ratio = 0.6 } # This is for the CTT
# add_to_temp_array = { bill_support_ratio = 0.5 } # This is for the Independents
# LCT_initiate_new_bill = yes
# hidden_effect = {
# 	 activate_mission = LCT_Bill_Mandatory_Cheeseburgers
# }

LCT_initiate_new_bill = {
	custom_effect_tooltip = LCT_initiate_new_bill_tt

	for_each_loop = {
		array = LCT_DIET_seats_array
		add_to_array = { LCT_DIET_support = v }
		multiply_variable = { LCT_DIET_support^i = bill_support_ratio^i }
		round_variable = LCT_DIET_support^i
	}
	set_country_flag = LCT_bill_on_the_floor
	LCT_re_calculate_support_for_bill = yes
}

## How to use:
# set_temp_variable = { temp_faction = 1 }
# set_temp_variable = { temp_support = 10 }
# LCT_change_support_for_bill = yes

## This will change the LDP's (1) support for the current bill by 10, maxing out at the LDP's total seat count.
## The scripted effect will generate its own tooltip so don't worry about that.

LCT_change_support_for_bill = {
	set_temp_variable = { hard_cap = LCT_DIET_seats_array^temp_faction }
	set_temp_variable = { future_value = LCT_DIET_support^temp_faction }
	add_to_temp_variable = { future_value = temp_support }
	
	if = {
		limit = {
			check_variable = { future_value > hard_cap }
		}
		set_temp_variable = { normalizer = future_value }
		subtract_from_temp_variable = { normalizer = hard_cap }
		subtract_from_temp_variable = { temp_support = normalizer }
	}

	custom_effect_tooltip = LCT_change_support_for_bill_tt

	add_to_variable = { LCT_DIET_support^temp_faction = temp_support }
	LCT_re_calculate_support_for_bill = yes
	
	clear_variable = temp_faction
	clear_variable = temp_support
}

### BACKEND STUFF, don't worry about these

LCT_DIET_re_render = {
	set_temp_variable = { seats_1 = LCT_DIET_seats_array^0 }
	add_to_temp_variable = { seats_1 = LCT_DIET_seats_array^1 }

	set_temp_variable = { seats_2 = seats_1 }
	add_to_temp_variable = { seats_2 = LCT_DIET_seats_array^2 }

	set_temp_variable = { seats_3 = seats_2 }
	add_to_temp_variable = { seats_3 = LCT_DIET_seats_array^3 }
	
	clear_array = LCT_DIET_seats_display_array
	
	resize_array = { LCT_DIET_seats_display_array = LCT_DIET_seats_array^0 value = 0 }
	resize_array = { LCT_DIET_seats_display_array = seats_1 value = 1 }
	resize_array = { LCT_DIET_seats_display_array = seats_2 value = 2 }
	resize_array = { LCT_DIET_seats_display_array = seats_3 value = 3 }
	add_to_variable = { LCT_Diet_Dirty = 0.01 }
	
	if = {
		limit = {
			has_country_flag = LCT_bill_on_the_floor
		}
		LCT_re_calculate_support_for_bill = yes
	}
	
	log = "LCT: Re render GUI"
	log = "LCT_DIET_seats_array^0 = [?LCT_DIET_seats_array^0]"
	log = "LCT_DIET_seats_array^1 = [?LCT_DIET_seats_array^1]"
	log = "LCT_DIET_seats_array^2 = [?LCT_DIET_seats_array^2]"
	log = "LCT_DIET_seats_array^3 = [?LCT_DIET_seats_array^3]"
	log = "TOTAL = [?LCT_DIET_seats_display_array^num]"
}

LCT_re_calculate_support_for_bill = {
	clear_variable = LCT_Current_Support_for_Bill
	for_each_loop = {
		array = LCT_DIET_support

		clamp_variable = { var = LCT_DIET_support^i min = 0 max = LCT_DIET_seats_array^i }
		add_to_variable = { LCT_Current_Support_for_Bill = v }
	}
	
	resize_array = { LCT_DIET_is_seat_supporting = LCT_DIET_support^0 value = 1 }
	resize_array = { LCT_DIET_is_seat_supporting = LCT_DIET_seats_array^0 value = 0 }
	
	set_temp_variable = { supporting_1 = LCT_DIET_is_seat_supporting^num }
	add_to_temp_variable = { supporting_1 = LCT_DIET_support^1 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_1 value = 1 }
	subtract_from_temp_variable = { supporting_1 = LCT_DIET_support^1 }
	add_to_temp_variable = { supporting_1 = LCT_DIET_seats_array^1 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_1 value = 0 }
	
	set_temp_variable = { supporting_2 = LCT_DIET_is_seat_supporting^num }
	add_to_temp_variable = { supporting_2 = LCT_DIET_support^2 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_2 value = 1 }
	subtract_from_temp_variable = { supporting_2 = LCT_DIET_support^2 }
	add_to_temp_variable = { supporting_2 = LCT_DIET_seats_array^2 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_2 value = 0 }
	
	set_temp_variable = { supporting_3 = LCT_DIET_is_seat_supporting^num }
	add_to_temp_variable = { supporting_3 = LCT_DIET_support^3 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_3 value = 1 }
	subtract_from_temp_variable = { supporting_3 = LCT_DIET_support^3 }
	add_to_temp_variable = { supporting_3 = LCT_DIET_seats_array^3 }
	resize_array = { LCT_DIET_is_seat_supporting = supporting_3 value = 0 }
	
	add_to_variable = { LCT_Diet_Dirty = 0.01 }
}

LCT_clean_up_bill = {
	clear_array = LCT_DIET_support
	clear_array = LCT_DIET_is_seat_supporting
	clear_variable = LCT_Current_Support_for_Bill
	clr_country_flag = LCT_bill_on_the_floor
	add_to_variable = { LCT_Diet_Dirty = 0.01 }
}

LCT_do_demand_random = {
	if = {
		limit = {
			NOT = {
				has_country_flag = LCT_demand_in_Progress
			}
		}
		random = {
			chance = 33
			LCT_select_demand = yes
		}
	}
}

LCT_select_demand = {

	#Reset Chance To Happen Variables
	set_variable = { LCT_fort_build_chance_var = 0 }
	set_variable = { LCT_raise_rhetoric_chance_var = 0 }
	
	#Fort Building Demand
	clear_variable = LCT_bordering_state_target_var
	random_owned_state = {
		limit = {
			NOT = {
				all_neighbor_state  = {
					is_owned_by = LCT
				}
				has_state_flag = LCT_fortified_border
			}
		}
		set_variable = { ROOT.LCT_bordering_state_target_var = THIS.id }
		set_variable = { ROOT.LCT_fort_build_chance_var = 10 }
	}
	
	#Raise Rhetoric Demand
	if = {
		limit = {
			OR = {
				AND = {
					check_variable = {
						var = lct_unity_rhetoric_var
						value = 0.3
						compare = less_than
					}
					has_country_flag = LCT_unlocked_stability_rhetoric
				}
				AND = {
					check_variable = {
						var = lct_productivity_rhetoric_var
						value = 0.3
						compare = less_than
					}
					has_country_flag = LCT_Propaganda_Campaign_Visible
				}
				AND = {
					check_variable = {
						var = lct_war_support_rhetoric_var
						value = 0.3
						compare = less_than
					}
					has_country_flag = LCT_unlocked_war_support_rhetoric
				}
			}
		}
		set_variable = { LCT_raise_rhetoric_chance_var = 10 }
	}
	
	log = "[?LCT_fort_build_chance_var]"
	log = "[?LCT_raise_rhetoric_chance_var]"
	
	#Random Mission List
	random_list = {
		LCT_fort_build_chance_var = {
			country_event = {
				id = LCT_six_lords_demands.1
				days = 5
				random_hours = 24
				random_days = 13
			}
			log = "Build Forts"
		}
		LCT_raise_rhetoric_chance_var = {
			LCT_raise_rhetoric_demand_selection = yes
			log = "Raise Rhetoric"
		}
	}
}

LCT_raise_rhetoric_demand_selection = {
	set_temp_variable = { LCT_unity_chance_var = 0 }
	set_temp_variable = { LCT_productivity_chance_var = 0 }
	set_temp_variable = { LCT_war_support_chance_var = 0 }
	
	if = {
		limit = {
			check_variable = {
				var = lct_unity_rhetoric_var
				value = 0.3
				compare = less_than
			}
			has_country_flag = LCT_unlocked_stability_rhetoric
		}
		set_temp_variable = { LCT_unity_chance_var = 10 }
	}
	if = {
		limit = {
			check_variable = {
				var = lct_productivity_rhetoric_var
				value = 0.3
				compare = less_than
			}
			has_country_flag = LCT_Propaganda_Campaign_Visible
		}
		set_temp_variable = { LCT_productivity_chance_var = 10 }
	}
	if = {
		limit = {
			check_variable = {
				var = lct_war_support_rhetoric_var
				value = 0.3
				compare = less_than
			}
			has_country_flag = LCT_unlocked_war_support_rhetoric
		}
		set_temp_variable = { LCT_war_support_chance_var = 10 }
	}
	
	random_list = {
		LCT_unity_chance_var = {
			country_event = {
				id = LCT_six_lords_demands.2
				days = 5
				random_hours = 24
				random_days = 13
			}
		}
		LCT_productivity_chance_var = {
			country_event = {
				id = LCT_six_lords_demands.3
				days = 5
				random_hours = 24
				random_days = 13
			}
		}
		LCT_war_support_chance_var = {
			country_event = {
				id = LCT_six_lords_demands.4
				days = 5
				random_hours = 24
				random_days = 13
			}
		}
	}
}