HYE_underground_conscription_var_display = {
	set_variable = { HYE_underworld_population_displayed = HYE_underworld_population }
	subtract_from_variable = { HYE_underworld_population_displayed = HYE_deducted_casualties}
	round_variable = HYE_underworld_population_displayed
	divide_variable = { HYE_underworld_population_displayed = 1000 }

	set_variable = { HYE_deducted_casualties_displayed = HYE_deducted_casualties}
	multiply_variable = { HYE_deducted_casualties_displayed = 1000 }
	round_variable = HYE_deducted_casualties_displayed

	set_variable = { HYE_conscription_target_displayed = HYE_conscription_target }
	multiply_variable = { HYE_conscription_target_displayed = 100 }
	set_variable = { HYE_conscription_rate_displayed = HYE_conscription_rate }
	multiply_variable = { HYE_conscription_rate_displayed = 1000 }
	set_variable = { HYE_var_underworld_recruitable_pop_modif_displayed = HYE_var_underworld_recruitable_pop_displayed }
	multiply_variable = { HYE_var_underworld_recruitable_pop_modif_displayed = 100 }
	set_variable = { HYE_var_underworld_recruitable_pop_factor_modif_displayed = HYE_var_underworld_recruitable_pop_factor_modif }
	multiply_variable = { HYE_var_underworld_recruitable_pop_factor_modif_displayed = 100 }
	set_variable = { HYE_underworld_ratio_displayed = HYE_underworld_ratio}
	multiply_variable = { HYE_underworld_ratio_displayed = 100 }
}

HYE_underground_conscription_target_calculation = {
	if = { limit = { has_idea = disarmed_nation } set_variable = { HYE_var_underworld_recruitable_pop = 0.01 } }
	else_if = { limit = { has_idea = volunteer_only } set_variable = { HYE_var_underworld_recruitable_pop = 0.015 } }
	else_if = { limit = { has_idea = limited_conscription } set_variable = { HYE_var_underworld_recruitable_pop = 0.025 } }
	else_if = { limit = { has_idea = extensive_conscription } set_variable = { HYE_var_underworld_recruitable_pop = 0.05 } }
	else_if = { limit = { has_idea = service_by_requirement } set_variable = { HYE_var_underworld_recruitable_pop = 0.1 } }
	else_if = { limit = { has_idea = all_adults_serve } set_variable = { HYE_var_underworld_recruitable_pop = 0.2 } }
	else_if = { limit = { has_idea = scraping_the_barrel } set_variable = { HYE_var_underworld_recruitable_pop = 0.25 } }
	else = { set_variable = { HYE_var_underworld_recruitable_pop = 0.05 } }

	set_variable = { HYE_var_underworld_recruitable_pop_modif = modifier@HYE_recruitable_underworld_pop }
	set_variable = { HYE_var_underworld_recruitable_pop_factor_modif = modifier@HYE_recruitable_underworld_pop_factor }


	add_to_variable = { HYE_var_underworld_recruitable_pop = HYE_var_underworld_recruitable_pop_modif }
	set_variable = { HYE_var_underworld_recruitable_pop_displayed = HYE_var_underworld_recruitable_pop }
	set_temp_variable = { HYE_base_factor = 1 }
	add_to_temp_variable = { HYE_base_factor = HYE_var_underworld_recruitable_pop_factor_modif }
	multiply_variable = { HYE_var_underworld_recruitable_pop = HYE_base_factor }
	set_variable = { HYE_conscription_target = HYE_var_underworld_recruitable_pop }
}

HYE_underground_conscription_pool_calculation = {
	set_variable = { HYE_conscription_pool = HYE_underworld_population }
	multiply_variable = { HYE_conscription_pool = HYE_conscription_target }
	round_variable = HYE_conscription_pool #--Value in thousands

	set_variable = { HYE_deducted_casualties = casualties_k }
	multiply_variable = { HYE_deducted_casualties = HYE_underworld_ratio }
	round_variable = HYE_deducted_casualties

	set_variable = { HYE_conscription_rate = HYE_conscription_pool }
	multiply_variable = { HYE_conscription_rate = HYE_conscription_mobilization_speed }
	round_variable = HYE_conscription_rate #--Value in thousands
}

HYE_underground_conscription_setup = {
	set_variable = { HYE_underworld_population = 906.78 } #In Thousands
	set_variable = { HYE_conscription_target = 0.015 }
	set_variable = { HYE_conscription_mobilization_speed = 0.1 }

	set_temp_variable = { HYE_total_population = max_manpower_k }
	add_to_temp_variable = { HYE_total_population = HYE_underworld_population }
	set_variable = { HYE_underworld_ratio = HYE_underworld_population }
	divide_variable = { HYE_underworld_ratio = HYE_total_population }

	HYE_underground_conscription_target_calculation = yes
	HYE_underground_conscription_pool_calculation = yes

	set_variable = { HYE_conscription_conscripted_underworlders = 0 } #In Thousands

	HYE_underground_conscription_var_display = yes
}

HYE_underground_conscription_weekly = {
	HYE_underground_conscription_target_calculation = yes
	HYE_underground_conscription_pool_calculation = yes

	clr_country_flag = HYE_underworld_trying_to_demobilize
	clr_country_flag = HYE_underworld_demobilizing
	clr_country_flag = HYE_underworld_mobilizing

	if = {
		limit = {
			check_variable = {
				HYE_conscription_conscripted_underworlders < HYE_conscription_pool
			}
		}

		#Conscripting more

		set_temp_variable = {
			HYE_unconscripted_underworlders = HYE_conscription_pool
		}
		subtract_from_temp_variable = {
			HYE_unconscripted_underworlders = HYE_conscription_conscripted_underworlders
		}
		if = {
			limit = {
				check_variable = {
					var = HYE_unconscripted_underworlders
					value = HYE_conscription_rate
					compare = less_than_or_equals
				}
			}
			set_variable = { HYE_conscription_conscripted_underworlders = HYE_conscription_pool }
			set_temp_variable = { HYE_var_added_manpower = HYE_unconscripted_underworlders }
			multiply_temp_variable = { HYE_var_added_manpower = 1000 }
			add_manpower = var:HYE_var_added_manpower
		}
		else = {
			add_to_variable = { HYE_conscription_conscripted_underworlders = HYE_conscription_rate }
			set_temp_variable = { HYE_var_added_manpower = HYE_conscription_rate }
			multiply_temp_variable = { HYE_var_added_manpower = 1000 }
			add_manpower = var:HYE_var_added_manpower
			set_country_flag = HYE_underworld_mobilizing
		}
	}
	else_if = {
		limit = {
			check_variable = {
				HYE_conscription_conscripted_underworlders > HYE_conscription_pool
			}
		}
		#Demobilization

		if = {
			limit = {
				check_variable = { max_available_manpower_k = 0 }
			}
			set_country_flag = HYE_underworld_trying_to_demobilize
		}
		else = {
			if = {
				limit = {
					check_variable = { HYE_conscription_conscripted_underworlders > HYE_deducted_casualties }
				}
				if = {
					limit = {
						check_variable = { HYE_deducted_casualties < HYE_conscription_pool }
					}
					set_variable = { HYE_demob_target = HYE_conscription_pool}
				}
				else = {
					set_variable = { HYE_demob_target = HYE_deducted_casualties}
				}

				set_variable = { HYE_underworlders_demobilizing = HYE_conscription_conscripted_underworlders }
				subtract_from_variable = { HYE_underworlders_demobilizing = HYE_demob_target }

				if = {
					limit = {
						check_variable = { HYE_underworlders_demobilizing < HYE_conscription_rate }
					}
					set_variable = { HYE_conscription_conscripted_underworlders = HYE_demob_target }
					set_temp_variable = { HYE_removed_mp = HYE_underworlders_demobilizing }
					multiply_temp_variable = { HYE_removed_mp = -1000 }
					add_manpower = var:HYE_removed_mp
				}
				else = {
					subtract_from_variable = { HYE_conscription_conscripted_underworlders = HYE_conscription_rate }
					set_temp_variable = { HYE_removed_mp = HYE_conscription_rate }
					multiply_temp_variable = { HYE_removed_mp = -1000 }

					add_manpower = var:HYE_removed_mp

					set_country_flag = HYE_underworld_demobilizing
				}
			}
		}
	}

	HYE_underground_conscription_var_display = yes
}

HYE_underground_population_increase = {
	set_temp_variable = { HYE_underworld_population_temp = HYE_underworld_population}
	divide_temp_variable = { HYE_underworld_population_temp = 1000 }
	multiply_temp_variable = { HYE_underworld_population_temp = 1.25 }
	add_to_variable = { HYE_underworld_population = HYE_underworld_population_temp }
}

# Function : HYE_undergound_add_population
# Description : Add or subtract manpower from the underworld manpower pool
# Input : temp_HYE_incr_underworld_population - The variation of underground manpower in thousands
HYE_undergound_add_population = {
	add_to_variable = { HYE_underworld_population = temp_HYE_incr_underworld_population }
	set_temp_variable = { temp_HYE_incr_underworld_population_display = temp_HYE_incr_underworld_population }
	multiply_temp_variable = { temp_HYE_incr_underworld_population_display = 1000 }
	custom_effect_tooltip = HYE_underground_add_population_tt
}



HYE_support_gui_reload = {
	set_variable = { garg_support_visual = garg_support }
	set_variable = { taur_support_visual = taur_support }
	add_to_variable = { garg_support_visual = 1 }
	add_to_variable = { taur_support_visual = 1 }
}