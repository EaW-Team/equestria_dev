
MSH_Influences_start = {
	set_country_flag = MSH_Influences_local_view

	for_each_scope_loop = {
		array = MSH_Influences_States
		clear_array = MSH_Influences_Peasants
		clear_array = MSH_Influences_Soldiers
		clear_array = MSH_Influences_Intelligentsia
		clear_array = MSH_Influences_Leadership
	}
	clear_array = MSH_Influences_States
	clear_array = MSH_Influences_x
	clear_array = MSH_Influences_y

	# Map asset + coords setup
	
	add_to_array = { MSH_Influences_States = 767 }
	add_to_array = { MSH_Influences_x = 118 }
	add_to_array = { MSH_Influences_y = 63 }
	
	add_to_array = { MSH_Influences_States = 768 }
	add_to_array = { MSH_Influences_x = 130 }
	add_to_array = { MSH_Influences_y = 0 }
	
	add_to_array = { MSH_Influences_States = 902 }
	add_to_array = { MSH_Influences_x = 128 }
	add_to_array = { MSH_Influences_y = 102 }
	
	add_to_array = { MSH_Influences_States = 903 }
	add_to_array = { MSH_Influences_x = 174 }
	add_to_array = { MSH_Influences_y = 119 }
	
	add_to_array = { MSH_Influences_States = 935 }
	add_to_array = { MSH_Influences_x = 124 }
	add_to_array = { MSH_Influences_y = 134 }
	
	add_to_array = { MSH_Influences_States = 936 }
	add_to_array = { MSH_Influences_x = 191 }
	add_to_array = { MSH_Influences_y = 149 }
	
	add_to_array = { MSH_Influences_States = 937 }
	add_to_array = { MSH_Influences_x = 76 }
	add_to_array = { MSH_Influences_y = 97 }
	
	add_to_array = { MSH_Influences_States = 938 }
	add_to_array = { MSH_Influences_x = 103 }
	add_to_array = { MSH_Influences_y = 133 }
	
	add_to_array = { MSH_Influences_States = 939 }
	add_to_array = { MSH_Influences_x = 128 }
	add_to_array = { MSH_Influences_y = 206 }
	
	add_to_array = { MSH_Influences_States = 940 }
	add_to_array = { MSH_Influences_x = 110 }
	add_to_array = { MSH_Influences_y = 194 }
	
	add_to_array = { MSH_Influences_States = 941 }
	add_to_array = { MSH_Influences_x = 89 }
	add_to_array = { MSH_Influences_y = 212 }
	
	add_to_array = { MSH_Influences_States = 942 }
	add_to_array = { MSH_Influences_x = 21 }
	add_to_array = { MSH_Influences_y = 228 }
	
	add_to_array = { MSH_Influences_States = 943 }
	add_to_array = { MSH_Influences_x = 76 }
	add_to_array = { MSH_Influences_y = 258 }
	
	add_to_array = { MSH_Influences_States = 944 }
	add_to_array = { MSH_Influences_x = 28 }
	add_to_array = { MSH_Influences_y = 270 }
	
	add_to_array = { MSH_Influences_States = 945 }
	add_to_array = { MSH_Influences_x = 113 }
	add_to_array = { MSH_Influences_y = 259 }
	
	add_to_array = { MSH_Influences_States = 946 }
	add_to_array = { MSH_Influences_x = 103 }
	add_to_array = { MSH_Influences_y = 277 }
	
	add_to_array = { MSH_Influences_States = 947 }
	add_to_array = { MSH_Influences_x = 68 }
	add_to_array = { MSH_Influences_y = 289 }
	
	add_to_array = { MSH_Influences_States = 948 }
	add_to_array = { MSH_Influences_x = 124 }
	add_to_array = { MSH_Influences_y = 228 }
	
	add_to_array = { MSH_Influences_States = 949 }
	add_to_array = { MSH_Influences_x = 164 }
	add_to_array = { MSH_Influences_y = 249 }
	
	add_to_array = { MSH_Influences_States = 950 }
	add_to_array = { MSH_Influences_x = 4 }
	add_to_array = { MSH_Influences_y = 191 }
	
	add_to_array = { MSH_Influences_States = 951 }
	add_to_array = { MSH_Influences_x = 32 }
	add_to_array = { MSH_Influences_y = 198 }
	
	add_to_array = { MSH_Influences_States = 952 }
	add_to_array = { MSH_Influences_x = 64 }
	add_to_array = { MSH_Influences_y = 193 }
	
	add_to_array = { MSH_Influences_States = 953 }
	add_to_array = { MSH_Influences_x = 66 }
	add_to_array = { MSH_Influences_y = 128 }
	
	add_to_array = { MSH_Influences_States = 959 }
	add_to_array = { MSH_Influences_x = 0 }
	add_to_array = { MSH_Influences_y = 246 }
	
	add_to_array = { MSH_Influences_States = 960 }
	add_to_array = { MSH_Influences_x = 5 }
	add_to_array = { MSH_Influences_y = 281 }
	
	add_to_array = { MSH_Influences_States = 961 }
	add_to_array = { MSH_Influences_x = 30 }
	add_to_array = { MSH_Influences_y = 312 }
	
	add_to_array = { MSH_Influences_States = 963 }
	add_to_array = { MSH_Influences_x = 125 }
	add_to_array = { MSH_Influences_y = 286 }
	
	add_to_array = { MSH_Influences_States = 964 }
	add_to_array = { MSH_Influences_x = 177 }
	add_to_array = { MSH_Influences_y = 282 }
	
	add_to_array = { MSH_Influences_States = 965 }
	add_to_array = { MSH_Influences_x = 211 }
	add_to_array = { MSH_Influences_y = 268 }
	
	add_to_array = { MSH_Influences_States = 966 }
	add_to_array = { MSH_Influences_x = 198 }
	add_to_array = { MSH_Influences_y = 287 }
	
	add_to_array = { MSH_Influences_States = 967 }
	add_to_array = { MSH_Influences_x = 158 }
	add_to_array = { MSH_Influences_y = 299 }
	
	add_to_array = { MSH_Influences_States = 968 }
	add_to_array = { MSH_Influences_x = 152 }
	add_to_array = { MSH_Influences_y = 182 }
	
	add_to_array = { MSH_Influences_States = 969 }
	add_to_array = { MSH_Influences_x = 180 }
	add_to_array = { MSH_Influences_y = 179 }
	
	add_to_array = { MSH_Influences_States = 970 }
	add_to_array = { MSH_Influences_x = 197 }
	add_to_array = { MSH_Influences_y = 227 }
	
	add_to_array = { MSH_Influences_States = 972 }
	add_to_array = { MSH_Influences_x = 254 }
	add_to_array = { MSH_Influences_y = 202 }
	
	add_to_array = { MSH_Influences_States = 973 }
	add_to_array = { MSH_Influences_x = 242 }
	add_to_array = { MSH_Influences_y = 225 }
	
	add_to_array = { MSH_Influences_States = 971 }
	add_to_array = { MSH_Influences_x = 235 }
	add_to_array = { MSH_Influences_y = 255 }
	
	add_to_array = { MSH_Influences_States = 974 }
	add_to_array = { MSH_Influences_x = 294 }
	add_to_array = { MSH_Influences_y = 248 }
	
	add_to_array = { MSH_Influences_States = 975 }
	add_to_array = { MSH_Influences_x = 240 }
	add_to_array = { MSH_Influences_y = 285 }
	
	add_to_array = { MSH_Influences_States = 976 }
	add_to_array = { MSH_Influences_x = 277 }
	add_to_array = { MSH_Influences_y = 290 }
	
	add_to_array = { MSH_Influences_States = 977 }
	add_to_array = { MSH_Influences_x = 308 }
	add_to_array = { MSH_Influences_y = 305 }
	
	add_to_array = { MSH_Influences_States = 1038 }
	add_to_array = { MSH_Influences_x = 356 }
	add_to_array = { MSH_Influences_y = 261 }
	
	add_to_array = { MSH_Influences_States = 1037 }
	add_to_array = { MSH_Influences_x = 385 }
	add_to_array = { MSH_Influences_y = 314 }
	
	# MSH's states
	every_owned_state = {
		set_temp_variable = { legalists_min = 50 }
		set_temp_variable = { legalists_max = 75 }
		MSH_randomize_legalists = yes
	
		add_to_array = { MSH_Influences_Peasants = legalists_temp }
		add_to_array = { MSH_Influences_Peasants = purists_temp }
		add_to_array = { MSH_Influences_Peasants = reformists_temp }
		
		MSH_randomize_legalists = yes
	
		add_to_array = { MSH_Influences_Soldiers = legalists_temp }
		add_to_array = { MSH_Influences_Soldiers = purists_temp }
		add_to_array = { MSH_Influences_Soldiers = reformists_temp }
		
		set_temp_variable = { legalists_min = 50 }
		set_temp_variable = { legalists_max = 85 }
		MSH_randomize_legalists = yes
	
		add_to_array = { MSH_Influences_Intelligentsia = legalists_temp }
		add_to_array = { MSH_Influences_Intelligentsia = purists_temp }
		add_to_array = { MSH_Influences_Intelligentsia = reformists_temp }
		
		MSH_randomize_legalists = yes
	
		add_to_array = { MSH_Influences_Leadership = legalists_temp }
		add_to_array = { MSH_Influences_Leadership = purists_temp }
		add_to_array = { MSH_Influences_Leadership = reformists_temp }
			
		set_state_flag = MSH_scholarch_legalist
		force_update_dynamic_modifier = yes
	}
	
	# SON's states
	SON = {
		every_owned_state = {
			set_temp_variable = { legalists_min = 40 }
			set_temp_variable = { legalists_max = 60 }
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Peasants = legalists_temp }
			add_to_array = { MSH_Influences_Peasants = purists_temp }
			add_to_array = { MSH_Influences_Peasants = reformists_temp }
			
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Soldiers = legalists_temp }
			add_to_array = { MSH_Influences_Soldiers = purists_temp }
			add_to_array = { MSH_Influences_Soldiers = reformists_temp }
			
			set_temp_variable = { legalists_min = 40 }
			set_temp_variable = { legalists_max = 70 }
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Intelligentsia = legalists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = purists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = reformists_temp }
			
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Leadership = legalists_temp }
			add_to_array = { MSH_Influences_Leadership = purists_temp }
			add_to_array = { MSH_Influences_Leadership = reformists_temp }
			
			set_state_flag = MSH_scholarch_legalist
			force_update_dynamic_modifier = yes
		}
	}
	
	# REE's states
	REE = {
		every_owned_state = {
			set_temp_variable = { reformists_min = 70 }
			set_temp_variable = { reformists_max = 90 }
			MSH_randomize_reformists = yes
		
			add_to_array = { MSH_Influences_Peasants = legalists_temp }
			add_to_array = { MSH_Influences_Peasants = purists_temp }
			add_to_array = { MSH_Influences_Peasants = reformists_temp }
			
			MSH_randomize_reformists = yes
		
			add_to_array = { MSH_Influences_Soldiers = legalists_temp }
			add_to_array = { MSH_Influences_Soldiers = purists_temp }
			add_to_array = { MSH_Influences_Soldiers = reformists_temp }
			
			MSH_randomize_reformists = yes
		
			add_to_array = { MSH_Influences_Intelligentsia = legalists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = purists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = reformists_temp }
			
			MSH_randomize_reformists = yes
		
			add_to_array = { MSH_Influences_Leadership = legalists_temp }
			add_to_array = { MSH_Influences_Leadership = purists_temp }
			add_to_array = { MSH_Influences_Leadership = reformists_temp }
			
			random_list = {
				1 = { set_state_flag = MSH_scholarch_legalist }
				1 = { set_state_flag = MSH_scholarch_purist }
				1 = { set_state_flag = MSH_scholarch_reformist }
			}
			force_update_dynamic_modifier = yes
		}
	}
	
	# The rest
	for_each_scope_loop = {
		array = MSH_Influences_States
		if = {
			limit = {
				NOT = {
					is_owned_by = MSH
					is_owned_by = SON
					is_owned_by = REE
				}
			}
			set_temp_variable = { legalists_min = 0 }
			set_temp_variable = { legalists_max = 60 }
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Peasants = legalists_temp }
			add_to_array = { MSH_Influences_Peasants = purists_temp }
			add_to_array = { MSH_Influences_Peasants = reformists_temp }
			
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Soldiers = legalists_temp }
			add_to_array = { MSH_Influences_Soldiers = purists_temp }
			add_to_array = { MSH_Influences_Soldiers = reformists_temp }
			
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Intelligentsia = legalists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = purists_temp }
			add_to_array = { MSH_Influences_Intelligentsia = reformists_temp }
			
			MSH_randomize_legalists = yes
		
			add_to_array = { MSH_Influences_Leadership = legalists_temp }
			add_to_array = { MSH_Influences_Leadership = purists_temp }
			add_to_array = { MSH_Influences_Leadership = reformists_temp }
			
			random_list = {
				1 = { set_state_flag = MSH_scholarch_legalist }
				1 = { set_state_flag = MSH_scholarch_purist }
				1 = { set_state_flag = MSH_scholarch_reformist }
			}
			force_update_dynamic_modifier = yes
		}
	}
	
	set_variable = { MSH_Influences_Selected_State = 968 }
	
	set_variable = { MSH_Focus_Faction = 0 }
	set_variable = { legalist_btn_frame = 1 }
	set_variable = { purist_btn_frame = 2 }
	set_variable = { reformist_btn_frame = 2 }
	
	MSH_Influences_re_render = yes
}

MSH_Influences_re_render = {
	MSH = {
		set_variable = { MSH_piety = 0 }
		set_temp_variable = { population_total = 0 }
		for_each_scope_loop = { # can't trust max_manpower_k
			array = MSH_Influences_States
			
			if = {
				limit = {
					is_owned_by = MSH
				}
				add_to_temp_variable = { population_total = state_population_k }
			}
		}
		set_variable = { population_total_permanent = population_total }
		set_temp_variable = { population_total_check = 0 }
		for_each_scope_loop = {
			array = MSH_Influences_States
			
			if = {
				limit = {
					is_owned_by = MSH
				}
				set_variable = { population_factor = state_population_k }
				divide_variable = { population_factor = population_total }
			}
		}
		
		resize_temp_array = { temp_peasants = 3 }
		resize_temp_array = { temp_soldiers = 3 }
		resize_temp_array = { temp_intelligentsia = 3 }
		resize_temp_array = { temp_leadership = 3 }
		resize_temp_array = { temp_influence_average = 3 }
		
		for_each_loop = {
			array = MSH_Influences_States
			
			var:v = {
				if = {
					limit = {
						is_owned_by = MSH
					}
					
					## Set local progressbar variables to be called for in local view

					set_variable = { MSH_peasants_local_display = 100 }
					subtract_from_variable = { MSH_peasants_local_display = MSH_Influences_Peasants^2 }
					
					set_variable = { MSH_soldiers_local_display = 100 }
					subtract_from_variable = { MSH_soldiers_local_display = MSH_Influences_Soldiers^2 }
					
					set_variable = { MSH_intelligentsia_local_display = 100 }
					subtract_from_variable = { MSH_intelligentsia_local_display = MSH_Influences_Intelligentsia^2 }
					
					set_variable = { MSH_leadership_local_display = 100 }
					subtract_from_variable = { MSH_leadership_local_display = MSH_Influences_Leadership^2 }
					
					## Count faction support averages

					set_temp_variable = { legalists_average_temp = MSH_Influences_Peasants^0 }
					add_to_temp_variable = { legalists_average_temp = MSH_Influences_Soldiers^0 }
					add_to_temp_variable = { legalists_average_temp = MSH_Influences_Intelligentsia^0 }
					add_to_temp_variable = { legalists_average_temp = MSH_Influences_Leadership^0 }
					divide_temp_variable = { legalists_average_temp = 4 }
					
					set_temp_variable = { purists_average_temp = MSH_Influences_Peasants^1 }
					add_to_temp_variable = { purists_average_temp = MSH_Influences_Soldiers^1 }
					add_to_temp_variable = { purists_average_temp = MSH_Influences_Intelligentsia^1 }
					add_to_temp_variable = { purists_average_temp = MSH_Influences_Leadership^1 }
					divide_temp_variable = { purists_average_temp = 4 }
					
					set_temp_variable = { reformists_average_temp = MSH_Influences_Peasants^2 }
					add_to_temp_variable = { reformists_average_temp = MSH_Influences_Soldiers^2 }
					add_to_temp_variable = { reformists_average_temp = MSH_Influences_Intelligentsia^2 }
					add_to_temp_variable = { reformists_average_temp = MSH_Influences_Leadership^2 }
					divide_temp_variable = { reformists_average_temp = 4 }
					
					clear_array = MSH_influence_average_local
					
					add_to_array = { MSH_influence_average_local = legalists_average_temp }
					add_to_array = { MSH_influence_average_local = purists_average_temp }
					add_to_array = { MSH_influence_average_local = reformists_average_temp }
					
					if = {
						limit = {
							check_variable = { legalists_average_temp > purists_average_temp }
							check_variable = { legalists_average_temp > reformists_average_temp }
						}
						set_variable = { MSH_Influences_Frame = 2 }
					}
					else_if = {
						limit = {
							check_variable = { purists_average_temp > legalists_average_temp }
							check_variable = { purists_average_temp > reformists_average_temp }
						}
						set_variable = { MSH_Influences_Frame = 3 }
					}
					else_if = {
						limit = {
							check_variable = { reformists_average_temp > legalists_average_temp }
							check_variable = { reformists_average_temp > purists_average_temp }
						}
						set_variable = { MSH_Influences_Frame = 4 }
					}
					else = {
						set_variable = { MSH_Influences_Frame = 1 }
					}
					
					# Piety
					set_temp_variable = { local_piety = MSH_influence_average_local^0 }
					multiply_temp_variable = { local_piety = population_factor }
					set_variable = { MSH_local_piety_contribution = local_piety }
					
					## Count each group's averages
					
					for_each_loop = {
						array = MSH_Influences_Peasants
						index = j
						value = w
						set_temp_variable = { temp_peasants_calc = w }
						multiply_temp_variable = { temp_peasants_calc = population_factor }
						add_to_temp_variable = { temp_peasants^j = temp_peasants_calc }
					}
					for_each_loop = {
						array = MSH_Influences_Soldiers
						index = j
						value = w
						set_temp_variable = { temp_soldiers_calc = w }
						multiply_temp_variable = { temp_soldiers_calc = population_factor }
						add_to_temp_variable = { temp_soldiers^j = temp_soldiers_calc }
					}
					for_each_loop = {
						array = MSH_Influences_Intelligentsia
						index = j
						value = w
						set_temp_variable = { temp_intelligentsia_calc = w }
						multiply_temp_variable = { temp_intelligentsia_calc = population_factor }
						add_to_temp_variable = { temp_intelligentsia^j = temp_intelligentsia_calc }
					}
					for_each_loop = {
						array = MSH_Influences_Leadership
						index = j
						value = w
						set_temp_variable = { temp_leadership_calc = w }
						multiply_temp_variable = { temp_leadership_calc = population_factor }
						add_to_temp_variable = { temp_leadership^j = temp_leadership_calc }
					}
					
					set_temp_variable = { temp_influence_average_calc = legalists_average_temp }
					multiply_temp_variable = { temp_influence_average_calc = population_factor }
					add_to_temp_variable = { temp_influence_average^0 = temp_influence_average_calc }
					
					set_temp_variable = { temp_influence_average_calc = purists_average_temp }
					multiply_temp_variable = { temp_influence_average_calc = population_factor }
					add_to_temp_variable = { temp_influence_average^1 = temp_influence_average_calc }
					
					set_temp_variable = { temp_influence_average_calc = reformists_average_temp }
					multiply_temp_variable = { temp_influence_average_calc = population_factor }
					add_to_temp_variable = { temp_influence_average^2 = temp_influence_average_calc }
					
					multiply_variable = { population_factor = 100 }
				}
			}
		}
		
		clear_array = MSH_influence_average_national
		set_temp_variable = { total_average_check = 100 }
		set_temp_variable = { total_average_check_v = 0 }
		for_each_loop = {
			array = temp_influence_average
			add_to_array = { MSH_influence_average_national = temp_influence_average^i }
			add_to_temp_variable = { total_average_check_v = v }
		}
		subtract_from_temp_variable = { total_average_check = total_average_check_v }
		divide_temp_variable = { total_average_check = 3 }
		for_each_loop = {
			array = MSH_influence_average_national
			add_to_variable = { MSH_influence_average_national^i = total_average_check }
		}
		set_variable = { MSH_piety = MSH_influence_average_national^0 }
		
		clear_array = MSH_Influences_Peasants_Average
		clear_array = MSH_Influences_Soldiers_Average
		clear_array = MSH_Influences_Intelligentsia_Average
		clear_array = MSH_Influences_Leadership_Average

		for_each_loop = {
			array = temp_peasants
			add_to_array = { MSH_Influences_Peasants_Average = temp_peasants^i }
		}
		for_each_loop = {
			array = temp_soldiers
			add_to_array = { MSH_Influences_Soldiers_Average = temp_soldiers^i }
		}
		for_each_loop = {
			array = temp_intelligentsia
			add_to_array = { MSH_Influences_Intelligentsia_Average = temp_intelligentsia^i }
		}
		for_each_loop = {
			array = temp_leadership
			add_to_array = { MSH_Influences_Leadership_Average = temp_leadership^i }
		}

		set_variable = { MSH_peasants_national_display = 100 }
		subtract_from_variable = { MSH_peasants_national_display = MSH_Influences_Peasants_Average^2 }
		
		set_variable = { MSH_soldiers_national_display = 100 }
		subtract_from_variable = { MSH_soldiers_national_display = MSH_Influences_Soldiers_Average^2 }
		
		set_variable = { MSH_intelligentsia_national_display = 100 }
		subtract_from_variable = { MSH_intelligentsia_national_display = MSH_Influences_Intelligentsia_Average^2 }
		
		set_variable = { MSH_leadership_national_display = 100 }
		subtract_from_variable = { MSH_leadership_national_display = MSH_Influences_Leadership_Average^2 }
		
		# Compute curved bar frame
		set_variable = { MSH_piety_frame = MSH_piety }
		multiply_variable = { MSH_piety_frame = -1.2 }
		add_to_variable = { MSH_piety_frame = 150 }
		
		MSH_Influences_local_or_national = yes
		MSH_Influences_re_position_num = yes
		
		# Dynmod apply
		for_each_loop = {
			array = MSH_Influences_States
			
			var:v = {
				if = {
					limit = {
						is_owned_by = MSH
					}
					
					if = {
						limit = {
							has_state_flag = MSH_scholarch_legalist
						}
						add_dynamic_modifier = { modifier = MSH_scholarch_legalist }
						clr_state_flag = MSH_scholarch_legalist
					}
					else_if = {
						limit = {
							has_state_flag = MSH_scholarch_purist
						}
						add_dynamic_modifier = { modifier = MSH_scholarch_purist }
						clr_state_flag = MSH_scholarch_purist
					}
					else_if = {
						limit = {
							has_state_flag = MSH_scholarch_reformist
						}
						add_dynamic_modifier = { modifier = MSH_scholarch_reformist }
						clr_state_flag = MSH_scholarch_reformist
					}
		
				}
			}
		}
		
		add_to_variable = { MSH_Influences_Dirty = 0.01 }
		
		MSH_calculate_piety_effects = yes
	}
}

MSH_Influences_local_or_national = {
	if = {
		limit = {
			has_country_flag = MSH_Influences_local_view
		}
		set_variable = { MSH_peasants_display_0 = MSH_Influences_Selected_State:MSH_Influences_Peasants^0 }
		set_variable = { MSH_soldiers_display_0 = MSH_Influences_Selected_State:MSH_Influences_Soldiers^0 }
		set_variable = { MSH_intelligentsia_display_0 = MSH_Influences_Selected_State:MSH_Influences_Intelligentsia^0 }
		set_variable = { MSH_leadership_display_0 = MSH_Influences_Selected_State:MSH_Influences_Leadership^0 }

		set_variable = { MSH_peasants_display_2 = MSH_Influences_Selected_State:MSH_peasants_local_display }
		set_variable = { MSH_soldiers_display_2 = MSH_Influences_Selected_State:MSH_soldiers_local_display }
		set_variable = { MSH_intelligentsia_display_2 = MSH_Influences_Selected_State:MSH_intelligentsia_local_display }
		set_variable = { MSH_leadership_display_2 = MSH_Influences_Selected_State:MSH_leadership_local_display }
		
		clear_array = MSH_influence_average_display
		for_each_loop = {
			array = MSH_Influences_Selected_State:MSH_influence_average_local
			add_to_array = { MSH_influence_average_display = v }
			multiply_variable = { MSH_influence_average_display^i = 100 }
			round_variable = MSH_influence_average_display^i
			multiply_variable = { MSH_influence_average_display^i = 0.01 }
		}
	}
	else = {
		set_variable = { MSH_peasants_display_0 = MSH_Influences_Peasants_Average^0 }
		set_variable = { MSH_soldiers_display_0 = MSH_Influences_Soldiers_Average^0 }
		set_variable = { MSH_intelligentsia_display_0 = MSH_Influences_Intelligentsia_Average^0 }
		set_variable = { MSH_leadership_display_0 = MSH_Influences_Leadership_Average^0 }

		set_variable = { MSH_peasants_display_2 = MSH_peasants_national_display }
		set_variable = { MSH_soldiers_display_2 = MSH_soldiers_national_display }
		set_variable = { MSH_intelligentsia_display_2 = MSH_intelligentsia_national_display }
		set_variable = { MSH_leadership_display_2 = MSH_leadership_national_display }
		
		clear_array = MSH_influence_average_display
		for_each_loop = {
			array = MSH_influence_average_national
			add_to_array = { MSH_influence_average_display = v }
			multiply_variable = { MSH_influence_average_display^i = 100 }
			round_variable = MSH_influence_average_display^i
			multiply_variable = { MSH_influence_average_display^i = 0.01 }
		}
	}
}

MSH_Influences_re_position_num = {
	if = {
		limit = {
			NOT = {
				check_variable = { has_already_re_position = 1 }
			}
		}
		
		if = {
			limit = {
				has_country_flag = MSH_Influences_local_view
			}
		
			for_each_loop = {
				array = MSH_Influences_Selected_State:MSH_Influences_Peasants
				add_to_temp_array = { temp_peasants_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Selected_State:MSH_Influences_Soldiers
				add_to_temp_array = { temp_soldiers_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Selected_State:MSH_Influences_Intelligentsia
				add_to_temp_array = { temp_intelligentsia_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Selected_State:MSH_Influences_Leadership
				add_to_temp_array = { temp_leadership_used = v }
			}
		}
		else = {
			for_each_loop = {
				array = MSH_Influences_Peasants_Average
				add_to_temp_array = { temp_peasants_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Soldiers_Average
				add_to_temp_array = { temp_soldiers_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Intelligentsia_Average
				add_to_temp_array = { temp_intelligentsia_used = v }
			}
			for_each_loop = {
				array = MSH_Influences_Leadership_Average
				add_to_temp_array = { temp_leadership_used = v }
			}
		}

		### Peasants
		set_variable = { peasants_legalists_x_pos = 404 }
		divide_variable = { peasants_legalists_x_pos = 200 }
		multiply_variable = { peasants_legalists_x_pos = temp_peasants_used^0 }
		subtract_from_variable = { peasants_legalists_x_pos = 40 }
		
		set_variable = { peasants_purists_x_pos = 404 }
		divide_variable = { peasants_purists_x_pos = 200 }
		multiply_variable = { peasants_purists_x_pos = temp_peasants_used^1 }
		subtract_from_variable = { peasants_purists_x_pos = 40 }
		set_temp_variable = { added = temp_peasants_used^0 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { peasants_purists_x_pos = added }
		
		set_variable = { peasants_reformists_x_pos = 404 }
		divide_variable = { peasants_reformists_x_pos = 200 }
		multiply_variable = { peasants_reformists_x_pos = temp_peasants_used^2 }
		subtract_from_variable = { peasants_reformists_x_pos = 40 }
		set_temp_variable = { added = temp_peasants_used^0 }
		add_to_temp_variable = { added = temp_peasants_used^1 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { peasants_reformists_x_pos = added }
		
		### Soldiers
		set_variable = { soldiers_legalists_x_pos = 404 }
		divide_variable = { soldiers_legalists_x_pos = 200 }
		multiply_variable = { soldiers_legalists_x_pos = temp_soldiers_used^0 }
		subtract_from_variable = { soldiers_legalists_x_pos = 40 }
		
		set_variable = { soldiers_purists_x_pos = 404 }
		divide_variable = { soldiers_purists_x_pos = 200 }
		multiply_variable = { soldiers_purists_x_pos = temp_soldiers_used^1 }
		subtract_from_variable = { soldiers_purists_x_pos = 40 }
		set_temp_variable = { added = temp_soldiers_used^0 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { soldiers_purists_x_pos = added }
		
		set_variable = { soldiers_reformists_x_pos = 404 }
		divide_variable = { soldiers_reformists_x_pos = 200 }
		multiply_variable = { soldiers_reformists_x_pos = temp_soldiers_used^2 }
		subtract_from_variable = { soldiers_reformists_x_pos = 40 }
		set_temp_variable = { added = temp_soldiers_used^0 }
		add_to_temp_variable = { added = temp_soldiers_used^1 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { soldiers_reformists_x_pos = added }
		
		### Intelligentsia
		set_variable = { intelligentsia_legalists_x_pos = 404 }
		divide_variable = { intelligentsia_legalists_x_pos = 200 }
		multiply_variable = { intelligentsia_legalists_x_pos = temp_intelligentsia_used^0 }
		subtract_from_variable = { intelligentsia_legalists_x_pos = 40 }
		
		set_variable = { intelligentsia_purists_x_pos = 404 }
		divide_variable = { intelligentsia_purists_x_pos = 200 }
		multiply_variable = { intelligentsia_purists_x_pos = temp_intelligentsia_used^1 }
		subtract_from_variable = { intelligentsia_purists_x_pos = 40 }
		set_temp_variable = { added = temp_intelligentsia_used^0 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { intelligentsia_purists_x_pos = added }
		
		set_variable = { intelligentsia_reformists_x_pos = 404 }
		divide_variable = { intelligentsia_reformists_x_pos = 200 }
		multiply_variable = { intelligentsia_reformists_x_pos = temp_intelligentsia_used^2 }
		subtract_from_variable = { intelligentsia_reformists_x_pos = 40 }
		set_temp_variable = { added = temp_intelligentsia_used^0 }
		add_to_temp_variable = { added = temp_intelligentsia_used^1 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { intelligentsia_reformists_x_pos = added }
		
		### Leadership
		set_variable = { leadership_legalists_x_pos = 404 }
		divide_variable = { leadership_legalists_x_pos = 200 }
		multiply_variable = { leadership_legalists_x_pos = temp_leadership_used^0 }
		subtract_from_variable = { leadership_legalists_x_pos = 40 }
		
		set_variable = { leadership_purists_x_pos = 404 }
		divide_variable = { leadership_purists_x_pos = 200 }
		multiply_variable = { leadership_purists_x_pos = temp_leadership_used^1 }
		subtract_from_variable = { leadership_purists_x_pos = 40 }
		set_temp_variable = { added = temp_leadership_used^0 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { leadership_purists_x_pos = added }
		
		set_variable = { leadership_reformists_x_pos = 404 }
		divide_variable = { leadership_reformists_x_pos = 200 }
		multiply_variable = { leadership_reformists_x_pos = temp_leadership_used^2 }
		subtract_from_variable = { leadership_reformists_x_pos = 40 }
		set_temp_variable = { added = temp_leadership_used^0 }
		add_to_temp_variable = { added = temp_leadership_used^1 }
		divide_temp_variable = { added = 100 }
		multiply_temp_variable = { added = 404 }
		add_to_variable = { leadership_reformists_x_pos = added }
		
		set_temp_variable = { has_already_re_position = 1 }
	}
}

MSH_Influence_check_for_100 = {
	for_each_loop = {
		array = MSH_Influences_States
		set_temp_variable = { temp_check = 0 }
		var:v = {
			for_each_loop = {
				array = MSH_influence_average_local
				value = w
				index = j
				add_to_temp_variable = { temp_check = w }
			}
			if = {
				limit = {
					check_variable = { temp_check < 100 }
				}
				log = "[THIS.GetName] less than 100: [?temp_check]"
			}
			
			add_to_temp_variable = { percentage_total = population_factor }
		}
	}
	log = "percentage_total = [?percentage_total]"
}

### MASSIVE INFLUENCE CODE INCOMING ###

## t_index values:
# 0 - Legalists
# 1 - Purists
# 2 - Reformists

## How to use:

# 1000 = {
#	 set_temp_variable = { t_index = 1 }
#	 set_temp_variable = { t_change = 10 }
#	 MSH_change_(peasants/soldiers/intelligentsia/leaderhip)_support = yes
# }

## This will change 1000's purist influence in the specified support group by 10

MSH_change_peasants_support = {
	set_temp_variable = { v_check = MSH_Influences_Peasants^t_index }
	add_to_temp_variable = { v_check = t_change }

	if = {
		limit = {
			check_variable = { v_check < 0 }
		}
		subtract_from_temp_variable = { t_change = v_check }
	}
	else_if = {
		limit = {
			check_variable = { v_check > 100 }
		}
		set_temp_variable = { n_100 = v_check }
		subtract_from_temp_variable = { n_100 = 100 }
		subtract_from_temp_variable = { t_change = n_100 }
	}
	
	if = {
		limit = {
			NOT = {
				check_variable = { t_change = 0 }
			}
		}
		custom_effect_tooltip = MSH_change_peasants_support_CET
		
		add_to_variable = { MSH_Influences_Peasants^t_index = t_change }
		
		set_temp_variable = { t_change_divide = t_change }
		
		for_each_loop = {
			array = MSH_Influences_Peasants
			if = {
				limit = {
					check_variable = { v = 0 }
					NOT = { check_variable = { i = t_index } }
				}
				add_to_temp_array = { has_0 = i }
			}
		}
		
		set_temp_variable = { divide_factor = 2 }
		subtract_from_temp_variable = { divide_factor = has_0^num }
		divide_temp_variable = { t_change_divide = divide_factor }
		
		set_temp_variable = { excess = 0 }
		for_each_loop = {
			array = MSH_Influences_Peasants
			if = {
				limit = {
					NOT = {
						check_variable = { i = t_index }
						is_in_array = { array = has_0 value = i }
					}
				}
				subtract_from_variable = { MSH_Influences_Peasants^i = t_change_divide }
			}
			if = {
				limit = { check_variable = { MSH_Influences_Peasants^i < 0 } }
				add_to_temp_variable = { excess = MSH_Influences_Peasants^i }
				set_variable = { MSH_Influences_Peasants^i = 0 }
				add_to_temp_array = { zero_value = i }
			}
		}
		for_each_loop = {
			array = MSH_Influences_Peasants
			if = {
				limit = {
					NOT = {
						is_in_array = { array = zero_value value = i }
						check_variable = { i = t_index }
					}
				}
				add_to_variable = { MSH_Influences_Peasants^i = excess }
			}
		}
	}
	
	if = {
		limit = {
			check_variable = { manually_re_render_gui = 0 }
		}
		MSH_Influences_re_render = yes
	}
	
	clear_temp_array = has_0
	clear_temp_array = zero_value
}

d_MSH_change_peasants_support = {
	set_temp_variable = { t_index = args^0 }
	set_temp_variable = { t_change = args^1 }
	MSH_change_peasants_support = yes
}

MSH_change_soldiers_support = {
	set_temp_variable = { v_check = MSH_Influences_Soldiers^t_index }
	add_to_temp_variable = { v_check = t_change }

	if = {
		limit = {
			check_variable = { v_check < 0 }
		}
		subtract_from_temp_variable = { t_change = v_check }
	}
	else_if = {
		limit = {
			check_variable = { v_check > 100 }
		}
		set_temp_variable = { n_100 = v_check }
		subtract_from_temp_variable = { n_100 = 100 }
		subtract_from_temp_variable = { t_change = n_100 }
	}
	
	if = {
		limit = {
			NOT = {
				check_variable = { t_change = 0 }
			}
		}
		custom_effect_tooltip = MSH_change_soldiers_support_CET
		
		add_to_variable = { MSH_Influences_Soldiers^t_index = t_change }
		
		set_temp_variable = { t_change_divide = t_change }
		
		for_each_loop = {
			array = MSH_Influences_Soldiers
			if = {
				limit = {
					check_variable = { v = 0 }
					NOT = { check_variable = { i = t_index } }
				}
				add_to_temp_array = { has_0 = i }
			}
		}
		
		set_temp_variable = { divide_factor = 2 }
		subtract_from_temp_variable = { divide_factor = has_0^num }
		divide_temp_variable = { t_change_divide = divide_factor }
		
		set_temp_variable = { excess = 0 }
		for_each_loop = {
			array = MSH_Influences_Soldiers
			if = {
				limit = {
					NOT = {
						check_variable = { i = t_index }
						is_in_array = { array = has_0 value = i }
					}
				}
				subtract_from_variable = { MSH_Influences_Soldiers^i = t_change_divide }
			}
			if = {
				limit = { check_variable = { MSH_Influences_Soldiers^i < 0 } }
				add_to_temp_variable = { excess = MSH_Influences_Soldiers^i }
				set_variable = { MSH_Influences_Soldiers^i = 0 }
				add_to_temp_array = { zero_value = i }
			}
		}
		for_each_loop = {
			array = MSH_Influences_Soldiers
			if = {
				limit = {
					NOT = {
						is_in_array = { array = zero_value value = i }
						check_variable = { i = t_index }
					}
				}
				add_to_variable = { MSH_Influences_Soldiers^i = excess }
			}
		}
	}
	
	if = {
		limit = {
			check_variable = { manually_re_render_gui = 0 }
		}
		MSH_Influences_re_render = yes
	}
	
	clear_temp_array = has_0
	clear_temp_array = zero_value
}

d_MSH_change_soldiers_support = {
	set_temp_variable = { t_index = args^0 }
	set_temp_variable = { t_change = args^1 }
	MSH_change_soldiers_support = yes
}

MSH_change_intelligentsia_support = {
	set_temp_variable = { v_check = MSH_Influences_Intelligentsia^t_index }
	add_to_temp_variable = { v_check = t_change }

	if = {
		limit = {
			check_variable = { v_check < 0 }
		}
		subtract_from_temp_variable = { t_change = v_check }
	}
	else_if = {
		limit = {
			check_variable = { v_check > 100 }
		}
		set_temp_variable = { n_100 = v_check }
		subtract_from_temp_variable = { n_100 = 100 }
		subtract_from_temp_variable = { t_change = n_100 }
	}
	
	if = {
		limit = {
			NOT = {
				check_variable = { t_change = 0 }
			}
		}
		custom_effect_tooltip = MSH_change_intelligentsia_support_CET
		
		add_to_variable = { MSH_Influences_Intelligentsia^t_index = t_change }
		
		set_temp_variable = { t_change_divide = t_change }
		
		for_each_loop = {
			array = MSH_Influences_Intelligentsia
			if = {
				limit = {
					check_variable = { v = 0 }
					NOT = { check_variable = { i = t_index } }
				}
				add_to_temp_array = { has_0 = i }
			}
		}
		
		set_temp_variable = { divide_factor = 2 }
		subtract_from_temp_variable = { divide_factor = has_0^num }
		divide_temp_variable = { t_change_divide = divide_factor }
		
		set_temp_variable = { excess = 0 }
		for_each_loop = {
			array = MSH_Influences_Intelligentsia
			if = {
				limit = {
					NOT = {
						check_variable = { i = t_index }
						is_in_array = { array = has_0 value = i }
					}
				}
				subtract_from_variable = { MSH_Influences_Intelligentsia^i = t_change_divide }
			}
			if = {
				limit = { check_variable = { MSH_Influences_Intelligentsia^i < 0 } }
				add_to_temp_variable = { excess = MSH_Influences_Intelligentsia^i }
				set_variable = { MSH_Influences_Intelligentsia^i = 0 }
				add_to_temp_array = { zero_value = i }
			}
		}
		for_each_loop = {
			array = MSH_Influences_Intelligentsia
			if = {
				limit = {
					NOT = {
						is_in_array = { array = zero_value value = i }
						check_variable = { i = t_index }
					}
				}
				add_to_variable = { MSH_Influences_Intelligentsia^i = excess }
			}
		}
	}
	
	if = {
		limit = {
			check_variable = { manually_re_render_gui = 0 }
		}
		MSH_Influences_re_render = yes
	}
	
	clear_temp_array = has_0
	clear_temp_array = zero_value
}

d_MSH_change_intelligentsia_support = {
	set_temp_variable = { t_index = args^0 }
	set_temp_variable = { t_change = args^1 }
	MSH_change_intelligentsia_support = yes
}

MSH_change_leadership_support = {
	set_temp_variable = { v_check = MSH_Influences_Leadership^t_index }
	add_to_temp_variable = { v_check = t_change }

	if = {
		limit = {
			check_variable = { v_check < 0 }
		}
		subtract_from_temp_variable = { t_change = v_check }
	}
	else_if = {
		limit = {
			check_variable = { v_check > 100 }
		}
		set_temp_variable = { n_100 = v_check }
		subtract_from_temp_variable = { n_100 = 100 }
		subtract_from_temp_variable = { t_change = n_100 }
	}
	
	if = {
		limit = {
			NOT = {
				check_variable = { t_change = 0 }
			}
		}
		custom_effect_tooltip = MSH_change_leadership_support_CET
		
		add_to_variable = { MSH_Influences_Leadership^t_index = t_change }
		
		set_temp_variable = { t_change_divide = t_change }
		
		for_each_loop = {
			array = MSH_Influences_Leadership
			if = {
				limit = {
					check_variable = { v = 0 }
					NOT = { check_variable = { i = t_index } }
				}
				add_to_temp_array = { has_0 = i }
			}
		}
		
		set_temp_variable = { divide_factor = 2 }
		subtract_from_temp_variable = { divide_factor = has_0^num }
		divide_temp_variable = { t_change_divide = divide_factor }
		
		set_temp_variable = { excess = 0 }
		for_each_loop = {
			array = MSH_Influences_Leadership
			if = {
				limit = {
					NOT = {
						check_variable = { i = t_index }
						is_in_array = { array = has_0 value = i }
					}
				}
				subtract_from_variable = { MSH_Influences_Leadership^i = t_change_divide }
			}
			if = {
				limit = { check_variable = { MSH_Influences_Leadership^i < 0 } }
				add_to_temp_variable = { excess = MSH_Influences_Leadership^i }
				set_variable = { MSH_Influences_Leadership^i = 0 }
				add_to_temp_array = { zero_value = i }
			}
		}
		for_each_loop = {
			array = MSH_Influences_Leadership
			if = {
				limit = {
					NOT = {
						is_in_array = { array = zero_value value = i }
						check_variable = { i = t_index }
					}
				}
				add_to_variable = { MSH_Influences_Leadership^i = excess }
			}
		}
	}
	
	if = {
		limit = {
			check_variable = { manually_re_render_gui = 0 }
		}
		MSH_Influences_re_render = yes
	}
	
	clear_temp_array = has_0
	clear_temp_array = zero_value
}

d_MSH_change_leadership_support = {
	set_temp_variable = { t_index = args^0 }
	set_temp_variable = { t_change = args^1 }
	MSH_change_leadership_support = yes
}

MSH_change_global_support = {
	custom_effect_tooltip = MSH_change_global_support_CET
	
	if = {
		limit = {
			NOT = {
				check_variable = { manually_re_render_gui = 2 }
			}
		}
		set_temp_variable = { manually_re_render_gui = 1 }
	}
	
	hidden_effect = {
		MSH_change_peasants_support = yes
		MSH_change_soldiers_support = yes
		MSH_change_intelligentsia_support = yes
		MSH_change_leadership_support = yes
	}
	
	if = {
		limit = {
			NOT = {
				check_variable = { manually_re_render_gui = 2 }
			}
		}
		MSH_Influences_re_render = yes
	}
}

### INFLUENCE CODE CHANGE BUT YOU TAKE FROM A SPECIFIC FACTION INSTEAD OF DIVIDING THE δ BY 2 ###
### PLEASE ONLY INPUT POSITIVE VALUES IN t_change ###

## Instead of only one t_index, there is also t_index_2, with the latter being the faction you take the influence from
## Use the same index definitions as the one stated above

MSH_change_peasants_support_targeted = {
	custom_effect_tooltip = MSH_change_peasants_support_targeted_CET

	add_to_variable = { MSH_Influences_Peasants^t_index = t_change }
	subtract_from_variable = { MSH_Influences_Peasants^t_index_2 = t_change }
	
	if = {
		limit = {
			check_variable = { MSH_Influences_Peasants^t_index_2 < 0 }
		}
		set_temp_variable = { normalize = MSH_Influences_Peasants^t_index_2 }
		set_variable = { MSH_Influences_Peasants^t_index_2 = 0 }
		add_to_variable = { MSH_Influences_Peasants^t_index = normalize }
	}
	
	clear_variable = t_index
	clear_variable = t_index_2
	clear_variable = t_change
	MSH_Influences_re_render = yes
}

MSH_change_soldiers_support_targeted = {
	custom_effect_tooltip = MSH_change_soldiers_support_targeted_CET
	
	add_to_variable = { MSH_Influences_Soldiers^t_index = t_change }
	subtract_from_variable = { MSH_Influences_Soldiers^t_index_2 = t_change }
	
	if = {
		limit = {
			check_variable = { MSH_Influences_Soldiers^t_index_2 < 0 }
		}
		set_temp_variable = { normalize = MSH_Influences_Soldiers^t_index_2 }
		set_variable = { MSH_Influences_Soldiers^t_index_2 = 0 }
		add_to_variable = { MSH_Influences_Soldiers^t_index = normalize }
	}
	
	clear_variable = t_index
	clear_variable = t_index_2
	clear_variable = t_change
	MSH_Influences_re_render = yes
}

MSH_change_intelligentsia_support_targeted = {
	custom_effect_tooltip = MSH_change_intelligentsia_support_targeted_CET
	
	add_to_variable = { MSH_Influences_Intelligentsia^t_index = t_change }
	subtract_from_variable = { MSH_Influences_Intelligentsia^t_index_2 = t_change }
	
	if = {
		limit = {
			check_variable = { MSH_Influences_Intelligentsia^t_index_2 < 0 }
		}
		set_temp_variable = { normalize = MSH_Influences_Intelligentsia^t_index_2 }
		set_variable = { MSH_Influences_Intelligentsia^t_index_2 = 0 }
		add_to_variable = { MSH_Influences_Intelligentsia^t_index = normalize }
	}
	
	clear_variable = t_index
	clear_variable = t_index_2
	clear_variable = t_change
	MSH_Influences_re_render = yes
}

MSH_change_leadership_support_targeted = {
	custom_effect_tooltip = MSH_change_leadership_support_targeted_CET
	
	add_to_variable = { MSH_Influences_Leadership^t_index = t_change }
	subtract_from_variable = { MSH_Influences_Leadership^t_index_2 = t_change }
	
	if = {
		limit = {
			check_variable = { MSH_Influences_Leadership^t_index_2 < 0 }
		}
		set_temp_variable = { normalize = MSH_Influences_Leadership^t_index_2 }
		set_variable = { MSH_Influences_Leadership^t_index_2 = 0 }
		add_to_variable = { MSH_Influences_Leadership^t_index = normalize }
	}
	
	clear_variable = t_index
	clear_variable = t_index_2
	clear_variable = t_change
	MSH_Influences_re_render = yes
}

MSH_calculate_piety_effects = {
    set_temp_variable = { MSH_piety_temp = MSH_piety } # Copy variable between 0 and 100

    set_temp_variable = { MSH_reverse_piety_temp = 100 }
    subtract_from_temp_variable = { MSH_reverse_piety_temp = MSH_piety_temp } #While piety temp increases, reverse piety decreases

    divide_temp_variable = { MSH_piety_temp = 100 } #Variable is now -1 to 1
    divide_temp_variable = { MSH_reverse_piety_temp = 100 }

    set_temp_variable = { MSH_piety_min_moralf = 0.10 }
	set_temp_variable = { MSH_piety_min_compgain = 0.05 }
	set_temp_variable = { MSH_piety_min_consgood = -0.1 }
    set_temp_variable = { MSH_piety_min_supplycomp = -0.10 }
	set_temp_variable = { MSH_piety_max_wkstab = 0.003 }
    set_temp_variable = { MSH_piety_max_indcap = 0.05 }
	set_temp_variable = { MSH_piety_max_respeed = 0.05 }
	set_temp_variable = { MSH_piety_max_locresf = 0.10 }

    multiply_temp_variable = { MSH_piety_min_moralf = MSH_piety_temp }
    multiply_temp_variable = { MSH_piety_min_compgain = MSH_piety_temp }
    multiply_temp_variable = { MSH_piety_min_consgood = MSH_piety_temp }
    multiply_temp_variable = { MSH_piety_min_supplycomp = MSH_piety_temp }
    multiply_temp_variable = { MSH_piety_max_wkstab = MSH_reverse_piety_temp }
    multiply_temp_variable = { MSH_piety_max_indcap = MSH_reverse_piety_temp }
    multiply_temp_variable = { MSH_piety_max_respeed = MSH_reverse_piety_temp }
    multiply_temp_variable = { MSH_piety_max_locresf = MSH_reverse_piety_temp }

    set_variable = { modif_MSH_piety_min_moralf = MSH_piety_min_moralf }
    set_variable = { modif_MSH_piety_min_compgain = MSH_piety_min_compgain }
    set_variable = { modif_MSH_piety_min_consgood = MSH_piety_min_consgood }
    set_variable = { modif_MSH_piety_min_supplycomp = MSH_piety_min_supplycomp }
    set_variable = { modif_MSH_piety_max_wkstab = MSH_piety_max_wkstab }
    set_variable = { modif_MSH_piety_max_indcap = MSH_piety_max_indcap }
    set_variable = { modif_MSH_piety_max_respeed = MSH_piety_max_respeed }
    set_variable = { modif_MSH_piety_max_locresf = MSH_piety_max_locresf }
    force_update_dynamic_modifier = yes
}

MSH_randomize_legalists = {
	randomize_temp_variable = {
		var = legalists_temp
		distribution = uniform
		min = legalists_min
		max = legalists_max
	}
	round_temp_variable = legalists_temp
	set_temp_variable = { purists_temp = 100 }
	subtract_from_temp_variable = { purists_temp = legalists_temp }
	set_temp_variable = { reformists_temp = random }
	multiply_temp_variable = { reformists_temp = purists_temp }
	round_temp_variable = reformists_temp
	subtract_from_temp_variable = { purists_temp = reformists_temp }
}

MSH_randomize_reformists = {
	randomize_temp_variable = {
		var = reformists_temp
		distribution = uniform
		min = reformists_min
		max = reformists_max
	}
	round_temp_variable = reformists_temp
	set_temp_variable = { purists_temp = 100 }
	subtract_from_temp_variable = { purists_temp = reformists_temp }
	set_temp_variable = { legalists_temp = random }
	multiply_temp_variable = { legalists_temp = purists_temp }
	round_temp_variable = legalists_temp
	subtract_from_temp_variable = { purists_temp = legalists_temp }
}

MSH_clear_advisor_modifiers = {
    if = {
	    limit = {
		    MSH_ochen_zekuris = {
			    is_country_leader = no
			}
        }
		remove_advisor_role = {
        	character = "MSH_ochen_zekuris"
        	slot = political_advisor
    	}
	}
	if = {
	    limit = {
		    MSH_zulaihat_zekuris = {
			    is_country_leader = no
			}
        }
		remove_advisor_role = {
        	character = "MSH_zulaihat_zekuris"
        	slot = political_advisor
		}
    }
	if = {
	    limit = {
		    has_country_flag = MSH_has_bamina
        }
		remove_advisor_role = {
            character = "HAY_queen_bamina"
            slot = political_advisor
		}
	}
	remove_advisor_role = {
        character = "MSH_sanusi_katoucha"
        slot = political_advisor
    }
	remove_advisor_role = {
        character = "MSH_sheebah_nakiyemba"
        slot = political_advisor
    }
	remove_advisor_role = {
        character = "MSH_selas_umaru"
        slot = political_advisor
    }
	if = {
	    limit = {
		    has_country_flag = MSH_has_amanyi
        }
		remove_advisor_role = {
            character = "ZUG_amanyi"
            slot = political_advisor
		}
	}
	if = {
	    limit = {
		    MSH_ochen_zekuris = {
			    is_country_leader = no
			}
        }
		add_advisor_role = {
			character = MSH_ochen_zekuris
			advisor = {
				slot = political_advisor
				idea_token = MSH_ochen_zekuris
				traits = { 
					MSH_mystic 
				}
			}
		}
	}
	if = {
	    limit = {
		    MSH_zulaihat_zekuris = {
			    is_country_leader = no
			}
        }
		add_advisor_role = {
			character = MSH_zulaihat_zekuris
			advisor = {
				slot = political_advisor
				idea_token = MSH_zulaihat_zekuris
				traits = { 
					MSH_legalist_judge 
				}
			}
		}
	}
	if = {
	    limit = {
		    has_country_flag = MSH_has_bamina
        }
		add_advisor_role = {
			character = HAY_queen_bamina
			advisor = {
				slot = political_advisor
				idea_token = HAY_queen_bamina
				traits = { 
					MSH_the_slave_queen 
				}
			}
		}
	}
	if = {
	    limit = {
		    has_country_flag = MSH_has_amanyi
        }
		add_advisor_role = {
			character = ZUG_amanyi
			advisor = {
				slot = political_advisor
				idea_token = ZUG_amanyi
				traits = { 
					MSH_agricultural_chemist 
				}
			}
		}
	}
	add_advisor_role = {
		character = MSH_sanusi_katoucha
		advisor = {
			slot = political_advisor
			idea_token = MSH_sanusi_katoucha
			traits = { 
				MSH_the_shade 
			}
		}
	}
	add_advisor_role = {
		character = MSH_sheebah_nakiyemba
		advisor = {
			slot = political_advisor
			idea_token = MSH_sheebah_nakiyemba
			traits = { 
				captain_of_industry 
			}
		}
	}
	add_advisor_role = {
		character = MSH_selas_umaru
		advisor = {
			slot = political_advisor
			idea_token = MSH_selas_umaru
			traits = { 
				administrative_genius 
			}
		}
	}
	remove_advisor_role = {
        character = "MSH_zardo_ganduje"
        slot = theorist
    }
	remove_advisor_role = {
        character = "MSH_zaaba_maal"
        slot = theorist
    }
	remove_advisor_role = {
        character = "MSH_aicha_zamidou"
        slot = theorist
    }
	add_advisor_role = {
		character = MSH_zardo_ganduje
		advisor = {
			slot = theorist
			idea_token = MSH_zardo_ganduje
			cost = 100
			traits = { 
				superior_firepower_expert 
			}
		}
	}
	add_advisor_role = {
		character = MSH_zaaba_maal
		advisor = {
			slot = theorist
			idea_token = MSH_zaaba_maal
			cost = 100
			traits = { 
				grand_battle_plan_expert 
			}
		}
	}
	add_advisor_role = {
		character = MSH_aicha_zamidou
		advisor = {
			slot = theorist
			idea_token = MSH_aicha_zamidou
			cost = 100
			traits = { 
				mass_assault_expert 
			}
		}
	}
	remove_advisor_role = {
        character = "MSH_bayero_zanduje"
        slot = army_chief
    }
	remove_advisor_role = {
        character = "MSH_lamina_konare"
        slot = army_chief
    }
	remove_advisor_role = {
        character = "MSH_zufai_sumaila"
        slot = army_chief
    }
	add_advisor_role = {
		character = MSH_bayero_zanduje
		advisor = {
			slot = army_chief
			idea_token = MSH_bayero_zanduje
			cost = 100
			traits = { 
				army_chief_organizational_2 
			}
		}
	}
	add_advisor_role = {
		character = MSH_lamina_konare
		advisor = {
			slot = army_chief
			idea_token = MSH_lamina_konare
			cost = 100
			traits = { 
				army_chief_morale_2 
			}
		}
	}
	add_advisor_role = {
		character = MSH_zufai_sumaila
		advisor = {
			slot = army_chief
			idea_token = MSH_lamina_konare
			cost = 100
			traits = { 
				army_chief_offensive_2 
			}
		}
	}
	remove_advisor_role = {
        character = "MSH_nadira_sekai"
        slot = air_chief
    }
	remove_advisor_role = {
        character = "MSH_russom_sekai"
        slot = air_chief
    }
	add_advisor_role = {
		character = MSH_nadira_sekai
		advisor = {
			slot = air_chief
			idea_token = MSH_nadira_sekai
			cost = 150
			traits = { 
				air_chief_safety_3 
			}
		}
	}
	add_advisor_role = {
		character = MSH_russom_sekai
		advisor = {
			slot = air_chief
			idea_token = MSH_russom_sekai
			cost = 150
			traits = { 
				air_chief_ground_support_3 
			}
		}
	}
	remove_advisor_role = {
        character = "MSH_zana_asmau"
        slot = high_command
    }
	remove_advisor_role = {
        character = "MSH_fodio_zagudu"
        slot = high_command
    }
	remove_advisor_role = {
        character = "MSH_zalilu_konate"
        slot = high_command
    }
	remove_advisor_role = {
        character = "MSH_karamokho_zalfa"
        slot = high_command
    }
	remove_advisor_role = {
        character = "MSH_yahya_modja"
        slot = high_command
    }
	remove_advisor_role = {
        character = "MSH_kourido_rassin"
        slot = high_command
    }
	add_advisor_role = {
		character = MSH_zana_asmau
		advisor = {
			slot = high_command
			idea_token = MSH_zana_asmau
			cost = 100
			traits = { 
				army_infantry_2 
			}
		}
	}
	add_advisor_role = {
		character = MSH_fodio_zagudu
		advisor = {
			slot = high_command
			idea_token = MSH_fodio_zagudu
			cost = 50
			traits = { 
				army_CombinedArms_1 
			}
		}
	}
	add_advisor_role = {
		character = MSH_zalilu_konate
		advisor = {
			slot = high_command
			idea_token = MSH_zalilu_konate
			cost = 100
			traits = { 
				army_artillery_2 
			}
		}
	}
	add_advisor_role = {
		character = MSH_karamokho_zalfa
		advisor = {
			slot = high_command
			idea_token = MSH_karamokho_zalfa
			cost = 100
			traits = { 
				army_commando_2 
			}
		}
	}
	add_advisor_role = {
		character = MSH_yahya_modja
		advisor = {
			slot = high_command
			idea_token = MSH_yahya_modja
			cost = 50
			traits = { 
				army_regrouping_1 
			}
		}
	}
	add_advisor_role = {
		character = MSH_kourido_rassin
		advisor = {
			slot = high_command
			idea_token = MSH_kourido_rassin
			cost = 150
			traits = { 
				army_logistics_3 
			}
			can_be_fired = yes
		}
	}
}

MSH_set_state_region = {
    ### Upper Neighle ###
	767 = {
	    set_state_flag = MSH_upper_neighle_region
	}
	902 = {
	    set_state_flag = MSH_upper_neighle_region
	}
	### Timbucktu ###
	937 = {
	    set_state_flag = MSH_timbucktu_region
	}
	938 = {
	    set_state_flag = MSH_timbucktu_region
	}
	953 = {
	    set_state_flag = MSH_timbucktu_region
	}
	### Re'em ###
	950 = {
	    set_state_flag = MSH_reem_region
	}
	951 = {
	    set_state_flag = MSH_reem_region
	}
	952 = {
	    set_state_flag = MSH_reem_region
	}
	### Ashlands ###
	903 = {
	    set_state_flag = MSH_ashlands_region
	}
	935 = {
	    set_state_flag = MSH_ashlands_region
	}
	936 = {
	    set_state_flag = MSH_ashlands_region
	}
	969 = {
	    set_state_flag = MSH_ashlands_region
	}
	### God's Eye ###
	968 = {
	    set_state_flag = MSH_gods_eye_region
	}
	939 = {
	    set_state_flag = MSH_gods_eye_region
	}
	948 = {
	    set_state_flag = MSH_gods_eye_region
	}
	### The Hinterlands ###
	940 = {
	    set_state_flag = MSH_hinterlands_region
	}
	941 = {
	    set_state_flag = MSH_hinterlands_region
	}
	### Golden Hills ###
	942 = {
	    set_state_flag = MSH_golden_hills_region
	}
	### Arabian Marches ###
	959 = {
	    set_state_flag = MSH_arabian_marches_region
	}
	960 = {
        set_state_flag = MSH_arabian_marches_region
	}
	944 = {
	    set_state_flag = MSH_arabian_marches_region
	}
	### Ziani Metropolitan Area ###
	943 = {
	    set_state_flag = MSH_ziani_region
	}
	### Mozzi Forest ###
	961 = {
	    set_state_flag = MSH_mozzi_forest_region
	}
	947 = {
	    set_state_flag = MSH_mozzi_forest_region
	}
	### Marshlands ###
	945 = {
	    set_state_flag = MSH_marshlands_region
	}
	946 = {
        set_state_flag = MSH_marshlands_region
	}
	963 = {
	    set_state_flag = MSH_marshlands_region
	}
	### Northern Ekirombe ###
	949 = {
	    set_state_flag = MSH_north_ekirombe_region
	}
	970 = {
        set_state_flag = MSH_north_ekirombe_region
	}
	### Southern Ekirombe ###
	966 = {
	    set_state_flag = MSH_south_ekirombe_region
	}
	967 = {
        set_state_flag = MSH_south_ekirombe_region
	}
	964 = {
        set_state_flag = MSH_south_ekirombe_region
	}
	### Eastern Ekirombe ###
	965 = {
	    set_state_flag = MSH_east_ekirombe_region
	}
	971 = {
        set_state_flag = MSH_east_ekirombe_region
	}
	975 = {
        set_state_flag = MSH_east_ekirombe_region
	}
	### South Ashlands ###
	972 = {
	    set_state_flag = MSH_south_ashlands_region
	}
	973 = {
        set_state_flag = MSH_south_ashlands_region
	}
	### The Shire ###
	974 = {
	    set_state_flag = MSH_shire_region
	}
	976 = {
        set_state_flag = MSH_shire_region
	}
	### Deep South ###
	977 = {
	    set_state_flag = MSH_deep_south_region
	}
	1037 = {
        set_state_flag = MSH_deep_south_region
	}
	1038 = {
        set_state_flag = MSH_deep_south_region
	}
}

MSH_set_state_status = {
	#0 - Unowned
	#1 - Undecided
	#2 - Agricultural
	#3 - Resource
	#4 - Industrial
	every_state = {
		limit = {
			has_state_flag = MSH_upper_neighle_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_timbucktu_region
		}
		set_variable = { MSH_economic_region = 4 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_industrial 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_ashlands_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_gods_eye_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_hinterlands_region
		}
		set_variable = { MSH_economic_region = 3 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_resource 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_golden_hills_region
		}
		set_variable = { MSH_economic_region = 3 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_resource 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_arabian_marches_region
		}
		set_variable = { MSH_economic_region = 2 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_agriculture 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_ziani_region
		}
		set_variable = { MSH_economic_region = 4 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_industrial 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_mozzi_forest_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_marshlands_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_north_ekirombe_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_south_ekirombe_region
		}
		set_variable = { MSH_economic_region = 2 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_agriculture 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_east_ekirombe_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_south_ashlands_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	every_state = {
		limit = {
			has_state_flag = MSH_shire_region
		}
		set_variable = { MSH_economic_region = 4 }
		add_dynamic_modifier = { 
			modifier = MSH_economic_industrial 
		}
	}
	every_state = {
		limit = {
			has_state_flag = MSH_deep_south_region
		}
		set_variable = { MSH_economic_region = 1 }
	}
	if = {
	    limit = {
		    950 = {
			    is_owned_and_controlled_by = ROOT
			}
			951 = {
			    is_owned_and_controlled_by = ROOT
			}
			952 = {
			    is_owned_and_controlled_by = ROOT
			}
		}
		every_state = {
			limit = {
				has_state_flag = MSH_reem_region
			}
			set_variable = { MSH_economic_region = 1 }
		}
	}
	if = {
	    limit = {
		    950 = {
			    NOT = {
			        is_owned_and_controlled_by = ROOT
				}
			}
			951 = {
			    NOT = {
			        is_owned_and_controlled_by = ROOT
				}
			}
			952 = {
			    NOT = {
			        is_owned_and_controlled_by = ROOT
				}
			}
		}
		every_state = {
			limit = {
				has_state_flag = MSH_reem_region
			}
			set_variable = { MSH_economic_region = 0 }
		}
	}
}

MSH_set_up_civil_war = {
	#hidden_effect = {
		retire_character = MSH_uncertain_leadership
		release = REE
		every_owned_state = {
			add_core_of = MSH
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = picked_legalist
				}
			}
			create_dynamic_country = {
				original_tag = MSH
				setup_legalist_cw = yes
			}
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = picked_purist
				}
			}
			create_dynamic_country = {
				original_tag = MSH
				setup_purist_cw = yes
			}
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = picked_reformist
				}
			}
			create_dynamic_country = {
				original_tag = MSH
				setup_reformist_cw = yes
			}
		}
		if = {
			limit = {
				has_country_flag = picked_legalist
			}
			setup_legalist_cw = yes
			transfer_units_fraction = {
				target = MSP
				size = 0.33
			}
			transfer_units_fraction = {
				target = MSR
				size = 0.5
			}
		}
		else_if = {
			limit = {
				has_country_flag = picked_purist
			}
			setup_purist_cw = yes
			transfer_units_fraction = {
				target = MSL
				size = 0.33
			}
			transfer_units_fraction = {
				target = MSR
				size = 0.5
			}
		}
		else_if = {
			limit = {
				has_country_flag = picked_reformist
			}
			setup_reformist_cw = yes
			transfer_units_fraction = {
				target = MSP
				size = 0.33
			}
			transfer_units_fraction = {
				target = MSL
				size = 0.5
			}
		}

		MSL = {
			#placeholder before using oob
			division_template = {
				name = "Civ War Militia"
				is_locked = yes
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
				}
			}
			for_loop_effect = {
				start = 1
				end = 15
				capital_scope = {
					create_unit = {
						division = "name = \"AAAAAAAAAAAAA\" division_template = \"Civ War Militia\" start_experience_factor = 0.1"
						owner = PREV
					}					
				}				
			}
			every_owned_state = {
				limit = {
					NOT = {
						state = 968
						state = 948
						state = 939
						state = 940
					}
				}
				teleport_armies = {
					to_state = 968
				}
			}
			PREV = {
				MSH_safinata_zekuris = {
					set_nationality = PREV.PREV
				}
			}
			add_country_leader_role = {
				character = MSH_safinata_zekuris
				promote_leader = yes
				country_leader = {
					desc = MSH_safinata_zekuris_desc
					expire = "1965.1.1"
					ideology = falangism
					traits = { 
						MSH_legalist_judge
					}
				}
			}
			add_country_leader_role = {
				character = MSH_safinata_zekuris
				promote_leader = yes
				country_leader = {
					desc = MSH_safinata_zekuris_desc
					expire = "1965.1.1"
					ideology = theocracy_subideology
					traits = { 
						MSH_legalist_judge
					}
				}
			}
			add_country_leader_role = {
				character = MSH_safinata_zekuris
				promote_leader = yes
				country_leader = {
					desc = MSH_safinata_zekuris_desc
					expire = "1965.1.1"
					ideology = harmonic_theocracy
					traits = { 
						MSH_legalist_judge
					}
				}
			}
			declare_war_on = {
				target = MSP
				type = civil_war
			}
			add_civil_war_target = MSL
			add_civil_war_target = MSP
			add_civil_war_target = MSR
		}
		MSP = {
			#placeholder before using oob
			division_template = {
				name = "Civ War Militia"
				is_locked = yes
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
				}
			}
			for_loop_effect = {
				start = 1
				end = 15
				capital_scope = {
					create_unit = {
						division = "name = \"AAAAAAAAAAAAA\" division_template = \"Civ War Militia\" start_experience_factor = 0.1"
						owner = PREV
					}					
				}				
			}
			every_owned_state = {
				limit = {
					NOT = {
						state = 943
						state = 944
						state = 947
						state = 960
						state = 942
					}
				}
				teleport_armies = {
					to_state = 943
				}
			}
			PREV = {
				MSH_sanusi_katoucha = {
					set_nationality = PREV.PREV
				}
			}
			add_country_leader_role = {
				character = MSH_sanusi_katoucha
				promote_leader = yes
				country_leader = {
					desc = MSH_sanusi_katoucha_desc
					expire = "1965.1.1"
					ideology = falangism
					traits = { 
						MSH_the_shade
					}
				}
			}
			add_country_leader_role = {
				character = MSH_sanusi_katoucha
				promote_leader = yes
				country_leader = {
					desc = MSH_sanusi_katoucha_desc
					expire = "1965.1.1"
					ideology = theocracy_subideology
					traits = { 
						MSH_the_shade
					}
				}
			}
			add_country_leader_role = {
				character = MSH_sanusi_katoucha
				promote_leader = yes
				country_leader = {
					desc = MSH_sanusi_katoucha_desc
					expire = "1965.1.1"
					ideology = harmonic_theocracy
					traits = { 
						MSH_the_shade
					}
				}
			}
			declare_war_on = {
				target = MSR
				type = civil_war
			}
			add_civil_war_target = MSL
			add_civil_war_target = MSP
			add_civil_war_target = MSR
		}
		MSR = {
			PREV = {
				MSH_issa_jalloh = {
					set_nationality = PREV.PREV
				}
			}
			add_country_leader_role = {
				character = MSH_issa_jalloh
				promote_leader = yes
				country_leader = {
					desc = MSH_issa_jalloh_desc
					expire = "1965.1.1"
					ideology = harmonic_theocracy
					traits = { 
						MSH_mystic
					}
				}
			}	
			add_country_leader_role = {
				character = MSH_issa_jalloh
				promote_leader = yes
				country_leader = {
					desc = MSH_issa_jalloh_desc
					expire = "1965.1.1"
					ideology = falangism
					traits = { 
						MSH_mystic
					}
				}
			}
			add_country_leader_role = {
				character = MSH_issa_jalloh
				promote_leader = yes
				country_leader = {
					desc = MSH_issa_jalloh_desc
					expire = "1965.1.1"
					ideology = theocracy_subideology
					traits = { 
						MSH_mystic
					}
				}
			}
			#placeholder before using oob
			division_template = {
				name = "Civ War Militia"
				is_locked = yes
				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
				}
			}
			for_loop_effect = {
				start = 1
				end = 15
				capital_scope = {
					create_unit = {
						division = "name = \"AAAAAAAAAAAAA\" division_template = \"Civ War Militia\" start_experience_factor = 0.05"
						owner = PREV
					}					
				}				
			}
			every_owned_state = {
				limit = {
					NOT = {
						state = 974
						state = 975
						state = 976
						state = 977
					}
				}
				teleport_armies = {
					to_state = 974
				}
			}
			declare_war_on = {
				target = MSL
				type = civil_war
			}
			add_civil_war_target = MSL
			add_civil_war_target = MSP
			add_civil_war_target = MSR
		}
	#}
}

setup_legalist_cw = {
	set_country_flag = MSH_civ_war_legalist
	set_cosmetic_tag = MSH_legalist_cw

	load_focus_tree = maciegna_tree_3
	complete_national_focus = MSH_uncertain_legalist

	set_politics = {
		ruling_party = fascism
		elections_allowed = no
	}
	set_popularities = {
		fascism = 100
	}

	set_capital = {
		state = 968
	}

	transfer_state = 968
	transfer_state = 948
	transfer_state = 939
	transfer_state = 940

	transfer_state = 959
	transfer_state = 961
	transfer_state = 963
	transfer_state = 964
	transfer_state = 966
	transfer_state = 1038
	transfer_state = 973
	transfer_state = 971
	transfer_state = 903
	transfer_state = 935
	transfer_state = 937
}
setup_purist_cw = {
	set_country_flag = MSH_civ_war_purist
	set_cosmetic_tag = MSH_purist_cw

	load_focus_tree = maciegna_tree_4
	complete_national_focus = MSH_uncertain_purist
	
	set_politics = {
		ruling_party = neutrality
		elections_allowed = no
	}
	set_popularities = {
		neutrality = 100
	}

	set_capital = {
		state = 943
	}

	transfer_state = 943
	transfer_state = 944
	transfer_state = 947
	transfer_state = 960
	
	transfer_state = 942

	transfer_state = 970
	transfer_state = 965
	transfer_state = 1037
	transfer_state = 972

	transfer_state = 768 #impassable lel

}
setup_reformist_cw = {
	set_country_flag = MSH_civ_war_reformist
	set_cosmetic_tag = MSH_reformist_cw

	load_focus_tree = maciegna_tree_5
	#complete_national_focus = MSH_uncertain_reformist

	set_politics = {
		ruling_party = democratic
		elections_allowed = no
	}

	set_popularities = {
		democratic = 100
	}

	set_capital = {
		state = 974
	}

	transfer_state = 974
	transfer_state = 975
	transfer_state = 976
	transfer_state = 977

	transfer_state = 941
	transfer_state = 945

	transfer_state = 967
	transfer_state = 969
	transfer_state = 936
	transfer_state = 953
	transfer_state = 938
	transfer_state = 902
	transfer_state = 767
}