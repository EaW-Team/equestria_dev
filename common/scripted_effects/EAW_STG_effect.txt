modify_var_stg_construction_2 = {
	if = {
		limit = {
			OR = { has_food_shortages_STG = yes has_war = yes }
		}
		add_to_variable = { var = palace_construction value = 3 }
	}
	else_if = {
		limit = {
			has_war = no
			NOT = { has_food_shortages_STG = yes }
		}
		add_to_variable = { var = palace_construction value = 4 }
	}
	else_if = {
		limit = {
			has_war = no
			NOT = { has_food_shortages_STG = yes }
			NOT = { has_idea = incomplete_industrialization }
		}
		add_to_variable = { var = palace_construction value = 5 }
	}
}

deconstruct_the_palace_stg = {
	if = {
		limit = {
			check_variable = { var = palace_construction value = 20 compare = greater_than_or_equals }
			NOT = { check_variable = { var = palace_construction value = 20 compare = less_than } }
			has_country_flag = statue_obtained
		}
		four_random_industrial_complex = yes
		add_resource = { type = steel amount = 20 state = 153 }
		add_resource = { type = steel amount = 5 state = 166 }
	}
	if = {
		limit = {
			check_variable = { var = palace_construction value = 20 compare = greater_than_or_equals }
			NOT = { check_variable = { var = palace_construction value = 20 compare = less_than } }
			NOT = { has_country_flag = statue_obtained }
		}
		four_random_industrial_complex = yes
		add_resource = { type = steel amount = 20 state = 153 }
	}
	if = {
		limit = {
			NOT = { check_variable = { var = palace_construction value = 20 compare = greater_than_or_equals } }
			check_variable = { var = palace_construction value = 15 compare = greater_than_or_equals }
			NOT = { check_variable = { var = palace_construction value = 15 compare = less_than } }
		}
		three_random_industrial_complex = yes
		add_resource = { type = steel amount = 15 state = 153 }
	}
	if = {
		limit = {
			NOT = { check_variable = { var = palace_construction value = 15 compare = greater_than_or_equals } }
			check_variable = { var = palace_construction value = 10 compare = greater_than_or_equals }
			NOT = { check_variable = { var = palace_construction value = 10 compare = less_than } }
		}
		two_random_industrial_complex = yes
		add_resource = { type = steel amount = 10 state = 153 }
	}
	if = {
		limit = {
			NOT = { check_variable = { var = palace_construction value = 10 compare = greater_than_or_equals } }
			check_variable = { var = palace_construction value = 1 compare = greater_than_or_equals }
		}
		two_random_industrial_complex = yes
		add_resource = { type = steel amount = 5 state = 153 }
	}
	if = {
		limit = {
			check_variable = { var = palace_construction value = 0 compare = equals }
		}
		one_random_industrial_complex = yes
		add_resource = { type = steel amount = 3 state = 153 }
	}
}

remove_hunger_effect = {
	if = {
		limit = {
			has_idea = severe_famine
		}
		swap_ideas = { add_idea = severe_famine2 remove_idea = severe_famine }
	}
	else_if = {
		limit = {
			has_idea = severe_famine2
		}
		swap_ideas = { add_idea = severe_famine3 remove_idea = severe_famine2 }
	}
	else_if = {
		limit = {
			has_idea = severe_famine3
		}
		swap_ideas = { add_idea = severe_famine4 remove_idea = severe_famine3 }
	}
	else_if = {
		limit = {
			has_idea = severe_famine4
		}
		swap_ideas = { add_idea = severe_famine5 remove_idea = severe_famine4 }
	}
	else_if = {
		limit = {
			has_idea = severe_famine5
		}
		swap_ideas = { add_idea = severe_famine6 remove_idea = severe_famine5 }
	}
	else_if = {
		limit = {
			has_idea = severe_famine6
		}
		remove_ideas = severe_famine6
	}
}
remove_agrarian_problem_vasya = {
	if = {
		limit = {
			has_idea = STG_agrarian_problem
		}
		swap_ideas = {
			remove_idea = STG_agrarian_problem
			add_idea = STG_agrarian_problem_vasya_1
		}
	}
}
remove_agrarian_problem_karamelka = {
	if = {
		limit = {
			has_idea = STG_agrarian_problem
		}
		swap_ideas = {
			remove_idea = STG_agrarian_problem
			add_idea = STG_agrarian_problem_karamelka_1
		}
	}
}
remove_workers_army = {
	if = {
		limit = {
			has_idea = STG_workers_army
		}
		swap_ideas = {
			remove_idea = STG_workers_army
			add_idea = STG_workers_army_1
		}
	}
}
remove_equestrian_embargo_vasya = {
	if = {
		limit = {
			has_idea = STG_equestrian_embargo
		}
	}
	swap_ideas = {
		remove_idea = STG_equestrian_embargo
		add_idea = STG_equestrian_embargo_vasya_1
	}
}
remove_equestrian_embargo_karamelka = {
	if = {
		limit = {
			has_idea = STG_equestrian_embargo
		}
	}
	swap_ideas = {
		remove_idea = STG_equestrian_embargo
		add_idea = STG_equestrian_embargo_kar_1
	}
}
STG_vasya_industry_upd = {
	if = {
		limit = {
			has_idea = STG_new_economic_policy
		}
	}
	swap_ideas = {
		remove_idea = STG_new_economic_policy
		add_idea = STG_vasya_industry
	}
}
STG_sladkova_industry_upd = {
	if = {
		limit = {
			has_idea = STG_create_new_ships_idea
		}
	}
	swap_ideas = {
		remove_idea = STG_new_economic_policy
		add_idea = STG_sladkova_industry
	}
}

STG_check_party_variables = {

	clamp_variable = {
		var = STG_main_party_support
		min = 0
		max = 100
	}

	clamp_variable = {
		var = STG_left_opposition_support
		min = 0
		max = 100
	}

	clamp_variable = {
		var = STG_right_opposition_support
		min = 0
		max = 100
	}
}
#Crutch for party mechanic part 
#Just delete shit that you don't need. Loc and checks are written in other shit
#typical_cringe_STG_effect = { #name for your effect and don't forget write in event typacal_cringe_STG_effect = yes
#	add_to_variable = {
#		var = STG_main_party_influence
#		value = x you can use negative number
#		tooltip = STG_main_party_influence_tt
#	}
#	add_to_variable = {
#		var = STG_main_party_support
#		value = x you can use negative number
#		tooltip = STG_main_party_party_support_tt
#	}
#	add_to_variable = {
#		var = STG_opposition_influence
#		value = x you can use negative number
#		tooltip = STG_opposition_influence_tt
#	}
#	add_to_variable = {
#		var = STG_opposition_support
#		value = x you can use negative number
#		tooltip = STG_opposition_support_tt
#	}
#	add_to_variable = {
#		var = STG_main_party_influence_2
#		value = x you can use negative number
#		tooltip = STG_main_party_influence_2_tt
#	}
#	add_to_variable = {
#		var = STG_main_party_influence_2
#		value = x you can use negative number
#		tooltip = STG_main_party_support_2_tt
#	}
#	add_to_variable = {
#		var = STG_left_opposition_influence
#		value = x you can use negative number
#		tooltip = STG_left_opposition_influence_tt
#	}
#	add_to_variable = {
#		var = STG_left_opposition_support
#		value = x you can use negative number
#		tooltip = STG_left_opposition_support_tt
#	}
#	add_to_variable = {
#		var = STG_right_opposition_influence
#		value = x you can use negative number
#		tooltip = STG_right_opposition_influence_tt
#	}
#	add_to_variable = {
#		var = STG_right_opposition_support
#		value = x you can use negative number
#		tooltip = STG_right_opposition_support_tt
#	}
#	STG_check_party_variables = yes
#}
#STG_party_recalculating = {
#	TODO this shit later (don't forget about status quo)
#	
vasya_STG_effect = {
	add_to_variable = {
		var = STG_main_party_support
		value = 2
		tooltip = STG_main_party_party_support_tt
	}
	add_to_variable = {
		var = STG_opposition_support
		value = -2
		tooltip = STG_opposition_support_tt
	}
	STG_check_party_variables = yes
}
opposition_STG_effect = {
	add_to_variable = {
		var = STG_main_party_support
		value = -2
		tooltip = STG_main_party_party_support_tt
	}
	add_to_variable = {
		var = STG_opposition_support
		value = 2
		tooltip = STG_opposition_support_tt
	}
	STG_check_party_variables = yes
}
vasya_adv_STG_effect = {
	add_to_variable = {
		var = STG_main_party_support
		value = 2
		tooltip = STG_main_party_party_support_tt
	}
	add_to_variable = {
		var = STG_opposition_support
		value = -2
		tooltip = STG_opposition_support_tt
	}
	add_to_variable = {
		var = STG_main_party_influence
		value = 1 
		tooltip = STG_main_party_influence_tt
	}
	add_to_variable = {
		var = STG_opposition_influence
		value = -1 
		tooltip = STG_opposition_influence_tt
	}
	STG_check_party_variables = yes
}
opposition_STG_effect_LEFT = {
	add_to_variable = {
		var = STG_main_party_support
		value = -4
		tooltip = STG_main_party_party_support_tt
	}
	add_to_variable = {
		var = STG_opposition_support
		value = 4
		tooltip = STG_opposition_support_tt
	}
	STG_check_party_variables = yes
}
vasya_STG_effect_2 = {
	add_to_variable = {
		var = STG_main_party_support_2
		value = 2
		tooltip = STG_main_party_party_support_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_support
		value = -2
		tooltip = STG_left_opposition_support_tt
	}
	add_to_variable = {
		var = STG_right_opposition_support
		value = -2
		tooltip = STG_right_opposition_support_tt
	}
	add_to_variable = {
		var = STG_main_party_influence_2
		value = 1
		tooltip = STG_main_party_influence_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_influence
		value = -1
		tooltip = STG_left_opposition_influence_tt
	}
	add_to_variable = {
		var = STG_right_opposition_influence
		value = -1
		tooltip = STG_right_opposition_influence_tt
	}
	STG_check_party_variables = yes
}
left_STG_effect_2 = {
	add_to_variable = {
		var = STG_main_party_support_2
		value = -2
		tooltip = STG_main_party_party_support_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_support
		value = 2
		tooltip = STG_left_opposition_support_tt
	}
	add_to_variable = {
		var = STG_right_opposition_support
		value = -2
		tooltip = STG_right_opposition_support_tt
	}
	add_to_variable = {
		var = STG_main_party_influence_2
		value = -1
		tooltip = STG_main_party_influence_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_influence
		value = 1
		tooltip = STG_left_opposition_influence_tt
	}
	add_to_variable = {
		var = STG_right_opposition_influence
		value = -1
		tooltip = STG_right_opposition_influence_tt
	}
	STG_check_party_variables = yes
}
right_STG_effect_2 = {
	add_to_variable = {
		var = STG_main_party_support_2
		value = -2
		tooltip = STG_main_party_support_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_support
		value = -2
		tooltip = STG_left_opposition_support_tt
	}
	add_to_variable = {
		var = STG_right_opposition_support
		value = 2
		tooltip = STG_right_opposition_support_tt
	}
	add_to_variable = {
		var = STG_main_party_influence_2
		value = -1
		tooltip = STG_main_party_influence_2_tt
	}
	add_to_variable = {
		var = STG_left_opposition_influence
		value = -1
		tooltip = STG_left_opposition_influence_tt
	}
	add_to_variable = {
		var = STG_right_opposition_influence
		value = 1
		tooltip = STG_right_opposition_influence_tt
	}
	STG_check_party_variables = yes
}
I_WANT_TO_FINISH_THIS_MECHANIC_WHEN_I_AM_ALIVE = {
	if = {
		limit = {
			check_variable = { STG_opposition_support < 30 }
		}
		set_country_flag = STG_flag_unity_in_party
	}
	else_if = { 
		limit = {
			check_variable = { STG_main_party_support < 71 }
			has_country_flag = STG_EASY_LEFT
		}
		set_country_flag = STG_flag_status_quo
		set_temp_variable = { temp1 = STG_main_party_support }
		divide_temp_variable = { temp1 = 8 }
		set_temp_variable = { temp2 = STG_main_party_support_2 }
		add_to_temp_variable = { temp2 = temp1 }
		multiply_temp_variable = { temp2 = 4 }
		set_temp_variable = { temp3 = STG_left_opposition_support }
		add_to_temp_variable = { temp3 = temp1 }
		multiply_temp_variable = { temp3 = 3 }
		set_temp_variable = { temp4 = STG_right_opposition_support }
		add_to_temp_variable = { temp4 = temp1 }
		multiply_temp_variable = { temp4 = 1 }
		set_temp_variable = { temp5 = STG_opposition_support }
		divide_temp_variable = { temp5 = 2 }
		add_to_variable = { STG_left_opposition_support = temp5 }
		add_to_variable = { STG_right_opposition_support = temp5 }
		add_to_variable = { STG_main_party_support_2 = temp2 }
		add_to_variable = { STG_left_opposition_support = temp3 }
		add_to_variable = { STG_right_opposition_support = temp4 }
		STG_check_party_variables = yes
	}
	else_if = { 
		limit = {
			check_variable = { STG_main_party_support < 71 }
		}
		set_country_flag = STG_flag_status_quo
		set_temp_variable = { temp1 = STG_main_party_support }
		divide_temp_variable = { temp1 = 4 }
		set_temp_variable = { temp2 = STG_main_party_support_2 }
		add_to_temp_variable = { temp2 = temp1 }
		multiply_temp_variable = { temp2 = 2 }
		set_temp_variable = { temp3 = STG_left_opposition_support }
		add_to_temp_variable = { temp3 = temp1 }
		multiply_temp_variable = { temp3 = 1 }
		set_temp_variable = { temp4 = STG_right_opposition_support }
		add_to_temp_variable = { temp4 = temp1 }
		multiply_temp_variable = { temp4 = 1 }
		set_temp_variable = { temp5 = STG_opposition_support }
		divide_temp_variable = { temp5 = 2 }
		add_to_variable = { STG_left_opposition_support = temp5 }
		add_to_variable = { STG_right_opposition_support = temp5 }
		add_to_variable = { STG_main_party_support_2 = temp2 }
		add_to_variable = { STG_left_opposition_support = temp3 }
		add_to_variable = { STG_right_opposition_support = temp4 }
		STG_check_party_variables = yes
	}
	
	opposition_adv_STG_effect = {
		add_to_variable = {
			var = STG_main_party_support
			value = -2
			tooltip = STG_main_party_party_support_tt
		}
		add_to_variable = {
			var = STG_opposition_support
			value = 2
			tooltip = STG_opposition_support_tt
		}
		add_to_variable = {
			var = STG_main_party_influence
			value = -1 
			tooltip = STG_main_party_influence_tt
		}
		add_to_variable = {
			var = STG_opposition_influence
			value = 1 
			tooltip = STG_opposition_influence_tt
		}
		STG_check_party_variables = yes
	}
}
karamelkas_reform_increase_5 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = 5
		tooltip = STG_karamelkas_reform_increase_tt
	}
	check_karamelkas_variables = yes
}
karamelkas_reform_increase_10 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = 10
		tooltip = STG_karamelkas_reform_increase_tt
	}
	check_karamelkas_variables = yes
}
karamelkas_reform_increase_15 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = 15
		tooltip = STG_karamelkas_reform_increase_tt
	}
	check_karamelkas_variables = yes
}
karamelkas_reform_decrease_5 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = -5
		tooltip = STG_karamelkas_reform_decrease_tt
	}
	check_karamelkas_variables = yes
}

karamelkas_reform_decrease_10 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = -10
		tooltip = STG_karamelkas_reform_decrease_tt
	}
	check_karamelkas_variables = yes
}
karamelkas_reform_decrease_15 = {
	add_to_variable = {
		var = STG_Karamelkas_reform_progress
		value = -15
		tooltip = STG_karamelkas_reform_decrease_tt
		}
	check_karamelkas_variables = yes
}
check_karamelkas_variables = {
	clamp_variable = {
		var = STG_Karamelkas_reform_progress
		min = 0
		max = 100
	}
}

STG_wings_popularity_penalties_check = {
	
	##### Left wing influence
	
	set_temp_variable = { tmp_factories_change = STG_left_opposition_support }
	subtract_from_temp_variable = { tmp_factories_change = 50 }
	multiply_temp_variable = { tmp_factories_change = 0.003 }
	set_variable = { left_opposition_factory_influence = tmp_factories_change }
	
	#### Right wing influence
	
	set_temp_variable = { tmp_resource_change = STG_right_opposition_support }
	subtract_from_temp_variable = { tmp_resource_change = 50 }
	multiply_temp_variable = { tmp_resource_change = 0.003 }
	set_variable = { right_opposition_resources_influence = tmp_resource_change }
	
	#### Main party influence
	
	set_temp_variable = { tmp_politpower_change = STG_main_party_support }
	subtract_from_temp_variable = { tmp_politpower_change = 50 }
	multiply_temp_variable = { tmp_politpower_change = 0.003 }
	set_variable = { centrists_politpower_influence = tmp_politpower_change }
	
}