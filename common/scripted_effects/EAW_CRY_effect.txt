CRY_sombra_takeover = {
	
	promote_character = CRY_sombra
	add_country_leader_role = {
		character = CRY_radiant_hope
		promote_leader = yes

		country_leader = {
			expire = "1965.1.1"
			ideology = harmonic_magocracy
			traits = { fascist_sympathies }
		}
	}
	set_party_name = { ideology = fascism name = CRY_sombra_party long_name = CRY_sombra_party }
	set_party_name = { ideology = democratic name = CRY_nice_sombra_party long_name = CRY_nice_sombra_party_long }
	set_party_name = { ideology = communism name = CRY_slaves_party long_name = CRY_slaves_party_long }
	set_party_name = { ideology = neutrality name = CRY_irrelevant_party long_name = CRY_irrelevant_party_long }
	set_cosmetic_tag = CRY_SOM
	load_focus_tree = crystalempire_sombra
	hidden_effect = {
		load_oob = "CRY_SOM_devoted_army"
	}
	custom_effect_tooltip = sqeeky_hooves_stats_tp
	add_field_marshal_role = {
		character = CRY_sombra

		traits = { brilliant_strategist organizer king_of_monsters pony_race_trait }
		skill = 5
		attack_skill = 5
		defense_skill = 1
		planning_skill = 5
		logistics_skill = 5
		visible = {
			has_government = fascism
			has_country_leader = {
				character = CRY_sombra
				ruling_only = yes
			}
		}
	}
	custom_effect_tooltip = king_sombra_stats_tp

	remove_opinion_modifier = { target = CHN modifier = CHN_embargo }
	CHN = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
	remove_opinion_modifier = { target = CHN modifier = mortal_enemies }
	CHN = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
	remove_opinion_modifier = {
		target = NLR
		modifier = cry_betrayal
	}
	set_global_flag = sombra_returned
	add_opinion_modifier = { target = event_target:equestria modifier = mortal_enemies }
	reverse_add_opinion_modifier = { target = event_target:equestria modifier = mortal_enemies }
	add_opinion_modifier = { target = EQS modifier = mortal_enemies }
	reverse_add_opinion_modifier = { target = EQS modifier = mortal_enemies }
	add_opinion_modifier = { target = event_target:equestria modifier = CHN_embargo }
	reverse_add_opinion_modifier = { target = event_target:equestria modifier = CHN_embargo }
	add_opinion_modifier = { target = EQS modifier = CHN_embargo }
	reverse_add_opinion_modifier = { target = EQS modifier = CHN_embargo }
}
CRY_reduce_sombra_threat = {
	if = {
		limit = {
			has_idea = CRY_sombra_threat
		}
		swap_ideas = {
			remove_idea = CRY_sombra_threat
			add_idea = CRY_sombra_threat2
		}
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat2
		}
		swap_ideas = {
			remove_idea = CRY_sombra_threat2
			add_idea = CRY_sombra_threat3
		}
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat3
		}
		swap_ideas = {
			remove_idea = CRY_sombra_threat3
			add_idea = CRY_sombra_threat4
		}
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat4
		}
		remove_ideas = CRY_sombra_threat4
	}
}
CRY_remove_sombra_threat = {
	if = {
		limit = {
			has_idea = CRY_sombra_threat
		}
		remove_ideas = CRY_sombra_threat
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat2
		}
		remove_ideas = CRY_sombra_threat2
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat3
		}
		remove_ideas = CRY_sombra_threat3
	}
	else_if = {
		limit = {
			has_idea = CRY_sombra_threat4
		}
		remove_ideas = CRY_sombra_threat4
	}
}
CRY_cult_visibility_check = {
	if = {
		limit = {
			check_variable = {
				CRY_cult_visibility > 1
			}
			NOT = {
				has_country_flag = CRY_you_got_arrested
			}
		}
		set_country_flag = CRY_you_got_arrested
		hidden_effect = {
			country_event = {
				id = crystalsombra.8 # bad end for the event chain
				hours = 4
			}	
		}
	}
}