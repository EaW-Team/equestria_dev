### Some blocks of code from on_actions have been moved here for readability and reusability

apply_cosmetic_tags_on_puppet = {
	if = {
		limit = {
			FROM = {
				tag = event_target:griffonian_empire
				NOT = { has_country_flag = have_regular_puppets }
			}
			is_feudal_vassal = yes
		}
		country_event = griffonian.1
		break = yes
	}
	if = {
		limit = {
			FROM = {
				tag = event_target:solar_empire
				has_government = fascism
			}
		}
		if = {
			limit = { original_tag = CRY }
			FROM = {
				set_country_flag = SOL_twilight_governor
				set_autonomy = { target = ROOT autonomy_state = autonomy_reichskommissariat }
			}
			set_cosmetic_tag = CRY_SOL
			add_autonomy_ratio = { value = -0.20 }
			set_country_flag = CRY_solar_governorship
			load_focus_tree = crystal_empire_solar_focus
			set_party_name = { ideology = fascism long_name = SOL_fascism_party_long name = SOL_fascism_party }
			if = {
				limit = {
					NOT = { has_global_flag = SOL_twilight_converted }
					has_global_flag = SOL_chose_EQC_leader
					any_other_country = {
						NOT = { has_country_leader = { ruling_only = yes name = "Arcane Nova" } }
					}
				}
				create_country_leader = {
					name = "Arcane Nova"
					#desc = "TWILIGHT_DESC"
					picture = "ArcaneNova.tga"
					expire = "1965.1.1"
					ideology = falangism
					traits = {
					}
				}
				else = {
					if = {
						limit = {
							has_global_flag = SOL_twilight_converted
						}
						create_country_leader = {
							name = "Grand Inquisitor Sunrise Sparkle"
							#desc = "TWILIGHT_DESC"
							picture = "TwilightSunrise.tga"
							expire = "1965.1.1"
							ideology = falangism
							traits = {
								lady_inquisitor
							}
						}
						else = {
							create_country_leader = {
								name = "Nameless Busybody"
								expire = "1965.1.1"
								ideology = falangism
								traits = {
								}
							}
						}
					}
				}
			}
			break = yes
		}
		if = {
			limit = { original_tag = EQC }
			create_country_leader = {
				name = "Arcane Nova"
				picture = "ArcaneNova.tga"
				expire = "1965.1.1"
				ideology = falangism
				traits = {
				}
			}
			set_party_name = { ideology = fascism long_name = EQC_SOL_fascism_party_long name = EQC_SOL_fascism_party }
			if = {
				limit = {
					has_country_flag = EQC_destined_to_be_an_RK
				}
				FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_reichskommissariat } }
			}
			load_focus_tree = eqc_sol_focus
			set_global_flag = SOL_chose_EQC_leader
			set_province_name = { id = 10005 name = "Sunset"}
			break = yes
		}
		if = {
			limit = { original_tag = PLB }
			country_event = solarempire.1000
			break = yes
		}
		if = {
			limit = { original_tag = GRF }
			country_event = solarempire.1001
			break = yes
		}
		if = {
			limit = { original_tag = PNG }
			country_event = solarempire.1002
			break = yes
		}
		if = {
			limit = { original_tag = STL }
			country_event = solarempire.1003
			break = yes
		}
		if = {
			limit = { original_tag = BUF }
			country_event = solarempire.1004
			break = yes
		}
		if = {
			limit = { original_tag = DRG }
			country_event = solarempire.1005
			break = yes
		}
		if = {
			limit = { original_tag = GFF }
			country_event = solarempire.1006
			break = yes
		}
		if = {
			limit = { original_tag = OLE }
			country_event = solarempire.1008
			break = yes
		}
		if = {
			limit = { original_tag = BAL }
			country_event = solarempire.1009
			break = yes
		}
		if = {
			limit = { original_tag = CES }
			country_event = solarempire.1010
			break = yes
		}
		if = {
			limit = { original_tag = JUN }
			country_event = solarempire.1011
			break = yes
		}
		if = {
			limit = { original_tag = SCS }
			country_event = solarempire.1012
			break = yes
		}
		if = {
			limit = { original_tag = STG }
			country_event = solarempire.1013
			break = yes
		}
		if = {
			limit = { original_tag = JAK }
			country_event = solarempire.1015
			break = yes
		}
		if = {
			limit = { original_tag = CES }
			country_event = solarempire.1010
			break = yes
		}
		if = {
			limit = { original_tag = CHN }
			country_event = solarempire.1016
			break = yes
		}
		if = {
			limit = { original_tag = YAK }
			country_event = solarempire.1017
			break = yes
		}
	}
	if = {
		limit = {
			FROM = {
				original_tag = NLR
				has_government = fascism
			}
		}
		if = {
			limit = { original_tag = EQC }
			set_country_flag = EQC_NLR_LoyalBat
			set_party_name = { ideology = fascism long_name = EQC_bat_supporters_fash name = EQC_bat_supporters_fash }
			create_country_leader = {
				name = "Flawless Glow"
				desc = "POLITICS_FLAWLESS_GLOW"
				picture = "FlawlessGlow.tga"
				expire = "1965.1.1"
				ideology = fascism_ideology
				id = 717
				traits = {
				}
			}
			load_focus_tree = eqc_nlr_focus
			break = yes
		}
		if = {
			limit = { original_tag = PLB }
			country_event = { id = lunas.900 }
			break = yes
		}
		if = {
			limit = { original_tag = GRF }
			country_event = { id = lunas.902 }
			break = yes
		}
		if = {
			limit = { original_tag = PNG }
			country_event = { id = lunas.901 }
			break = yes
		}
		if = {
			limit = { original_tag = STL }
			country_event = { id = lunas.903 }
			break = yes
		}
		if = {
			limit = { original_tag = BUF }
			country_event = { id = lunas.904 }
			break = yes
		}
		if = {
			limit = { original_tag = DRG }
			country_event = { id = lunas.905 }
			break = yes
		}
		if = {
			limit = { original_tag = GFF }
			country_event = { id = lunas.906 }
			break = yes
		}
		if = {
			limit = { original_tag = OLE }
			country_event = { id = lunas.911 }
			break = yes
		}
		if = {
			limit = { original_tag = BAL }
			country_event = { id = lunas.912 }
			break = yes
		}
		if = {
			limit = { original_tag = CES }
			country_event = { id = lunas.913 }
			break = yes
		}
		if = {
			limit = { original_tag = JUN }
			country_event = { id = lunas.914 }
			break = yes
		}
		if = {
			limit = { original_tag = SCS }
			country_event = { id = lunas.916 }
			break = yes
		}
		if = {
			limit = { original_tag = STG }
			country_event = { id = lunas.917 }
			break = yes
		}
		if = {
			limit = { original_tag = CRY }
			country_event = { id = lunas.918 }
			break = yes
		}
		if = {
			limit = { original_tag = JAK }
			country_event = { id = lunas.919 }
			break = yes
		}
		if = {
			limit = { original_tag = CHN }
			country_event = { id = lunas.920 }
			break = yes
		}
		if = {
			limit = { original_tag = YAK }
			country_event = { id = lunas.921 }
			break = yes
		}
	}
	if = {
		limit = {
			FROM = {
				original_tag = CHN
				has_government = fascism
			}
		}
		if = {
			limit = { original_tag = OLE }
			country_event = { id = olenia.718 }
			break = yes
		}
		if = {
			limit = { original_tag = PLB }
			country_event = { id = changelings.900 }
			break = yes
		}
		if = {
			limit = { original_tag = GRF }
			country_event = { id = changelings.902 }
			break = yes
		}
		if = {
			limit = { original_tag = PNG }
			country_event = { id = changelings.901 }
			break = yes
		}
		if = {
			limit = { original_tag = STL }
			country_event = { id = changelings.903 }
			break = yes
		}
		if = {
			limit = { original_tag = BUF }
			country_event = { id = changelings.904 }
			break = yes
		}
		if = {
			limit = { original_tag = DRG }
			country_event = { id = changelings.905 }
			break = yes
		}
		if = {
			limit = { original_tag = GFF }
			country_event = { id = changelings.906 }
			break = yes
		}
		if = {
			limit = { original_tag = GFF }
			country_event = { id = changelings.906 }
			break = yes
		}
		if = {
			limit = { original_tag = OLE }
			country_event = { id = olenia.718 }
			break = yes
		}
		if = {
			limit = { original_tag = CRY }
			country_event = { id = crystalemp.23 }
			break = yes
		}
		if = {
			limit = { original_tag = EQS }
			country_event = { id = equestriachn.3 }
			break = yes
		}
		if = {
			limit = { original_tag = STG }
			country_event = { id = stalliongrad.98 }
			break = yes
		}
		if = {
			limit = { original_tag = YAK }
			country_event = { id = yakistan.12 }
			break = yes
		}
		if = {
			limit = { original_tag = SCS }
			set_cosmetic_tag = CHN_confpuppet
			break = yes
		}
		if = {
			limit = { original_tag = JUN }
			set_cosmetic_tag = JUN_CHN
			break = yes
		}
		if = {
			limit = { original_tag = BAL }
			set_cosmetic_tag = BAL_CHN
			break = yes
		}
		if = {
			limit = { original_tag = CES }
			set_cosmetic_tag = CES_CHN
			break = yes
		}
		if = {
			limit = { original_tag = MAN }
			set_cosmetic_tag = MAN_CHN
			CHN = {
				set_country_flag = released_manehattan_puppet
			}
			break = yes
		}
		if = {
			limit = { original_tag = JAK }
			country_event = { id = yakistan.13 }
			break = yes
		}
	}
	if = {
		limit = { original_tag = STG }
		if = {
			limit = {
				FROM = { has_government = democratic }
			}
			ROOT = {
				drop_cosmetic_tag = yes
				set_cosmetic_tag = STG_EQS
				load_focus_tree = generic_focus
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { NOT = { tag = EQS } has_government = democratic }
			}
			ROOT = {
				drop_cosmetic_tag = yes
				set_cosmetic_tag = STG_DEM
				load_focus_tree = generic_focus
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { has_government = fascism }
			}
			ROOT = {
				drop_cosmetic_tag = yes
				set_cosmetic_tag = STG_PAGAN
				load_focus_tree = generic_focus
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { has_government = neutrality }
			}
			ROOT = {
				drop_cosmetic_tag = yes
				set_cosmetic_tag = STG_MONARCHY
				load_focus_tree = generic_focus
			}
			break = yes
		}
		break = yes
	}
	if = {
		limit = { tag = GRW }
		if = {
			limit = {
				FROM = { tag = BAN }
			}
			ROOT = {
				set_cosmetic_tag = GRW_BAN
				load_focus_tree = generic_focus
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { NOT = { tag = BRF tag = BAN } has_government = fascism }
			}
			ROOT = {
				set_cosmetic_tag = GRW_FASHPUPPET
				load_focus_tree = generic_focus
			}
			break = yes
		}
		if = {
			limit = {
				FROM = { NOT = { tag = BRF tag = BAN } NOT = { has_government = fascism } }
			}
			ROOT = {
				set_cosmetic_tag = GRW_PUPPET
				load_focus_tree = generic_focus
			}
			break = yes
		}
	}
	if = {
		limit = {
			FROM = {
				original_tag = CRY
				has_government = fascism
				has_country_leader = { ruling_only = yes name = "King Sombra" }
			}
		}
		if = {
			limit = { original_tag = EQS }
			country_event = equestria.56
			break = yes
		}
	}
}

CRY_check_for_Sombra_when_released = {
	if = {
		limit = {
			original_tag = CRY
		}
		country_event = crysom.48
		if = {
			limit = {
				FROM = {
					original_tag = EQS
					has_government = democratic
				}
			}
			country_event = crysom.40
		}
		if = {
			limit = {
				FROM = { has_government = fascism }
			}
			kill_country_leader = yes
		}
	}
}

CRY_process_when_puppeted_by_EQS = {
	if = {
		limit = { original_tag = CRY }
		if = {
			limit = { FROM = { has_government = democratic } }
			CRY_restore_establishment = yes
		}
		if = {
			limit = {
				NOT = {
					has_idea = equestrian_overlord
					has_idea = equestrian_overlord2
					has_idea = equestrian_overlord3
				}
			}
			if = {
				limit = { has_completed_focus = CRY_subordination }
				add_ideas = equestrian_overlord3
				else = {
					if = {
						limit = { has_completed_focus = CRY_eqsengineers }
						add_ideas = equestrian_overlord2
						else = { add_ideas = equestrian_overlord }
					}
				}
			}
		}
		event_target:equestria = {
			remove_opinion_modifier = { target = ROOT modifier = CHN_embargo }
			remove_opinion_modifier = { target = ROOT modifier = cry_refused_demmands }
			remove_opinion_modifier = { target = ROOT modifier = enemies }
			remove_opinion_modifier = { target = ROOT modifier = executed_royalty }
		}
		EQC = {
			remove_opinion_modifier = { target = ROOT modifier = CHN_embargo }
			remove_opinion_modifier = { target = ROOT modifier = cry_refused_demmands }
			remove_opinion_modifier = { target = ROOT modifier = enemies }
		}
	}
}

CRY_restore_establishment = {
	if = {
		limit = {
			has_government = democratic
			NOT = {
				has_country_leader = { ruling_only = yes name = "Princess Mi Amore Cadenza" }
				has_country_leader = { ruling_only = yes name = "Princess Twilight Sparkle" }
				has_country_leader = { ruling_only = yes name = "Princess Flurry Heart" }
			}
			OR = {
				AND = {
					OR = {
						has_global_flag = free_the_old_royalty
						has_global_flag = continue_imprisonment
					}
				}
				AND = {
					has_global_flag = royalty_executed
					NOT = { country_exists = event_target:solar_empire }
					NOT = { has_global_flag = SOL_twilight_converted }
				}
			}
			has_global_flag = sombra_returned
		}
		country_event = { id = crysom.40 days = 1 }
	}
}

CHN_remove_pony_opinion_maluses = {
	if = {
		limit = { tag = CHN }
		remove_opinion_modifier = { target = FROM modifier = CHN_embargo }
		FROM = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
		remove_opinion_modifier = { target = CRY modifier = CHN_embargo }
		CRY = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
		remove_opinion_modifier = { target = EQC modifier = CHN_embargo }
		EQC = { remove_opinion_modifier = { target = ROOT modifier = CHN_embargo } }
		remove_opinion_modifier = { target = FROM modifier = mortal_enemies }
		FROM = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
		remove_opinion_modifier = { target = CRY modifier = mortal_enemies }
		CRY = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
		remove_opinion_modifier = { target = EQC modifier = mortal_enemies }
		EQC = { remove_opinion_modifier = { target = ROOT modifier = mortal_enemies } }
	}
}

CHN_demilitarise = {
	if = {
		limit = {
			FROM = {
				OR = {
					original_tag = EQS
					original_tag = CRY
				}
				has_government = democratic
			}
		}
		FROM = {
			country_event = { id = changelings.39 days = 1 }
		}
	}
}

EQS_force_OLE_release_when_puppeting_CHN = {
	if = {
		limit = {
			FROM = { 
				original_tag = EQS
				has_government = democratic
				is_ai = yes
			}
			any_owned_state = {
				is_core_of = OLE
			}
		}
		if = {
			limit = { NOT = { country_exists = OLE } }
			release = OLE
			FROM = { puppet = OLE }
		}
		if = {
			limit = { OLE = { OR = { is_in_faction_with = FROM is_subject_of = FROM } } }
			FROM = {
				every_owned_state = {
					limit = { is_core_of = OLE }
					OLE = { transfer_state = PREV }
				}
			}
		}
	}
}

GRI_remove_RIV_opinion_modifiers = {
	if = {
		limit = {
			original_tag = GRI
		}
		RCT = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		LCT = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		DEP = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		WIT = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		BAR = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		FRE = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		NIM = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		BAK = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
		DMT = { remove_opinion_modifier = { target = GRI modifier  = RIV_hates_the_empire } }
	}	
}

LUS_load_commie_focus = {
	if = {
		limit = {
			FROM = { has_government = communism }
			ROOT = { original_tag = LUS }
		}
		ROOT = {
			load_focus_tree = Lushi_peasants_focus
			remove_ideas = {
				feudalism
				lack_of_scientists2
			}
		}
	}
}

FAT_add_puppet_ideas = {
	if = {
		limit = {
			FROM = { tag = FAT }
			is_griffon_continent_griffon_country = yes
		}
		if = {
			limit = {
				FROM = { has_idea = FAT_decentralized_republic_idea }
			}
			if = {
				limit = { has_dlc = "Together for Victory" }
				FROM = { set_autonomy = { target = ROOT autonomy_state = autonomy_integrated_puppet } }
				add_ideas = FAT_decentralized_republic_puppet
				add_to_tech_sharing_group = FAT_research_group
				else = {
					add_ideas = FAT_decentralized_republic_puppet_no_TfV
				}
			}
		}
		if = {
			limit = {
				has_dlc = "Together for Victory" 
				FROM = { has_idea = FAT_griffonian_alliance_idea }
			}
			add_to_tech_sharing_group = FAT_research_group
		}
		if = {
			limit = { original_tag = SRS }
			country_event = griffonRepublic.100
		}
	}
}

JUN_handle_puppet = {
	if = {
		limit = {
			original_tag = JUN
			OR = {
				AND = {
					NOT = { has_completed_focus = JUN_alone }
					OR = {
						has_country_leader = { ruling_only = yes name = "Caballeron" }
						FROM = { AND = { original_tag = CHN has_government = fascism } }
						FROM = { AND = { original_tag = EQS has_government = democratic } }
					}
				}
				AND = {
					FROM = {
						OR = {
							original_tag = EQS
							original_tag = CHN
						}
						is_ai = yes
					}
				}
			}
		}
		FROM = { country_event = jungle.17 }
	}
}

JER_complete_focuses_based_on_overlord = {
	if = {
		limit = {
			tag = JER
		}
		if = {
			limit = {
				OR = {
					has_government = democratic
					has_government = communism
				}
				NOT = { has_country_flag = JER_AWPR_wins }
				FAT = { has_unit_leader = 75654 }
			}
			FAT = { country_event = griffonRepublic.84 }
		}
		if = {
			limit = {
				has_government = communism
				NOT = {
					has_completed_focus = JER_election_radicals
					has_completed_focus = JER_election_moderates
				}
			}
			complete_national_focus = JER_election_moderates
		}
		if = {
			limit = {
				has_government = democratic
				NOT = {
					has_completed_focus = JER_election_democracy
				}
			}
			complete_national_focus = JER_election_democracy
		}
		if = {
			limit = {
				has_government = neutrality
				NOT = {
					has_completed_focus = JER_absolute_rule
				}
			}
			complete_national_focus = JER_absolute_rule
		}
		if = {
			limit = {
				has_government = fascism
				NOT = {
					has_completed_focus = JER_fascist_coup
				}
			}
			set_country_flag = JER_fash_bypass
			complete_national_focus = JER_fascist_coup
			clr_country_flag = JER_fash_bypass
		}
	}
}

handle_twilight_escaping = {
	if = {
		limit = {
			has_country_flag = EQS_CRY_has_twilight
			FROM = { tag = event_target:solar_empire }
		}
		if = {
			limit = {
				tag = event_target:equestria
			}
			FROM = { country_event = solarempire.22 }
			else = {
				if = {
					limit = {
						original_tag = CRY
					}
					FROM = { news_event = solarempire.26 }
				}
			}
		}
	}
}

AI_puppet_to_annex = {
	if = {
		limit = { tag = DED }
		FROM = {
			annex_country = { target = ROOT }
			country_event = { id = deadempire.29 days = 1 }
		}
	}
	if = {
		limit = { 
			OR = {
				AND = { FROM = { original_tag = NLR } original_tag = EQS }
				AND = { FROM = { original_tag = EQS } original_tag = NLR }
			}
		}
		FROM = { annex_country = { target = ROOT } }
	}
	if = {
		limit = {
			FROM = { tag = GRW }
			ROOT = { tag = BRF }
		}
		FROM = { annex_country = { target = ROOT } }
	}
	if = {
		limit = {
			FROM = { tag = BRF }
			ROOT = { tag = GRW }
		}
		FROM = { annex_country = { target = ROOT } }
	}
	if = {
		limit = {
			FROM = {
				is_ai = yes
				original_tag = GRF
			}
			ROOT = {
				original_tag = GFF
			}
		}
		FROM = { annex_country =  { target = ROOT } }
	}
	if = {
		limit = {
			FROM = {
				is_ai = yes
				is_eqs_civil_war_tag = yes
				NOT = { original_tag = JUN }
			}
			ROOT = {
				is_ai = yes
				is_eqs_civil_war_tag = yes
				NOT = { original_tag = JUN }
			}
		}
		FROM = { annex_country =  { target = ROOT } }
	}
	if = {
		limit = {
			FROM = {
				is_ai = yes
				original_tag = JER
			}
			OR = {
				original_tag = HEL
				original_tag = FLO
				original_tag = POM
				original_tag = AET
				original_tag = FEZ
				original_tag = JEB
				original_tag = JES
				original_tag = JRR
				original_tag = VIN
				original_tag = JFT
			}
		}
		FROM = { annex_country = { target = ROOT transfer_troops = yes } }
		break = yes
	}
	if = {
		limit = {
			FROM = {
				is_ai = yes
				OR = {
					original_tag = JEB
					original_tag = JES
					original_tag = JRR
					original_tag = VIN
					original_tag = JFT
				}
			}
			original_tag = JER
		}
		FROM = { annex_country = { target = ROOT transfer_troops = yes } }
		break = yes
	}
}

GRY_load_focus_tree_on_puppet = {
	load_focus_tree = GRY_focus
	if = {
		limit = {
			ROOT = {
				has_government = communism
			}
		}
		complete_national_focus = GRY_first_universale
			create_country_leader = {
				name = "Cornilo Khurshevich"
				desc = ""
				picture = "Cornilo_Khursevich.tga"
				expire = "1965.1.1"
				ideology = leninism
				traits = {
				
				}
			}
	}
	else_if = {
		limit = {
			ROOT = {
				has_government = democratic
			}
		}
		complete_national_focus = GRY_volnoye
		
		create_country_leader = {
			name = "Borad Grifnitsky"
			desc = ""
			picture = "Grifninsky.tga"
			expire = "1965.1.1"
			ideology = liberalism
			traits = {

			}
		}
	}
	else_if = {
		limit = {
			ROOT = {
				has_government = fascism
			}
		}
		complete_national_focus = GRY_stronger_together
		create_country_leader = {
			name = "Yeven Krawvelets"

			picture = "Yeven_Krawvelets.tga"
			expire = "1965.1.1"
			ideology = rexism
			traits = {

			}
		}
	}
}

CHN_handle_fascist_communist_overlord = {
	if = {
		limit = { FROM = { has_government = fascism } }
		country_event = { id = solarempire.906 }
	}
	if = {
		limit = { FROM = { has_government = communism } }
		complete_national_focus = seize_production
		complete_national_focus = equality_for_all_CHN
		complete_national_focus = battleforthehives_chn
	}
}

transfer_society_and_science_ideas_when_released = {
	if = {
		limit = {
			FROM = {
				NOT = { has_idea = modern_society }
			}
		}
		hidden_effect = { FROM = { ROOT = { transfer_society_ideas = yes } } }
		else = {
			hidden_effect = { add_ideas = modern_society }
		}
	}
	if = {
		limit = {
			FROM = {
				NOT = { has_idea = proper_science_base }
			}
		}
		hidden_effect = { FROM = { ROOT = { transfer_science_ideas = yes } } }
		else = {
			hidden_effect = { add_ideas = proper_science_base }
		}
	}
}

handle_generic_griffon_ideas_on_govt_change = {
	if = {
		limit = {
			OR = {
				has_idea = griffon_neutrality_support_idea
				has_idea = griffon_monarchy_support_idea
			}
			NOT = { has_government = neutrality }
		}
		remove_ideas = { griffon_monarchy_support_idea griffon_neutrality_support_idea }
	}
	if = {
		limit = {
			OR = {
				has_idea = griffon_monarchy_dem_support_idea
				has_idea = griffon_harmony_support_idea
			}
			NOT = { has_government = democratic }
		}
		remove_ideas = { griffon_monarchy_dem_support_idea griffon_harmony_support_idea }
	}
	if = {
		limit = {
			OR = {
				has_idea = griffon_fascism_support_idea
				has_idea = griffon_monarchy_fas_support_idea
			}
			NOT = { has_government = fascism }
		}
		remove_ideas = { griffon_monarchy_fas_support_idea griffon_fascism_support_idea }
	}
	if = {
		limit = {
			has_idea = griffon_communism_support_idea
			NOT = { has_government = communism }
		}
		remove_ideas = griffon_communism_support_idea
	}
}

handle_op_paperclip = {
	every_state = {
		limit = {
			is_core_of = FROM
		}
		add_to_variable = { FROM.industry_value = industrial_complex_level }
		add_to_variable = { FROM.industry_value = arms_factory_level }
	}
	every_state = {
		limit = {
			is_core_of = FROM
		}
		set_state_flag = op_paperclip_state
		set_variable = { previous_owner = FROM.id }
		set_variable = { previous_owner_industry_value = FROM.industry_value }
	}
	FROM = { clear_variable = industry_value }
	country_event = oppaperclip.1
}

set_have_regular_puppets = {
	if = {
		limit = {
			is_feudal_vassal = yes
			FROM = { has_country_flag = have_regular_puppets }
		}
		set_country_flag = have_regular_puppets
	}
}